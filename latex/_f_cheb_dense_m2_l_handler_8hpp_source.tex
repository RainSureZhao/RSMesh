\doxysection{FCheb\+Dense\+M2\+LHandler.\+hpp}
\hypertarget{_f_cheb_dense_m2_l_handler_8hpp_source}{}\label{_f_cheb_dense_m2_l_handler_8hpp_source}\index{third\_party/ScalFMM/include/ScalFMM/Kernels/Chebyshev/FChebDenseM2LHandler.hpp@{third\_party/ScalFMM/include/ScalFMM/Kernels/Chebyshev/FChebDenseM2LHandler.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ See\ LICENCE\ file\ at\ project\ root}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#ifndef\ FCHEBDENSEM2LHANDLER\_HPP}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#define\ FCHEBDENSEM2LHANDLER\_HPP}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <numeric>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <stdexcept>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <sstream>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <fstream>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <typeinfo>}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}Utils/FBlas.hpp"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}Utils/FTic.hpp"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}FChebTensor.hpp"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00042\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keywordtype}{int}\ ORDER,\ \textcolor{keyword}{class}\ MatrixKernelClass>}
\DoxyCodeLine{00043\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_f_cheb_dense_m2_l_handler}{FChebDenseM2LHandler}}\ :\ \mbox{\hyperlink{class_f_no_copyable}{FNoCopyable}}}
\DoxyCodeLine{00044\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keyword}{enum}\ \{order\ =\ ORDER,}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nnodes\ =\ \mbox{\hyperlink{struct_tensor_traits}{TensorTraits<ORDER>::nnodes}},}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ninteractions\ =\ 316\};\ \textcolor{comment}{//\ 7\string^3\ -\/\ 3\string^3\ (max\ num\ cells\ in\ far-\/field)}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ MatrixKernel;}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ FReal\ *C;}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ rank;\ \ \ \textcolor{comment}{//<!\ truncation\ rank,\ satisfies\ @p\ epsilon}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ std::string\ getFileName()}
\DoxyCodeLine{00056\ \ \ \ \ \{}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ precision\_type\ =\ (\textcolor{keyword}{typeid}(FReal)==\textcolor{keyword}{typeid}(\textcolor{keywordtype}{double})\ ?\ \textcolor{charliteral}{'d'}\ :\ \textcolor{charliteral}{'f'});}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ std::stringstream\ stream;}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ stream\ <<\ \textcolor{stringliteral}{"{}m2l\_k"{}}<<\ MatrixKernelClass::getID()\ <<\ \textcolor{stringliteral}{"{}\_"{}}\ <<\ precision\_type}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\_o"{}}\ <<\ order\ <<\ \textcolor{stringliteral}{"{}.bin"{}};}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ stream.str();}
\DoxyCodeLine{00062\ \ \ \ \ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00066\ \ \ \ \ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler}{FChebDenseM2LHandler}}(\textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ inMatrixKernel,\ \textcolor{keyword}{const}\ FReal\ dummy)}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ :\ MatrixKernel(inMatrixKernel),\ C(\textcolor{keyword}{nullptr}),\ rank(0)}
\DoxyCodeLine{00068\ \ \ \ \ \{\}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler}{\string~FChebDenseM2LHandler}}()}
\DoxyCodeLine{00071\ \ \ \ \ \{}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (C\ !=\ \textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}\ []\ C;}
\DoxyCodeLine{00073\ \ \ \ \ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_a3af0dd6ce51554688af362c19892cd0f}{ComputeAndCompressAndSet}}()}
\DoxyCodeLine{00079\ \ \ \ \ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ measure\ time}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_tic}{FTic}}\ time;\ time.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}();}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ check\ if\ aready\ set}}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (C)\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Full\ M2L\ operator\ already\ set"{}});}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ rank\ =\ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_a830fc2b48b8a010446297f7acf199b7a}{Compute}}(MatrixKernel,\ C);}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ sizeM2L\ =\ 343*rank*rank*\textcolor{keyword}{sizeof}(FReal);}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ write\ info}}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Compute\ and\ set\ full\ M2L\ operators\ ("{}}\ <<\ long(sizeM2L)\ <<\ \textcolor{stringliteral}{"{}\ B)\ in\ "{}}}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ time.\mbox{\hyperlink{class_f_tic_ade3afdb1aa198635ebbc5ee8b7f4f081}{tacAndElapsed}}()\ <<\ \textcolor{stringliteral}{"{}sec."{}}\ \ <<\ std::endl;}
\DoxyCodeLine{00091\ \ \ \ \ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_a4489104f2e45f774368023edf1f66076}{ComputeAndStoreInBinaryFileAndReadFromFileAndSet}}()}
\DoxyCodeLine{00097\ \ \ \ \ \{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_a8cb65f5bf8291ed25dd2d7ed2a91e0d5}{FChebDenseM2LHandler<FReal,\ ORDER,MatrixKernelClass>::ComputeAndStoreInBinaryFile}}();}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ this-\/>\mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_a31b0aef6f1253a17761d0b3c814b65e3}{ReadFromBinaryFileAndSet}}();}
\DoxyCodeLine{00100\ \ \ \ \ \}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_a830fc2b48b8a010446297f7acf199b7a}{Compute}}(\textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ MatrixKernel,\ FReal*\ \&C);}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_a8cb65f5bf8291ed25dd2d7ed2a91e0d5}{ComputeAndStoreInBinaryFile}}(\textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ MatrixKernel);}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_a31b0aef6f1253a17761d0b3c814b65e3}{ReadFromBinaryFileAndSet}}();}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_af18efc0f76cf7a75e352a8c5e82cc810}{getRank}}()\textcolor{keyword}{\ const\ }\{\textcolor{keywordflow}{return}\ rank;\}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00139\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_ac660993a7200601182aaabcb5c66ccdc}{applyC}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ transfer[3],\ FReal\ CellWidth,}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ *\textcolor{keyword}{const}\ Y,\ FReal\ *\textcolor{keyword}{const}\ X)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00141\ \textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ =\ (transfer[0]+3)*7*7\ +\ (transfer[1]+3)*7\ +\ (transfer[2]+3);}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keyword}{const}\ FReal\ scale(MatrixKernel-\/>getScaleFactor(CellWidth));}
\DoxyCodeLine{00145\ \ \ \ \ FBlas::gemva(rank,\ rank,\ scale,\ C\ +\ idx*rank*rank,\ \textcolor{keyword}{const\_cast<}FReal*\textcolor{keyword}{>}(Y),\ X);}
\DoxyCodeLine{00146\ \ \ \}}
\DoxyCodeLine{00147\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_ac660993a7200601182aaabcb5c66ccdc}{applyC}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx,\ FReal\ CellWidth,}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ *\textcolor{keyword}{const}\ Y,\ FReal\ *\textcolor{keyword}{const}\ X)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00149\ \textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keyword}{const}\ FReal\ scale(MatrixKernel-\/>getScaleFactor(CellWidth));}
\DoxyCodeLine{00151\ \ \ \ \ FBlas::gemva(rank,\ rank,\ scale,\ C\ +\ idx*rank*rank,\ \textcolor{keyword}{const\_cast<}FReal*\textcolor{keyword}{>}(Y),\ X);}
\DoxyCodeLine{00152\ \ \ \}}
\DoxyCodeLine{00153\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_ac660993a7200601182aaabcb5c66ccdc}{applyC}}(FReal\ CellWidth,}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ *\textcolor{keyword}{const}\ Y,\ FReal\ *\textcolor{keyword}{const}\ X)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00155\ \textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keyword}{const}\ FReal\ scale(MatrixKernel-\/>getScaleFactor(CellWidth));}
\DoxyCodeLine{00157\ \ \ \ \ FBlas::gemva(rank,\ rank\ *\ 343,\ scale,\ C,\ \textcolor{keyword}{const\_cast<}FReal*\textcolor{keyword}{>}(Y),\ X);}
\DoxyCodeLine{00158\ \ \ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \};}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00168\ \textcolor{comment}{//\ definition\ ////////////////////////////////////////////////////////}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keywordtype}{int}\ ORDER,\ \textcolor{keyword}{class}\ MatrixKernelClass>}
\DoxyCodeLine{00177\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}}
\DoxyCodeLine{00178\ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_a830fc2b48b8a010446297f7acf199b7a}{FChebDenseM2LHandler<FReal,\ ORDER,\ MatrixKernelClass>::Compute}}(\textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ MatrixKernel,\ FReal*\ \&C)}
\DoxyCodeLine{00179\ \{}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{comment}{//\ allocate\ memory\ and\ store\ compressed\ M2L\ operators}}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keywordflow}{if}\ (C)\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Full\ M2L\ operators\ are\ already\ set"{}});}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{comment}{//\ interpolation\ points\ of\ source\ (Y)\ and\ target\ (X)\ cell}}
\DoxyCodeLine{00184\ \ \ \ \ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ X[nnodes],\ Y[nnodes];}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{comment}{//\ set\ roots\ of\ target\ cell\ (X)}}
\DoxyCodeLine{00186\ \ \ \ \ \mbox{\hyperlink{class_f_interp_tensor_ac8107c468326e9c786873c23fe2e8766}{FChebTensor<FReal,\ order>::setRoots}}(\mbox{\hyperlink{class_f_point}{FPoint<FReal>}}(0.,0.,0.),\ FReal(2.),\ X);}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{comment}{//\ allocate\ memory\ and\ compute\ 316\ m2l\ operators}}
\DoxyCodeLine{00189\ \ \ \ \ FReal\ *\_C;}
\DoxyCodeLine{00190\ \ \ \ \ \_C\ =\ \textcolor{keyword}{new}\ FReal\ [nnodes*nnodes\ *\ ninteractions];}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ counter\ =\ 0;}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=-\/3;\ i<=3;\ ++i)\ \{}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=-\/3;\ j<=3;\ ++j)\ \{}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k=-\/3;\ k<=3;\ ++k)\ \{}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(i)>1\ ||\ abs(j)>1\ ||\ abs(k)>1)\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ roots\ of\ source\ cell\ (Y)}}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ cy(FReal(2.*i),\ FReal(2.*j),\ FReal(2.*k));}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_interp_tensor_ac8107c468326e9c786873c23fe2e8766}{FChebTensor<FReal,\ order>::setRoots}}(cy,\ FReal(2.),\ Y);}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ evaluate\ m2l\ operator}}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<nnodes;\ ++n)}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ m=0;\ m<nnodes;\ ++m)}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_C[counter*nnodes*nnodes\ +\ n*nnodes\ +\ m]}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ MatrixKernel-\/>evaluate(X[m],\ Y[n]);}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ increment\ interaction\ counter}}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ counter++;}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00209\ \ \ \ \ \}}
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{keywordflow}{if}\ (counter\ !=\ ninteractions)}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Number\ of\ interactions\ must\ correspond\ to\ 316"{}});}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{comment}{//\ svd\ compression\ of\ M2L}}
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ rank\ =\ nnodes;}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{comment}{//\ store\ C}}
\DoxyCodeLine{00217\ \ \ \ \ counter\ =\ 0;}
\DoxyCodeLine{00218\ \ \ \ \ C\ =\ \textcolor{keyword}{new}\ FReal\ [343\ *\ rank*rank];}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=-\/3;\ i<=3;\ ++i)}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=-\/3;\ j<=3;\ ++j)}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k=-\/3;\ k<=3;\ ++k)\ \{}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx\ =\ (i+3)*7*7\ +\ (j+3)*7\ +\ (k+3);}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(i)>1\ ||\ abs(j)>1\ ||\ abs(k)>1)\ \{}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::copy(rank*rank,\ \_C\ +\ counter*rank*rank,\ C\ +\ idx*rank*rank);}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ counter++;}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ FBlas::setzero(rank*rank,\ C\ +\ idx*rank*rank);}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{keywordflow}{if}\ (counter\ !=\ ninteractions)}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Number\ of\ interactions\ must\ correspond\ to\ 316"{}});}
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{keyword}{delete}\ []\ \_C;}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{comment}{//\ return\ low\ rank}}
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{keywordflow}{return}\ rank;}
\DoxyCodeLine{00234\ \}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keywordtype}{int}\ ORDER,\ \textcolor{keyword}{class}\ MatrixKernelClass>}
\DoxyCodeLine{00242\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00243\ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_a8cb65f5bf8291ed25dd2d7ed2a91e0d5}{FChebDenseM2LHandler<FReal,\ ORDER,\ MatrixKernelClass>::ComputeAndStoreInBinaryFile}}(\textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ MatrixKernel)}
\DoxyCodeLine{00244\ \{}
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{comment}{//\ measure\ time}}
\DoxyCodeLine{00246\ \ \ \ \ \mbox{\hyperlink{class_f_tic}{FTic}}\ time;\ time.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}();}
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{comment}{//\ start\ computing\ process}}
\DoxyCodeLine{00248\ \ \ \ \ FReal\ *C;}
\DoxyCodeLine{00249\ \ \ \ \ C\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ rank\ =\ nnodes;}
\DoxyCodeLine{00251\ \ \ \ \ \textcolor{comment}{//\ store\ into\ binary\ file}}
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ filename(getFileName());}
\DoxyCodeLine{00253\ \ \ \ \ std::ofstream\ stream(filename.c\_str(),\ std::ios::out\ |\ std::ios::binary\ |\ std::ios::trunc);}
\DoxyCodeLine{00254\ \ \ \ \ \textcolor{keywordflow}{if}\ (stream.good())\ \{}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ stream.seekp(0);}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 1)\ write\ number\ of\ interpolation\ points\ (int)}}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \_nnodes\ =\ nnodes;}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ stream.write(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\&\_nnodes),\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 2)\ write\ low\ rank\ (int)}}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \_rank\ =\ rank;}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ stream.write(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\&\_rank),\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 5)\ write\ 343\ C\ (343\ *\ rank*rank\ *\ FReal)}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ stream.write(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(C),\ \textcolor{keyword}{sizeof}(FReal)*rank*rank*343);}
\DoxyCodeLine{00264\ \ \ \ \ \}\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}File\ could\ not\ be\ opened\ to\ write"{}});}
\DoxyCodeLine{00265\ \ \ \ \ stream.close();}
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{comment}{//\ free\ memory}}
\DoxyCodeLine{00267\ \ \ \ \ \textcolor{keywordflow}{if}\ (C\ !=\ \textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}\ []\ C;}
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{comment}{//\ write\ info}}
\DoxyCodeLine{00269\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Full\ M2L\ operators\ ("{}}<<\ rank\ <<\ \textcolor{stringliteral}{"{})\ stored\ in\ binary\ file\ "{}}\ \ \ \ <<\ filename}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ in\ "{}}\ <<\ time.\mbox{\hyperlink{class_f_tic_ade3afdb1aa198635ebbc5ee8b7f4f081}{tacAndElapsed}}()\ <<\ \textcolor{stringliteral}{"{}sec."{}}\ \ \ \ <<\ std::endl;}
\DoxyCodeLine{00271\ \}}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keywordtype}{int}\ ORDER,\ \textcolor{keyword}{class}\ MatrixKernelClass>}
\DoxyCodeLine{00275\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00276\ \mbox{\hyperlink{class_f_cheb_dense_m2_l_handler_a31b0aef6f1253a17761d0b3c814b65e3}{FChebDenseM2LHandler<FReal,\ ORDER,\ MatrixKernelClass>::ReadFromBinaryFileAndSet}}()}
\DoxyCodeLine{00277\ \{}
\DoxyCodeLine{00278\ \ \ \ \ \textcolor{comment}{//\ measure\ time}}
\DoxyCodeLine{00279\ \ \ \ \ \mbox{\hyperlink{class_f_tic}{FTic}}\ time;\ time.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}();}
\DoxyCodeLine{00280\ \ \ \ \ \textcolor{comment}{//\ start\ reading\ process}}
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{keywordflow}{if}\ (C)\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Full\ M2L\ operator\ already\ set"{}});}
\DoxyCodeLine{00282\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ filename(getFileName());}
\DoxyCodeLine{00283\ \ \ \ \ std::ifstream\ stream(filename.c\_str(),}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::ios::in\ |\ std::ios::binary\ |\ std::ios::ate);}
\DoxyCodeLine{00285\ \ \ \ \ \textcolor{keyword}{const}\ std::ifstream::pos\_type\ size\ =\ stream.tellg();}
\DoxyCodeLine{00286\ \ \ \ \ \textcolor{keywordflow}{if}\ (size<=0)\ \{}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Info:\ The\ requested\ binary\ file\ "{}}\ <<\ filename}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ does\ not\ yet\ exist.\ Compute\ it\ now\ ...\ "{}}\ <<\ std::endl;}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ this-\/>ComputeAndStoreInBinaryFileAndReadFromFileAndSet();}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00291\ \ \ \ \ \}}
\DoxyCodeLine{00292\ \ \ \ \ \textcolor{keywordflow}{if}\ (stream.good())\ \{}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ stream.seekg(0);}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 1)\ read\ number\ of\ interpolation\ points\ (int)}}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ npts;}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ stream.read(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\&npts),\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (npts!=nnodes)\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}nnodes\ and\ npts\ do\ not\ correspond"{}});}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 2)\ read\ low\ rank\ (int)}}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ stream.read(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\&rank),\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 5)\ write\ 343\ C\ (343\ *\ rank*rank\ *\ FReal)}}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ C\ =\ \textcolor{keyword}{new}\ FReal\ [343\ *\ rank*rank];}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ stream.read(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(C),\ \textcolor{keyword}{sizeof}(FReal)*rank*rank*343);}
\DoxyCodeLine{00303\ \ \ \ \ \}\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}File\ could\ not\ be\ opened\ to\ read"{}});}
\DoxyCodeLine{00304\ \ \ \ \ stream.close();}
\DoxyCodeLine{00305\ \ \ \ \ \textcolor{comment}{//\ write\ info}}
\DoxyCodeLine{00306\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Full\ M2L\ operators\ ("{}}\ <<\ rank\ <<\ \textcolor{stringliteral}{"{})\ read\ from\ binary\ file\ "{}}}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ filename\ <<\ \textcolor{stringliteral}{"{}\ in\ "{}}\ <<\ time.\mbox{\hyperlink{class_f_tic_ade3afdb1aa198635ebbc5ee8b7f4f081}{tacAndElapsed}}()\ <<\ \textcolor{stringliteral}{"{}sec."{}}\ \ \ \ <<\ std::endl;}
\DoxyCodeLine{00308\ \}}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ FCHEBDENSEM2LHANDLER\_HPP}}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \textcolor{comment}{//\ [-\/-\/END-\/-\/]}}

\end{DoxyCode}
