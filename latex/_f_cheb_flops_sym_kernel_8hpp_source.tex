\doxysection{FCheb\+Flops\+Sym\+Kernel.\+hpp}
\hypertarget{_f_cheb_flops_sym_kernel_8hpp_source}{}\label{_f_cheb_flops_sym_kernel_8hpp_source}\index{third\_party/ScalFMM/include/ScalFMM/Kernels/Chebyshev/FChebFlopsSymKernel.hpp@{third\_party/ScalFMM/include/ScalFMM/Kernels/Chebyshev/FChebFlopsSymKernel.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ See\ LICENCE\ file\ at\ project\ root}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#ifndef\ FCHEBFLOPSSYMKERNEL\_HPP}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#define\ FCHEBFLOPSSYMKERNEL\_HPP}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <stdexcept>}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FGlobal.hpp"{}}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FSmartPointer.hpp"{}}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}../../Components/FAbstractKernels.hpp"{}}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}./FChebInterpolator.hpp"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}../Interpolation/FInterpSymmetries.hpp"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}};}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00036\ \textcolor{keyword}{template}\ <\ \textcolor{keyword}{class}\ FReal,\ \textcolor{keyword}{class}\ CellClass,\ \ \ \ \textcolor{keyword}{class}\ ContainerClass,\ \textcolor{keyword}{class}\ MatrixKernelClass,\ \textcolor{keywordtype}{int}\ ORDER>}
\DoxyCodeLine{00037\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_f_cheb_flops_sym_kernel}{FChebFlopsSymKernel}}}
\DoxyCodeLine{00038\ \ \ \ \ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_f_abstract_kernels}{FAbstractKernels}}<CellClass,\ ContainerClass>}
\DoxyCodeLine{00039\ \{}
\DoxyCodeLine{00040\ \ \ \textcolor{keyword}{enum}\ \{nnodes\ =\ \mbox{\hyperlink{struct_tensor_traits}{TensorTraits<ORDER>::nnodes}}\};}
\DoxyCodeLine{00041\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{class_symmetry_handler}{SymmetryHandler}};}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_smart_pointer}{FSmartPointer<MatrixKernelClass,FSmartPointerMemory>}}\ \mbox{\hyperlink{class_f_cheb_flops_sym_kernel_aacedc3e38b5145dd048012bd993c229c}{MatrixKernel}};}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_smart_pointer}{FSmartPointer<SymmetryHandler,\ \ FSmartPointerMemory>}}\ SymHandler;}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_f_cheb_flops_sym_kernel_a7946d27808feb25107a38f056719669c}{inTreeHeight}};}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{comment}{//\ count\ permuted\ local\ and\ multipole\ expansions}}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}*\ countExp;}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ flopsP2M,\ flopsM2M,\ flopsM2L,\ flopsL2L,\ flopsL2P,\ flopsP2P;}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ *flopsPerLevelM2M,\ *flopsPerLevelM2L,\ *flopsPerLevelL2L;}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{comment}{//\ start\ flop\ counters\ }}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ countFlopsM2MorL2L()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00063\ \textcolor{keyword}{\ \ \ \ }\{\ \textcolor{keywordflow}{return}\ 3\ *\ nnodes\ *\ (2*ORDER-\/1);\ \}}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ countFlopsM2L(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nexp,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ rank)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00065\ \textcolor{keyword}{\ \ \ \ }\{\ \textcolor{keywordflow}{return}\ nexp\ *\ (4*nnodes*rank\ -\/\ rank\ -\/\ nnodes);\ \}}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ countFlopsP2P()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00067\ \textcolor{keyword}{\ \ \ \ }\{\ \textcolor{keywordflow}{return}\ 34;\ \}}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ countFlopsP2Pmutual()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00069\ \textcolor{keyword}{\ \ \ \ }\{\ \textcolor{keywordflow}{return}\ 39;\ \}}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ countFlopsP2M(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ N)\textcolor{keyword}{\ const\ \ }\{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ first\ \ =\ N\ *\ (18\ +\ (ORDER-\/2)\ *\ 6\ +\ (ORDER-\/1)\ *\ (6\ +\ (ORDER-\/1)\ *\ (6\ +\ (ORDER-\/1)\ *\ 2)));}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ W2\ =\ 3\ *\ ORDER*(2*(ORDER-\/1)-\/1);}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ W4\ =\ 3\ *\ (ORDER*(ORDER-\/1)*(2*(ORDER-\/1)-\/1)\ +\ ORDER*ORDER*(2*(ORDER-\/1)-\/1));}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ W8\ =\ 3\ *\ (2*(ORDER-\/1)-\/1)\ *\ (ORDER*(ORDER-\/1)*(ORDER-\/1)\ +\ ORDER*ORDER*(ORDER-\/1)\ +\ nnodes);}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ first\ +\ W2\ +\ W4\ +\ W8\ +\ nnodes*11;}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ countFlopsL2PTotal(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ N)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ W0\ =\ nnodes;}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ W2\ =\ 3\ *\ (ORDER-\/1)*ORDER*ORDER\ *\ 2*ORDER;}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ W4\ =\ 3\ *\ ORDER*(ORDER-\/1)*(ORDER-\/1)\ *\ 2*ORDER;}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ W8\ =\ (ORDER-\/1)*(ORDER-\/1)*(ORDER-\/1)\ *\ (2*ORDER-\/1);}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ second\ =\ N\ *\ (38\ +\ (ORDER-\/2)*15\ +\ (ORDER-\/1)*((ORDER-\/1)\ *\ (27\ +\ (ORDER-\/1)\ *\ 16)))\ +\ 6;}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ W0\ +\ W2\ +\ W4\ +\ W8\ +\ second;}
\DoxyCodeLine{00084\ \ \ \ \ \}}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ end\ flop\ counters}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00093\ \ \ \ \ \mbox{\hyperlink{class_f_cheb_flops_sym_kernel_aa93df4ce3a846e502469fbb24d97912b}{FChebFlopsSymKernel}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \_inTreeHeight,}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ inBoxWidth,}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ inBoxCenter,}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ Epsilon)}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ :\ \ \ \mbox{\hyperlink{class_f_cheb_flops_sym_kernel_aacedc3e38b5145dd048012bd993c229c}{MatrixKernel}}(new\ MatrixKernelClass()),}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ SymHandler(new\ \mbox{\hyperlink{class_symmetry_handler}{SymmetryHandler}}(\mbox{\hyperlink{class_f_cheb_flops_sym_kernel_aacedc3e38b5145dd048012bd993c229c}{MatrixKernel}}.getPtr(),\ Epsilon)),\ \mbox{\hyperlink{class_f_cheb_flops_sym_kernel_a7946d27808feb25107a38f056719669c}{inTreeHeight}}(\_inTreeHeight),}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ flopsP2M(0),\ flopsM2M(0),\ flopsM2L(0),\ flopsL2L(0),\ flopsL2P(0),\ flopsP2P(0),}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ flopsPerLevelM2M(nullptr),\ flopsPerLevelM2L(nullptr),\ flopsPerLevelL2L(nullptr)}
\DoxyCodeLine{00101\ \ \ \ \ \{}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ countExp\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ [343];}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ flopsPerLevelM2M\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ [\mbox{\hyperlink{class_f_cheb_flops_sym_kernel_a7946d27808feb25107a38f056719669c}{inTreeHeight}}];}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ flopsPerLevelM2L\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ [\mbox{\hyperlink{class_f_cheb_flops_sym_kernel_a7946d27808feb25107a38f056719669c}{inTreeHeight}}];}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ flopsPerLevelL2L\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ [\mbox{\hyperlink{class_f_cheb_flops_sym_kernel_a7946d27808feb25107a38f056719669c}{inTreeHeight}}];}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ level\ =\ 0;\ level<\mbox{\hyperlink{class_f_cheb_flops_sym_kernel_a7946d27808feb25107a38f056719669c}{inTreeHeight}};\ ++level)}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ flopsPerLevelM2M[level]\ =\ flopsPerLevelM2L[level]\ =\ flopsPerLevelL2L[level]\ =\ 0;}
\DoxyCodeLine{00108\ \ \ \ \ \}}
\DoxyCodeLine{00109\ \ \ \ \ }
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00113\ \ \ \ \ \mbox{\hyperlink{class_f_cheb_flops_sym_kernel_a815878a28d9c67f01f4d6fe898b6c168}{FChebFlopsSymKernel}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_cheb_flops_sym_kernel}{FChebFlopsSymKernel}}\&\ other)}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ :\ SymHandler(other.SymHandler),}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ flopsP2M(0),\ flopsM2M(0),\ flopsM2L(0),\ flopsL2L(0),\ flopsL2P(0),\ flopsP2P(0)}
\DoxyCodeLine{00116\ \ \ \ \ \{\ \ \ countExp\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ [343];\ \}}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00121\ \ \ \ \ \mbox{\hyperlink{class_f_cheb_flops_sym_kernel_ae8e2f4067694fd2bd3be14cafb1a2aa4}{\string~FChebFlopsSymKernel}}()}
\DoxyCodeLine{00122\ \ \ \ \ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ countExp;}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n=================================================="{}}\ }
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n-\/\ Flops\ for\ P2M\ =\ "{}}\ <<\ flopsP2M\ }
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n-\/\ Flops\ for\ M2M\ =\ "{}}\ <<\ flopsM2M}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n-\/\ Flops\ for\ M2L\ =\ "{}}\ <<\ flopsM2L}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n-\/\ Flops\ for\ L2L\ =\ "{}}\ <<\ flopsL2L}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n-\/\ Flops\ for\ L2P\ =\ "{}}\ <<\ flopsL2P}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n-\/\ Flops\ for\ P2P\ =\ "{}}\ <<\ flopsP2P}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n-\/\ Overall\ Flops\ =\ "{}}\ <<\ flopsP2M\ +\ flopsM2M\ +\ flopsM2L\ +\ flopsL2L\ +\ flopsL2P\ +\ flopsP2P}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n==================================================\(\backslash\)n"{}}}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ std::endl;}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n=================================================="{}}\ }
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n-\/\ Flops\ for\ P2M/M2M"{}}\ <<\ std::endl;}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ level=0;\ level<\mbox{\hyperlink{class_f_cheb_flops_sym_kernel_a7946d27808feb25107a38f056719669c}{inTreeHeight}};\ ++level)}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (level\ <\ \mbox{\hyperlink{class_f_cheb_flops_sym_kernel_a7946d27808feb25107a38f056719669c}{inTreeHeight}}-\/1)}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ |-\/\ at\ level\ "{}}\ <<\ level\ <<\ \textcolor{stringliteral}{"{}\ flops\ =\ "{}}\ <<\ flopsPerLevelM2M[level]\ <<\ std::endl;}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ |-\/\ at\ level\ "{}}\ <<\ level\ <<\ \textcolor{stringliteral}{"{}\ flops\ =\ "{}}\ <<\ flopsP2M\ <<\ std::endl;}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}=================================================="{}}\ }
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n-\/\ Flops\ for\ M2L"{}}\ <<\ std::endl;}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ level=0;\ level<\mbox{\hyperlink{class_f_cheb_flops_sym_kernel_a7946d27808feb25107a38f056719669c}{inTreeHeight}};\ ++level)}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ |-\/\ at\ level\ "{}}\ <<\ level\ <<\ \textcolor{stringliteral}{"{}\ flops\ =\ "{}}\ <<\ flopsPerLevelM2L[level]\ <<\ std::endl;}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}=================================================="{}}\ }
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n-\/\ Flops\ for\ L2L/L2P"{}}\ <<\ std::endl;}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ level=0;\ level<\mbox{\hyperlink{class_f_cheb_flops_sym_kernel_a7946d27808feb25107a38f056719669c}{inTreeHeight}};\ ++level)}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (level\ <\ \mbox{\hyperlink{class_f_cheb_flops_sym_kernel_a7946d27808feb25107a38f056719669c}{inTreeHeight}}-\/1)}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ |-\/\ at\ level\ "{}}\ <<\ level\ <<\ \textcolor{stringliteral}{"{}\ flops\ =\ "{}}\ <<\ flopsPerLevelL2L[level]\ <<\ std::endl;}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ |-\/\ at\ level\ "{}}\ <<\ level\ <<\ \textcolor{stringliteral}{"{}\ flops\ =\ "{}}\ <<\ flopsL2P\ <<\ std::endl;}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}=================================================="{}}\ <<\ std::endl;\ }
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (flopsPerLevelM2M)\ \textcolor{keyword}{delete}\ []\ flopsPerLevelM2M;}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (flopsPerLevelM2L)\ \textcolor{keyword}{delete}\ []\ flopsPerLevelM2L;}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (flopsPerLevelL2L)\ \textcolor{keyword}{delete}\ []\ flopsPerLevelL2L;}
\DoxyCodeLine{00160\ \ \ \ \ \}}
\DoxyCodeLine{00161\ \ \ \ \ }
\DoxyCodeLine{00162\ \ \ \ \ }
\DoxyCodeLine{00163\ \ \ \ \ }
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordtype}{void}\ P2M(CellClass*\ \textcolor{keyword}{const}\ \textcolor{comment}{/*\ not\ needed\ */},\ \textcolor{keyword}{const}\ ContainerClass*\ \textcolor{keyword}{const}\ SourceParticles)\textcolor{keyword}{\ override}}
\DoxyCodeLine{00165\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ flopsP2M\ +=\ countFlopsP2M(\textcolor{keywordtype}{int}(SourceParticles-\/>getNbParticles()));}
\DoxyCodeLine{00167\ \ \ \ \ \}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keywordtype}{void}\ M2M(CellClass*\ \textcolor{keyword}{const}\ FRestrict\ \textcolor{comment}{/*\ not\ needed\ */},}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CellClass*\textcolor{keyword}{const}\ FRestrict\ *\textcolor{keyword}{const}\ FRestrict\ ChildCells,}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ TreeLevel)\textcolor{keyword}{\ override}}
\DoxyCodeLine{00174\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ flops\ =\ 0;}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ ChildIndex=0;\ ChildIndex\ <\ 8;\ ++ChildIndex)}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ChildCells[ChildIndex])\ flops\ +=\ countFlopsM2MorL2L();}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ flopsM2M\ +=\ flops;}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ flopsPerLevelM2M[TreeLevel]\ +=\ flops;}
\DoxyCodeLine{00180\ \ \ \ \ \}}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keywordtype}{void}\ M2L(CellClass*\ \textcolor{keyword}{const}\ FRestrict\ \textcolor{comment}{/*\ not\ needed\ */},}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CellClass*\ SourceCells[],}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ positions[],}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ size,}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ TreeLevel)\textcolor{keyword}{\ override}}
\DoxyCodeLine{00190\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ flops\ =\ 0;}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ count\ how\ ofter\ each\ of\ the\ 16\ interactions\ is\ used}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(countExp,\ 0,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int})\ *\ 343);}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ idx=0;\ idx<size;\ ++idx)}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ countExp[SymHandler-\/>pindices[positions[idx]]]++;}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ multiply\ (mat-\/mat-\/mul)}}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ pidx=0;\ pidx<343;\ ++pidx)}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (countExp[pidx])}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ flops\ +=\ countFlopsM2L(countExp[pidx],\ SymHandler-\/>LowRank[pidx])\ +\ countExp[pidx]*nnodes;}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ flopsM2L\ +=\ flops;}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ flopsPerLevelM2L[TreeLevel]\ +=\ flops;}
\DoxyCodeLine{00202\ \ \ \ \ \}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{keywordtype}{void}\ L2L(\textcolor{keyword}{const}\ CellClass*\ \textcolor{keyword}{const}\ FRestrict\ \textcolor{comment}{/*\ not\ needed\ */},}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CellClass*\ FRestrict\ *\textcolor{keyword}{const}\ FRestrict\ ChildCells,}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ TreeLevel)\textcolor{keyword}{\ override}}
\DoxyCodeLine{00208\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ flops\ =\ 0;}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ ChildIndex=0;\ ChildIndex\ <\ 8;\ ++ChildIndex)}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ChildCells[ChildIndex])\ flops\ +=\ countFlopsM2MorL2L()\ +\ nnodes;}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ flopsL2L\ +=\ flops;}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ flopsPerLevelL2L[TreeLevel]\ +=\ flops;}
\DoxyCodeLine{00214\ \ \ \ \ \}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keywordtype}{void}\ L2P(\textcolor{keyword}{const}\ CellClass*\ \textcolor{keyword}{const}\ \textcolor{comment}{/*\ not\ needed\ */},}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass*\ \textcolor{keyword}{const}\ TargetParticles)\textcolor{keyword}{\ override}}
\DoxyCodeLine{00220\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \textcolor{comment}{//flopsL2P\ +=\ countFlopsP2MorL2P(TargetParticlesParticles-\/>getNbParticles())\ +\ TargetParticles-\/>getNbParticles();}}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \textcolor{comment}{//flopsL2P\ +=\ countFlopsL2PGradient(TargetParticlesParticles-\/>getNbParticles())\ +\ 3\ *\ TargetParticles-\/>getNbParticles();}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ or}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 2)\ apply\ Sx\ and\ Px\ (grad\ Sx)}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ flopsL2P\ +=\ countFlopsL2PTotal(\textcolor{keywordtype}{int}(TargetParticles-\/>getNbParticles()))\ +\ 4\ *\ int(TargetParticles-\/>getNbParticles());}
\DoxyCodeLine{00230\ \ \ \ \ \}}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keywordtype}{void}\ P2P(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\&\ \textcolor{comment}{/*\ LeafCellCoordinate\ */},\ \textcolor{comment}{//\ needed\ for\ periodic\ boundary\ conditions}}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass*\ \textcolor{keyword}{const}\ FRestrict\ TargetParticles,}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ContainerClass*\ \textcolor{keyword}{const}\ FRestrict\ SourceParticles,}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass*\ \textcolor{keyword}{const}\ NeighborSourceParticles[],}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ neighborPositions[],}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ size)\textcolor{keyword}{\ override}}
\DoxyCodeLine{00240\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (TargetParticles\ !=\ SourceParticles)\ \{}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ flopsP2P\ +=\ countFlopsP2P()\ *\ TargetParticles-\/>getNbParticles()\ *\ SourceParticles-\/>getNbParticles();}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ idx=0;\ idx<size;\ ++idx)}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ flopsP2P\ +=\ countFlopsP2P()\ *\ TargetParticles-\/>getNbParticles()\ *\ NeighborSourceParticles[idx]-\/>getNbParticles();}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ flopsP2P\ +=\ countFlopsP2Pmutual()\ *\ ((TargetParticles-\/>getNbParticles()*TargetParticles-\/>getNbParticles()+TargetParticles-\/>getNbParticles())\ /\ 2);}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ idx=0;\ idx\ <\ size\ \&\&\ neighborPositions[idx]<=13;\ ++idx)}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ flopsP2P\ +=\ countFlopsP2Pmutual()\ *\ TargetParticles-\/>getNbParticles()\ *\ NeighborSourceParticles[idx]-\/>getNbParticles();}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00250\ \ \ \ \ \}}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{keywordtype}{void}\ P2POuter(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\&\ \textcolor{comment}{/*\ LeafCellCoordinate\ */},\ \textcolor{comment}{//\ needed\ for\ periodic\ boundary\ conditions}}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass*\ \textcolor{keyword}{const}\ FRestrict\ TargetParticles,}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass*\ \textcolor{keyword}{const}\ NeighborSourceParticles[],}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ neighborPositions[],}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ size)\textcolor{keyword}{\ override}}
\DoxyCodeLine{00257\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ idx=0;\ idx\ <\ size\ \&\&\ neighborPositions[idx]<=13;\ ++idx)}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ flopsP2P\ +=\ countFlopsP2Pmutual()\ *\ TargetParticles-\/>getNbParticles()\ *\ NeighborSourceParticles[idx]-\/>getNbParticles();}
\DoxyCodeLine{00260\ \ \ \ \ \}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \};}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00277\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class\ }FReal,\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }CellClass,}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }ContainerClass,}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }MatrixKernelClass,}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ ORDER>}
\DoxyCodeLine{00281\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{class_f_cheb_flops_sym_kernel}{FChebFlopsSymKernel}}<FReal,\ CellClass,\ ContainerClass,\ MatrixKernelClass,\ ORDER>}
\DoxyCodeLine{00282\ ::\mbox{\hyperlink{struct_f_cheb_flops_sym_kernel_01_1_1_symmetry_handler}{SymmetryHandler}}}
\DoxyCodeLine{00283\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{comment}{//\ M2L\ operators}}
\DoxyCodeLine{00285\ \ \ \ \ FReal*\ \ \ \ K[343];}
\DoxyCodeLine{00286\ \ \ \ \ \textcolor{keywordtype}{int}\ LowRank[343];}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{comment}{//\ permutation\ vectors\ and\ permutated\ indices}}
\DoxyCodeLine{00289\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ pvectors[343][nnodes];}
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ pindices[343];}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \ \ \textcolor{comment}{//\ compute\ rank}}
\DoxyCodeLine{00294\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ getRank(\textcolor{keyword}{const}\ FReal\ singular\_values[],\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ eps)}
\DoxyCodeLine{00295\ \ \ \ \ \{}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ FReal\ nrm2(0.);}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ k=0;\ k<nnodes;\ ++k)}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ nrm2\ +=\ singular\_values[k]\ *\ singular\_values[k];}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ FReal\ nrm2k(0.);}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ k=nnodes;\ k>0;\ -\/-\/k)\ \{}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \ \ nrm2k\ +=\ singular\_values[k-\/1]\ *\ singular\_values[k-\/1];}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nrm2k\ >\ eps*eps\ *\ nrm2)\ \textcolor{keywordflow}{return}\ k;}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}rank\ cannot\ be\ larger\ than\ nnodes"{}});}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00307\ \ \ \ \ \}}
\DoxyCodeLine{00308\ \ \ \ \ }
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00311\ \ \ \ \ \mbox{\hyperlink{struct_f_cheb_flops_sym_kernel_01_1_1_symmetry_handler_a66097ec6ece5cd1f40638933e7c04899}{SymmetryHandler}}(\textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_cheb_flops_sym_kernel_aacedc3e38b5145dd048012bd993c229c}{MatrixKernel}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ Epsilon)}
\DoxyCodeLine{00312\ \ \ \ \ \{}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ init\ all\ 343\ item\ to\ zero,\ because\ effectively\ only\ 16\ exist}}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t=0;\ t<343;\ ++t)\ \{}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ K[t]\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ LowRank[t]\ =\ 0;}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ permutation\ vector\ and\ indices}}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_interp_symmetries}{FInterpSymmetries<ORDER>}}\ Symmetries;}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=-\/3;\ i<=3;\ ++i)}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=-\/3;\ j<=3;\ ++j)}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k=-\/3;\ k<=3;\ ++k)}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(i)>1\ ||\ abs(j)>1\ ||\ abs(k)>1)\ \{}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx\ =\ ((i+3)\ *\ 7\ +\ (j+3))\ *\ 7\ +\ (k+3);}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pindices[idx]\ =\ Symmetries.getPermutationArrayAndIndex(i,j,k,\ pvectors[idx]);}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ precompute\ 16\ M2L\ operators}}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ this-\/>precomputeSVD(\mbox{\hyperlink{class_f_cheb_flops_sym_kernel_aacedc3e38b5145dd048012bd993c229c}{MatrixKernel}},\ Epsilon);}
\DoxyCodeLine{00331\ \ \ \ \ \}}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00336\ \ \ \ \ \mbox{\hyperlink{struct_f_cheb_flops_sym_kernel_01_1_1_symmetry_handler_a37f6d829b0edc9b76cc89a680d9f3cc9}{\string~SymmetryHandler}}()}
\DoxyCodeLine{00337\ \ \ \ \ \{}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t=0;\ t<343;\ ++t)}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (K[\ \ t]!=\textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}\ []\ K[\ \ t];}
\DoxyCodeLine{00340\ \ \ \ \ \}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00345\ \ \ \ \ \textcolor{keywordtype}{void}\ precomputeSVD(\textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_cheb_flops_sym_kernel_aacedc3e38b5145dd048012bd993c229c}{MatrixKernel}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ Epsilon)}
\DoxyCodeLine{00346\ \ \ \ \ \{}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ interpolation\ points\ of\ source\ (Y)\ and\ target\ (X)\ cell}}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ X[nnodes],\ Y[nnodes];}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ roots\ of\ target\ cell\ (X)}}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_interp_tensor_ac8107c468326e9c786873c23fe2e8766}{FChebTensor<FReal,ORDER>::setRoots}}(\mbox{\hyperlink{class_f_point}{FPoint<FReal>}}(0.,0.,0.),\ FReal(2.),\ X);}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ temporary\ matrix}}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ FReal*\ U\ =\ \textcolor{keyword}{new}\ FReal\ [nnodes*nnodes];}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ needed\ for\ the\ SVD}}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ LWORK\ =\ 2\ *\ (3*nnodes\ +\ nnodes);}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ WORK\ =\ \textcolor{keyword}{new}\ FReal\ [LWORK];}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ VT\ =\ \textcolor{keyword}{new}\ FReal\ [nnodes*nnodes];}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ S\ =\ \textcolor{keyword}{new}\ FReal\ [nnodes];}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ counter\ =\ 0;}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=2;\ i<=3;\ ++i)\ \{}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=0;\ j<=i;\ ++j)\ \{}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k=0;\ k<=j;\ ++k)\ \{}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ assemble\ matrix}}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ cy(FReal(2.*i),\ FReal(2.*j),\ FReal(2.*k));}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_interp_tensor_ac8107c468326e9c786873c23fe2e8766}{FChebTensor<FReal,ORDER>::setRoots}}(cy,\ FReal(2.),\ Y);}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<nnodes;\ ++n)}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ m=0;\ m<nnodes;\ ++m)}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ U[n*nnodes\ +\ m]\ =\ \mbox{\hyperlink{class_f_cheb_flops_sym_kernel_aacedc3e38b5145dd048012bd993c229c}{MatrixKernel}}-\/>evaluate(X[m],\ Y[n]);}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ applying\ weights\ ////////////////////////////////////////}}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ weights[nnodes];}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_cheb_tensor_ad6b767c7fcabc179a5d5e808a5540972}{FChebTensor<FReal,ORDER>::setRootOfWeights}}(weights);}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<nnodes;\ ++n)\ \{}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::scal(nnodes,\ weights[n],\ U\ +\ n,\ \ nnodes);\ \textcolor{comment}{//\ scale\ rows}}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::scal(nnodes,\ weights[n],\ U\ +\ n\ *\ nnodes);\ \textcolor{comment}{//\ scale\ cols}}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ truncated\ singular\ value\ decomposition\ of\ matrix}}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ info\ \ =\ FBlas::gesvd(nnodes,\ nnodes,\ U,\ S,\ VT,\ nnodes,\ LWORK,\ WORK);}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (info!=0)\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}SVD\ did\ not\ converge\ with\ "{}}\ +\ std::to\_string(info));}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ rank\ =\ this-\/>getRank(S,\ Epsilon);}
\DoxyCodeLine{00385\ }
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ store\ }}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx\ =\ (i+3)*7*7\ +\ (j+3)*7\ +\ (k+3);}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ assert(K[idx]==\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ K[idx]\ =\ \textcolor{keyword}{new}\ FReal\ [2*rank*nnodes];}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LowRank[idx]\ =\ rank;}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ r=0;\ r<rank;\ ++r)}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::scal(nnodes,\ S[r],\ U\ +\ r*nnodes);}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::copy(rank*nnodes,\ U,\ \ K[idx]);}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ r=0;\ r<rank;\ ++r)}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::copy(nnodes,\ VT\ +\ r,\ nnodes,\ K[idx]\ +\ rank*nnodes\ +\ r*nnodes,\ 1);}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ un-\/weighting\ ////////////////////////////////////////////}}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<nnodes;\ ++n)\ \{}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::scal(rank,\ FReal(1.)\ /\ weights[n],\ K[idx]\ +\ n,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nnodes);\ \textcolor{comment}{//\ scale\ rows}}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::scal(rank,\ FReal(1.)\ /\ weights[n],\ K[idx]\ +\ rank*nnodes\ +\ n,\ nnodes);\ \textcolor{comment}{//\ scale\ rows}}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00403\ }
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}("{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{},"{}}\ <<\ j\ <<\ \textcolor{stringliteral}{"{},"{}}\ <<\ k\ <<\ \textcolor{stringliteral}{"{})\ "{}}\ <<\ idx\ <<}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\ low\ rank\ =\ "{}}\ <<\ rank\ <<\ std::endl;}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ counter++;}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}num\ interactions\ =\ "{}}\ <<\ counter\ <<\ std::endl;}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ U;}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ WORK;}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ VT;}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ S;}
\DoxyCodeLine{00416\ \ \ \ \ \}}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \};}
\DoxyCodeLine{00419\ }
\DoxyCodeLine{00420\ }
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ }
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ }
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ }
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//FCHEBSYMKERNELS\_HPP}}
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00432\ \textcolor{comment}{//\ [-\/-\/END-\/-\/]}}

\end{DoxyCode}
