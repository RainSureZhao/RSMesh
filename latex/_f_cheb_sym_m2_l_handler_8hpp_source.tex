\doxysection{FCheb\+Sym\+M2\+LHandler.\+hpp}
\hypertarget{_f_cheb_sym_m2_l_handler_8hpp_source}{}\label{_f_cheb_sym_m2_l_handler_8hpp_source}\index{third\_party/ScalFMM/include/ScalFMM/Kernels/Chebyshev/FChebSymM2LHandler.hpp@{third\_party/ScalFMM/include/ScalFMM/Kernels/Chebyshev/FChebSymM2LHandler.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ See\ LICENCE\ file\ at\ project\ root}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#ifndef\ FCHEBSYMM2LHANDLER\_HPP}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#define\ FCHEBSYMM2LHANDLER\_HPP}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <climits>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <sstream>}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FBlas.hpp"{}}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}FChebTensor.hpp"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}../Interpolation/FInterpSymmetries.hpp"{}}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}FChebM2LHandler.hpp"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FAca.hpp"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00028\ \textcolor{comment}{//\#define\ ONLY\_SVD}}
\DoxyCodeLine{00029\ \textcolor{comment}{//\#define\ FULLY\_PIVOTED\_ACASVD}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#define\ PARTIALLY\_PIVOTED\_ACASVD}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00039\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keywordtype}{int}\ ORDER,\ \textcolor{keyword}{typename}\ MatrixKernelClass>}
\DoxyCodeLine{00040\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ precompute(\textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ MatrixKernel,\ \textcolor{keyword}{const}\ FReal\ CellWidth,}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ Epsilon,\ FReal*\ K[343],\ \textcolor{keywordtype}{int}\ LowRank[343])}
\DoxyCodeLine{00042\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{comment}{//\ \ std::cout\ <<\ "{}\(\backslash\)nComputing\ 16\ far-\/field\ interactions\ (l="{}\ <<\ ORDER\ <<\ "{},\ eps="{}\ <<\ Epsilon}}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ "{})\ for\ cells\ of\ width\ w\ =\ "{}\ <<\ CellWidth\ <<\ std::endl;}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nnodes\ =\ ORDER*ORDER*ORDER;}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{comment}{//\ interpolation\ points\ of\ source\ (Y)\ and\ target\ (X)\ cell}}
\DoxyCodeLine{00049\ \ \ \ \ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ X[nnodes],\ Y[nnodes];}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{comment}{//\ set\ roots\ of\ target\ cell\ (X)}}
\DoxyCodeLine{00051\ \ \ \ \ \mbox{\hyperlink{class_f_interp_tensor_ac8107c468326e9c786873c23fe2e8766}{FChebTensor<FReal,\ ORDER>::setRoots}}(\mbox{\hyperlink{class_f_point}{FPoint<FReal>}}(0.,0.,0.),\ CellWidth,\ X);}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{comment}{//\ temporary\ matrix}}
\DoxyCodeLine{00053\ \ \ \ \ FReal*\ U\ =\ \textcolor{keyword}{new}\ FReal\ [nnodes*nnodes];}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{comment}{//\ needed\ for\ the\ SVD}}
\DoxyCodeLine{00056\ \ \ \ \ \ \textcolor{keywordtype}{int}\ INFO;}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ LWORK\ =\ 2\ *\ (3*nnodes\ +\ nnodes);}
\DoxyCodeLine{00058\ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ WORK\ =\ \textcolor{keyword}{new}\ FReal\ [LWORK];}
\DoxyCodeLine{00059\ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ VT\ =\ \textcolor{keyword}{new}\ FReal\ [nnodes*nnodes];}
\DoxyCodeLine{00060\ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ S\ =\ \textcolor{keyword}{new}\ FReal\ [nnodes];}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{comment}{//\ initialize\ timer}}
\DoxyCodeLine{00064\ \ \ \ \ \mbox{\hyperlink{class_f_tic}{FTic}}\ time;}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordtype}{double}\ overall\_time(0.);}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordtype}{double}\ elapsed\_time(0.);}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{comment}{//\ initialize\ rank\ counter}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ overall\_rank\ =\ 0;}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ counter\ =\ 0;}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=2;\ i<=3;\ ++i)\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=0;\ j<=i;\ ++j)\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k=0;\ k<=j;\ ++k)\ \{}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ assemble\ matrix\ and\ apply\ weighting\ matrices}}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ cy(CellWidth*FReal(i),\ CellWidth*FReal(j),\ CellWidth*FReal(k));}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_interp_tensor_ac8107c468326e9c786873c23fe2e8766}{FChebTensor<FReal,\ ORDER>::setRoots}}(cy,\ CellWidth,\ Y);}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ weights[nnodes];}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_cheb_tensor_ad6b767c7fcabc179a5d5e808a5540972}{FChebTensor<FReal,\ ORDER>::setRootOfWeights}}(weights);}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ now\ the\ entry-\/computer\ is\ responsible\ for\ weighting\ the\ matrix\ entries}}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_entry_computer}{EntryComputer<FReal,\ MatrixKernelClass>}}\ Computer(MatrixKernel,\ nnodes,\ X,\ nnodes,\ Y,\ weights);}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ start\ timer}}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ time.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}();}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \textcolor{preprocessor}{\#if\ (defined\ ONLY\_SVD\ ||\ defined\ FULLY\_PIVOTED\_ACASVD)}}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Computer(0,\ nnodes,\ 0,\ nnodes,\ U);}
\DoxyCodeLine{00090\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00092\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ //\ applying\ weights\ ////////////////////////////////////////}}
\DoxyCodeLine{00093\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ weights[nnodes];}}
\DoxyCodeLine{00094\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FChebTensor<FReal,ORDER>::setRootOfWeights(weights);}}
\DoxyCodeLine{00095\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ for\ (unsigned\ int\ n=0;\ n<nnodes;\ ++n)\ \{}}
\DoxyCodeLine{00096\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::scal(nnodes,\ weights[n],\ U\ +\ n,\ \ nnodes);\ //\ scale\ rows}}
\DoxyCodeLine{00097\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::scal(nnodes,\ weights[n],\ U\ +\ n\ *\ nnodes);\ //\ scale\ cols}}
\DoxyCodeLine{00098\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{00099\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ALL\ PREPROC\ FLAGS\ ARE\ SET\ ON\ TOP\ OF\ THIS\ FILE\ !!!\ /////////}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00112\ \textcolor{preprocessor}{\#if\ (defined\ FULLY\_PIVOTED\_ACASVD\ ||\ defined\ PARTIALLY\_PIVOTED\_ACASVD)\ }}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *UU,\ *VV;}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ rank;}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \textcolor{preprocessor}{\#ifdef\ FULLY\_PIVOTED\_ACASVD}}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAca::fACA(U,\ \ \ \ \ \ \ \ nnodes,\ nnodes,\ Epsilon,\ UU,\ VV,\ rank);}
\DoxyCodeLine{00118\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAca::pACA(Computer,\ nnodes,\ nnodes,\ Epsilon,\ UU,\ VV,\ rank);}
\DoxyCodeLine{00120\ \textcolor{preprocessor}{\#endif\ }}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ QR\ decomposition}}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal*\ phi\ =\ \textcolor{keyword}{new}\ FReal\ [rank*rank];}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ QR\ of\ U\ and\ V}}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal*\ tauU\ =\ \textcolor{keyword}{new}\ FReal\ [rank];}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ INFO\ =\ FBlas::geqrf(nnodes,\ rank,\ UU,\ tauU,\ LWORK,\ WORK);}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ assert(INFO==0);}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal*\ tauV\ =\ \textcolor{keyword}{new}\ FReal\ [rank];}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ INFO\ =\ FBlas::geqrf(nnodes,\ rank,\ VV,\ tauV,\ LWORK,\ WORK);}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ assert(INFO==0);}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ phi\ =\ Ru\ Rv'}}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal*\ rU\ =\ \textcolor{keyword}{new}\ FReal\ [2\ *\ rank*rank];}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal*\ rV\ =\ rU\ +\ rank*rank;}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::setzero(2\ *\ rank*rank,\ rU);}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ l=0;\ l<rank;\ ++l)\ \{}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::copy(l+1,\ UU\ +\ l*nnodes,\ rU\ +\ l*rank);}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::copy(l+1,\ VV\ +\ l*nnodes,\ rV\ +\ l*rank);}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::gemmt(rank,\ rank,\ rank,\ FReal(1.),\ rU,\ rank,\ rV,\ rank,\ phi,\ rank);}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ rU;}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ get\ Qu\ and\ Qv}}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ INFO\ =\ FBlas::orgqr(nnodes,\ rank,\ UU,\ tauU,\ LWORK,\ WORK);}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ assert(INFO==0);}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ INFO\ =\ FBlas::orgqr(nnodes,\ rank,\ VV,\ tauV,\ LWORK,\ WORK);}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ assert(INFO==0);}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ tauU;}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ tauV;}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ aca\_rank\ =\ rank;}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ SVD}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ INFO\ =\ FBlas::gesvd(aca\_rank,\ aca\_rank,\ phi,\ S,\ VT,\ aca\_rank,\ LWORK,\ WORK);}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (INFO!=0)\{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::stringstream\ stream;}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stream\ <<\ INFO;}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}SVD\ did\ not\ converge\ with\ "{}}\ +\ stream.str());}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rank\ =\ FSvd::getRank(S,\ aca\_rank,\ Epsilon);}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx\ =\ (i+3)*7*7\ +\ (j+3)*7\ +\ (k+3);}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ store}}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ allocate}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ assert(K[idx]==\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ K[idx]\ =\ \textcolor{keyword}{new}\ FReal\ [2*rank*nnodes];}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ low\ rank}}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LowRank[idx]\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(rank);}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (U\ Sigma)}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ r=0;\ r<rank;\ ++r)}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::scal(aca\_rank,\ S[r],\ phi\ +\ r*aca\_rank);}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Qu\ (U\ Sigma)\ }}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::gemm(nnodes,\ aca\_rank,\ rank,\ FReal(1.),\ UU,\ nnodes,\ phi,\ aca\_rank,\ K[idx],\ nnodes);}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ phi;}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Vt\ -\/>\ V\ and\ then\ Qu\ V}}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ V\ =\ \textcolor{keyword}{new}\ FReal\ [aca\_rank\ *\ rank];}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ r=0;\ r<rank;\ ++r)}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::copy(aca\_rank,\ VT\ +\ r,\ aca\_rank,\ V\ +\ r*aca\_rank,\ 1);}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::gemm(nnodes,\ aca\_rank,\ rank,\ FReal(1.),\ VV,\ nnodes,\ V,\ aca\_rank,\ K[idx]\ +\ rank*nnodes,\ nnodes);}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ V;}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//const\ unsigned\ int\ idx\ =\ (i+3)*7*7\ +\ (j+3)*7\ +\ (k+3);}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//assert(K[idx]==NULL);}}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//K[idx]\ =\ new\ FReal\ [2*rank*nnodes];}}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//LowRank[idx]\ =\ rank;}}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//FBlas::copy(rank*nnodes,\ UU,\ \ K[idx]);}}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//FBlas::copy(rank*nnodes,\ VV,\ \ K[idx]\ +\ rank*nnodes);}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ UU;}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ VV;}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ elapsed\_time\ =\ time.\mbox{\hyperlink{class_f_tic_ade3afdb1aa198635ebbc5ee8b7f4f081}{tacAndElapsed}}();\ }
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ overall\_time\ +=\ elapsed\_time;}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ overall\_rank\ +=\ rank;}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}("{}\ <<\ i\ <<\ "{},"{}\ <<\ j\ <<\ "{},"{}\ <<\ k\ <<\ "{})\ "{}\ <<\ idx\ <<}}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ "{},\ low\ rank\ =\ "{}\ <<\ rank\ <<\ "{}\ ("{}\ <<\ aca\_rank\ <<\ "{})\ in\ "{}\ <<\ elapsed\_time\ <<\ "{}s"{}\ <<\ std::endl;}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ALL\ PREPROC\ FLAGS\ ARE\ SET\ ON\ TOP\ OF\ THIS\ FILE\ !!!\ /////////}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \textcolor{preprocessor}{\#elif\ defined\ ONLY\_SVD}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ truncated\ singular\ value\ decomposition\ of\ matrix}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ INFO\ =\ FBlas::gesvd(nnodes,\ nnodes,\ U,\ S,\ VT,\ nnodes,\ LWORK,\ WORK);}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (INFO!=0)\{}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::stringstream\ stream;}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stream\ <<\ INFO;}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}SVD\ did\ not\ converge\ with\ "{}}\ +\ stream.str());}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ rank\ =\ FSvd::getRank<ORDER>(S,\ Epsilon);}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ store\ }}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx\ =\ (i+3)*7*7\ +\ (j+3)*7\ +\ (k+3);}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ assert(K[idx]==\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ K[idx]\ =\ \textcolor{keyword}{new}\ FReal\ [2*rank*nnodes];}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LowRank[idx]\ =\ rank;}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ r=0;\ r<rank;\ ++r)}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::scal(nnodes,\ S[r],\ U\ +\ r*nnodes);}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::copy(rank*nnodes,\ U,\ \ K[idx]);}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ r=0;\ r<rank;\ ++r)}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::copy(nnodes,\ VT\ +\ r,\ nnodes,\ K[idx]\ +\ rank*nnodes\ +\ r*nnodes,\ 1);}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ elapsed\_time\ =\ time.\mbox{\hyperlink{class_f_tic_ade3afdb1aa198635ebbc5ee8b7f4f081}{tacAndElapsed}}();\ }
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ overall\_time\ +=\ elapsed\_time;}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ overall\_rank\ +=\ rank;}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ "{}("{}\ <<\ i\ <<\ "{},"{}\ <<\ j\ <<\ "{},"{}\ <<\ k\ <<\ "{})\ "{}\ <<\ idx\ <<}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ "{},\ low\ rank\ =\ "{}\ <<\ rank\ <<\ "{}\ in\ "{}\ <<\ elapsed\_time\ <<\ "{}s"{}\ <<\ std::endl;}}
\DoxyCodeLine{00242\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00243\ \textcolor{preprocessor}{\#error\ Either\ fully-\/,\ partially\ pivoted\ ACA\ or\ only\ SVD\ must\ be\ defined!}}
\DoxyCodeLine{00244\ \textcolor{preprocessor}{\#endif\ }}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ALL\ PREPROC\ FLAGS\ ARE\ SET\ ON\ TOP\ OF\ THIS\ FILE\ !!!\ /////////}}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ un-\/weighting\ ////////////////////////////////////////////}}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<nnodes;\ ++n)\ \{}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::scal(rank,\ FReal(1.)\ /\ weights[n],\ K[idx]\ +\ n,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nnodes);\ \textcolor{comment}{//\ scale\ rows}}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FBlas::scal(rank,\ FReal(1.)\ /\ weights[n],\ K[idx]\ +\ rank*nnodes\ +\ n,\ nnodes);\ \textcolor{comment}{//\ scale\ rows}}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++counter;}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00267\ \ \ \ \ \}}
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{comment}{//std::cout\ <<\ "{}The\ approximation\ of\ the\ "{}\ <<\ counter}}
\DoxyCodeLine{00269\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ <<\ "{}\ far-\/field\ interactions\ (overall\ rank\ "{}\ <<\ overall\_rank}}
\DoxyCodeLine{00270\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ <<\ "{}\ /\ "{}\ <<\ 16*nnodes}}
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ <<\ "{}\ ,\ sizeM2L=\ "{}\ <<\ 2*overall\_rank*nnodes*sizeof(FReal)\ <<\ "{}"{}}}
\DoxyCodeLine{00272\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ <<\ "{}\ /\ "{}\ <<\ 16*nnodes*nnodes*sizeof(FReal)\ <<\ "{}\ B"{}}}
\DoxyCodeLine{00273\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ <<\ "{})\ took\ "{}\ <<\ overall\_time\ <<\ "{}s\(\backslash\)n"{}\ <<\ std::endl;}}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Compressed\ and\ set\ M2L\ operators\ ("{}}\ <<\ 2*overall\_rank*nnodes*\textcolor{keyword}{sizeof}(FReal)\ <<\ \textcolor{stringliteral}{"{}\ B)\ in\ "{}}\ <<\ overall\_time\ <<\ \textcolor{stringliteral}{"{}sec."{}}\ <<\ std::endl;}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{keyword}{delete}\ []\ U;}
\DoxyCodeLine{00278\ \ \ \ \ \textcolor{keyword}{delete}\ []\ WORK;}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{keyword}{delete}\ []\ VT;}
\DoxyCodeLine{00280\ \ \ \ \ \textcolor{keyword}{delete}\ []\ S;}
\DoxyCodeLine{00281\ \}}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00300\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keywordtype}{int}\ ORDER,\ KERNEL\_FUNCTION\_TYPE\ TYPE>\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_symmetry_handler}{SymmetryHandler}};}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00303\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keywordtype}{int}\ ORDER>}
\DoxyCodeLine{00304\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_symmetry_handler}{SymmetryHandler}}<FReal,\ ORDER,\ HOMOGENEOUS>}
\DoxyCodeLine{00305\ \{}
\DoxyCodeLine{00306\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nnodes\ =\ ORDER*ORDER*ORDER;}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{comment}{//\ M2L\ operators}}
\DoxyCodeLine{00309\ \ \ \ \ FReal*\ \ \ \ K[343];}
\DoxyCodeLine{00310\ \ \ \ \ \textcolor{keywordtype}{int}\ LowRank[343];}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{comment}{//\ permutation\ vectors\ and\ permutated\ indices}}
\DoxyCodeLine{00315\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ pvectors[343][nnodes];}
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ pindices[343];}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00320\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixKernelClass>}
\DoxyCodeLine{00321\ \ \ \ \ \mbox{\hyperlink{class_symmetry_handler_3_01_f_real_00_01_o_r_d_e_r_00_01_h_o_m_o_g_e_n_e_o_u_s_01_4_a5a581400642b2a4cf74bfa75875b8bb3}{SymmetryHandler}}(\textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ MatrixKernel,\ \textcolor{keyword}{const}\ FReal\ Epsilon,}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int})}
\DoxyCodeLine{00323\ \ \ \ \ \{}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ init\ all\ 343\ item\ to\ zero,\ because\ effectively\ only\ 16\ exist}}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t=0;\ t<343;\ ++t)\ \{}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ K[t]\ \ \ \ \ \ \ \ \ \ \ \ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ LowRank[t]\ =\ 0;}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ permutation\ vector\ and\ indices}}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_interp_symmetries}{FInterpSymmetries<ORDER>}}\ Symmetries;}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=-\/3;\ i<=3;\ ++i)}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=-\/3;\ j<=3;\ ++j)}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k=-\/3;\ k<=3;\ ++k)\ \{}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx\ =\ ((i+3)\ *\ 7\ +\ (j+3))\ *\ 7\ +\ (k+3);}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pindices[idx]\ =\ 0;}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(i)>1\ ||\ abs(j)>1\ ||\ abs(k)>1)}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pindices[idx]\ =\ Symmetries.getPermutationArrayAndIndex(i,j,k,\ pvectors[idx]);}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ precompute\ 16\ M2L\ operators}}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ ReferenceCellWidth\ =\ FReal(2.0);}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ precompute<FReal,\ ORDER>(MatrixKernel,\ ReferenceCellWidth,\ Epsilon,\ K,\ LowRank);}
\DoxyCodeLine{00344\ \ \ \ \ \}}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00349\ \ \ \ \ \mbox{\hyperlink{class_symmetry_handler_3_01_f_real_00_01_o_r_d_e_r_00_01_h_o_m_o_g_e_n_e_o_u_s_01_4_a0f41f4c95436600f45d855463921a2f1}{\string~SymmetryHandler}}()}
\DoxyCodeLine{00350\ \ \ \ \ \{}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t=0;\ t<343;\ ++t)\ \textcolor{keywordflow}{if}\ (K[t]!=\textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}\ []\ K[t];}
\DoxyCodeLine{00352\ \ \ \ \ \}}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00356\ \ \ \ \ \textcolor{keyword}{const}\ FReal\ *\ \mbox{\hyperlink{class_symmetry_handler_3_01_f_real_00_01_o_r_d_e_r_00_01_h_o_m_o_g_e_n_e_o_u_s_01_4_a082cda18191bfd3a775b9201174b12e3}{getK}}(\textcolor{keyword}{const}\ \ \textcolor{keywordtype}{int},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00357\ \textcolor{keyword}{\ \ \ \ }\{\ \ \ \textcolor{keywordflow}{return}\ K[t];\ \}}
\DoxyCodeLine{00358\ }
\DoxyCodeLine{00360\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_symmetry_handler_3_01_f_real_00_01_o_r_d_e_r_00_01_h_o_m_o_g_e_n_e_o_u_s_01_4_a6d23a02d738bf11745ed419d3fad4361}{getLowRank}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00361\ \textcolor{keyword}{\ \ \ \ }\{\ \ \ \textcolor{keywordflow}{return}\ LowRank[t];\ \}}
\DoxyCodeLine{00362\ }
\DoxyCodeLine{00363\ \};}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00371\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keywordtype}{int}\ ORDER>}
\DoxyCodeLine{00372\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_symmetry_handler}{SymmetryHandler}}<FReal,\ ORDER,\ NON\_HOMOGENEOUS>}
\DoxyCodeLine{00373\ \{}
\DoxyCodeLine{00374\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nnodes\ =\ ORDER*ORDER*ORDER;}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \ \ \textcolor{comment}{//\ Height\ of\ octree;\ needed\ only\ in\ the\ case\ of\ non-\/homogeneous\ kernel\ functions}}
\DoxyCodeLine{00377\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ TreeHeight;}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \ \ \textcolor{comment}{//\ M2L\ operators\ for\ all\ levels\ in\ the\ octree}}
\DoxyCodeLine{00380\ \ \ \ \ FReal***\ \ \ \ K;}
\DoxyCodeLine{00381\ \ \ \ \ \textcolor{keywordtype}{int}**\ LowRank;}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ \ \ \ \ \textcolor{comment}{//\ permutation\ vectors\ and\ permutated\ indices}}
\DoxyCodeLine{00386\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ pvectors[343][nnodes];}
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ pindices[343];}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00391\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixKernelClass>}
\DoxyCodeLine{00392\ \ \ \ \ \mbox{\hyperlink{class_symmetry_handler_3_01_f_real_00_01_o_r_d_e_r_00_01_n_o_n___h_o_m_o_g_e_n_e_o_u_s_01_4_ae2f7e4f320590547f3c6be57fe01e5f5}{SymmetryHandler}}(\textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ MatrixKernel,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ Epsilon,}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ RootCellWidth,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ inTreeHeight)}
\DoxyCodeLine{00394\ \ \ \ \ :\ TreeHeight(inTreeHeight)}
\DoxyCodeLine{00395\ \ \ \ \ \{}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ init\ all\ 343\ item\ to\ zero,\ because\ effectively\ only\ 16\ exist}}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ K\ \ \ \ \ \ \ =\ \textcolor{keyword}{new}\ FReal**\ [TreeHeight];}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ LowRank\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{int}*\ \ \ \ [TreeHeight];}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ K[0]\ \ \ \ \ \ \ =\ \textcolor{keyword}{nullptr};\ K[1]\ \ \ \ \ \ \ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ LowRank[0]\ =\ \textcolor{keyword}{nullptr};\ LowRank[1]\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ l=2;\ l<TreeHeight;\ ++l)\ \{}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ \ \ K[l]\ \ \ \ \ \ \ =\ \textcolor{keyword}{new}\ FReal*\ [343];}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \ \ \ \ LowRank[l]\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{int}\ \ \ \ [343];}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t=0;\ t<343;\ ++t)\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ K[l][t]\ \ \ \ \ \ \ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LowRank[l][t]\ =\ 0;}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ permutation\ vector\ and\ indices}}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_interp_symmetries}{FInterpSymmetries<ORDER>}}\ Symmetries;}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=-\/3;\ i<=3;\ ++i)}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=-\/3;\ j<=3;\ ++j)}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k=-\/3;\ k<=3;\ ++k)\ \{}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx\ =\ ((i+3)\ *\ 7\ +\ (j+3))\ *\ 7\ +\ (k+3);}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pindices[idx]\ =\ 0;}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(i)>1\ ||\ abs(j)>1\ ||\ abs(k)>1)}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pindices[idx]\ =\ Symmetries.getPermutationArrayAndIndex(i,j,k,\ pvectors[idx]);}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ precompute\ 16\ M2L\ operators\ at\ all\ levels\ having\ far-\/field\ interactions}}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ FReal\ CellWidth\ =\ RootCellWidth\ /\ FReal(2.);\ \textcolor{comment}{//\ at\ level\ 1}}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ CellWidth\ /=\ FReal(2.);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ at\ level\ 2}}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ l=2;\ l<TreeHeight;\ ++l)\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ precompute<FReal,ORDER>(MatrixKernel,\ CellWidth,\ Epsilon,\ K[l],\ LowRank[l]);}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ CellWidth\ /=\ FReal(2.);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ at\ level\ l+1\ }}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00429\ \ \ \ \ \}}
\DoxyCodeLine{00430\ }
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00434\ \ \ \ \ \mbox{\hyperlink{class_symmetry_handler_3_01_f_real_00_01_o_r_d_e_r_00_01_n_o_n___h_o_m_o_g_e_n_e_o_u_s_01_4_a9d06058cdec0b2d04ad7beeeffda0c15}{\string~SymmetryHandler}}()}
\DoxyCodeLine{00435\ \ \ \ \ \{}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ l=0;\ l<TreeHeight;\ ++l)\ \{}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (K[l]!=\textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t=0;\ t<343;\ ++t)\ \textcolor{keywordflow}{if}\ (K[l][t]!=\textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}\ []\ K[l][t];}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ K[l];}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (LowRank[l]!=\textcolor{keyword}{nullptr})\ \ \ \ \textcolor{keyword}{delete}\ []\ LowRank[l];}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ K;}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ LowRank;}
\DoxyCodeLine{00445\ \ \ \ \ \}}
\DoxyCodeLine{00446\ }
\DoxyCodeLine{00448\ \ \ \ \ \textcolor{keyword}{const}\ FReal\ *\ \mbox{\hyperlink{class_symmetry_handler_3_01_f_real_00_01_o_r_d_e_r_00_01_n_o_n___h_o_m_o_g_e_n_e_o_u_s_01_4_a283210ff79d18fed8e592afbc2e4e595}{getK}}(\textcolor{keyword}{const}\ \ \textcolor{keywordtype}{int}\ l,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00449\ \textcolor{keyword}{\ \ \ \ }\{\ \ \ \textcolor{keywordflow}{return}\ K[l][t];\ \}}
\DoxyCodeLine{00450\ }
\DoxyCodeLine{00452\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_symmetry_handler_3_01_f_real_00_01_o_r_d_e_r_00_01_n_o_n___h_o_m_o_g_e_n_e_o_u_s_01_4_a1924703aa98309c9653674d7e40152c1}{getLowRank}}(\textcolor{keyword}{const}\ \ \textcolor{keywordtype}{int}\ l,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00453\ \textcolor{keyword}{\ \ \ \ }\{\ \ \ \textcolor{keywordflow}{return}\ LowRank[l][t];\ \}}
\DoxyCodeLine{00454\ }
\DoxyCodeLine{00455\ \};}
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ }
\DoxyCodeLine{00459\ }
\DoxyCodeLine{00460\ }
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00462\ }
\DoxyCodeLine{00463\ }
\DoxyCodeLine{00464\ \textcolor{preprocessor}{\#include\ <fstream>}}
\DoxyCodeLine{00465\ \textcolor{preprocessor}{\#include\ <sstream>}}
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00467\ }
\DoxyCodeLine{00471\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keywordtype}{int}\ ORDER,\ \textcolor{keyword}{typename}\ MatrixKernelClass>}
\DoxyCodeLine{00472\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ ComputeAndCompressAndStoreInBinaryFile(\textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ MatrixKernel,\ \textcolor{keyword}{const}\ FReal\ Epsilon)}
\DoxyCodeLine{00473\ \{}
\DoxyCodeLine{00474\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nnodes\ =\ ORDER*ORDER*ORDER;}
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \ \ \ \ \textcolor{comment}{//\ compute\ and\ compress\ ////////////}}
\DoxyCodeLine{00477\ \ \ \ \ FReal*\ K[343];}
\DoxyCodeLine{00478\ \ \ \ \ \textcolor{keywordtype}{int}\ LowRank[343];}
\DoxyCodeLine{00479\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx=0;\ idx<343;\ ++idx)\ \{\ K[idx]\ =\ \textcolor{keyword}{nullptr};\ LowRank[idx]\ =\ 0;\ \ \}}
\DoxyCodeLine{00480\ \ \ \ \ precompute<FReal,ORDER>(MatrixKernel,\ FReal(2.),\ Epsilon,\ K,\ LowRank);}
\DoxyCodeLine{00481\ }
\DoxyCodeLine{00482\ \ \ \ \ \textcolor{comment}{//\ write\ to\ binary\ file\ ////////////}}
\DoxyCodeLine{00483\ \ \ \ \ \mbox{\hyperlink{class_f_tic}{FTic}}\ time;\ time.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}();}
\DoxyCodeLine{00484\ \ \ \ \ \textcolor{comment}{//\ start\ computing\ process}}
\DoxyCodeLine{00485\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ precision\ =\ (\textcolor{keyword}{typeid}(FReal)==\textcolor{keyword}{typeid}(\textcolor{keywordtype}{double})\ ?\ \textcolor{charliteral}{'d'}\ :\ \textcolor{charliteral}{'f'});}
\DoxyCodeLine{00486\ \ \ \ \ std::stringstream\ sstream;}
\DoxyCodeLine{00487\ \ \ \ \ sstream\ <<\ \textcolor{stringliteral}{"{}sym2l\_"{}}\ <<\ precision\ <<\ \textcolor{stringliteral}{"{}\_o"{}}\ <<\ ORDER\ <<\ \textcolor{stringliteral}{"{}\_e"{}}\ <<\ Epsilon\ <<\ \textcolor{stringliteral}{"{}.bin"{}};}
\DoxyCodeLine{00488\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ filename(sstream.str());}
\DoxyCodeLine{00489\ \ \ \ \ std::ofstream\ stream(filename.c\_str(),}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \ \ \ \ std::ios::out\ |\ std::ios::binary\ |\ std::ios::trunc);}
\DoxyCodeLine{00491\ \ \ \ \ \textcolor{keywordflow}{if}\ (stream.good())\ \{}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ stream.seekp(0);}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx=0;\ idx<343;\ ++idx)}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (K[idx]!=\textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 1)\ write\ index}}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stream.write(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\&idx),\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 2)\ write\ low\ rank\ (int)}}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ rank\ =\ LowRank[idx];}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stream.write(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\&rank),\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 3)\ write\ U\ and\ V\ (both:\ rank*nnodes\ *\ FReal)}}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ U\ =\ K[idx];}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ V\ =\ K[idx]\ +\ rank*nnodes;}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stream.write(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(U),\ \textcolor{keyword}{sizeof}(FReal)*rank*nnodes);}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stream.write(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(V),\ \textcolor{keyword}{sizeof}(FReal)*rank*nnodes);}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00506\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}File\ could\ not\ be\ opened\ to\ write"{}});}
\DoxyCodeLine{00507\ \ \ \ \ stream.close();}
\DoxyCodeLine{00508\ \ \ \ \ \textcolor{comment}{//\ write\ info}}
\DoxyCodeLine{00509\ \ \ \ \ \textcolor{comment}{//\ \ std::cout\ <<\ "{}Compressed\ M2L\ operators\ stored\ in\ binary\ file\ "{}\ <<\ filename}}
\DoxyCodeLine{00510\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ "{}\ in\ "{}\ <<\ time.tacAndElapsed()\ <<\ "{}sec."{}\ <<\ std::endl;}}
\DoxyCodeLine{00511\ }
\DoxyCodeLine{00512\ \ \ \ \ \textcolor{comment}{//\ free\ memory\ /////////////////////}}
\DoxyCodeLine{00513\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t=0;\ t<343;\ ++t)\ \textcolor{keywordflow}{if}\ (K[t]!=\textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}\ []\ K[t];}
\DoxyCodeLine{00514\ \}}
\DoxyCodeLine{00515\ }
\DoxyCodeLine{00516\ }
\DoxyCodeLine{00521\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keywordtype}{int}\ ORDER>}
\DoxyCodeLine{00522\ \textcolor{keywordtype}{void}\ ReadFromBinaryFile(\textcolor{keyword}{const}\ FReal\ Epsilon,\ FReal*\ K[343],\ \textcolor{keywordtype}{int}\ LowRank[343])}
\DoxyCodeLine{00523\ \{}
\DoxyCodeLine{00524\ \ \ \ \ \textcolor{comment}{//\ compile\ time\ constants}}
\DoxyCodeLine{00525\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nnodes\ =\ ORDER*ORDER*ORDER;}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00527\ \ \ \ \ \textcolor{comment}{//\ find\ filename}}
\DoxyCodeLine{00528\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ precision\ =\ (\textcolor{keyword}{typeid}(FReal)==\textcolor{keyword}{typeid}(\textcolor{keywordtype}{double})\ ?\ \textcolor{charliteral}{'d'}\ :\ \textcolor{charliteral}{'f'});}
\DoxyCodeLine{00529\ \ \ \ \ std::stringstream\ sstream;}
\DoxyCodeLine{00530\ \ \ \ \ sstream\ <<\ \textcolor{stringliteral}{"{}sym2l\_"{}}\ <<\ precision\ <<\ \textcolor{stringliteral}{"{}\_o"{}}\ <<\ ORDER\ <<\ \textcolor{stringliteral}{"{}\_e"{}}\ <<\ Epsilon\ <<\ \textcolor{stringliteral}{"{}.bin"{}};}
\DoxyCodeLine{00531\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ filename(sstream.str());}
\DoxyCodeLine{00532\ }
\DoxyCodeLine{00533\ \ \ \ \ \textcolor{comment}{//\ read\ binary\ file}}
\DoxyCodeLine{00534\ \ \ \ \ std::ifstream\ istream(filename.c\_str(),}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \ \ \ \ std::ios::in\ |\ std::ios::binary\ |\ std::ios::ate);}
\DoxyCodeLine{00536\ \ \ \ \ \textcolor{keyword}{const}\ std::ifstream::pos\_type\ size\ =\ istream.tellg();}
\DoxyCodeLine{00537\ \ \ \ \ \textcolor{keywordflow}{if}\ (size<=0)\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}The\ requested\ binary\ file\ does\ not\ yet\ exist.\ Exit."{}});}
\DoxyCodeLine{00538\ }
\DoxyCodeLine{00539\ \ \ \ \ \textcolor{keywordflow}{if}\ (istream.good())\ \{}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ istream.seekg(0);}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 1)\ read\ index\ (int)}}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \_idx;}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ istream.read(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\&\_idx),\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ loop\ to\ find\ 16\ compressed\ m2l\ operators}}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ idx=0;\ idx<343;\ ++idx)\ \{}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \ \ \ \ K[idx]\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \ \ LowRank[idx]\ =\ 0;}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ it\ exists}}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (idx\ ==\ \_idx)\ \{}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 2)\ read\ low\ rank\ (int)}}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ rank;}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ istream.read(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\&rank),\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LowRank[idx]\ =\ rank;}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 3)\ read\ U\ and\ V\ (both:\ rank*nnodes\ *\ FReal)}}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ K[idx]\ =\ \textcolor{keyword}{new}\ FReal\ [2*rank*nnodes];}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ U\ =\ K[idx];}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ V\ =\ K[idx]\ +\ rank*nnodes;}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ istream.read(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(U),\ \textcolor{keyword}{sizeof}(FReal)*rank*nnodes);}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ istream.read(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(V),\ \textcolor{keyword}{sizeof}(FReal)*rank*nnodes);}
\DoxyCodeLine{00560\ }
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 1)\ read\ next\ index}}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ istream.read(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\&\_idx),\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00565\ \ \ \ \ \}\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}File\ could\ not\ be\ opened\ to\ read"{}});}
\DoxyCodeLine{00566\ \ \ \ \ istream.close();}
\DoxyCodeLine{00567\ \}}
\DoxyCodeLine{00568\ }
\DoxyCodeLine{00569\ }
\DoxyCodeLine{00570\ }
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00572\ }
\DoxyCodeLine{00573\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
