\doxysection{FCompare\+Results.\+hpp}
\hypertarget{_f_compare_results_8hpp_source}{}\label{_f_compare_results_8hpp_source}\index{third\_party/ScalFMM/include/ScalFMM/Utils/FCompareResults.hpp@{third\_party/ScalFMM/include/ScalFMM/Utils/FCompareResults.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ See\ LICENCE\ file\ at\ project\ root}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#ifndef\ FCOMPARERESULTS\_HPP}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#define\ FCOMPARERESULTS\_HPP}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <cstdlib>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00007\ \textcolor{comment}{//}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}Utils/FMath.hpp"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}Files/FFmaGenericLoader.hpp"{}}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keyword}{class}\ \textcolor{keyword}{class}ArrayType>}
\DoxyCodeLine{00012\ FSize\ compareTwoArrays(\textcolor{keyword}{const}\ std::string\ \&tag,\ \ \textcolor{keyword}{const}\ FSize\ \&nbParticles,\ \textcolor{keyword}{const}\ classArrayType\ \&array1,}
\DoxyCodeLine{00013\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ classArrayType\ \&array2)\{}
\DoxyCodeLine{00014\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00015\ \ \ \ \ \mbox{\hyperlink{class_f_math_1_1_f_accurater}{FMath::FAccurater<FReal>}}\ potentialDiff;}
\DoxyCodeLine{00016\ \ \ \ \ \mbox{\hyperlink{class_f_math_1_1_f_accurater}{FMath::FAccurater<FReal>}}\ fx,\ fy,\ fz;}
\DoxyCodeLine{00017\ \ \ \ \ \textcolor{keywordtype}{double}\ energy1=\ 0.0,\ energy2=\ 0.0;}
\DoxyCodeLine{00018\ \ \ \ \ FSize\ error\ =\ 0\ ;}
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{keywordflow}{for}(FSize\ idxPart\ =\ 0\ ;\ idxPart\ <\ nbParticles\ ;++idxPart)\{}
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(array1[idxPart].getPosition()\ !=\ array2[idxPart].getPosition()\ )\{}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \ \ \ \ \ \ std::cerr\ <<\textcolor{stringliteral}{"{}Wrong\ positions\ \ "{}}\ <<std::endl}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ \ P1:\ "{}}\ <<array1[idxPart].getPosition()<<std::endl}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ \ P2:\ "{}}\ <<array2[idxPart].getPosition()<<std::endl}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ \ error\ \ "{}}\ <<array1[idxPart].getPosition()-\/array2[idxPart].getPosition()<<std::endl;}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ potentialDiff.\mbox{\hyperlink{class_f_math_1_1_f_accurater_ae033a65e0d493d58d5e1448636090dbc}{add}}(array1[idxPart].getPotential(),array2[idxPart].getPotential());}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ fx.\mbox{\hyperlink{class_f_math_1_1_f_accurater_ae033a65e0d493d58d5e1448636090dbc}{add}}(array1[idxPart].getForces()[0],array2[idxPart].getForces()[0]);}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ fy.\mbox{\hyperlink{class_f_math_1_1_f_accurater_ae033a65e0d493d58d5e1448636090dbc}{add}}(array1[idxPart].getForces()[1],array2[idxPart].getForces()[1]);}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ fz.\mbox{\hyperlink{class_f_math_1_1_f_accurater_ae033a65e0d493d58d5e1448636090dbc}{add}}(array1[idxPart].getForces()[2],array2[idxPart].getForces()[2]);}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ energy1\ +=\ array1[idxPart].getPhysicalValue()\ *array1[idxPart].getPotential()\ ;}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ energy2\ +=\ array2[idxPart].getPhysicalValue()\ *array2[idxPart].getPotential()\ ;}
\DoxyCodeLine{00032\ \ \ \ \ \}}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{comment}{//\ Print\ for\ information}}
\DoxyCodeLine{00034\ \ \ \ \ std::cout\ <<\ tag<<\ \textcolor{stringliteral}{"{}\ Energy\ "{}}\ \ <<\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(energy1-\/energy2)\ <<\ \textcolor{stringliteral}{"{}\ \ "{}}}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(energy1-\/energy2)\ /energy1\ <<std::endl;}
\DoxyCodeLine{00036\ \ \ \ \ std::cout\ <<\ tag<<\ \textcolor{stringliteral}{"{}\ Potential\ "{}}\ <<\ potentialDiff\ <<\ std::endl;}
\DoxyCodeLine{00037\ \ \ \ \ std::cout\ <<\ tag<<\ \textcolor{stringliteral}{"{}\ Fx\ "{}}\ <<\ fx\ <<\ std::endl;}
\DoxyCodeLine{00038\ \ \ \ \ std::cout\ <<\ tag<<\ \textcolor{stringliteral}{"{}\ Fy\ "{}}\ <<\ fy\ <<\ std::endl;}
\DoxyCodeLine{00039\ \ \ \ \ std::cout\ <<\ tag<<\ \textcolor{stringliteral}{"{}\ Fz\ "{}}\ <<\ fz\ <<\ std::endl;}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordflow}{return}\ error\ ;}
\DoxyCodeLine{00042\ \}}
\DoxyCodeLine{00043\ \textcolor{comment}{//}}
\DoxyCodeLine{00044\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keyword}{class}\ \textcolor{keyword}{class}ArrayType>}
\DoxyCodeLine{00045\ \textcolor{keywordtype}{void}\ computeFirstMoment(\ \textcolor{keyword}{const}\ FSize\ \&nbParticles,\ \textcolor{keyword}{const}\ classArrayType\ \&particles,\ \ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ \&FirstMoment)\{}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ FReal\ mx,my,mz\ ;}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#pragma\ omp\ parallel\ \ for\ shared(nbParticles,particles)\ reduction(+:mx,my,mz)}}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordflow}{for}(FSize\ idxPart\ =\ 0\ ;\ idxPart\ <\ nbParticles\ ;\ ++idxPart)\{}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ mx\ +=\ particles[idxPart].getPhysicalValue()*particles[idxPart].getPosition().getX()\ ;}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ my\ +=\ particles[idxPart].getPhysicalValue()*particles[idxPart].getPosition().getY()\ ;}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ mz\ +=\ particles[idxPart].getPhysicalValue()*particles[idxPart].getPosition().getZ()\ ;}
\DoxyCodeLine{00055\ \ \ \ \ \}}
\DoxyCodeLine{00056\ \ \ \ \ FirstMoment.\mbox{\hyperlink{class_f_point_ad2eec275cf9bddb1c00acff4f7873e4d}{setPosition}}(mx,my,mz);}
\DoxyCodeLine{00057\ \}\ ;}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \textcolor{keyword}{template}\ <\ \textcolor{keyword}{class}\ FReal,\ \textcolor{keyword}{class}\ \textcolor{keyword}{class}ArrayType>}
\DoxyCodeLine{00060\ \textcolor{keywordtype}{void}\ removeFirstMoment(\ \textcolor{keyword}{const}\ std::string\&\ TYPE,\ \textcolor{keyword}{const}\ FSize\ \&nbParticles,\ \textcolor{keyword}{const}\ classArrayType\ \&particles,\ \ FReal\ \&volume)\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ FirstMoment\ ;}
\DoxyCodeLine{00062\ \ \ \ \ computeFirstMoment<FReal,\ classArrayType>(\ nbParticles,\ particles,\ \ FirstMoment);}
\DoxyCodeLine{00063\ \ \ \ \ std::cout\ <<\ std::endl;}
\DoxyCodeLine{00064\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Electric\ Moment\ \ \ \ \ \ \ \ \ \ =\ "{}}<<\ FirstMoment\ <<std::endl;}
\DoxyCodeLine{00065\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Electric\ Moment\ norm\ =\ "{}}<<\ FirstMoment.\mbox{\hyperlink{class_f_point_a13f3fa46b8af935cafd8281880232c15}{norm2}}()\ \ <<std::endl;}
\DoxyCodeLine{00066\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/"{}}<<std::endl;}
\DoxyCodeLine{00067\ \ \ \ \ std::cout\ <<\ std::endl;}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{comment}{//\ Remove}}
\DoxyCodeLine{00070\ \ \ \ \ FReal\ coeffCorrection\ \ =\ 4.0*FMath::FPi<FReal>()/volume/3.0\ ;}
\DoxyCodeLine{00071\ \ \ \ \ FReal\ scaleEnergy=1.0,\ scaleForce=1.0\ \ ;}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keywordflow}{if}\ (TYPE\ ==\ \textcolor{stringliteral}{"{}DLPOLY"{}})\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ r4pie0\ =\ FReal(138935.4835);}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ scaleEnergy\ =\ \ r4pie0\ /\ 418.4\ ;\ \ \ \textcolor{comment}{//\ kcal\ mol\string^\{-\/1\}}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ scaleForce\ \ =\ -\/r4pie0\ ;\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 10\ J\ mol\string^\{-\/1\}\ A\string^\{-\/1\}}}
\DoxyCodeLine{00077\ \ \ \ \ \}}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (TYPE\ ==\ \textcolor{stringliteral}{"{}NOSCALE"{}})\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ scaleEnergy=1.0,\ scaleForce=1.0\ \ ;}
\DoxyCodeLine{00080\ \ \ \ \ \}}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}In\ removeFirstMoment\ TYPE\ "{}}\ <<\ TYPE\ <<\ \textcolor{stringliteral}{"{}\ was\ not\ know.\ Available\ TYPE\ DLPOLY\ "{}}<<\ std::endl;}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ std::exit(\ EXIT\_FAILURE);}
\DoxyCodeLine{00084\ \ \ \ \ \}}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordtype}{double}\ tmp;}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordflow}{for}(FSize\ idx\ =\ 0\ ;\ idx\ <\ nbParticles\ ;\ ++idx)\{}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ tmp\ =\ particles[idx].getPosition().getX()*FirstMoment.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()\ \ +\ particles[idx].getPosition().getY()*FirstMoment.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ particles[idx].getPosition().getZ()*FirstMoment.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()\ \ ;}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ FReal\ Q\ =\ \ particles[idx].getPhysicalValue(),\ P\ =\ particles[idx].getPotential();}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ particles[idx].setPotential(\ P\ -\/\ tmp*coeffCorrection);}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}idx:\ "{}}<<\ idx\ <<\textcolor{stringliteral}{"{}\ old:\ "{}}\ <<\ particles[idx].getForces()[0]\ ;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ particles[idx].getForces()[0]\ -\/=\ Q*coeffCorrection*FirstMoment.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()\ ;}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ particles[idx].getForces()[1]\ -\/=\ Q*coeffCorrection*FirstMoment.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()\ ;}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ particles[idx].getForces()[2]\ -\/=\ Q*coeffCorrection*FirstMoment.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()\ ;}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ new:\ "{}}\ <<\ particles[idx].getForces()[0]\ <<std::endl;}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ particles[idx].getForces()[0]\ *=\ scaleForce;}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ particles[idx].getForces()[1]\ *=\ scaleForce;}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ particles[idx].getForces()[2]\ *=\ scaleForce;}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ newEnergy\ +=\ Q*particles[idx].getPotential()\ \ ;}}
\DoxyCodeLine{00107\ \ \ \ \ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \}}
\DoxyCodeLine{00110\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
