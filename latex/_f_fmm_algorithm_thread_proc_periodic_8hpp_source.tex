\doxysection{FFmm\+Algorithm\+Thread\+Proc\+Periodic.\+hpp}
\hypertarget{_f_fmm_algorithm_thread_proc_periodic_8hpp_source}{}\label{_f_fmm_algorithm_thread_proc_periodic_8hpp_source}\index{third\_party/ScalFMM/include/ScalFMM/Core/FFmmAlgorithmThreadProcPeriodic.hpp@{third\_party/ScalFMM/include/ScalFMM/Core/FFmmAlgorithmThreadProcPeriodic.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ See\ LICENCE\ file\ at\ project\ root}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#ifndef\ FFMMALGORITHMTHREADPROCPPERIODIC\_HPP}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#define\ FFMMALGORITHMTHREADPROCPPERIODIC\_HPP}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#define\ SCALFMM\_DISTRIBUTED\_ALGORITHM}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <array>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}Utils/FAssert.hpp"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}Utils/FLog.hpp"{}}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}Utils/FTic.hpp"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}Utils/FGlobal.hpp"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}Utils/FMemUtils.hpp"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}Utils/FEnv.hpp"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}Containers/FBoolArray.hpp"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}Containers/FOctree.hpp"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}Containers/FLightOctree.hpp"{}}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}Containers/FBufferWriter.hpp"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}Containers/FBufferReader.hpp"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}Containers/FMpiBufferWriter.hpp"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}Containers/FMpiBufferReader.hpp"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}Utils/FEnv.hpp"{}}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}Utils/FMpi.hpp"{}}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#ifdef\ \_OPENMP}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ <omp.h>}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}FCoreCommon.hpp"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}FP2PExclusion.hpp"{}}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ "{}Utils/FAlgorithmTimers.hpp"{}}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00060\ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ FReal,\ \textcolor{keyword}{class}\ OctreeClass,\ \textcolor{keyword}{class}\ CellClass,\ \textcolor{keyword}{class}\ ContainerClass,\ \textcolor{keyword}{class}\ KernelClass,\ \textcolor{keyword}{class}\ LeafClass,\ \textcolor{keyword}{class}\ P2PExclusionClass\ =\ FP2PM\textcolor{keywordtype}{id}dleExclusion>}
\DoxyCodeLine{00061\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic}{FFmmAlgorithmThreadProcPeriodic}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_f_abstract_algorithm}{FAbstractAlgorithm}},\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_f_algorithm_timers}{FAlgorithmTimers}}\ \{}
\DoxyCodeLine{00062\ \ \ \ \ OctreeClass*\ \textcolor{keyword}{const}\ tree;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//<\ The\ octree\ to\ work\ on}}
\DoxyCodeLine{00063\ \ \ \ \ KernelClass**\ kernels;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//<\ The\ kernels}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_mpi_1_1_f_comm}{FMpi::FComm}}\&\ comm;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//<\ MPI\ comm}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ CellClass\ rootCellFromProc;\ \ \ \ \ \textcolor{comment}{//<\ root\ of\ tree\ needed\ by\ the\ periodicity}}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ nbLevelsAboveRoot;\ \ \ \ \textcolor{comment}{//<\ The\ nb\ of\ level\ the\ user\ ask\ to\ go\ above\ the\ tree\ (>=\ -\/1)}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ offsetRealTree;\ \ \ \ \ \ \ \textcolor{comment}{//<\ nbLevelsAboveRoot\ GetFackLevel}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator*\ iterArray;}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator*\ iterArrayComm;}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keywordtype}{int}\ numberOfLeafs;\ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ MaxThreads;\ \ \ \ \ \ \ \ }
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ nbProcess;\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ idProcess;\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ OctreeHeight;\ \ \ \ \ \ }
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ userChunkSize;}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ leafLevelSeparationCriteria;}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_interval}{Interval}}\{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ MortonIndex\ leftIndex;}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ MortonIndex\ rightIndex;}
\DoxyCodeLine{00089\ \ \ \ \ \};}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00092\ \ \ \ \ \mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_interval}{Interval}}*\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_af2f3968f5789f95490a1aea5a0a91a81}{intervals}};}
\DoxyCodeLine{00094\ \ \ \ \ \mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_interval}{Interval}}*\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a75c3a2762a90be463a573874c7e4efbb}{workingIntervalsPerLevel}};}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00097\ \ \ \ \ \mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_interval}{Interval}}\&\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(\ \textcolor{keywordtype}{int}\ level,\ \ \textcolor{keywordtype}{int}\ proc)\{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a75c3a2762a90be463a573874c7e4efbb}{workingIntervalsPerLevel}}[OctreeHeight\ *\ proc\ +\ level];}
\DoxyCodeLine{00099\ \ \ \ \ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_interval}{Interval}}\&\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_acdaa827fd7bb88e03fdebadcfaae0463}{getWorkingInterval}}(\ \textcolor{keywordtype}{int}\ level,\ \ \textcolor{keywordtype}{int}\ proc)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a75c3a2762a90be463a573874c7e4efbb}{workingIntervalsPerLevel}}[OctreeHeight\ *\ proc\ +\ level];}
\DoxyCodeLine{00104\ \ \ \ \ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ idxLevel\ ,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ idxProc)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel,\ idxProc).leftIndex\ <=\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel,\ idxProc).rightIndex;}
\DoxyCodeLine{00110\ \ \ \ \ \}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a89bc577cb52f95a7d705d1f82efa38cd}{procCoversMyRightBorderCell}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ idxLevel\ ,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ idxProc)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}((idxLevel+1)\ ,\ idProcess).rightIndex>>3)\ ==\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}((idxLevel+1)\ ,idxProc).leftIndex\ >>3);}
\DoxyCodeLine{00115\ \ \ \ \ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a5c43fa25b8738ca5ce9684eccc1308eb}{procCoversMyLeftBorderCell}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ idxLevel\ ,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ idxProc)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}((idxLevel+1)\ ,\ idxProc).rightIndex\ >>3)\ ==\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}((idxLevel+1)\ ,\ idProcess).leftIndex>>3);}
\DoxyCodeLine{00120\ \ \ \ \ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keywordtype}{void}\ setKernel(KernelClass*\textcolor{keyword}{const}\ inKernels)\{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ this-\/>kernels\ =\ \textcolor{keyword}{new}\ KernelClass*[MaxThreads];}
\DoxyCodeLine{00126\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#pragma\ omp\ parallel\ num\_threads(MaxThreads)}}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00128\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ critical\ (InitFFmmAlgorithmThreadProcPeriodic)}}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ this-\/>kernels[omp\_get\_thread\_num()]\ =\ \textcolor{keyword}{new}\ KernelClass(*inKernels);}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00133\ \ \ \ \ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \ \ Interval\&\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ level)\{}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(level,\ idProcess);}
\DoxyCodeLine{00138\ \ \ \ \ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a1a54c715e72598b9a3ceccb1d31b4f87}{hasWorkAtLevel}}(\ \textcolor{keywordtype}{int}\ level)\{}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ idProcess\ ==\ 0\ ||\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(level,\ idProcess\ -\/\ 1).rightIndex)\ <\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(level,\ idProcess).rightIndex);}
\DoxyCodeLine{00143\ \ \ \ \ \}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00151\ \ \ \ \ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a355dcfbd985148ef73d366aeec19e4d1}{FFmmAlgorithmThreadProcPeriodic}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_mpi_1_1_f_comm}{FMpi::FComm}}\&\ inComm,\ OctreeClass*\ \textcolor{keyword}{const}\ inTree,}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inUpperLevel\ =\ 2,}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inUserChunkSize\ =\ 10,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inLeafLevelSeperationCriteria\ =\ 1)}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ :\ tree(inTree)\ ,}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ kernels(nullptr),\ comm(inComm),}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ nbLevelsAboveRoot(inUpperLevel),\ offsetRealTree(inUpperLevel\ +\ 2),}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ numberOfLeafs(0),}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ MaxThreads(FEnv::GetValue(\textcolor{stringliteral}{"{}SCALFMM\_ALGO\_NUM\_THREADS"{}},omp\_get\_max\_threads())),}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ nbProcess(inComm.processCount()),}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ idProcess(inComm.processId()),}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ OctreeHeight(tree-\/>getHeight()),}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ userChunkSize(inUserChunkSize),}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ leafLevelSeparationCriteria(inLeafLevelSeperationCriteria),}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_af2f3968f5789f95490a1aea5a0a91a81}{intervals}}(new\ \mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_interval}{Interval}}[inComm.processCount()]),}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a75c3a2762a90be463a573874c7e4efbb}{workingIntervalsPerLevel}}(new\ \mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_interval}{Interval}}[inComm.processCount()\ *\ tree-\/>getHeight()])\ \{}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ FAssertLF(tree,\ \textcolor{stringliteral}{"{}tree\ cannot\ be\ null"{}});}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ FAssertLF(-\/1\ <=\ inUpperLevel,\ \textcolor{stringliteral}{"{}inUpperLevel\ cannot\ be\ <\ -\/1"{}});}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ FAssertLF(leafLevelSeparationCriteria\ <\ 3,\ \textcolor{stringliteral}{"{}Separation\ criteria\ should\ be\ <\ 3"{}});}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ FAbstractAlgorithm::setNbLevelsInTree(\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a5938cd87fccbadb63e9fa4f8c458eab8}{extendedTreeHeight}}());}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}FFmmAlgorithmThreadProcPeriodic\(\backslash\)n"{}});}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}Max\ threads\ =\ "{}}\ \ <<\ MaxThreads\ <<\ \textcolor{stringliteral}{"{},\ Procs\ =\ "{}}\ <<\ nbProcess\ <<\ \textcolor{stringliteral}{"{},\ I\ am\ "{}}\ <<\ idProcess\ <<\ \textcolor{stringliteral}{"{}.\(\backslash\)n"{}});}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}Chunck\ Size\ =\ "{}}\ <<\ userChunkSize\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00176\ \ \ \ \ \}}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a5c06b480ee9f3c47724988f50d8c4c14}{\string~FFmmAlgorithmThreadProcPeriodic}}()\{}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxThread\ =\ 0\ ;\ idxThread\ <\ MaxThreads\ ;\ ++idxThread)\{}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ this-\/>kernels[idxThread];}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ this-\/>kernels;}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_af2f3968f5789f95490a1aea5a0a91a81}{intervals}};}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a75c3a2762a90be463a573874c7e4efbb}{workingIntervalsPerLevel}};}
\DoxyCodeLine{00187\ \ \ \ \ \}}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{int}\ theoricalRepetition()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ nbLevelsAboveRoot\ ==\ -\/1\ )\{}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ know\ it\ is\ 3\ (-\/1;+1)}}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 3;}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 6\ *\ (1\ <<\ nbLevelsAboveRoot);}
\DoxyCodeLine{00198\ \ \ \ \ \}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{keywordtype}{void}\ repetitionsIntervals(\mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}*\textcolor{keyword}{const}\ min,\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}*\textcolor{keyword}{const}\ max)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ nbLevelsAboveRoot\ ==\ -\/1\ )\{}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ know\ it\ is\ (-\/1;1)}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ min-\/>\mbox{\hyperlink{class_f_point_ad2eec275cf9bddb1c00acff4f7873e4d}{setPosition}}(-\/1,-\/1,-\/1);}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ max-\/>\mbox{\hyperlink{class_f_point_ad2eec275cf9bddb1c00acff4f7873e4d}{setPosition}}(1,1,1);}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ halfRepeated\ =\ int(theoricalRepetition()/2);}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ min-\/>\mbox{\hyperlink{class_f_point_ad2eec275cf9bddb1c00acff4f7873e4d}{setPosition}}(-\/halfRepeated,-\/halfRepeated,-\/halfRepeated);}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ we\ repeat\ the\ box\ 8\ times,\ we\ go\ from\ [-\/4\ to\ 3]}}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ max-\/>\mbox{\hyperlink{class_f_point_ad2eec275cf9bddb1c00acff4f7873e4d}{setPosition}}(halfRepeated-\/1,halfRepeated-\/1,halfRepeated-\/1);}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00213\ \ \ \ \ \}}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ FReal\ extendedBoxWidth()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ nbLevelsAboveRoot\ ==\ -\/1\ )\{}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ tree-\/>getBoxWidth()*2;}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ tree-\/>getBoxWidth()\ *\ FReal(4<<(nbLevelsAboveRoot));}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00223\ \ \ \ \ \}}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ FReal\ extendedBoxWidthBoundary()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ nbLevelsAboveRoot\ ==\ -\/1\ )\{}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ tree-\/>getBoxWidth()*4;}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ tree-\/>getBoxWidth()\ *\ FReal(8<<(nbLevelsAboveRoot));}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00232\ \ \ \ \ \}}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00241\ \ \ \ \ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a6d9e0f3cbe7565378c443999a3330bf1}{extendedBoxCenter}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ nbLevelsAboveRoot\ ==\ -\/1\ )\{}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ originalBoxWidth\ \ \ \ \ \ \ \ \ \ \ \ =\ tree-\/>getBoxWidth();}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ originalBoxCenter\ \ \ =\ tree-\/>getBoxCenter();}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ originalBoxWidthDiv2\ \ \ \ \ \ \ \ =\ originalBoxWidth/2.0;}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}(\ originalBoxCenter.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()\ +\ originalBoxWidthDiv2,}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ originalBoxCenter.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()\ +\ originalBoxWidthDiv2,}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ originalBoxCenter.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()\ +\ originalBoxWidthDiv2);}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ originalBoxWidth\ \ \ \ \ =\ tree-\/>getBoxWidth();}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ originalBoxWidthDiv2\ =\ originalBoxWidth/2.0;}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ originalBoxCenter\ \ \ =\ tree-\/>getBoxCenter();}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ offset\ =\ extendedBoxWidth()/FReal(2.0);}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}(\ originalBoxCenter.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()\ -\/\ originalBoxWidthDiv2\ +\ offset,}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ originalBoxCenter.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()\ -\/\ originalBoxWidthDiv2\ +\ offset,}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ originalBoxCenter.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()\ -\/\ originalBoxWidthDiv2\ +\ offset);}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00260\ \ \ \ \ \}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \ \ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ extendedBoxCenterBoundary()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ nbLevelsAboveRoot\ ==\ -\/1\ )\{}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ originalBoxWidth\ \ \ \ \ \ \ \ \ \ \ \ =\ tree-\/>getBoxWidth();}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ originalBoxCenter\ \ \ =\ tree-\/>getBoxCenter();}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ originalBoxWidthDiv2\ \ \ \ \ \ \ \ =\ originalBoxWidth/2.0;}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}(\ originalBoxCenter.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()\ +\ originalBoxWidthDiv2,}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ originalBoxCenter.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()\ +\ originalBoxWidthDiv2,}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ originalBoxCenter.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()\ +\ originalBoxWidthDiv2);}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ originalBoxWidth\ \ \ \ \ =\ tree-\/>getBoxWidth();}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ originalBoxWidthDiv2\ =\ originalBoxWidth/2.0;}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ originalBoxCenter\ \ \ =\ tree-\/>getBoxCenter();}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}(\ originalBoxCenter.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()\ +\ originalBoxWidthDiv2,}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ originalBoxCenter.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()\ +\ originalBoxWidthDiv2,}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ originalBoxCenter.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()\ +\ originalBoxWidthDiv2);}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00280\ \ \ \ \ \}}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a5938cd87fccbadb63e9fa4f8c458eab8}{extendedTreeHeight}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ real\ height}}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ OctreeHeight\ +\ offsetRealTree;}
\DoxyCodeLine{00291\ \ \ \ \ \}}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \ \ \textcolor{keywordtype}{int}\ extendedTreeHeightBoundary()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ real\ height}}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ OctreeHeight\ +\ offsetRealTree\ +\ 1;}
\DoxyCodeLine{00296\ \ \ \ \ \}}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00304\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_aba55ca07931868790ca33ea7d084b4b6}{executeCore}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ operationsToProceed)\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Count\ leaf}}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ this-\/>numberOfLeafs\ =\ 0;}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_interval}{Interval}}\ myFullInterval;}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{comment}{//Building\ the\ interval\ with\ the\ first\ and\ last\ leaves\ (and\ count\ the\ number\ of\ leaves)}}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ octreeIterator(tree);}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator.gotoBottomLeft();}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myFullInterval.leftIndex\ =\ octreeIterator.getCurrentGlobalIndex();}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\{}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++this-\/>numberOfLeafs;}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}(octreeIterator.moveRight());}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myFullInterval.rightIndex\ =\ octreeIterator.getCurrentGlobalIndex();}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Allocate\ a\ number\ to\ store\ the\ pointer\ of\ the\ cells\ at\ a\ level}}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \ \ iterArray\ \ \ \ \ =\ \textcolor{keyword}{new}\ \textcolor{keyword}{typename}\ OctreeClass::Iterator[numberOfLeafs];}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \ \ iterArrayComm\ =\ \textcolor{keyword}{new}\ \textcolor{keyword}{typename}\ OctreeClass::Iterator[numberOfLeafs];}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(iterArray,\ \ \ \ \ \textcolor{stringliteral}{"{}iterArray\ \ \ \ \ bad\ alloc"{}});}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(iterArrayComm,\ \textcolor{stringliteral}{"{}iterArrayComm\ bad\ alloc"{}});}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ get\ the\ leftIndex/rightIndex\ indexes\ from\ each\ procs}}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(\ MPI\_Allgather(\ \&myFullInterval,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_interval}{Interval}}),\ MPI\_BYTE,\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_af2f3968f5789f95490a1aea5a0a91a81}{intervals}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_interval}{Interval}}),\ MPI\_BYTE,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}()),\ \ \_\_LINE\_\_\ );}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Build\ my\ intervals\ for\ all\ levels}}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<Interval[]>\ myIntervals(\textcolor{keyword}{new}\ \mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_interval}{Interval}}[OctreeHeight]);}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ At\ leaf\ level\ we\ know\ it\ is\ the\ full\ interval}}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \ \ \ \ myIntervals[OctreeHeight\ -\/\ 1]\ =\ myFullInterval;}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ can\ estimate\ the\ interval\ for\ each\ level\ by\ using\ the\ parent/child\ relation}}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ OctreeHeight\ -\/\ 2\ ;\ idxLevel\ >=\ 0\ ;\ -\/-\/idxLevel)\{}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myIntervals[idxLevel].leftIndex\ =\ myIntervals[idxLevel+1].leftIndex\ >>\ 3;}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myIntervals[idxLevel].rightIndex\ =\ myIntervals[idxLevel+1].rightIndex\ >>\ 3;}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Process\ 0\ uses\ the\ estimates\ as\ real\ intervals,\ but\ other\ processes}}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ should\ remove\ cells\ that\ belong\ to\ others}}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idProcess\ !=\ 0)\{}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//We\ test\ for\ each\ level\ if\ process\ on\ left\ (idProcess-\/1)\ own\ cell\ I\ thought\ I\ owned}}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ octreeIterator(tree);}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator.gotoBottomLeft();}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator.moveUp();}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ At\ h-\/1\ the\ working\ limit\ is\ the\ parent\ of\ the\ right\ cell\ of\ the\ proc\ on\ the\ left}}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MortonIndex\ workingLimitAtLevel\ =\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_af2f3968f5789f95490a1aea5a0a91a81}{intervals}}[idProcess-\/1].rightIndex\ >>\ 3;}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ check\ if\ we\ have\ no\ more\ work\ to\ do}}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nullIntervalFromLevel\ =\ 0;}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ OctreeHeight\ -\/\ 2\ ;\ idxLevel\ >=\ 1\ \&\&\ nullIntervalFromLevel\ ==\ 0\ ;\ -\/-\/idxLevel)\{}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(octreeIterator.getCurrentGlobalIndex()\ <=\ workingLimitAtLevel)\{}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !octreeIterator.moveRight()\ )\{}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ cannot\ move\ right\ we\ are\ not\ owner\ of\ any\ more\ cell}}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nullIntervalFromLevel\ =\ idxLevel;}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ are\ responsible\ for\ some\ cells\ at\ this\ level\ keep\ the\ first\ index}}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(nullIntervalFromLevel\ ==\ 0)\{}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myIntervals[idxLevel].leftIndex\ =\ octreeIterator.getCurrentGlobalIndex();}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator.moveUp();}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ workingLimitAtLevel\ >>=\ 3;}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ In\ case\ we\ are\ not\ responsible\ for\ any\ cells\ we\ put\ the\ leftIndex\ =\ rightIndex+1}}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ nullIntervalFromLevel\ ;\ idxLevel\ >=\ 1\ ;\ -\/-\/idxLevel)\{}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myIntervals[idxLevel].leftIndex\ =\ myIntervals[idxLevel].rightIndex\ +\ 1;}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ get\ the\ leftIndex/rightIndex\ indexes\ from\ each\ procs}}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(\ MPI\_Allgather(\ myIntervals.get(),\ \textcolor{keywordtype}{int}(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_interval}{Interval}}))\ *\ OctreeHeight,\ MPI\_BYTE,}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a75c3a2762a90be463a573874c7e4efbb}{workingIntervalsPerLevel}},\ \textcolor{keywordtype}{int}(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_interval}{Interval}}))\ *\ OctreeHeight,\ MPI\_BYTE,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}()),\ \ \_\_LINE\_\_\ );}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ run;}}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_algorithm_timers_a414650c8c31b68bb838166554847cd7d}{Timers}}[P2MTimer].tic();}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(operationsToProceed\ \&\ FFmmP2M)\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_ace0612ec004670889f16c9d7780c4c45}{bottomPass}}();}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_algorithm_timers_a414650c8c31b68bb838166554847cd7d}{Timers}}[P2MTimer].tac();}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_algorithm_timers_a414650c8c31b68bb838166554847cd7d}{Timers}}[M2MTimer].tic();}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(operationsToProceed\ \&\ FFmmM2M)\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a5bb8e03a9de36b695fad6e66c74665bb}{upwardPass}}();}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_algorithm_timers_a414650c8c31b68bb838166554847cd7d}{Timers}}[M2MTimer].tac();}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_algorithm_timers_a414650c8c31b68bb838166554847cd7d}{Timers}}[M2LTimer].tic();}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(operationsToProceed\ \&\ FFmmM2L)\ transferPass();}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_algorithm_timers_a414650c8c31b68bb838166554847cd7d}{Timers}}[M2LTimer].tac();}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_algorithm_timers_a414650c8c31b68bb838166554847cd7d}{Timers}}[L2LTimer].tic();}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(operationsToProceed\ \&\ FFmmL2L)\ downardPass();}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_algorithm_timers_a414650c8c31b68bb838166554847cd7d}{Timers}}[L2LTimer].tac();}
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_algorithm_timers_a414650c8c31b68bb838166554847cd7d}{Timers}}[NearTimer].tic();}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}((operationsToProceed\ \&\ FFmmP2P)\ ||\ (operationsToProceed\ \&\ FFmmL2P))\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a7a98936159047398cf90d198588958cc}{directPass}}((operationsToProceed\ \&\ FFmmP2P),(operationsToProceed\ \&\ FFmmL2P));}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_algorithm_timers_a414650c8c31b68bb838166554847cd7d}{Timers}}[NearTimer].tac();}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ delete\ array}}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ \ \ \ \ iterArray;}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ \ \ \ \ iterArrayComm;}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ iterArray\ \ \ \ \ \ \ \ \ \ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ iterArrayComm\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00405\ \ \ \ \ \}}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00408\ \ \ \ \ \textcolor{comment}{//\ P2M}}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00416\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_ace0612ec004670889f16c9d7780c4c45}{bottomPass}}()\{}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller.write(\textcolor{stringliteral}{"{}\(\backslash\)tStart\ Bottom\ Pass\(\backslash\)n"{}}).write(FLog::Flush)\ );}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ counterTime);}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ computationCounter);}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ octreeIterator(tree);}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ the\ ptr\ to\ leaves\ in\ array}}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ octreeIterator.gotoBottomLeft();}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ leafs\ =\ 0;}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ iterArray[leafs++]\ =\ octreeIterator;}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}(octreeIterator.moveRight());}
\DoxyCodeLine{00428\ }
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ FLOG(computationCounter.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}());}
\DoxyCodeLine{00430\ \textcolor{preprocessor}{\#pragma\ omp\ parallel\ num\_threads(MaxThreads)}}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Each\ thread\ get\ its\ own\ kernel}}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \ \ \ \ KernelClass\ *\ \textcolor{keyword}{const}\ myThreadkernels\ =\ kernels[omp\_get\_thread\_num()];}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Parallel\ iteration\ on\ the\ leaves}}
\DoxyCodeLine{00435\ \textcolor{preprocessor}{\#pragma\ omp\ for\ nowait\ schedule(dynamic,\ userChunkSize)}}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLeafs\ =\ 0\ ;\ idxLeafs\ <\ leafs\ ;\ ++idxLeafs)\{}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myThreadkernels-\/>P2M(\ iterArray[idxLeafs].getCurrentCell()\ ,\ iterArray[idxLeafs].getCurrentListSrc());}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ FLOG(computationCounter.\mbox{\hyperlink{class_f_tic_a3efff71f7c95acd38451bfab08fa4583}{tac}}());}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)tFinished\ (@Bottom\ Pass\ (P2M)\ =\ "{}}\ \ <<\ counterTime.\mbox{\hyperlink{class_f_tic_ade3afdb1aa198635ebbc5ee8b7f4f081}{tacAndElapsed}}()\ <<\ \textcolor{stringliteral}{"{}\ s)\(\backslash\)n"{}}\ );}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Computation\ :\ "{}}\ <<\ computationCounter.\mbox{\hyperlink{class_f_tic_a30b9f876fb7188f85b4c2b9d7fd7943e}{elapsed}}()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller.flush());}
\DoxyCodeLine{00444\ \ \ \ \ \}}
\DoxyCodeLine{00445\ }
\DoxyCodeLine{00447\ \ \ \ \ \textcolor{comment}{//\ Upward}}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00451\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a5bb8e03a9de36b695fad6e66c74665bb}{upwardPass}}()\{}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller.write(\textcolor{stringliteral}{"{}\(\backslash\)tStart\ Upward\ Pass\(\backslash\)n"{}}).write(FLog::Flush);\ );}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ counterTime);}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ computationCounter);}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ singleCounter);}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ parallelCounter);}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Start\ from\ leal\ level\ (height-\/1)}}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ octreeIterator(tree);}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ octreeIterator.gotoBottomLeft();}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ octreeIterator.moveUp();}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ avoidGotoLeftIterator(octreeIterator);}
\DoxyCodeLine{00463\ }
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ proc\ to\ send\ the\ shared\ cells\ to}}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Starting\ to\ the\ proc\ on\ the\ left\ this\ variable\ will\ go\ to\ 0}}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ currentProcIdToSendTo\ =\ (idProcess\ -\/\ 1);}
\DoxyCodeLine{00467\ }
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There\ are\ a\ maximum\ of\ 1\ sends\ and\ 8-\/1\ receptions}}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ MPI\_Request\ requests[8];}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ MPI\_Status\ status[8];}
\DoxyCodeLine{00471\ }
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ MPI\_Request\ requestsSize[8];}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ MPI\_Status\ statusSize[8];}
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ FSize\ bufferSize;}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_buffer_writer}{FMpiBufferWriter}}\ sendBuffer(1);\textcolor{comment}{//\ Max\ =\ 1\ +\ sizeof(cell)*7}}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ std::unique\_ptr<FMpiBufferReader[]>\ recvBuffer(\textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_mpi_buffer_reader}{FMpiBufferReader}}[7]);}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ FSize\ recvBufferSize[7];}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ CellClass\ recvBufferCells[7];}
\DoxyCodeLine{00480\ }
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ first\ proc\ that\ send\ to\ me\ a\ cell}}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ variable\ will\ go\ to\ nbProcess}}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ firstProcThatSend\ =\ idProcess\ +\ 1;}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ FLOG(computationCounter.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}());}
\DoxyCodeLine{00485\ }
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ work\ from\ height-\/1\ to\ 1}}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ OctreeHeight\ -\/\ 2\ ;\ idxLevel\ >\ 0\ ;\ -\/-\/idxLevel\ )\{}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ fackLevel\ =\ idxLevel\ +\ offsetRealTree;}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Does\ my\ cells\ are\ covered\ by\ my\ neighbors\ working\ interval\ and\ so\ I\ have\ no\ more\ work?}}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ noMoreWorkForMe\ =\ (idProcess\ !=\ 0\ \&\&\ !\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel+1,\ idProcess));}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(noMoreWorkForMe)\{}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel,\ idProcess)\ ==\ \textcolor{keyword}{false});}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ and\ count\ ALL\ the\ cells\ (even\ the\ ones\ outside\ the\ working\ interval)}}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ totalNbCellsAtLevel\ =\ 0;}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\{}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iterArray[totalNbCellsAtLevel++]\ =\ octreeIterator;}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}(octreeIterator.moveRight());}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ \ \ \ avoidGotoLeftIterator.moveUp();}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator\ =\ avoidGotoLeftIterator;}
\DoxyCodeLine{00503\ }
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ iterMpiRequests\ \ \ \ \ \ \ =\ 0;\ \textcolor{comment}{//\ The\ iterator\ for\ send/recv\ requests}}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ iterMpiRequestsSize\ \ \ =\ 0;\ \textcolor{comment}{//\ The\ iterator\ for\ send/recv\ requests}}
\DoxyCodeLine{00506\ }
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nbCellsToSkip\ \ \ \ \ =\ 0;\ \textcolor{comment}{//\ The\ number\ of\ cells\ to\ send}}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ all\ the\ cells\ that\ are\ out\ of\ my\ working\ interval}}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(nbCellsToSkip\ <\ totalNbCellsAtLevel\ \&\&\ iterArray[nbCellsToSkip].getCurrentGlobalIndex()\ <\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel,\ idProcess).leftIndex)\{}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++nbCellsToSkip;}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00512\ }
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ know\ if\ we\ will\ recv\ something\ in\ order\ to\ know\ if\ threads\ skip\ the\ last\ cell}}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nbCellsForThreads\ =\ totalNbCellsAtLevel;\ \textcolor{comment}{//\ totalNbCellsAtLevel\ or\ totalNbCellsAtLevel-\/1}}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ hasToReceive\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idProcess\ !=\ nbProcess-\/1\ \&\&\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel\ ,\ idProcess))\{}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ the\ first\ proc\ that\ may\ send\ to\ me}}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(firstProcThatSend\ <\ nbProcess\ \&\&\ !\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel+1,\ firstProcThatSend)\ )\{}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ firstProcThatSend\ +=\ 1;}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Do\ we\ have\ to\ receive?}}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(firstProcThatSend\ <\ nbProcess\ \&\&\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel+1,\ firstProcThatSend)\ \&\&\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a89bc577cb52f95a7d705d1f82efa38cd}{procCoversMyRightBorderCell}}(idxLevel,\ firstProcThatSend)\ )\{}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hasToReceive\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Threads\ do\ not\ compute\ the\ last\ cell,\ we\ will\ do\ it\ once\ data\ are\ received}}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nbCellsForThreads\ -\/=\ 1;}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00528\ }
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(parallelCounter.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}());}
\DoxyCodeLine{00530\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ parallel\ num\_threads(MaxThreads)}}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ KernelClass*\ myThreadkernels\ =\ (kernels[omp\_get\_thread\_num()]);}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//This\ single\ section\ post\ and\ receive\ the\ comms,\ and\ then\ do\ the\ M2M\ associated\ with\ it.}}
\DoxyCodeLine{00534\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ single\ nowait}}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(singleCounter.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}());}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Master\ proc\ never\ send}}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idProcess\ !=\ 0)\{}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ process\ that\ have\ no\ work\ at\ that\ level}}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ currentProcIdToSendTo\ \&\&\ !\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel,\ currentProcIdToSendTo)\ \ )\{}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/currentProcIdToSendTo;}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Does\ the\ next\ proc\ that\ has\ work\ is\ sharing\ the\ parent\ of\ my\ left\ cell}}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel,\ currentProcIdToSendTo)\ \&\&\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a5c43fa25b8738ca5ce9684eccc1308eb}{procCoversMyLeftBorderCell}}(idxLevel,\ currentProcIdToSendTo))\{}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(nbCellsToSkip\ !=\ 0);}
\DoxyCodeLine{00546\ }
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ packageFlags\ =\ 0;}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_a0afc1bae9ec489108a86d6588e10cf2b}{write}}(packageFlags);}
\DoxyCodeLine{00549\ }
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ the\ cell\ the\ most\ on\ the\ right\ out\ of\ my\ working\ interval\ should\ be\ taken\ in}}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ consideration\ (at\ pos\ nbCellsToSkip-\/1)\ other\ (x\ <\ nbCellsToSkip-\/1)\ have\ already\ been\ sent}}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CellClass*\ \textcolor{keyword}{const}*\ \textcolor{keyword}{const}\ child\ =\ iterArray[nbCellsToSkip-\/1].getCurrentChild();}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxChild\ =\ 0\ ;\ idxChild\ <\ 8\ ;\ ++idxChild)\{}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ child\ exists\ and\ it\ was\ part\ of\ my\ working\ interval}}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ child[idxChild]\ \&\&\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}((idxLevel+1),\ idProcess).leftIndex\ <=\ child[idxChild]-\/>getMortonIndex()\ )\{}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ the\ cell\ to\ the\ buffer}}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ child[idxChild]-\/>serializeUp(sendBuffer);}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ packageFlags\ =\ char(packageFlags\ |\ (0x1\ <<\ idxChild));}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ the\ flag\ as\ first\ value}}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_a67d766a9b2e16206b809c5d3bfb69a3c}{writeAt}}(0,packageFlags);}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Post\ the\ message}}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferSize\ =\ sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_afc7f9cb6ee1c0bdcccfffaf187907858}{getSize}}();}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Isend(\&bufferSize,\ 1,\ \mbox{\hyperlink{class_f_mpi_a48a971c22b91bf6b4b5f827c9d9fdbee}{FMpi::GetType}}(bufferSize),\ currentProcIdToSendTo,}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FMpi::TagFmmM2MSize\ +\ idxLevel,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ \&requestsSize[iterMpiRequestsSize++]);}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_afc7f9cb6ee1c0bdcccfffaf187907858}{getSize}}()\ <\ std::numeric\_limits<int>::max());}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Isend(sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_a00e0998ee250133df7dcd5d9660e4ea8}{data}}(),\ \textcolor{keywordtype}{int}(sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_afc7f9cb6ee1c0bdcccfffaf187907858}{getSize}}()),\ MPI\_BYTE,\ currentProcIdToSendTo,}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FMpi::TagFmmM2M\ +\ idxLevel,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ \&requests[iterMpiRequests++]);}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00572\ }
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Post\ receive,\ Datas\ needed\ in\ several\ parts\ of\ the\ section}}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nbProcThatSendToMe\ =\ 0;}
\DoxyCodeLine{00575\ }
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(hasToReceive)\{}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Test\ :\ if\ the\ firstProcThatSend\ father\ minimal\ value\ in\ interval\ is\ lesser\ than\ mine}}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idProcSource\ =\ firstProcThatSend;}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ the\ last\ proc\ that\ should\ send\ to\ me}}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ idProcSource\ <\ nbProcess}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ (\ !\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel+1,\ idProcSource)\ ||\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a89bc577cb52f95a7d705d1f82efa38cd}{procCoversMyRightBorderCell}}(idxLevel,\ idProcSource)\ ))\{}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel+1,\ idProcSource)\ \&\&\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a89bc577cb52f95a7d705d1f82efa38cd}{procCoversMyRightBorderCell}}(idxLevel,\ idProcSource))\{}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Irecv(\&recvBufferSize[nbProcThatSendToMe],\ 1,\ \mbox{\hyperlink{class_f_mpi_a48a971c22b91bf6b4b5f827c9d9fdbee}{FMpi::GetType}}(recvBufferSize[nbProcThatSendToMe]),}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idProcSource,\ FMpi::TagFmmM2MSize\ +\ idxLevel,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ \&requestsSize[iterMpiRequestsSize++]);}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nbProcThatSendToMe\ +=\ 1;}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(nbProcThatSendToMe\ <=\ 7);}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++idProcSource;}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00591\ }
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Wait\ For\ the\ comms,\ and\ do\ the\ work}}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Are\ we\ sending\ or\ waiting\ anything?}}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(iterMpiRequestsSize)\{}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(iterMpiRequestsSize\ <=\ 8);}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Waitall(\ iterMpiRequestsSize,\ requestsSize,\ statusSize);}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00598\ }
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(hasToReceive)\{}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nbProcThatSendToMe\ =\ 0;}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Test\ :\ if\ the\ firstProcThatSend\ father\ minimal\ value\ in\ interval\ is\ lesser\ than\ mine}}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idProcSource\ =\ firstProcThatSend;}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ the\ last\ proc\ that\ should\ send\ to\ me}}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ idProcSource\ <\ nbProcess}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ (\ !\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel+1,\ idProcSource)\ ||\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a89bc577cb52f95a7d705d1f82efa38cd}{procCoversMyRightBorderCell}}(idxLevel,\ idProcSource)\ ))\{}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel+1,\ idProcSource)\ \&\&\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a89bc577cb52f95a7d705d1f82efa38cd}{procCoversMyRightBorderCell}}(idxLevel,\ idProcSource))\{}
\DoxyCodeLine{00607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recvBuffer[nbProcThatSendToMe].cleanAndResize(recvBufferSize[nbProcThatSendToMe]);}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(recvBufferSize[nbProcThatSendToMe]\ <\ std::numeric\_limits<int>::max());}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Irecv(recvBuffer[nbProcThatSendToMe].data(),\ \textcolor{keywordtype}{int}(recvBufferSize[nbProcThatSendToMe]),\ MPI\_BYTE,}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idProcSource,\ FMpi::TagFmmM2M\ +\ idxLevel,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ \&requests[iterMpiRequests++]);}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nbProcThatSendToMe\ +=\ 1;}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(nbProcThatSendToMe\ <=\ 7);}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++idProcSource;}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00617\ }
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Wait\ For\ the\ comms,\ and\ do\ the\ work}}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Are\ we\ sending\ or\ waiting\ anything?}}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(iterMpiRequests)\{}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(iterMpiRequests\ <=\ 8);}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Waitall(\ iterMpiRequests,\ requests,\ status);}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00624\ }
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ had\ received\ something\ so\ we\ need\ to\ proceed\ the\ last\ M2M}}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ hasToReceive\ )\{}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(iterMpiRequests\ !=\ 0);}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CellClass*\ currentChild[8];}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ memcpy(currentChild,\ iterArray[totalNbCellsAtLevel\ -\/\ 1].getCurrentChild(),\ 8\ *\ \textcolor{keyword}{sizeof}(CellClass*));}
\DoxyCodeLine{00630\ }
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Retreive\ data\ and\ merge\ my\ child\ and\ the\ child\ from\ others}}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProc\ =\ 0\ ;\ idxProc\ <\ nbProcThatSendToMe\ ;\ ++idxProc)\{}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ packageFlags\ =\ unsigned(recvBuffer[idxProc].getValue<unsigned\ char>());}
\DoxyCodeLine{00634\ }
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ position\ =\ 0;}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ positionToInsert\ =\ 0;}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ packageFlags\ \&\&\ position\ <\ 8)\{}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(!(packageFlags\ \&\ 0x1))\{}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ packageFlags\ >>=\ 1;}
\DoxyCodeLine{00640\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++position;}
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(positionToInsert\ <\ 7);}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(position\ <\ 8);}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(!currentChild[position],\ \textcolor{stringliteral}{"{}Already\ has\ a\ cell\ here"{}});}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recvBufferCells[positionToInsert].deserializeUp(recvBuffer[idxProc]);}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentChild[position]\ =\ (CellClass*)\ \&recvBufferCells[positionToInsert];}
\DoxyCodeLine{00647\ }
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ packageFlags\ >>=\ 1;}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ position\ +=\ 1;}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ positionToInsert\ +=\ 1;}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00652\ }
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recvBuffer[idxProc].seek(0);}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Finally\ compute}}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myThreadkernels-\/>M2M(\ iterArray[totalNbCellsAtLevel\ -\/\ 1].getCurrentCell()\ ,\ currentChild,\ fackLevel);}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ firstProcThatSend\ +=\ nbProcThatSendToMe\ -\/\ 1;}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ buffer}}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_a33be7e6032246aa5cd83c3d0b42d8c52}{reset}}();}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(singleCounter.\mbox{\hyperlink{class_f_tic_a3efff71f7c95acd38451bfab08fa4583}{tac}}());}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\textcolor{comment}{//End\ Of\ Single\ section}}
\DoxyCodeLine{00663\ }
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ All\ threads\ proceed\ the\ M2M}}
\DoxyCodeLine{00665\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ for\ nowait\ schedule(dynamic,\ userChunkSize)}}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keywordtype}{int}\ idxCell\ =\ nbCellsToSkip\ ;\ idxCell\ <\ nbCellsForThreads\ ;\ ++idxCell)\{}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myThreadkernels-\/>M2M(\ iterArray[idxCell].getCurrentCell()\ ,\ iterArray[idxCell].getCurrentChild(),\ fackLevel);}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \ \ \ \ \}\textcolor{comment}{//End\ of\ parallel\ section}}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(parallelCounter.\mbox{\hyperlink{class_f_tic_a3efff71f7c95acd38451bfab08fa4583}{tac}}());}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00672\ }
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ FLOG(counterTime.\mbox{\hyperlink{class_f_tic_a3efff71f7c95acd38451bfab08fa4583}{tac}}());}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ FLOG(computationCounter.\mbox{\hyperlink{class_f_tic_a3efff71f7c95acd38451bfab08fa4583}{tac}}());}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)tFinished\ (@Upward\ Pass\ (M2M)\ =\ "{}}\ \ <<\ counterTime.\mbox{\hyperlink{class_f_tic_a30b9f876fb7188f85b4c2b9d7fd7943e}{elapsed}}()\ <<\ \textcolor{stringliteral}{"{}\ s)\(\backslash\)n"{}}\ );}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Computation\ :\ "{}}\ <<\ computationCounter.\mbox{\hyperlink{class_f_tic_a30b9f876fb7188f85b4c2b9d7fd7943e}{elapsed}}()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Single\ :\ "{}}\ <<\ singleCounter.\mbox{\hyperlink{class_f_tic_ac53ed8191e3b5d9dadb88cae3f00a55e}{cumulated}}()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Parallel\ :\ "{}}\ <<\ parallelCounter.\mbox{\hyperlink{class_f_tic_ac53ed8191e3b5d9dadb88cae3f00a55e}{cumulated}}()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{00679\ }
\DoxyCodeLine{00680\ }
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \textcolor{comment}{//Periodicity}}
\DoxyCodeLine{00684\ }
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ octreeIterator\ =\ \textcolor{keyword}{typename}\ OctreeClass::Iterator(tree);}
\DoxyCodeLine{00686\ }
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ idProcess\ ==\ 0)\{}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ iterRequestsSize\ =\ 0;}
\DoxyCodeLine{00689\ }
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProc\ =\ 1\ ;\ idxProc\ <\ nbProcess\ ;\ ++idxProc\ )\{}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(1,idxProc)\ )\{}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Irecv(\&recvBufferSize[iterRequestsSize],\ 1,\ \mbox{\hyperlink{class_f_mpi_a48a971c22b91bf6b4b5f827c9d9fdbee}{FMpi::GetType}}(recvBufferSize[iterRequestsSize]),\ idxProc,}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FMpi::TagFmmM2MSize,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ \&requests[iterRequestsSize]);}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iterRequestsSize\ +=\ 1;}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(iterRequestsSize\ <=\ 7);}
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Waitall(\ iterRequestsSize,\ requests,\ MPI\_STATUSES\_IGNORE);}
\DoxyCodeLine{00699\ }
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ iterRequests\ =\ 0;}
\DoxyCodeLine{00701\ }
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProc\ =\ 1\ ;\ idxProc\ <\ nbProcess\ ;\ ++idxProc\ )\{}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(1,idxProc)\ )\{}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recvBuffer[iterRequests].cleanAndResize(recvBufferSize[iterRequests]);}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(recvBufferSize[iterRequests]\ <\ std::numeric\_limits<int>::max());}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Irecv(recvBuffer[iterRequests].data(),\ \textcolor{keywordtype}{int}(recvBufferSize[iterRequests]),\ MPI\_BYTE,\ idxProc,}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FMpi::TagFmmM2M,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ \&requests[iterRequests]);}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iterRequests\ +=\ 1;}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(iterRequests\ <=\ 7);}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00712\ }
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Waitall(\ iterRequests,\ requests,\ MPI\_STATUSES\_IGNORE);}
\DoxyCodeLine{00714\ }
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \ \ \ \ CellClass*\ currentChild[8];}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \ \ \ \ memcpy(currentChild,\ octreeIterator.getCurrentBox(),\ 8\ *\ \textcolor{keyword}{sizeof}(CellClass*));}
\DoxyCodeLine{00717\ }
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ retreive\ data\ and\ merge\ my\ child\ and\ the\ child\ from\ others}}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ counterProc\ =\ 0;}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProc\ =\ 1\ ;\ idxProc\ <\ nbProcess\ ;\ ++idxProc)\{}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(1,idxProc)\ )\{}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recvBuffer[counterProc].seek(0);}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ state\ =\ unsigned(recvBuffer[counterProc].getValue<unsigned\ char>());}
\DoxyCodeLine{00724\ }
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ position\ =\ 0;}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ positionToInsert\ =\ 0;}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ state\ \&\&\ position\ <\ 8)\{}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(!(state\ \&\ 0x1))\{}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ state\ >>=\ 1;}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++position;}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(positionToInsert\ <\ 7);}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(position\ <\ 8);}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(!currentChild[position],\ \textcolor{stringliteral}{"{}Already\ has\ a\ cell\ here"{}});}
\DoxyCodeLine{00735\ }
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recvBufferCells[positionToInsert].deserializeUp(recvBuffer[counterProc]);}
\DoxyCodeLine{00737\ }
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentChild[position]\ =\ (CellClass*)\ \&recvBufferCells[positionToInsert];}
\DoxyCodeLine{00739\ }
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ state\ >>=\ 1;}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ position\ +=\ 1;}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ positionToInsert\ +=\ 1;}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00744\ }
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(recvBuffer[counterProc].tell()\ ==\ recvBufferSize[counterProc]);}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ counterProc\ +=\ 1;}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00749\ }
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \ \ \ \ (*kernels[0]).M2M(\ \&rootCellFromProc\ ,\ currentChild,\ offsetRealTree);}
\DoxyCodeLine{00751\ }
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a6513b1c31411732e14f10b30f918d9d1}{processPeriodicLevels}}();}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a1a54c715e72598b9a3ceccb1d31b4f87}{hasWorkAtLevel}}(1)\ )\{}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ firstChild\ =\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(1,\ idProcess).leftIndex\ \&\ 7;}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ lastChild\ \ =\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(1,\ idProcess).rightIndex\ \&\ 7;}
\DoxyCodeLine{00758\ }
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CellClass**\ child\ =\ octreeIterator.getCurrentBox();}
\DoxyCodeLine{00760\ }
\DoxyCodeLine{00761\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ state\ =\ 0;}
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_a0afc1bae9ec489108a86d6588e10cf2b}{write}}(state);}
\DoxyCodeLine{00763\ }
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxChild\ =\ firstChild\ ;\ idxChild\ <=\ lastChild\ ;\ ++idxChild)\{}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ child[idxChild]\ )\{}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ child[idxChild]-\/>serializeUp(sendBuffer);}
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ state\ =\ char(\ state\ |\ (0x1\ <<\ idxChild));}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_a67d766a9b2e16206b809c5d3bfb69a3c}{writeAt}}(0,state);}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FSize\ sizeToSend\ =\ sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_afc7f9cb6ee1c0bdcccfffaf187907858}{getSize}}();}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Send(\&sizeToSend,\ 1,\ MPI\_LONG\_LONG,\ 0,\ FMpi::TagFmmM2MSize,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}());}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Send(sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_a00e0998ee250133df7dcd5d9660e4ea8}{data}}(),\ \textcolor{keywordtype}{int}(sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_afc7f9cb6ee1c0bdcccfffaf187907858}{getSize}}()),\ MPI\_BYTE,\ 0,\ FMpi::TagFmmM2M,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}());}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00776\ \ \ \ \ \}}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00779\ \ \ \ \ \textcolor{comment}{//\ Downard}}
\DoxyCodeLine{00781\ }
\DoxyCodeLine{00782\ }
\DoxyCodeLine{00783\ \ \ \ \ \textcolor{keywordtype}{void}\ transferPass()\{}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller.write(\textcolor{stringliteral}{"{}\(\backslash\)tStart\ Downward\ Pass\ (M2L)\(\backslash\)n"{}}).write(FLog::Flush);\ );}
\DoxyCodeLine{00785\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ counterTime);}
\DoxyCodeLine{00786\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ computationCounter);}
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ sendCounter);}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ receiveCounter);}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ prepareCounter);}
\DoxyCodeLine{00790\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ gatherCounter);}
\DoxyCodeLine{00791\ }
\DoxyCodeLine{00793\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ First\ know\ what\ to\ send\ to\ who}}
\DoxyCodeLine{00795\ }
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ pointer\ to\ send}}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ std::unique\_ptr<FVector<typename\ OctreeClass::Iterator>[]>\ toSend(\textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_vector}{FVector<typename\ OctreeClass::Iterator>}}[nbProcess\ *\ OctreeHeight]);}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ index}}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{int}*\textcolor{keyword}{const}\ indexToSend\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{int}[nbProcess\ *\ OctreeHeight];}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ memset(indexToSend,\ 0,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{int})\ *\ nbProcess\ *\ OctreeHeight);}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ To\ know\ which\ one\ has\ need\ someone}}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_bool_array}{FBoolArray}}**\ \textcolor{keyword}{const}\ leafsNeedOther\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_bool_array}{FBoolArray}}*[OctreeHeight];}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ memset(leafsNeedOther,\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{class_f_bool_array}{FBoolArray}}*)\ *\ OctreeHeight);}
\DoxyCodeLine{00804\ }
\DoxyCodeLine{00805\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ All\ process\ say\ to\ each\ others}}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ what\ the\ will\ send\ to\ who}}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{int}*\textcolor{keyword}{const}\ globalReceiveMap\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \ \textcolor{keywordtype}{int}[nbProcess\ *\ nbProcess\ *\ OctreeHeight];}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ \ memset(globalReceiveMap,\ 0,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \ \textcolor{keywordtype}{int})\ *\ nbProcess\ *\ nbProcess\ *\ OctreeHeight);}
\DoxyCodeLine{00809\ }
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_buffer_writer}{FMpiBufferWriter}}**\textcolor{keyword}{const}\ sendBuffer\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_mpi_buffer_writer}{FMpiBufferWriter}}*[nbProcess\ *\ OctreeHeight];}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ memset(sendBuffer,\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{class_f_mpi_buffer_writer}{FMpiBufferWriter}}*)\ *\ nbProcess\ *\ OctreeHeight);}
\DoxyCodeLine{00812\ }
\DoxyCodeLine{00813\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_buffer_reader}{FMpiBufferReader}}**\textcolor{keyword}{const}\ recvBuffer\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_mpi_buffer_reader}{FMpiBufferReader}}*[nbProcess\ *\ OctreeHeight];}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \ \ memset(recvBuffer,\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{class_f_mpi_buffer_reader}{FMpiBufferReader}}*)\ *\ nbProcess\ *\ OctreeHeight);}
\DoxyCodeLine{00815\ }
\DoxyCodeLine{00816\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#pragma\ omp\ parallel\ num\_threads(MaxThreads)}}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00818\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ master}}
\DoxyCodeLine{00819\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00821\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(prepareCounter.tic());}
\DoxyCodeLine{00822\ }
\DoxyCodeLine{00823\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<typename\ OctreeClass::Iterator[]>\ iterArrayLocal(\textcolor{keyword}{new}\ \textcolor{keyword}{typename}\ OctreeClass::Iterator[numberOfLeafs]);}
\DoxyCodeLine{00824\ }
\DoxyCodeLine{00825\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ To\ know\ if\ a\ leaf\ has\ been\ already\ sent\ to\ a\ proc}}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}*\textcolor{keyword}{const}\ alreadySent\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{bool}[nbProcess];}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ memset(alreadySent,\ 0,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{bool})\ *\ nbProcess);}
\DoxyCodeLine{00828\ }
\DoxyCodeLine{00829\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ octreeIterator(tree);}
\DoxyCodeLine{00831\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ avoidGotoLeftIterator(octreeIterator);}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ each\ levels}}
\DoxyCodeLine{00833\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 1\ ;\ idxLevel\ <\ OctreeHeight\ ;\ ++idxLevel\ )\{}
\DoxyCodeLine{00834\ }
\DoxyCodeLine{00835\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel,\ idProcess))\{}
\DoxyCodeLine{00836\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ avoidGotoLeftIterator.moveDown();}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator\ =\ avoidGotoLeftIterator;}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00840\ }
\DoxyCodeLine{00841\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ numberOfCells\ =\ 0;}
\DoxyCodeLine{00842\ }
\DoxyCodeLine{00843\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(octreeIterator.getCurrentGlobalIndex()\ <\ \ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel\ ,\ idProcess).leftIndex)\{}
\DoxyCodeLine{00844\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator.moveRight();}
\DoxyCodeLine{00845\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00846\ }
\DoxyCodeLine{00847\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ each\ cells}}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\{}
\DoxyCodeLine{00849\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iterArrayLocal[numberOfCells]\ =\ octreeIterator;}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++numberOfCells;}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}(octreeIterator.moveRight());}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ avoidGotoLeftIterator.moveDown();}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator\ =\ avoidGotoLeftIterator;}
\DoxyCodeLine{00854\ }
\DoxyCodeLine{00855\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leafsNeedOther[idxLevel]\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_bool_array}{FBoolArray}}(numberOfCells);}
\DoxyCodeLine{00856\ }
\DoxyCodeLine{00857\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Which\ cell\ potentialy\ needs\ other\ data\ and\ in\ the\ same\ time}}
\DoxyCodeLine{00858\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ are\ potentialy\ needed\ by\ other}}
\DoxyCodeLine{00859\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ neighborsPosition[\textcolor{comment}{/*189+26+1*/}216];}
\DoxyCodeLine{00860\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MortonIndex\ neighborsIndexes[\textcolor{comment}{/*189+26+1*/}216];}
\DoxyCodeLine{00861\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxCell\ =\ 0\ ;\ idxCell\ <\ numberOfCells\ ;\ ++idxCell)\{}
\DoxyCodeLine{00862\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ the\ M2L\ neigbors\ of\ a\ cell}}
\DoxyCodeLine{00863\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ counter\ =\ getPeriodicInteractionNeighbors(iterArray[idxCell].getCurrentGlobalCoordinate(),}
\DoxyCodeLine{00864\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idxLevel,}
\DoxyCodeLine{00865\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ neighborsIndexes,\ neighborsPosition,\ AllDirs,\ leafLevelSeparationCriteria);}
\DoxyCodeLine{00866\ }
\DoxyCodeLine{00867\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(alreadySent,\ \textcolor{keyword}{false},\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{bool})\ *\ nbProcess);}
\DoxyCodeLine{00868\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ needOther\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00869\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Test\ each\ negibors\ to\ know\ which\ one\ do\ not\ belong\ to\ us}}
\DoxyCodeLine{00870\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxNeigh\ =\ 0\ ;\ idxNeigh\ <\ counter\ ;\ ++idxNeigh)\{}
\DoxyCodeLine{00871\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(neighborsIndexes[idxNeigh]\ <\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel\ ,\ idProcess).leftIndex}
\DoxyCodeLine{00872\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel\ ,\ idProcess).rightIndex)\ <\ neighborsIndexes[idxNeigh])\{}
\DoxyCodeLine{00873\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ procToReceive\ =\ idProcess;}
\DoxyCodeLine{00874\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ 0\ !=\ procToReceive\ \&\&\ neighborsIndexes[idxNeigh]\ <\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel\ ,\ procToReceive).leftIndex\ )\{}
\DoxyCodeLine{00875\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/procToReceive;}
\DoxyCodeLine{00876\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00877\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ procToReceive\ !=\ nbProcess\ -\/1\ \&\&\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel\ ,\ procToReceive).rightIndex)\ <\ neighborsIndexes[idxNeigh])\{}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++procToReceive;}
\DoxyCodeLine{00879\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Maybe\ already\ sent\ to\ that\ proc?}}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !alreadySent[procToReceive]}
\DoxyCodeLine{00882\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel\ ,\ procToReceive).leftIndex\ <=\ neighborsIndexes[idxNeigh]}
\DoxyCodeLine{00883\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ neighborsIndexes[idxNeigh]\ <=\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel\ ,\ procToReceive).rightIndex)\{}
\DoxyCodeLine{00884\ }
\DoxyCodeLine{00885\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ alreadySent[procToReceive]\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00886\ }
\DoxyCodeLine{00887\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ needOther\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00888\ }
\DoxyCodeLine{00889\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ toSend[idxLevel\ *\ nbProcess\ +\ procToReceive].push(iterArrayLocal[idxCell]);}
\DoxyCodeLine{00890\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(indexToSend[idxLevel\ *\ nbProcess\ +\ procToReceive]\ ==\ 0)\{}
\DoxyCodeLine{00891\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ indexToSend[idxLevel\ *\ nbProcess\ +\ procToReceive]\ =\ \textcolor{keyword}{sizeof}(int);}
\DoxyCodeLine{00892\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00893\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ indexToSend[idxLevel\ *\ nbProcess\ +\ procToReceive]\ +=\ iterArrayLocal[idxCell].getCurrentCell()-\/>getSavedSizeUp();}
\DoxyCodeLine{00894\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ indexToSend[idxLevel\ *\ nbProcess\ +\ procToReceive]\ +=\ \textcolor{keyword}{sizeof}(MortonIndex);}
\DoxyCodeLine{00895\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ indexToSend[idxLevel\ *\ nbProcess\ +\ procToReceive]\ +=\ \textcolor{keyword}{sizeof}(FSize);}
\DoxyCodeLine{00896\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00897\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00898\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00899\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(needOther)\{}
\DoxyCodeLine{00900\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leafsNeedOther[idxLevel]-\/>\mbox{\hyperlink{class_f_bool_array_a391f0a8e3f0d923365d22304fda28fef}{set}}(idxCell,\textcolor{keyword}{true});}
\DoxyCodeLine{00901\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00902\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00903\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00904\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(prepareCounter.tac());}
\DoxyCodeLine{00905\ }
\DoxyCodeLine{00906\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ alreadySent;}
\DoxyCodeLine{00907\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00908\ }
\DoxyCodeLine{00910\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Gather\ this\ information}}
\DoxyCodeLine{00912\ }
\DoxyCodeLine{00913\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(gatherCounter.tic());}
\DoxyCodeLine{00914\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(\ MPI\_Allgather(\ indexToSend,\ nbProcess\ *\ OctreeHeight,\ MPI\_LONG\_LONG\_INT,\ globalReceiveMap,\ nbProcess\ *\ OctreeHeight,\ MPI\_LONG\_LONG\_INT,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}()),\ \ \_\_LINE\_\_\ );}
\DoxyCodeLine{00915\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(gatherCounter.tac());}
\DoxyCodeLine{00916\ }
\DoxyCodeLine{00918\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Send\ and\ receive\ for\ real}}
\DoxyCodeLine{00920\ }
\DoxyCodeLine{00921\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(sendCounter.tic());}
\DoxyCodeLine{00922\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Then\ they\ can\ send\ and\ receive\ (because\ they\ know\ what\ they\ will\ receive)}}
\DoxyCodeLine{00923\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ To\ send\ in\ asynchrone\ way}}
\DoxyCodeLine{00924\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<MPI\_Request>\ requests;}
\DoxyCodeLine{00925\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ requests.reserve(2\ *\ nbProcess\ *\ OctreeHeight);}
\DoxyCodeLine{00926\ }
\DoxyCodeLine{00927\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 1\ ;\ idxLevel\ <\ OctreeHeight\ ;\ ++idxLevel\ )\{}
\DoxyCodeLine{00928\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProc\ =\ 0\ ;\ idxProc\ <\ nbProcess\ ;\ ++idxProc)\{}
\DoxyCodeLine{00929\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{int}\ toSendAtProcAtLevel\ =\ indexToSend[idxLevel\ *\ nbProcess\ +\ idxProc];}
\DoxyCodeLine{00930\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(toSendAtProcAtLevel\ !=\ 0)\{}
\DoxyCodeLine{00931\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_mpi_buffer_writer}{FMpiBufferWriter}}(toSendAtProcAtLevel);}
\DoxyCodeLine{00932\ }
\DoxyCodeLine{00933\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>\mbox{\hyperlink{class_f_mpi_buffer_writer_a0afc1bae9ec489108a86d6588e10cf2b}{write}}(\textcolor{keywordtype}{int}(toSend[idxLevel\ *\ nbProcess\ +\ idxProc].getSize()));}
\DoxyCodeLine{00934\ }
\DoxyCodeLine{00935\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLeaf\ =\ 0\ ;\ idxLeaf\ <\ toSend[idxLevel\ *\ nbProcess\ +\ idxProc].getSize();\ ++idxLeaf)\{}
\DoxyCodeLine{00936\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FSize\ currentTell\ =\ sendBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>\mbox{\hyperlink{class_f_mpi_buffer_writer_afc7f9cb6ee1c0bdcccfffaf187907858}{getSize}}();}
\DoxyCodeLine{00937\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>\mbox{\hyperlink{class_f_mpi_buffer_writer_a0afc1bae9ec489108a86d6588e10cf2b}{write}}(currentTell);}
\DoxyCodeLine{00938\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ cellIndex\ =\ toSend[idxLevel\ *\ nbProcess\ +\ idxProc][idxLeaf].getCurrentGlobalIndex();}
\DoxyCodeLine{00939\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>\mbox{\hyperlink{class_f_mpi_buffer_writer_a0afc1bae9ec489108a86d6588e10cf2b}{write}}(cellIndex);}
\DoxyCodeLine{00940\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ toSend[idxLevel\ *\ nbProcess\ +\ idxProc][idxLeaf].getCurrentCell()-\/>serializeUp(*sendBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]);}
\DoxyCodeLine{00941\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00942\ }
\DoxyCodeLine{00943\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(sendBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>getSize()\ ==\ toSendAtProcAtLevel);}
\DoxyCodeLine{00944\ }
\DoxyCodeLine{00945\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(sendBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>getSize()\ <\ std::numeric\_limits<int>::max());}
\DoxyCodeLine{00946\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FMpi::ISendSplit(sendBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>data(),}
\DoxyCodeLine{00947\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>getSize(),\ idxProc,}
\DoxyCodeLine{00948\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FMpi::TagLast\ +\ idxLevel*100,\ comm,\ \&requests);}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00950\ }
\DoxyCodeLine{00951\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{int}\ toReceiveFromProcAtLevel\ =\ globalReceiveMap[(idxProc\ *\ nbProcess\ *\ OctreeHeight)\ +\ idxLevel\ *\ nbProcess\ +\ idProcess];}
\DoxyCodeLine{00952\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(toReceiveFromProcAtLevel)\{}
\DoxyCodeLine{00953\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recvBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_mpi_buffer_reader}{FMpiBufferReader}}(toReceiveFromProcAtLevel);}
\DoxyCodeLine{00954\ }
\DoxyCodeLine{00955\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(recvBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>getCapacity()\ <\ std::numeric\_limits<int>::max());}
\DoxyCodeLine{00956\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FMpi::IRecvSplit(recvBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>data(),}
\DoxyCodeLine{00957\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recvBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>getCapacity(),\ idxProc,}
\DoxyCodeLine{00958\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FMpi::TagLast\ +\ idxLevel*100,\ comm,\ \&requests);}
\DoxyCodeLine{00959\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00960\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00961\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00962\ }
\DoxyCodeLine{00964\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Wait\ received\ data\ and\ compute}}
\DoxyCodeLine{00966\ }
\DoxyCodeLine{00967\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Wait\ to\ receive\ every\ things\ (and\ send\ every\ things)}}
\DoxyCodeLine{00968\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(MPI\_Waitall(\textcolor{keywordtype}{int}(requests.size()),\ requests.data(),\ MPI\_STATUS\_IGNORE),\ \_\_LINE\_\_);}
\DoxyCodeLine{00969\ }
\DoxyCodeLine{00970\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(sendCounter.tac());}
\DoxyCodeLine{00971\ \ \ \ \ \ \ \ \ \ \ \ \ \}\textcolor{comment}{//End\ of\ Master\ region}}
\DoxyCodeLine{00972\ }
\DoxyCodeLine{00974\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Do\ M2L}}
\DoxyCodeLine{00976\ }
\DoxyCodeLine{00977\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ single\ nowait}}
\DoxyCodeLine{00978\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00979\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ octreeIterator(tree);}
\DoxyCodeLine{00981\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ avoidGotoLeftIterator(octreeIterator);}
\DoxyCodeLine{00982\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ we\ can\ compute\ all\ the\ data}}
\DoxyCodeLine{00983\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ each\ levels}}
\DoxyCodeLine{00984\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 1\ ;\ idxLevel\ <\ OctreeHeight\ ;\ ++idxLevel\ )\{}
\DoxyCodeLine{00985\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ fackLevel\ =\ idxLevel\ +\ offsetRealTree;}
\DoxyCodeLine{00986\ }
\DoxyCodeLine{00987\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ separationCriteria\ =\ (idxLevel\ !=\ OctreeHeight-\/1\ ?\ 1\ :\ leafLevelSeparationCriteria);}
\DoxyCodeLine{00988\ }
\DoxyCodeLine{00989\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel,\ idProcess))\{}
\DoxyCodeLine{00990\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ avoidGotoLeftIterator.moveDown();}
\DoxyCodeLine{00991\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator\ =\ avoidGotoLeftIterator;}
\DoxyCodeLine{00992\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00993\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00994\ }
\DoxyCodeLine{00995\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ numberOfCells\ =\ 0;}
\DoxyCodeLine{00996\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(octreeIterator.getCurrentGlobalIndex()\ <\ \ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel\ ,\ idProcess).leftIndex)\{}
\DoxyCodeLine{00997\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator.moveRight();}
\DoxyCodeLine{00998\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00999\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ each\ cells}}
\DoxyCodeLine{01000\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\{}
\DoxyCodeLine{01001\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iterArray[numberOfCells]\ =\ octreeIterator;}
\DoxyCodeLine{01002\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++numberOfCells;}
\DoxyCodeLine{01003\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}(octreeIterator.moveRight());}
\DoxyCodeLine{01004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ avoidGotoLeftIterator.moveDown();}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator\ =\ avoidGotoLeftIterator;}
\DoxyCodeLine{01006\ }
\DoxyCodeLine{01007\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(computationCounter.tic());}
\DoxyCodeLine{01008\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01009\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ chunckSize\ =\ userChunkSize;}
\DoxyCodeLine{01010\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxCell\ =\ 0\ ;\ idxCell\ <\ numberOfCells\ ;\ idxCell\ +=\ chunckSize)\{}
\DoxyCodeLine{01011\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ task\ default(none)\ shared(numberOfCells,idxLevel)\ firstprivate(idxCell)\ }\textcolor{comment}{//+\ shared(chunckSize)}}
\DoxyCodeLine{01012\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01013\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ KernelClass\ *\ \textcolor{keyword}{const}\ myThreadkernels\ =\ kernels[omp\_get\_thread\_num()];}
\DoxyCodeLine{01014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CellClass*\ neighbors[342];}
\DoxyCodeLine{01015\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ neighborPositions[342];}
\DoxyCodeLine{01016\ }
\DoxyCodeLine{01017\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ nbCellToCompute\ =\ \mbox{\hyperlink{struct_f_math_a43635af3d44bb1868015681ce994df7b}{FMath::Min}}(chunckSize,\ numberOfCells-\/idxCell);}
\DoxyCodeLine{01018\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxCellToCompute\ =\ idxCell\ ;\ idxCellToCompute\ <\ idxCell+nbCellToCompute\ ;\ ++idxCellToCompute)\{}
\DoxyCodeLine{01019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ counter\ =\ tree-\/>getPeriodicInteractionNeighbors(neighbors,\ neighborPositions,}
\DoxyCodeLine{01020\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iterArray[idxCellToCompute].getCurrentGlobalCoordinate(),}
\DoxyCodeLine{01021\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idxLevel,\ AllDirs,\ separationCriteria);}
\DoxyCodeLine{01022\ }
\DoxyCodeLine{01023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(counter)}
\DoxyCodeLine{01024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myThreadkernels-\/>M2L(\ iterArray[idxCellToCompute].getCurrentCell()\ ,\ neighbors,\ neighborPositions,\ counter,\ fackLevel);}
\DoxyCodeLine{01025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01026\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01027\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\textcolor{comment}{//End\ of\ task\ spawning}}
\DoxyCodeLine{01029\ }
\DoxyCodeLine{01030\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ taskwait}}
\DoxyCodeLine{01031\ }
\DoxyCodeLine{01032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxThread\ =\ 0\ ;\ idxThread\ <\ omp\_get\_num\_threads()\ ;\ ++idxThread)\{}
\DoxyCodeLine{01033\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ task\ \ default(none)\ firstprivate(idxThread,idxLevel)}}
\DoxyCodeLine{01034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ kernels[idxThread]-\/>finishedLevelM2L(fackLevel);}
\DoxyCodeLine{01036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01038\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ taskwait}}
\DoxyCodeLine{01039\ }
\DoxyCodeLine{01040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(computationCounter.tac());}
\DoxyCodeLine{01041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01043\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01044\ }
\DoxyCodeLine{01045\ }
\DoxyCodeLine{01046\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01047\ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(receiveCounter.tic());}
\DoxyCodeLine{01048\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ octreeIterator(tree);}
\DoxyCodeLine{01050\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ avoidGotoLeftIterator(octreeIterator);}
\DoxyCodeLine{01051\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ compute\ the\ second\ time}}
\DoxyCodeLine{01052\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ each\ levels}}
\DoxyCodeLine{01053\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 1\ ;\ idxLevel\ <\ OctreeHeight\ ;\ ++idxLevel\ )\{}
\DoxyCodeLine{01054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ fackLevel\ =\ idxLevel\ +\ offsetRealTree;}
\DoxyCodeLine{01055\ }
\DoxyCodeLine{01056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ separationCriteria\ =\ (fackLevel\ !=\ OctreeHeight-\/1\ ?\ 1\ :\ leafLevelSeparationCriteria);}
\DoxyCodeLine{01057\ }
\DoxyCodeLine{01058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel,\ idProcess))\{}
\DoxyCodeLine{01059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ avoidGotoLeftIterator.moveDown();}
\DoxyCodeLine{01060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator\ =\ avoidGotoLeftIterator;}
\DoxyCodeLine{01061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01063\ }
\DoxyCodeLine{01064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ the\ received\ data\ into\ a\ temporary\ tree}}
\DoxyCodeLine{01065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_light_octree}{FLightOctree<CellClass>}}\ tempTree;}
\DoxyCodeLine{01066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProc\ =\ 0\ ;\ idxProc\ <\ nbProcess\ ;\ ++idxProc)\{}
\DoxyCodeLine{01067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(recvBuffer[idxLevel\ *\ nbProcess\ +\ idxProc])\{}
\DoxyCodeLine{01068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ toReceiveFromProcAtLevel\ =\ recvBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>template\ getValue<int>();}
\DoxyCodeLine{01069\ }
\DoxyCodeLine{01070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxCell\ =\ 0\ ;\ idxCell\ <\ toReceiveFromProcAtLevel\ ;\ ++idxCell)\{}
\DoxyCodeLine{01071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FSize\ currentTell\ =\ recvBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>\mbox{\hyperlink{class_f_mpi_buffer_reader_a5a5cef9b49b77fb16da9427d608f06ee}{tell}}();}
\DoxyCodeLine{01072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FSize\ verifCurrentTell\ =\ recvBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>template\ getValue<FSize>();}
\DoxyCodeLine{01073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(currentTell\ ==\ verifCurrentTell,\ currentTell,\ \textcolor{stringliteral}{"{}\ "{}},\ verifCurrentTell);}
\DoxyCodeLine{01074\ }
\DoxyCodeLine{01075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ cellIndex\ =\ recvBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>template\ getValue<MortonIndex>();}
\DoxyCodeLine{01076\ }
\DoxyCodeLine{01077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CellClass*\ \textcolor{keyword}{const}\ newCell\ =\ \textcolor{keyword}{new}\ CellClass;}
\DoxyCodeLine{01078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ newCell-\/>setMortonIndex(cellIndex);}
\DoxyCodeLine{01079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ newCell-\/>deserializeUp(*recvBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]);}
\DoxyCodeLine{01080\ }
\DoxyCodeLine{01081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tempTree.insertCell(cellIndex,\ idxLevel,\ newCell);}
\DoxyCodeLine{01082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01083\ }
\DoxyCodeLine{01084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(globalReceiveMap[(idxProc\ *\ nbProcess\ *\ OctreeHeight)\ +\ idxLevel\ *\ nbProcess\ +\ idProcess]\ ==}
\DoxyCodeLine{01085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recvBuffer[idxLevel\ *\ nbProcess\ +\ idxProc]-\/>tell());}
\DoxyCodeLine{01086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01088\ }
\DoxyCodeLine{01089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ take\ cells\ from\ our\ octree\ only\ if\ they\ are}}
\DoxyCodeLine{01090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ linked\ to\ received\ data}}
\DoxyCodeLine{01091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ numberOfCells\ =\ 0;}
\DoxyCodeLine{01092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ realCellId\ =\ 0;}
\DoxyCodeLine{01093\ }
\DoxyCodeLine{01094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(octreeIterator.getCurrentGlobalIndex()\ <\ \ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel\ ,\ idProcess).leftIndex)\{}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator.moveRight();}
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ each\ cells}}
\DoxyCodeLine{01098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\{}
\DoxyCodeLine{01099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ copy\ cells\ that\ need\ data\ from\ others}}
\DoxyCodeLine{01100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(leafsNeedOther[idxLevel]-\/>get(realCellId++))\{}
\DoxyCodeLine{01101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iterArray[numberOfCells++]\ =\ octreeIterator;}
\DoxyCodeLine{01102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}(octreeIterator.moveRight());}
\DoxyCodeLine{01104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ avoidGotoLeftIterator.moveDown();}
\DoxyCodeLine{01105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator\ =\ avoidGotoLeftIterator;}
\DoxyCodeLine{01106\ }
\DoxyCodeLine{01107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ leafsNeedOther[idxLevel];}
\DoxyCodeLine{01108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leafsNeedOther[idxLevel]\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01109\ }
\DoxyCodeLine{01110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ this\ cells}}
\DoxyCodeLine{01111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(computationCounter.tic());}
\DoxyCodeLine{01112\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ parallel\ num\_threads(MaxThreads)}}
\DoxyCodeLine{01113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ KernelClass\ *\ \textcolor{keyword}{const}\ myThreadkernels\ =\ kernels[omp\_get\_thread\_num()];}
\DoxyCodeLine{01115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MortonIndex\ neighborsIndex[\textcolor{comment}{/*189+26+1*/}216];}
\DoxyCodeLine{01116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ neighborsPosition[\textcolor{comment}{/*189+26+1*/}216];}
\DoxyCodeLine{01117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CellClass*\ neighbors[342];}
\DoxyCodeLine{01118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ neighborPositions[342];}
\DoxyCodeLine{01119\ }
\DoxyCodeLine{01120\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ for\ \ schedule(dynamic,\ userChunkSize)\ nowait}}
\DoxyCodeLine{01121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxCell\ =\ 0\ ;\ idxCell\ <\ numberOfCells\ ;\ ++idxCell)\{}
\DoxyCodeLine{01122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ counterNeighbors\ =\ getPeriodicInteractionNeighbors(iterArray[idxCell].getCurrentGlobalCoordinate(),\ idxLevel,\ neighborsIndex,\ neighborsPosition,\ AllDirs,\ separationCriteria);}
\DoxyCodeLine{01123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ counter\ =\ 0;}
\DoxyCodeLine{01124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ does\ we\ receive\ this\ index\ from\ someone?}}
\DoxyCodeLine{01125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxNeig\ =\ 0\ ;idxNeig\ <\ counterNeighbors\ ;\ ++idxNeig)\{}
\DoxyCodeLine{01126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(neighborsIndex[idxNeig]\ <\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel\ ,\ idProcess).leftIndex)}
\DoxyCodeLine{01127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel\ ,\ idProcess).rightIndex)\ <\ neighborsIndex[idxNeig])\{}
\DoxyCodeLine{01128\ }
\DoxyCodeLine{01129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CellClass*\textcolor{keyword}{const}\ otherCell\ =\ tempTree.getCell(neighborsIndex[idxNeig],\ idxLevel);}
\DoxyCodeLine{01130\ }
\DoxyCodeLine{01131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(otherCell)\{}
\DoxyCodeLine{01132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//otherCell-\/>setMortonIndex(neighborsIndex[idxNeig]);}}
\DoxyCodeLine{01133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ neighbors[counter]\ =\ otherCell;}
\DoxyCodeLine{01134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ neighborPositions[counter]\ =\ neighborsPosition[idxNeig]\ ;}
\DoxyCodeLine{01135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++counter;}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ need\ to\ compute}}
\DoxyCodeLine{01140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(counter)\{}
\DoxyCodeLine{01141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myThreadkernels-\/>M2L(\ iterArray[idxCell].getCurrentCell()\ ,\ neighbors,\ neighborPositions,\ counter,\ fackLevel);}
\DoxyCodeLine{01142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01144\ }
\DoxyCodeLine{01145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myThreadkernels-\/>finishedLevelM2L(fackLevel);}
\DoxyCodeLine{01146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(computationCounter.tac());}
\DoxyCodeLine{01148\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01149\ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(receiveCounter.tac());}
\DoxyCodeLine{01150\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01151\ }
\DoxyCodeLine{01152\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxComm\ =\ 0\ ;\ idxComm\ <\ nbProcess\ *\ OctreeHeight;\ ++idxComm)\{}
\DoxyCodeLine{01153\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ sendBuffer[idxComm];}
\DoxyCodeLine{01154\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ recvBuffer[idxComm];}
\DoxyCodeLine{01155\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01156\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxComm\ =\ 0\ ;\ idxComm\ <\ OctreeHeight;\ ++idxComm)\{}
\DoxyCodeLine{01157\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ leafsNeedOther[idxComm];}
\DoxyCodeLine{01158\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01159\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ sendBuffer;}
\DoxyCodeLine{01160\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ recvBuffer;}
\DoxyCodeLine{01161\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ indexToSend;}
\DoxyCodeLine{01162\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ leafsNeedOther;}
\DoxyCodeLine{01163\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ globalReceiveMap;}
\DoxyCodeLine{01164\ }
\DoxyCodeLine{01165\ }
\DoxyCodeLine{01166\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)tFinished\ (@Downward\ Pass\ (M2L)\ =\ "{}}\ \ <<\ counterTime.tacAndElapsed()\ <<\ \textcolor{stringliteral}{"{}\ s)\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01167\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Computation\ :\ "{}}\ <<\ computationCounter.cumulated()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01168\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Send\ :\ "{}}\ <<\ sendCounter.cumulated()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01169\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Receive\ :\ "{}}\ <<\ receiveCounter.cumulated()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01170\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Gather\ :\ "{}}\ <<\ gatherCounter.cumulated()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01171\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Prepare\ :\ "{}}\ <<\ prepareCounter.cumulated()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01172\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller.flush());}
\DoxyCodeLine{01173\ }
\DoxyCodeLine{01174\ \ \ \ \ \}}
\DoxyCodeLine{01175\ }
\DoxyCodeLine{01177\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ L2L\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01179\ }
\DoxyCodeLine{01180\ \ \ \ \ \textcolor{keywordtype}{void}\ downardPass()\{\ \textcolor{comment}{//\ second\ L2L}}
\DoxyCodeLine{01181\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller.write(\textcolor{stringliteral}{"{}\(\backslash\)tStart\ Downward\ Pass\ (L2L)\(\backslash\)n"{}}).write(FLog::Flush);\ );}
\DoxyCodeLine{01182\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ counterTime);}
\DoxyCodeLine{01183\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ computationCounter);}
\DoxyCodeLine{01184\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ prepareCounter);}
\DoxyCodeLine{01185\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ waitCounter);}
\DoxyCodeLine{01186\ }
\DoxyCodeLine{01187\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Start\ from\ leal\ level\ -\/\ 1}}
\DoxyCodeLine{01188\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ octreeIterator(tree);}
\DoxyCodeLine{01190\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ avoidGotoLeftIterator(octreeIterator);}
\DoxyCodeLine{01191\ }
\DoxyCodeLine{01192\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Max\ 1\ receive\ and\ 7\ send\ (but\ 7\ times\ the\ same\ data)}}
\DoxyCodeLine{01193\ \ \ \ \ \ \ \ \ MPI\_Request*\textcolor{keyword}{const}\ requests\ =\ \textcolor{keyword}{new}\ MPI\_Request[8];}
\DoxyCodeLine{01194\ \ \ \ \ \ \ \ \ MPI\_Request*\textcolor{keyword}{const}\ requestsSize\ =\ \textcolor{keyword}{new}\ MPI\_Request[8];}
\DoxyCodeLine{01195\ }
\DoxyCodeLine{01196\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_buffer_writer}{FMpiBufferWriter}}\ sendBuffer;}
\DoxyCodeLine{01197\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_buffer_reader}{FMpiBufferReader}}\ recvBuffer;}
\DoxyCodeLine{01198\ }
\DoxyCodeLine{01199\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ righestProcToSendTo\ \ \ =\ nbProcess\ -\/\ 1;}
\DoxyCodeLine{01200\ }
\DoxyCodeLine{01201\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Periodic}}
\DoxyCodeLine{01202\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ idProcess\ ==\ 0)\{}
\DoxyCodeLine{01203\ \ \ \ \ \ \ \ \ \ \ \ \ rootCellFromProc.serializeDown(sendBuffer);}
\DoxyCodeLine{01204\ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_afc7f9cb6ee1c0bdcccfffaf187907858}{getSize}}()\ <\ std::numeric\_limits<int>::max());}
\DoxyCodeLine{01205\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ sizeOfSerialization\ =\ int(sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_afc7f9cb6ee1c0bdcccfffaf187907858}{getSize}}());}
\DoxyCodeLine{01206\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(\ MPI\_Bcast(\ \&sizeOfSerialization,\ 1,\ MPI\_INT,\ 0,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}()\ ),\ \_\_LINE\_\_\ );}
\DoxyCodeLine{01207\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(\ MPI\_Bcast(\ sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_a00e0998ee250133df7dcd5d9660e4ea8}{data}}(),\ \textcolor{keywordtype}{int}(sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_afc7f9cb6ee1c0bdcccfffaf187907858}{getSize}}()),\ MPI\_BYTE,\ 0,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}()\ ),\ \_\_LINE\_\_\ );}
\DoxyCodeLine{01208\ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_a33be7e6032246aa5cd83c3d0b42d8c52}{reset}}();}
\DoxyCodeLine{01209\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01210\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{01211\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ sizeOfSerialization\ =\ -\/1;}
\DoxyCodeLine{01212\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(\ MPI\_Bcast(\ \&sizeOfSerialization,\ 1,\ MPI\_INT,\ 0,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}()\ ),\ \_\_LINE\_\_\ );}
\DoxyCodeLine{01213\ \ \ \ \ \ \ \ \ \ \ \ \ recvBuffer.\mbox{\hyperlink{class_f_mpi_buffer_reader_acba450343ec567400e8d466337cb9db3}{cleanAndResize}}(sizeOfSerialization);}
\DoxyCodeLine{01214\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(\ MPI\_Bcast(\ recvBuffer.\mbox{\hyperlink{class_f_mpi_buffer_reader_aafcbe5cbd8a2e8434426959b4aba2c97}{data}}(),\ sizeOfSerialization,\ MPI\_BYTE,\ 0,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}()\ ),\ \_\_LINE\_\_\ );}
\DoxyCodeLine{01215\ \ \ \ \ \ \ \ \ \ \ \ \ rootCellFromProc.deserializeDown(recvBuffer);}
\DoxyCodeLine{01216\ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(recvBuffer.\mbox{\hyperlink{class_f_mpi_buffer_reader_abf7be319a03927f87c977d858a0e3ab4}{getSize}}()\ ==\ sizeOfSerialization);}
\DoxyCodeLine{01217\ \ \ \ \ \ \ \ \ \ \ \ \ recvBuffer.\mbox{\hyperlink{class_f_mpi_buffer_reader_a9ea55066fda1b31f13c1c175b39f1f64}{seek}}(0);}
\DoxyCodeLine{01218\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01219\ \ \ \ \ \ \ \ \ kernels[0]-\/>L2L(\&rootCellFromProc,\ octreeIterator.getCurrentBox(),\ offsetRealTree);}
\DoxyCodeLine{01220\ }
\DoxyCodeLine{01221\ }
\DoxyCodeLine{01222\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ each\ levels\ exepted\ leaf\ level}}
\DoxyCodeLine{01223\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 1\ ;\ idxLevel\ <\ OctreeHeight\ -\/\ 1\ ;\ ++idxLevel\ )\{}
\DoxyCodeLine{01224\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ fackLevel\ =\ idxLevel\ +\ offsetRealTree;}
\DoxyCodeLine{01225\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ nothing\ to\ do\ in\ the\ next\ level\ skip\ the\ current\ one}}
\DoxyCodeLine{01226\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idProcess\ !=\ 0\ \&\&\ !\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel+1,\ idProcess)\ )\{}
\DoxyCodeLine{01227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ avoidGotoLeftIterator.moveDown();}
\DoxyCodeLine{01228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator\ =\ avoidGotoLeftIterator;}
\DoxyCodeLine{01229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01230\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01231\ }
\DoxyCodeLine{01232\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ all\ the\ cells\ in\ an\ array\ even\ the\ one\ that\ are\ out\ of\ my\ working\ interval}}
\DoxyCodeLine{01233\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ totalNbCellsAtLevel\ =\ 0;}
\DoxyCodeLine{01234\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\{}
\DoxyCodeLine{01235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iterArray[totalNbCellsAtLevel++]\ =\ octreeIterator;}
\DoxyCodeLine{01236\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}(octreeIterator.moveRight());}
\DoxyCodeLine{01237\ \ \ \ \ \ \ \ \ \ \ \ \ avoidGotoLeftIterator.moveDown();}
\DoxyCodeLine{01238\ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator\ =\ avoidGotoLeftIterator;}
\DoxyCodeLine{01239\ }
\DoxyCodeLine{01240\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Count\ the\ number\ of\ cells\ that\ are\ out\ of\ my\ working\ interval}}
\DoxyCodeLine{01241\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nbCellsToSkip\ =\ 0;}
\DoxyCodeLine{01242\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(nbCellsToSkip\ <\ totalNbCellsAtLevel\ \&\&\ iterArray[nbCellsToSkip].getCurrentGlobalIndex()\ <\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a189aa3b1084194d01b0acd5930ff6940}{getWorkingInterval}}(idxLevel\ ,\ idProcess).leftIndex)\{}
\DoxyCodeLine{01243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nbCellsToSkip\ +=\ 1;}
\DoxyCodeLine{01244\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01245\ }
\DoxyCodeLine{01246\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ someone\ will\ send\ a\ cell\ to\ me}}
\DoxyCodeLine{01247\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ hasToReceive\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01248\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idxProcToReceive\ =\ idProcess\ -\/\ 1;}
\DoxyCodeLine{01249\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idProcess\ !=\ 0\ \&\&\ nbCellsToSkip)\{}
\DoxyCodeLine{01250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Starting\ from\ my\ left\ neighbor\ stop\ at\ the\ first\ proc\ that\ has\ work\ to\ do\ (not\ null\ interval)}}
\DoxyCodeLine{01251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(idxProcToReceive\ \&\&\ !\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel,\ idxProcToReceive)\ )\{}
\DoxyCodeLine{01252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idxProcToReceive\ -\/=\ 1;}
\DoxyCodeLine{01253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ we\ find\ such\ a\ proc\ and\ that\ it\ share\ a\ cell\ with\ us\ on\ the\ border}}
\DoxyCodeLine{01255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel,\ idxProcToReceive)\ \&\&\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a5c43fa25b8738ca5ce9684eccc1308eb}{procCoversMyLeftBorderCell}}(idxLevel,\ idxProcToReceive))\{}
\DoxyCodeLine{01256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hasToReceive\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01258\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01259\ }
\DoxyCodeLine{01260\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ parallel\ num\_threads(MaxThreads)}}
\DoxyCodeLine{01261\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ KernelClass*\ myThreadkernels\ =\ (kernels[omp\_get\_thread\_num()]);}
\DoxyCodeLine{01263\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ single\ nowait}}
\DoxyCodeLine{01264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(prepareCounter.tic());}
\DoxyCodeLine{01266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ iterRequests\ =\ 0;}
\DoxyCodeLine{01267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ iterRequestsSize\ =\ 0;}
\DoxyCodeLine{01268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FSize\ recvBufferSize\ =\ 0;}
\DoxyCodeLine{01269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FSize\ sendBufferSize;}
\DoxyCodeLine{01270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Post\ the\ receive}}
\DoxyCodeLine{01271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(hasToReceive)\{}
\DoxyCodeLine{01272\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(\ MPI\_Irecv(\ \&recvBufferSize,\ 1,\ \mbox{\hyperlink{class_f_mpi_a48a971c22b91bf6b4b5f827c9d9fdbee}{FMpi::GetType}}(recvBufferSize),\ idxProcToReceive,}
\DoxyCodeLine{01273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FMpi::TagFmmL2LSize\ +\ idxLevel,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ \&requestsSize[iterRequestsSize++]),\ \_\_LINE\_\_\ );}
\DoxyCodeLine{01274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01275\ }
\DoxyCodeLine{01276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ have\ to\ be\ sure\ that\ we\ are\ not\ sending\ if\ we\ have\ no\ work\ in\ the\ current\ level}}
\DoxyCodeLine{01277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idProcess\ !=\ nbProcess\ -\/\ 1\ \&\&\ idProcess\ <\ righestProcToSendTo\ \&\&\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel,\ idProcess))\{}
\DoxyCodeLine{01278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idxProcSend\ =\ idProcess\ +\ 1;}
\DoxyCodeLine{01279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nbMessageSent\ =\ 0;}
\DoxyCodeLine{01280\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ From\ the\ proc\ on\ the\ right\ to\ righestProcToSendTo,\ check\ if\ we\ have\ to\ send\ something}}
\DoxyCodeLine{01281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(idxProcSend\ <=\ righestProcToSendTo\ \&\&\ (\ !\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel+1,\ idxProcSend)\ ||\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a89bc577cb52f95a7d705d1f82efa38cd}{procCoversMyRightBorderCell}}(idxLevel,\ idxProcSend))\ )\{}
\DoxyCodeLine{01282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ know\ that\ if\ the\ proc\ has\ work\ at\ the\ next\ level\ it\ share\ a\ cell\ with\ us\ due\ to\ the\ while\ condition}}
\DoxyCodeLine{01283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a28ed76fb7492ad3c9df13a3c90c2e84f}{procHasWorkAtLevel}}(idxLevel+1,\ idxProcSend))\{}
\DoxyCodeLine{01284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a89bc577cb52f95a7d705d1f82efa38cd}{procCoversMyRightBorderCell}}(idxLevel,\ idxProcSend));}
\DoxyCodeLine{01285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ first\ message\ then\ serialize\ the\ cell\ to\ send}}
\DoxyCodeLine{01286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ nbMessageSent\ ==\ 0\ )\{}
\DoxyCodeLine{01287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ send\ our\ last\ cell}}
\DoxyCodeLine{01288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iterArray[totalNbCellsAtLevel\ -\/\ 1].getCurrentCell()-\/>serializeDown(sendBuffer);}
\DoxyCodeLine{01289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendBufferSize\ =\ sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_afc7f9cb6ee1c0bdcccfffaf187907858}{getSize}}();}
\DoxyCodeLine{01290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Post\ the\ send\ message}}
\DoxyCodeLine{01292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(\ MPI\_Isend(\&sendBufferSize,\ 1,\ \mbox{\hyperlink{class_f_mpi_a48a971c22b91bf6b4b5f827c9d9fdbee}{FMpi::GetType}}(sendBufferSize),\ idxProcSend,}
\DoxyCodeLine{01293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FMpi::TagFmmL2LSize\ +\ idxLevel,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ \&requestsSize[iterRequestsSize++]),\ \_\_LINE\_\_);}
\DoxyCodeLine{01294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_afc7f9cb6ee1c0bdcccfffaf187907858}{getSize}}()\ <\ std::numeric\_limits<int>::max());}
\DoxyCodeLine{01295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(\ MPI\_Isend(sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_a00e0998ee250133df7dcd5d9660e4ea8}{data}}(),\ \textcolor{keywordtype}{int}(sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_afc7f9cb6ee1c0bdcccfffaf187907858}{getSize}}()),\ MPI\_BYTE,\ idxProcSend,}
\DoxyCodeLine{01296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FMpi::TagFmmL2L\ +\ idxLevel,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ \&requests[iterRequests++]),\ \_\_LINE\_\_);}
\DoxyCodeLine{01297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Inc\ and\ check\ the\ counter}}
\DoxyCodeLine{01298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nbMessageSent\ +=\ 1;}
\DoxyCodeLine{01299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(nbMessageSent\ <=\ 7);}
\DoxyCodeLine{01300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idxProcSend\ +=\ 1;}
\DoxyCodeLine{01302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Next\ time\ we\ will\ not\ need\ to\ go\ further\ than\ idxProcSend}}
\DoxyCodeLine{01304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idxProcSend\ <\ righestProcToSendTo)\{}
\DoxyCodeLine{01305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ righestProcToSendTo\ =\ idxProcSend;}
\DoxyCodeLine{01306\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01307\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01308\ }
\DoxyCodeLine{01309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Finalize\ the\ communication}}
\DoxyCodeLine{01310\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(iterRequestsSize)\{}
\DoxyCodeLine{01311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(waitCounter.tic());}
\DoxyCodeLine{01312\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(iterRequestsSize\ <\ 8);}
\DoxyCodeLine{01313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(MPI\_Waitall(\ iterRequestsSize,\ requestsSize,\ MPI\_STATUSES\_IGNORE),\ \_\_LINE\_\_);}
\DoxyCodeLine{01314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(waitCounter.tac());}
\DoxyCodeLine{01315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01316\ }
\DoxyCodeLine{01317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(hasToReceive)\{}
\DoxyCodeLine{01318\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recvBuffer.\mbox{\hyperlink{class_f_mpi_buffer_reader_acba450343ec567400e8d466337cb9db3}{cleanAndResize}}(recvBufferSize);}
\DoxyCodeLine{01319\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(recvBuffer.\mbox{\hyperlink{class_f_mpi_buffer_reader_a96e01fc77c8c5aab78772de5d69e18ad}{getCapacity}}()\ <\ std::numeric\_limits<int>::max());}
\DoxyCodeLine{01320\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(\ MPI\_Irecv(\ recvBuffer.\mbox{\hyperlink{class_f_mpi_buffer_reader_aafcbe5cbd8a2e8434426959b4aba2c97}{data}}(),\ \textcolor{keywordtype}{int}(recvBuffer.\mbox{\hyperlink{class_f_mpi_buffer_reader_a96e01fc77c8c5aab78772de5d69e18ad}{getCapacity}}()),\ MPI\_BYTE,\ idxProcToReceive,}
\DoxyCodeLine{01321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FMpi::TagFmmL2L\ +\ idxLevel,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ \&requests[iterRequests++]),\ \_\_LINE\_\_\ );}
\DoxyCodeLine{01322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01323\ }
\DoxyCodeLine{01324\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(iterRequests)\{}
\DoxyCodeLine{01325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(waitCounter.tic());}
\DoxyCodeLine{01326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(iterRequests\ <\ 8);}
\DoxyCodeLine{01327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(MPI\_Waitall(\ iterRequests,\ requests,\ MPI\_STATUSES\_IGNORE),\ \_\_LINE\_\_);}
\DoxyCodeLine{01328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(waitCounter.tac());}
\DoxyCodeLine{01329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01330\ }
\DoxyCodeLine{01331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ receive\ something\ proceed\ the\ L2L}}
\DoxyCodeLine{01332\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(hasToReceive)\{}
\DoxyCodeLine{01333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(iterRequests\ !=\ 0);}
\DoxyCodeLine{01334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ In\ this\ case\ we\ know\ that\ we\ have\ to\ perform\ the\ L2L\ with\ the\ last\ cell\ that\ are}}
\DoxyCodeLine{01335\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ exclude\ from\ our\ working\ interval\ nbCellsToSkip-\/1}}
\DoxyCodeLine{01336\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iterArray[nbCellsToSkip-\/1].getCurrentCell()-\/>deserializeDown(recvBuffer);}
\DoxyCodeLine{01337\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myThreadkernels-\/>L2L(\ iterArray[nbCellsToSkip-\/1].getCurrentCell()\ ,\ iterArray[nbCellsToSkip-\/1].getCurrentChild(),\ fackLevel);}
\DoxyCodeLine{01338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01339\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(prepareCounter.tac());}
\DoxyCodeLine{01340\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01341\ }
\DoxyCodeLine{01342\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ single\ nowait}}
\DoxyCodeLine{01343\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01344\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(computationCounter.tic());}
\DoxyCodeLine{01345\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01346\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Threads\ are\ working\ on\ all\ the\ cell\ of\ our\ working\ interval\ at\ that\ level}}
\DoxyCodeLine{01347\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#pragma\ omp\ for\ nowait\ \ schedule(dynamic,\ userChunkSize)}}
\DoxyCodeLine{01348\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxCell\ =\ nbCellsToSkip\ ;\ idxCell\ <\ totalNbCellsAtLevel\ ;\ ++idxCell)\{}
\DoxyCodeLine{01349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myThreadkernels-\/>L2L(\ iterArray[idxCell].getCurrentCell()\ ,\ iterArray[idxCell].getCurrentChild(),\ fackLevel);}
\DoxyCodeLine{01350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01351\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01352\ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(computationCounter.tac());}
\DoxyCodeLine{01353\ }
\DoxyCodeLine{01354\ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer.\mbox{\hyperlink{class_f_mpi_buffer_writer_a33be7e6032246aa5cd83c3d0b42d8c52}{reset}}();}
\DoxyCodeLine{01355\ \ \ \ \ \ \ \ \ \ \ \ \ recvBuffer.\mbox{\hyperlink{class_f_mpi_buffer_reader_a9ea55066fda1b31f13c1c175b39f1f64}{seek}}(0);}
\DoxyCodeLine{01356\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01357\ }
\DoxyCodeLine{01358\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ requests;}
\DoxyCodeLine{01359\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ requestsSize;}
\DoxyCodeLine{01360\ }
\DoxyCodeLine{01361\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)tFinished\ (@Downward\ Pass\ (L2L)\ =\ "{}}\ \ <<\ counterTime.tacAndElapsed()\ <<\ \textcolor{stringliteral}{"{}\ s)\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01362\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Computation\ :\ "{}}\ <<\ computationCounter.cumulated()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01363\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Prepare\ :\ "{}}\ <<\ prepareCounter.cumulated()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01364\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Wait\ :\ "{}}\ <<\ waitCounter.cumulated()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01365\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller.flush());}
\DoxyCodeLine{01366\ \ \ \ \ \}}
\DoxyCodeLine{01367\ }
\DoxyCodeLine{01368\ }
\DoxyCodeLine{01370\ \ \ \ \ \textcolor{comment}{//\ Direct}}
\DoxyCodeLine{01372\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_leaf_data}{LeafData}}\{}
\DoxyCodeLine{01373\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ coord;}
\DoxyCodeLine{01374\ \ \ \ \ \ \ \ \ CellClass*\ cell;}
\DoxyCodeLine{01375\ \ \ \ \ \ \ \ \ ContainerClass*\ targets;}
\DoxyCodeLine{01376\ \ \ \ \ \ \ \ \ ContainerClass*\ sources;}
\DoxyCodeLine{01377\ \ \ \ \ \};}
\DoxyCodeLine{01378\ }
\DoxyCodeLine{01379\ }
\DoxyCodeLine{01381\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a7a98936159047398cf90d198588958cc}{directPass}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ p2pEnabled,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ l2pEnabled)\{}
\DoxyCodeLine{01382\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller.write(\textcolor{stringliteral}{"{}\(\backslash\)tStart\ Direct\ Pass\(\backslash\)n"{}}).write(FLog::Flush);\ );}
\DoxyCodeLine{01383\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ counterTime);}
\DoxyCodeLine{01384\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ prepareCounter);}
\DoxyCodeLine{01385\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ gatherCounter);}
\DoxyCodeLine{01386\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ waitCounter);}
\DoxyCodeLine{01387\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ computationCounter);}
\DoxyCodeLine{01388\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ computation2Counter);}
\DoxyCodeLine{01389\ }
\DoxyCodeLine{01391\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Prepare\ data\ to\ send\ receive}}
\DoxyCodeLine{01393\ \ \ \ \ \ \ \ \ FLOG(prepareCounter.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}());}
\DoxyCodeLine{01394\ }
\DoxyCodeLine{01395\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_bool_array}{FBoolArray}}\ leafsNeedOther(this-\/>numberOfLeafs);}
\DoxyCodeLine{01396\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ countNeedOther\ =\ 0;}
\DoxyCodeLine{01397\ \ \ \ \ \textcolor{keyword}{const}\ FReal\ boxWidth\ =\ tree-\/>getBoxWidth();}
\DoxyCodeLine{01398\ }
\DoxyCodeLine{01399\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ To\ store\ the\ result}}
\DoxyCodeLine{01400\ \ \ \ \ \ \ \ \ OctreeClass\ otherP2Ptree(\ tree-\/>getHeight(),\ tree-\/>getSubHeight(),}
\DoxyCodeLine{01401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxWidth,\ tree-\/>getBoxCenter()\ );}
\DoxyCodeLine{01402\ }
\DoxyCodeLine{01403\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ init}}
\DoxyCodeLine{01404\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ LeafIndex\ =\ OctreeHeight\ -\/\ 1;}
\DoxyCodeLine{01405\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ SizeShape\ =\ P2PExclusionClass::SizeShape;}
\DoxyCodeLine{01406\ }
\DoxyCodeLine{01407\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ shapeLeaf[SizeShape]\{\};}
\DoxyCodeLine{01408\ }
\DoxyCodeLine{01409\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_leaf_data}{LeafData}}*\ \textcolor{keyword}{const}\ leafsDataArray\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_leaf_data}{LeafData}}[this-\/>numberOfLeafs];}
\DoxyCodeLine{01410\ }
\DoxyCodeLine{01411\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_vector}{FVector<LeafData>}}\ leafsNeedOtherData(countNeedOther);}
\DoxyCodeLine{01412\ }
\DoxyCodeLine{01413\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_vector}{FVector<typename\ OctreeClass::Iterator>}}*\textcolor{keyword}{const}\ toSend\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_vector}{FVector<typename\ OctreeClass::Iterator>}}[nbProcess];}
\DoxyCodeLine{01414\ \ \ \ \ \ \ \ \ FSize\ partsToSend[nbProcess];}
\DoxyCodeLine{01415\ \ \ \ \ \ \ \ \ memset(partsToSend,\ 0,\ \textcolor{keyword}{sizeof}(FSize)\ *\ nbProcess);}
\DoxyCodeLine{01416\ }
\DoxyCodeLine{01417\ \textcolor{preprocessor}{\#pragma\ omp\ parallel\ num\_threads(MaxThreads)}}
\DoxyCodeLine{01418\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01419\ \textcolor{preprocessor}{\#pragma\ omp\ master\ }\textcolor{comment}{//\ MUST\ WAIT\ to\ fill\ leafsNeedOther}}
\DoxyCodeLine{01420\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(p2pEnabled)\{}
\DoxyCodeLine{01421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ leafs}}
\DoxyCodeLine{01422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ octreeIterator(tree);}
\DoxyCodeLine{01424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator.gotoBottomLeft();}
\DoxyCodeLine{01425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idxLeaf\ =\ 0;}
\DoxyCodeLine{01426\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\{}
\DoxyCodeLine{01427\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ this-\/>iterArray[idxLeaf++]\ =\ octreeIterator;}
\DoxyCodeLine{01428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}(octreeIterator.moveRight());}
\DoxyCodeLine{01429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ limite\ =\ 1\ <<\ (this-\/>OctreeHeight\ -\/\ 1);}
\DoxyCodeLine{01431\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ alreadySent[nbProcess];}
\DoxyCodeLine{01432\ }
\DoxyCodeLine{01433\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Will\ store\ the\ indexes\ of\ the\ neighbors\ of\ current\ cell}}
\DoxyCodeLine{01434\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MortonIndex\ indexesNeighbors[26];}
\DoxyCodeLine{01435\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ uselessIndexArray[26];}
\DoxyCodeLine{01436\ }
\DoxyCodeLine{01437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLeaf\ =\ 0\ ;\ idxLeaf\ <\ this-\/>numberOfLeafs\ ;\ ++idxLeaf)\{}
\DoxyCodeLine{01438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ memset(alreadySent,\ 0,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int})\ *\ nbProcess);}
\DoxyCodeLine{01439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ needOther\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Get\ the\ neighbors\ of\ current\ cell\ in\ indexesNeighbors,\ and\ their\ number\ in\ neighCount}}
\DoxyCodeLine{01441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ neighCount\ =\ getNeighborsIndexesPeriodic(iterArray[idxLeaf].getCurrentGlobalCoordinate(),limite,}
\DoxyCodeLine{01442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ indexesNeighbors,\ uselessIndexArray,\ AllDirs);}
\DoxyCodeLine{01443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Loop\ over\ the\ neighbor\ leafs}}
\DoxyCodeLine{01444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxNeigh\ =\ 0\ ;\ idxNeigh\ <\ neighCount\ ;\ ++idxNeigh)\{}
\DoxyCodeLine{01445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Test\ if\ leaf\ belongs\ to\ someone\ else\ (false\ if\ it's\ mine)}}
\DoxyCodeLine{01446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(indexesNeighbors[idxNeigh]\ <\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_af2f3968f5789f95490a1aea5a0a91a81}{intervals}}[idProcess].leftIndex)\ ||\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_af2f3968f5789f95490a1aea5a0a91a81}{intervals}}[idProcess].rightIndex)\ <\ indexesNeighbors[idxNeigh])\{}
\DoxyCodeLine{01447\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ needOther\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01448\ }
\DoxyCodeLine{01449\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ find\ the\ proc\ that\ will\ need\ current\ leaf}}
\DoxyCodeLine{01450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ procToReceive\ =\ idProcess;}
\DoxyCodeLine{01451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ procToReceive\ !=\ 0\ \&\&\ indexesNeighbors[idxNeigh]\ <\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_af2f3968f5789f95490a1aea5a0a91a81}{intervals}}[procToReceive].leftIndex)\{}
\DoxyCodeLine{01452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/procToReceive;\ \textcolor{comment}{//scroll\ process\ "{}before"{}\ current\ process}}
\DoxyCodeLine{01453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01454\ }
\DoxyCodeLine{01455\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ procToReceive\ !=\ nbProcess\ -\/\ 1\ \&\&\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_af2f3968f5789f95490a1aea5a0a91a81}{intervals}}[procToReceive].rightIndex)\ <\ indexesNeighbors[idxNeigh])\{}
\DoxyCodeLine{01456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++procToReceive;\textcolor{comment}{//scroll\ process\ "{}after"{}\ current\ process}}
\DoxyCodeLine{01457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ Test\ :\ Not\ Already\ Send\ \&\&\ be\ sure\ someone\ hold\ this\ interval}}
\DoxyCodeLine{01459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !alreadySent[procToReceive]\ \&\&\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_af2f3968f5789f95490a1aea5a0a91a81}{intervals}}[procToReceive].leftIndex\ <=\ indexesNeighbors[idxNeigh]\ \&\&\ indexesNeighbors[idxNeigh]\ <=\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_af2f3968f5789f95490a1aea5a0a91a81}{intervals}}[procToReceive].rightIndex)\{}
\DoxyCodeLine{01460\ }
\DoxyCodeLine{01461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ alreadySent[procToReceive]\ =\ 1;}
\DoxyCodeLine{01462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ toSend[procToReceive].\mbox{\hyperlink{class_f_vector_a0474667853d9c574c79c19a8f2a9dc2b}{push}}(\ iterArray[idxLeaf]\ );}
\DoxyCodeLine{01463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ partsToSend[procToReceive]\ +=\ iterArray[idxLeaf].getCurrentListSrc()-\/>getSavedSize();}
\DoxyCodeLine{01464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ partsToSend[procToReceive]\ +=\ int(\textcolor{keyword}{sizeof}(MortonIndex));}
\DoxyCodeLine{01465\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01467\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01468\ }
\DoxyCodeLine{01469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(needOther)\{\ \textcolor{comment}{//means\ that\ something\ need\ to\ be\ sent\ (or\ received)}}
\DoxyCodeLine{01470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leafsNeedOther.\mbox{\hyperlink{class_f_bool_array_a391f0a8e3f0d923365d22304fda28fef}{set}}(idxLeaf,\textcolor{keyword}{true});}
\DoxyCodeLine{01471\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++countNeedOther;}
\DoxyCodeLine{01472\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01473\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01474\ }
\DoxyCodeLine{01475\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ idea\ why\ it\ is\ mandatory\ there,\ could\ it\ be\ a\ few\ line\ before,}}
\DoxyCodeLine{01476\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProc\ =\ 0\ ;\ idxProc\ <\ nbProcess\ ;\ ++idxProc)\{}
\DoxyCodeLine{01477\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(partsToSend[idxProc])\{}
\DoxyCodeLine{01478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ partsToSend[idxProc]\ +=\ int(\textcolor{keyword}{sizeof}(FSize));}
\DoxyCodeLine{01479\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01481\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01482\ }
\DoxyCodeLine{01483\ \textcolor{preprocessor}{\#pragma\ omp\ barrier}}
\DoxyCodeLine{01484\ }
\DoxyCodeLine{01485\ \textcolor{preprocessor}{\#pragma\ omp\ master\ }\textcolor{comment}{//\ nowait}}
\DoxyCodeLine{01486\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(p2pEnabled)\{}
\DoxyCodeLine{01487\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ This\ a\ nbProcess\ x\ nbProcess\ matrix\ of\ integer}}
\DoxyCodeLine{01488\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ let\ U\ and\ V\ be\ id\ of\ processes\ :}}
\DoxyCodeLine{01489\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ globalReceiveMap[U*nbProcess\ +\ V]\ ==\ size\ of\ information\ needed\ by\ V\ and\ own\ by\ U}}
\DoxyCodeLine{01490\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{01491\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FSize*\textcolor{keyword}{const}\ globalReceiveMap\ =\ \textcolor{keyword}{new}\ FSize[nbProcess\ *\ nbProcess];}
\DoxyCodeLine{01492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ memset(globalReceiveMap,\ 0,\ \textcolor{keyword}{sizeof}(FSize)\ *\ nbProcess\ *\ nbProcess);}
\DoxyCodeLine{01493\ }
\DoxyCodeLine{01494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Share\ to\ all\ processus\ globalReceiveMap}}
\DoxyCodeLine{01495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(gatherCounter.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}());}
\DoxyCodeLine{01496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a19638e5c5eb8a18b69a017e0df10cf33}{FMpi::MpiAssert}}(\ MPI\_Allgather(\ partsToSend,\ nbProcess,\ \mbox{\hyperlink{class_f_mpi_a48a971c22b91bf6b4b5f827c9d9fdbee}{FMpi::GetType}}(*partsToSend),}
\DoxyCodeLine{01497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ globalReceiveMap,\ nbProcess,\ \mbox{\hyperlink{class_f_mpi_a48a971c22b91bf6b4b5f827c9d9fdbee}{FMpi::GetType}}(*partsToSend),\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}()),\ \ \_\_LINE\_\_\ );}
\DoxyCodeLine{01498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(gatherCounter.\mbox{\hyperlink{class_f_tic_a3efff71f7c95acd38451bfab08fa4583}{tac}}());}
\DoxyCodeLine{01499\ }
\DoxyCodeLine{01500\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_buffer_reader}{FMpiBufferReader}}**\textcolor{keyword}{const}\ recvBuffer\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_mpi_buffer_reader}{FMpiBufferReader}}*[nbProcess];}
\DoxyCodeLine{01501\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ memset(recvBuffer,\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{class_f_mpi_buffer_reader}{FMpiBufferReader}}*)\ *\ nbProcess);}
\DoxyCodeLine{01502\ }
\DoxyCodeLine{01503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_buffer_writer}{FMpiBufferWriter}}**\textcolor{keyword}{const}\ sendBuffer\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_mpi_buffer_writer}{FMpiBufferWriter}}*[nbProcess];}
\DoxyCodeLine{01504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ memset(sendBuffer,\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{class_f_mpi_buffer_writer}{FMpiBufferWriter}}*)\ *\ nbProcess);}
\DoxyCodeLine{01505\ }
\DoxyCodeLine{01506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ To\ send\ in\ asynchrone\ way}}
\DoxyCodeLine{01507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<MPI\_Request>\ requests;}
\DoxyCodeLine{01508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ requests.reserve(2\ *\ nbProcess);}
\DoxyCodeLine{01509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Prepare\ receive}}
\DoxyCodeLine{01510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProc\ =\ 0\ ;\ idxProc\ <\ nbProcess\ ;\ ++idxProc)\{}
\DoxyCodeLine{01511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(globalReceiveMap[idxProc\ *\ nbProcess\ +\ idProcess])\{\ \textcolor{comment}{//if\ idxProc\ has\ sth\ for\ me.}}
\DoxyCodeLine{01512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//allocate\ buffer\ of\ right\ size}}
\DoxyCodeLine{01513\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recvBuffer[idxProc]\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_mpi_buffer_reader}{FMpiBufferReader}}(globalReceiveMap[idxProc\ *\ nbProcess\ +\ idProcess]);}
\DoxyCodeLine{01514\ }
\DoxyCodeLine{01515\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FMpi::IRecvSplit(recvBuffer[idxProc]-\/>data(),\ recvBuffer[idxProc]-\/>getCapacity(),}
\DoxyCodeLine{01516\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idxProc,\ FMpi::TagFmmP2P,\ comm,\ \&requests);}
\DoxyCodeLine{01517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01518\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01519\ }
\DoxyCodeLine{01520\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Prepare\ send}}
\DoxyCodeLine{01521\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProc\ =\ 0\ ;\ idxProc\ <\ nbProcess\ ;\ ++idxProc)\{}
\DoxyCodeLine{01522\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(toSend[idxProc].getSize()\ !=\ 0)\{}
\DoxyCodeLine{01523\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer[idxProc]\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_mpi_buffer_writer}{FMpiBufferWriter}}(globalReceiveMap[idProcess*nbProcess+idxProc]);}
\DoxyCodeLine{01524\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ <<\ is\ equivalent\ to\ write().}}
\DoxyCodeLine{01525\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (*sendBuffer[idxProc])\ <<\ toSend[idxProc].getSize();}
\DoxyCodeLine{01526\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLeaf\ =\ 0\ ;\ idxLeaf\ <\ toSend[idxProc].\mbox{\hyperlink{class_f_vector_ae27a83b0b3e11851c9b3f5991937e3f2}{getSize}}()\ ;\ ++idxLeaf)\{}
\DoxyCodeLine{01527\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (*sendBuffer[idxProc])\ <<\ toSend[idxProc][idxLeaf].getCurrentGlobalIndex();}
\DoxyCodeLine{01528\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ toSend[idxProc][idxLeaf].getCurrentListSrc()-\/>save(*sendBuffer[idxProc]);}
\DoxyCodeLine{01529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01530\ }
\DoxyCodeLine{01531\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(sendBuffer[idxProc]-\/>getSize()\ ==\ globalReceiveMap[idProcess*nbProcess+idxProc]);}
\DoxyCodeLine{01532\ }
\DoxyCodeLine{01533\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FMpi::ISendSplit(sendBuffer[idxProc]-\/>data(),\ sendBuffer[idxProc]-\/>getSize(),}
\DoxyCodeLine{01534\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idxProc,\ FMpi::TagFmmP2P,\ comm,\ \&requests);}
\DoxyCodeLine{01535\ }
\DoxyCodeLine{01536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01537\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01538\ }
\DoxyCodeLine{01539\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ toSend;}
\DoxyCodeLine{01540\ }
\DoxyCodeLine{01541\ }
\DoxyCodeLine{01543\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Waitsend\ receive}}
\DoxyCodeLine{01545\ }
\DoxyCodeLine{01546\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<MPI\_Status[]>\ status(\textcolor{keyword}{new}\ MPI\_Status[requests.size()]);}
\DoxyCodeLine{01547\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Wait\ data}}
\DoxyCodeLine{01548\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(waitCounter.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}());}
\DoxyCodeLine{01549\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Waitall(\textcolor{keywordtype}{int}(requests.size()),\ requests.data(),\ status.get());}
\DoxyCodeLine{01550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(waitCounter.\mbox{\hyperlink{class_f_tic_a3efff71f7c95acd38451bfab08fa4583}{tac}}());}
\DoxyCodeLine{01551\ }
\DoxyCodeLine{01552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProc\ =\ 0\ ;\ idxProc\ <\ nbProcess\ ;\ ++idxProc)\{}
\DoxyCodeLine{01553\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(globalReceiveMap[idxProc\ *\ nbProcess\ +\ idProcess])\{\ \textcolor{comment}{//if\ idxProc\ has\ sth\ for\ me.}}
\DoxyCodeLine{01554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(recvBuffer[idxProc]);}
\DoxyCodeLine{01555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_buffer_reader}{FMpiBufferReader}}\&\ currentBuffer\ =\ (*recvBuffer[idxProc]);}
\DoxyCodeLine{01556\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FSize\ nbLeaves;}
\DoxyCodeLine{01557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentBuffer\ >>\ nbLeaves;}
\DoxyCodeLine{01558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(FSize\ idxLeaf\ =\ 0\ ;\ idxLeaf\ <\ nbLeaves\ ;\ ++idxLeaf)\{}
\DoxyCodeLine{01559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MortonIndex\ leafIndex;}
\DoxyCodeLine{01560\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentBuffer\ >>\ leafIndex;}
\DoxyCodeLine{01561\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ otherP2Ptree.createLeaf(leafIndex)-\/>getSrc()-\/>restore(currentBuffer);}
\DoxyCodeLine{01562\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01563\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Realease\ memory\ early}}
\DoxyCodeLine{01564\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ recvBuffer[idxProc];}
\DoxyCodeLine{01565\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recvBuffer[idxProc]\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01566\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01567\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01568\ }
\DoxyCodeLine{01569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProc\ =\ 0\ ;\ idxProc\ <\ nbProcess\ ;\ ++idxProc)\{}
\DoxyCodeLine{01570\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ sendBuffer[idxProc];}
\DoxyCodeLine{01571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ recvBuffer[idxProc];}
\DoxyCodeLine{01572\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ globalReceiveMap;}
\DoxyCodeLine{01574\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01575\ }
\DoxyCodeLine{01577\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Prepare\ data\ for\ thread\ P2P}}
\DoxyCodeLine{01579\ }
\DoxyCodeLine{01580\ \textcolor{preprocessor}{\#pragma\ omp\ single\ }\textcolor{comment}{//\ MUST\ WAIT!}}
\DoxyCodeLine{01581\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01582\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator\ octreeIterator(tree);}
\DoxyCodeLine{01583\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator.gotoBottomLeft();}
\DoxyCodeLine{01584\ }
\DoxyCodeLine{01585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ to\ store\ which\ shape\ for\ each\ leaf}}
\DoxyCodeLine{01586\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ OctreeClass::Iterator*\ \textcolor{keyword}{const}\ myLeafs\ =\ \textcolor{keyword}{new}\ \textcolor{keyword}{typename}\ OctreeClass::Iterator[this-\/>numberOfLeafs];}
\DoxyCodeLine{01587\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}*\textcolor{keyword}{const}\ shapeType\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{int}[this-\/>numberOfLeafs];}
\DoxyCodeLine{01588\ }
\DoxyCodeLine{01589\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLeaf\ =\ 0\ ;\ idxLeaf\ <\ this-\/>numberOfLeafs\ ;\ ++idxLeaf)\{}
\DoxyCodeLine{01590\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myLeafs[idxLeaf]\ =\ octreeIterator;}
\DoxyCodeLine{01591\ }
\DoxyCodeLine{01592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\&\ coord\ =\ octreeIterator.getCurrentCell()-\/>getCoordinate();}
\DoxyCodeLine{01593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ shape\ =\ P2PExclusionClass::GetShapeIdx(coord);}
\DoxyCodeLine{01594\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ shapeType[idxLeaf]\ =\ shape;}
\DoxyCodeLine{01595\ }
\DoxyCodeLine{01596\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++shapeLeaf[shape];}
\DoxyCodeLine{01597\ }
\DoxyCodeLine{01598\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ octreeIterator.moveRight();}
\DoxyCodeLine{01599\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01600\ }
\DoxyCodeLine{01601\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ startPosAtShape[SizeShape];}
\DoxyCodeLine{01602\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ startPosAtShape[0]\ =\ 0;}
\DoxyCodeLine{01603\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxShape\ =\ 1\ ;\ idxShape\ <\ SizeShape\ ;\ ++idxShape)\{}
\DoxyCodeLine{01604\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ startPosAtShape[idxShape]\ =\ startPosAtShape[idxShape-\/1]\ +\ shapeLeaf[idxShape-\/1];}
\DoxyCodeLine{01605\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01606\ }
\DoxyCodeLine{01607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idxInArray\ =\ 0;}
\DoxyCodeLine{01608\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLeaf\ =\ 0\ ;\ idxLeaf\ <\ this-\/>numberOfLeafs\ ;\ ++idxLeaf,\ ++idxInArray)\{}
\DoxyCodeLine{01609\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ shapePosition\ =\ shapeType[idxInArray];}
\DoxyCodeLine{01610\ }
\DoxyCodeLine{01611\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leafsDataArray[startPosAtShape[shapePosition]].coord\ =\ myLeafs[idxInArray].getCurrentGlobalCoordinate();}
\DoxyCodeLine{01612\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leafsDataArray[startPosAtShape[shapePosition]].cell\ =\ myLeafs[idxInArray].getCurrentCell();}
\DoxyCodeLine{01613\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leafsDataArray[startPosAtShape[shapePosition]].targets\ =\ myLeafs[idxInArray].getCurrentListTargets();}
\DoxyCodeLine{01614\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leafsDataArray[startPosAtShape[shapePosition]].sources\ =\ myLeafs[idxInArray].getCurrentListSrc();}
\DoxyCodeLine{01615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ leafsNeedOther.\mbox{\hyperlink{class_f_bool_array_a3ae5009b7fff6b703b60775cc8f53fd6}{get}}(idxLeaf)\ )\ leafsNeedOtherData.\mbox{\hyperlink{class_f_vector_a0474667853d9c574c79c19a8f2a9dc2b}{push}}(leafsDataArray[startPosAtShape[shapePosition]]);}
\DoxyCodeLine{01616\ }
\DoxyCodeLine{01617\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++startPosAtShape[shapePosition];}
\DoxyCodeLine{01618\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01619\ }
\DoxyCodeLine{01620\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ shapeType;}
\DoxyCodeLine{01621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ myLeafs;}
\DoxyCodeLine{01622\ }
\DoxyCodeLine{01623\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(prepareCounter.\mbox{\hyperlink{class_f_tic_a3efff71f7c95acd38451bfab08fa4583}{tac}}());}
\DoxyCodeLine{01624\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01625\ }
\DoxyCodeLine{01626\ }
\DoxyCodeLine{01628\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Computation\ P2P\ that\ DO\ NOT\ need\ others\ data}}
\DoxyCodeLine{01630\ }
\DoxyCodeLine{01631\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01632\ \textcolor{preprocessor}{\#pragma\ omp\ single\ nowait}}
\DoxyCodeLine{01633\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01634\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(computationCounter.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}());}
\DoxyCodeLine{01635\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ previous\ =\ 0;}
\DoxyCodeLine{01636\ }
\DoxyCodeLine{01637\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxShape\ =\ 0\ ;\ idxShape\ <\ SizeShape\ ;\ ++idxShape)\{}
\DoxyCodeLine{01638\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ endAtThisShape\ =\ shapeLeaf[idxShape]\ +\ previous;}
\DoxyCodeLine{01639\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ chunckSize\ =\ userChunkSize;}
\DoxyCodeLine{01640\ }
\DoxyCodeLine{01641\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLeafs\ =\ previous\ ;\ idxLeafs\ <\ endAtThisShape\ ;\ idxLeafs\ +=\ chunckSize)\{}
\DoxyCodeLine{01642\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ nbLeavesInTask\ =\ \mbox{\hyperlink{struct_f_math_a43635af3d44bb1868015681ce994df7b}{FMath::Min}}(endAtThisShape-\/idxLeafs,\ chunckSize);}
\DoxyCodeLine{01643\ \textcolor{preprocessor}{\#pragma\ omp\ task\ default(none)\ firstprivate(nbLeavesInTask,idxLeafs)\ }\textcolor{comment}{//+\ shared(leafsDataArray)}}
\DoxyCodeLine{01644\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01645\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ KernelClass*\ myThreadkernels\ =\ (kernels[omp\_get\_thread\_num()]);}
\DoxyCodeLine{01646\ }
\DoxyCodeLine{01647\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There\ is\ a\ maximum\ of\ 26\ neighbors}}
\DoxyCodeLine{01648\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass*\ neighbors[26]\{\};}
\DoxyCodeLine{01649\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ offsets[26]\{\};}
\DoxyCodeLine{01650\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ neighborPositions[26]\{\};}
\DoxyCodeLine{01651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::array<FTreeCoordinate,26>\ periodicOffsets\{\}\ ;}
\DoxyCodeLine{01652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ hasPeriodicLeaves\{\};}
\DoxyCodeLine{01653\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxTaskLeaf\ =\ idxLeafs\ ;\ idxTaskLeaf\ <\ (idxLeafs\ +\ nbLeavesInTask)\ ;\ ++idxTaskLeaf)\{}
\DoxyCodeLine{01654\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_leaf_data}{LeafData}}\&\ currentIter\ =\ leafsDataArray[idxTaskLeaf];}
\DoxyCodeLine{01655\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(l2pEnabled)\{}
\DoxyCodeLine{01656\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myThreadkernels-\/>L2P(currentIter.cell,\ currentIter.targets);}
\DoxyCodeLine{01657\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01658\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(p2pEnabled)\{}
\DoxyCodeLine{01659\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ need\ the\ current\ particles\ and\ neighbors\ particles}}
\DoxyCodeLine{01660\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ counter\ =\ tree-\/>getPeriodicLeafsNeighbors(neighbors,\ neighborPositions,\ offsets,\ \&hasPeriodicLeaves,}
\DoxyCodeLine{01661\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentIter.coord,\ LeafIndex,\ AllDirs);}
\DoxyCodeLine{01662\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ periodicNeighborsCounter\ =\ 0;}
\DoxyCodeLine{01663\ }
\DoxyCodeLine{01664\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(hasPeriodicLeaves)\{}
\DoxyCodeLine{01665\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{int}\ maxPeriodicNeighbors\ =\ 19;}
\DoxyCodeLine{01666\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass*\ periodicNeighbors[maxPeriodicNeighbors]\{\};}
\DoxyCodeLine{01667\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ periodicNeighborPositions[maxPeriodicNeighbors]\{\};}
\DoxyCodeLine{01668\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{01669\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxNeig\ =\ 0\ ;\ idxNeig\ <\ counter\ ;\ ++idxNeig)\{}
\DoxyCodeLine{01670\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !offsets[idxNeig].equals(0,0,0)\ )\{}
\DoxyCodeLine{01671\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{01672\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Put\ periodic\ cell\ into\ another\ cell\ (copy\ data)}}
\DoxyCodeLine{01673\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ periodicNeighbors[periodicNeighborsCounter]\ =\ \textcolor{keyword}{new}\ ContainerClass(*(neighbors[idxNeig]))\ ;}
\DoxyCodeLine{01674\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ newPos\ =\ pos\ +\ ofsset}}
\DoxyCodeLine{01675\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ *\ \textcolor{keyword}{const}\ \ positionsX\ =\ periodicNeighbors[periodicNeighborsCounter]-\/>getPositions()[0];}
\DoxyCodeLine{01676\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal*\textcolor{keyword}{const}\ positionsY\ =\ periodicNeighbors[periodicNeighborsCounter]-\/>getPositions()[1];}
\DoxyCodeLine{01677\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal*\textcolor{keyword}{const}\ positionsZ\ =\ periodicNeighbors[periodicNeighborsCounter]-\/>getPositions()[2];}
\DoxyCodeLine{01678\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ \ xoffset=\ boxWidth\ *\ FReal(offsets[idxNeig].getX())\ ;}
\DoxyCodeLine{01679\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ \ yoffset=\ boxWidth\ *\ FReal(offsets[idxNeig].getY())\ ;}
\DoxyCodeLine{01680\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ \ zoffset=\ boxWidth\ *\ FReal(offsets[idxNeig].getZ())\ ;}
\DoxyCodeLine{01681\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(FSize\ idxPart\ =\ 0;\ idxPart\ <\ periodicNeighbors[periodicNeighborsCounter]-\/>getNbParticles()\ ;\ ++idxPart)\{}
\DoxyCodeLine{01682\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ positionsX[idxPart]\ +=\ xoffset;}
\DoxyCodeLine{01683\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ positionsY[idxPart]\ +=\ yoffset;}
\DoxyCodeLine{01684\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ positionsZ[idxPart]\ +=\ zoffset;}
\DoxyCodeLine{01685\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01686\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ periodicNeighborPositions[periodicNeighborsCounter]\ =\ neighborPositions[idxNeig];}
\DoxyCodeLine{01687\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++periodicNeighborsCounter;}
\DoxyCodeLine{01688\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01689\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{01690\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ neighbors[idxNeig-\/periodicNeighborsCounter]\ =\ neighbors[idxNeig];}
\DoxyCodeLine{01691\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ neighborPositions[idxNeig-\/periodicNeighborsCounter]\ =\ neighborPositions[idxNeig];}
\DoxyCodeLine{01692\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01693\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01694\ }
\DoxyCodeLine{01695\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myThreadkernels-\/>P2PRemote(currentIter.coord,currentIter.targets,}
\DoxyCodeLine{01696\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentIter.sources,\ periodicNeighbors,\ periodicNeighborPositions,\ periodicNeighborsCounter);}
\DoxyCodeLine{01697\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxNeig\ =\ 0\ ;\ idxNeig\ <\ periodicNeighborsCounter\ ;\ ++idxNeig)\{}
\DoxyCodeLine{01698\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ periodicNeighbors[idxNeig]\ ;}
\DoxyCodeLine{01699\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01700\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01701\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{01702\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ treat\ P2P\ interaction\ with\ non\ periodic\ cells}}
\DoxyCodeLine{01703\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ Like\ in\ non\ periodic\ algorithm\ !!}}
\DoxyCodeLine{01704\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{01705\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myThreadkernels-\/>P2P(\ currentIter.coord,\ currentIter.targets,}
\DoxyCodeLine{01706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentIter.sources,\ neighbors,\ neighborPositions,\ counter\ -\/\ periodicNeighborsCounter);}
\DoxyCodeLine{01707\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01708\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01709\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01710\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01711\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01712\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ previous\ =\ endAtThisShape;}
\DoxyCodeLine{01713\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01714\ }
\DoxyCodeLine{01715\ \textcolor{preprocessor}{\#pragma\ omp\ taskwait}}
\DoxyCodeLine{01716\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01717\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(computationCounter.\mbox{\hyperlink{class_f_tic_a3efff71f7c95acd38451bfab08fa4583}{tac}}());}
\DoxyCodeLine{01718\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01719\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01720\ }
\DoxyCodeLine{01721\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Wait\ the\ come\ to\ finish\ (and\ the\ previous\ computation\ also)}}
\DoxyCodeLine{01722\ \textcolor{preprocessor}{\#pragma\ omp\ barrier}}
\DoxyCodeLine{01723\ }
\DoxyCodeLine{01724\ }
\DoxyCodeLine{01726\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Computation\ P2P\ that\ need\ others\ data}}
\DoxyCodeLine{01728\ \textcolor{preprocessor}{\#pragma\ omp\ master}}
\DoxyCodeLine{01729\ \ \ \ \ \ \ \ \ \{\ FLOG(\ computation2Counter.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}()\ );\ \}}
\DoxyCodeLine{01730\ }
\DoxyCodeLine{01731\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(p2pEnabled\ \&\&\ nbProcess\ >\ 1)\{}
\DoxyCodeLine{01732\ \ \ \ \ \ \ \ \ \ \ \ \ KernelClass\&\ myThreadkernels\ =\ (*kernels[omp\_get\_thread\_num()]);}
\DoxyCodeLine{01733\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There\ is\ a\ maximum\ of\ 26\ neighbors}}
\DoxyCodeLine{01734\ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass*\ neighbors[26];}
\DoxyCodeLine{01735\ \ \ \ \ \ \ \ \ \ \ \ \ MortonIndex\ indexesNeighbors[26];}
\DoxyCodeLine{01736\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ indexArray[26];}
\DoxyCodeLine{01737\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ neighborPositions[26];}
\DoxyCodeLine{01738\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Box\ limite}}
\DoxyCodeLine{01739\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ limite\ =\ 1\ <<\ (this-\/>OctreeHeight\ -\/\ 1);}
\DoxyCodeLine{01740\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ limitem1\ =\ limite\ -\/1\ ;}
\DoxyCodeLine{01741\ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(leafsNeedOtherData.\mbox{\hyperlink{class_f_vector_ae27a83b0b3e11851c9b3f5991937e3f2}{getSize}}()\ <\ std::numeric\_limits<int>::max());}
\DoxyCodeLine{01742\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ nbLeafToProceed\ =\ int(leafsNeedOtherData.\mbox{\hyperlink{class_f_vector_ae27a83b0b3e11851c9b3f5991937e3f2}{getSize}}());}
\DoxyCodeLine{01743\ }
\DoxyCodeLine{01744\ \textcolor{preprocessor}{\#pragma\ omp\ for\ \ schedule(dynamic,\ userChunkSize)}}
\DoxyCodeLine{01745\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLeafs\ =\ 0\ ;\ idxLeafs\ <\ nbLeafToProceed\ ;\ ++idxLeafs)\{}
\DoxyCodeLine{01746\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_f_fmm_algorithm_thread_proc_periodic_1_1_leaf_data}{LeafData}}\ currentIter\ =\ leafsNeedOtherData[idxLeafs];}
\DoxyCodeLine{01747\ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01748\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ need\ the\ current\ particles\ and\ neighbors\ particles}}
\DoxyCodeLine{01749\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ counter\ =\ 0;}
\DoxyCodeLine{01750\ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01751\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Take\ possible\ data}}
\DoxyCodeLine{01752\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ nbNeigh\ =\ this-\/>getNeighborsIndexesPeriodic(currentIter.coord,limite,}
\DoxyCodeLine{01753\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ indexesNeighbors,indexArray,AllDirs);}
\DoxyCodeLine{01754\ }
\DoxyCodeLine{01755\ \ \ \ \ \ \ \ \ \ \ std::array<ContainerClass*,19>\ \ \ \ \ periodicNeighbors\{\};}
\DoxyCodeLine{01756\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nbPeriodicCells\ =\ 0\ ;}
\DoxyCodeLine{01757\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{01758\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxNeigh\ =\ 0\ ;\ idxNeigh\ <\ nbNeigh\ ;\ ++idxNeigh)\{}
\DoxyCodeLine{01759\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(indexesNeighbors[idxNeigh]\ <\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_af2f3968f5789f95490a1aea5a0a91a81}{intervals}}[idProcess].leftIndex)\ ||\ (\mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_af2f3968f5789f95490a1aea5a0a91a81}{intervals}}[idProcess].rightIndex)\ <\ indexesNeighbors[idxNeigh])\{}
\DoxyCodeLine{01760\ }
\DoxyCodeLine{01761\ \ \ \ \ \ \ \ \ \ \ ContainerClass*\textcolor{keyword}{const}\ hypotheticNeighbor\ =\ otherP2Ptree.getLeafSrc(indexesNeighbors[idxNeigh]);}
\DoxyCodeLine{01762\ }
\DoxyCodeLine{01763\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(hypotheticNeighbor)\{}
\DoxyCodeLine{01764\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ should\ check\ if\ the\ cells\ is\ periodic\ or\ not}}
\DoxyCodeLine{01765\ \ \ \ \ \ \ \ \ \ \ \ \ neighbors[counter]\ \ \ \ \ \ \ \ \ =\ hypotheticNeighbor;}
\DoxyCodeLine{01766\ \ \ \ \ \ \ \ \ \ \ \ \ neighborPositions[counter]\ =\ indexArray[idxNeigh];}
\DoxyCodeLine{01767\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ coord3d(indexesNeighbors[idxNeigh]\ );}
\DoxyCodeLine{01768\ \ \ \ \ \ \ \ \ \ \ \ \ std::array<FReal,3>\ offSet\{\};}
\DoxyCodeLine{01769\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ movePos\ =\ false\ ;}
\DoxyCodeLine{01770\ \ \ \ \ \ \ \ \ \ \ \ \ coord3d-\/=currentIter.coord\ ;}
\DoxyCodeLine{01771\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::abs(coord3d.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}())\ ==\ limitem1\ \ )\{\ \textcolor{comment}{//\ it's\ a\ periodic\ cell)}}
\DoxyCodeLine{01772\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ offSet[0]\ =\ coord3d.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()\ <\ 0\ ?\ boxWidth\ :\ -\/boxWidth;}
\DoxyCodeLine{01773\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ movePos\ =\ true\ ;}
\DoxyCodeLine{01774\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01775\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::abs(coord3d.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}())\ ==\ limitem1\ )\{\ \textcolor{comment}{//\ it's\ a\ periodic\ cell)}}
\DoxyCodeLine{01776\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ offSet[1]\ =\ coord3d.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()\ <\ 0\ ?\ boxWidth\ :\ -\/boxWidth;}
\DoxyCodeLine{01777\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ movePos\ =\ true\ ;}
\DoxyCodeLine{01778\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01779\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::abs(coord3d.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}())\ ==\ limitem1\ )\{\ \textcolor{comment}{//\ it's\ a\ periodic\ cell)}}
\DoxyCodeLine{01780\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ offSet[2]\ =\ coord3d.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()\ <\ 0\ ?\ boxWidth\ :\ -\/boxWidth;}
\DoxyCodeLine{01781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ movePos\ =\ true\ ;}
\DoxyCodeLine{01782\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01783\ }
\DoxyCodeLine{01784\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(movePos)\{}
\DoxyCodeLine{01785\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Put\ periodic\ cell\ into\ another\ cell\ (copy\ data)}}
\DoxyCodeLine{01786\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ periodicNeighbors[nbPeriodicCells]\ =\ \textcolor{keyword}{new}\ ContainerClass(*hypotheticNeighbor)\ ;}
\DoxyCodeLine{01787\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ newPos\ =\ pos\ +\ ofsset}}
\DoxyCodeLine{01788\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal*\textcolor{keyword}{const}\ positionsX\ =\ periodicNeighbors[nbPeriodicCells]-\/>getPositions()[0];}
\DoxyCodeLine{01789\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal*\textcolor{keyword}{const}\ positionsY\ =\ periodicNeighbors[nbPeriodicCells]-\/>getPositions()[1];}
\DoxyCodeLine{01790\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal*\textcolor{keyword}{const}\ positionsZ\ =\ periodicNeighbors[nbPeriodicCells]-\/>getPositions()[2];}
\DoxyCodeLine{01791\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(FSize\ idxPart\ =\ 0;\ idxPart\ <\ periodicNeighbors[nbPeriodicCells]-\/>getNbParticles()\ ;\ ++idxPart)\{}
\DoxyCodeLine{01792\ \ \ \ \ \ \ \ \ \ \ \ \ positionsX[idxPart]\ +=\ offSet[0];}
\DoxyCodeLine{01793\ \ \ \ \ \ \ \ \ \ \ \ \ positionsY[idxPart]\ +=\ offSet[1];}
\DoxyCodeLine{01794\ \ \ \ \ \ \ \ \ \ \ \ \ positionsZ[idxPart]\ +=\ offSet[2];}
\DoxyCodeLine{01795\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01796\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ neighbors[counter]\ =\ periodicNeighbors[nbPeriodicCells];}
\DoxyCodeLine{01797\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++nbPeriodicCells;}
\DoxyCodeLine{01798\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01799\ \ \ \ \ \ \ \ \ \ \ \ \ ++counter;}
\DoxyCodeLine{01800\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01801\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01802\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01803\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(counter>\ 0)\{\ \ \textcolor{comment}{//\ neighborPositions\ doesn't\ use)}}
\DoxyCodeLine{01804\ \ \ \ \ \ \ \ \ myThreadkernels.P2PRemote(\ currentIter.coord,\ currentIter.targets,}
\DoxyCodeLine{01805\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{nullptr}\ \textcolor{comment}{/*currentIter.sources*/},\ neighbors,\ neighborPositions,\ counter);}
\DoxyCodeLine{01806\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(nbPeriodicCells\ >0)\{}
\DoxyCodeLine{01807\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//to\ Do}}
\DoxyCodeLine{01808\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0\ ;\ i\ <\ nbPeriodicCells\ ;\ ++i)\{}
\DoxyCodeLine{01809\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ periodicNeighbors[i]\ ;}
\DoxyCodeLine{01810\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01811\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01812\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01813\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01814\ \ \ \ \ \}}
\DoxyCodeLine{01815\ }
\DoxyCodeLine{01816\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ leafsDataArray;}
\DoxyCodeLine{01817\ }
\DoxyCodeLine{01818\ \ \ \ \ \ \ \ \ FLOG(computation2Counter.\mbox{\hyperlink{class_f_tic_a3efff71f7c95acd38451bfab08fa4583}{tac}}());}
\DoxyCodeLine{01819\ }
\DoxyCodeLine{01820\ }
\DoxyCodeLine{01821\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)tFinished\ (@Direct\ Pass\ (L2P\ +\ P2P)\ =\ "{}}\ \ <<\ counterTime.\mbox{\hyperlink{class_f_tic_ade3afdb1aa198635ebbc5ee8b7f4f081}{tacAndElapsed}}()\ <<\ \textcolor{stringliteral}{"{}\ s)\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01822\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Computation\ L2P\ +\ P2P\ :\ "{}}\ <<\ computationCounter.\mbox{\hyperlink{class_f_tic_a30b9f876fb7188f85b4c2b9d7fd7943e}{elapsed}}()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01823\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Computation\ P2P\ 2\ :\ "{}}\ <<\ computation2Counter.\mbox{\hyperlink{class_f_tic_a30b9f876fb7188f85b4c2b9d7fd7943e}{elapsed}}()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01824\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Prepare\ P2P\ :\ "{}}\ <<\ prepareCounter.\mbox{\hyperlink{class_f_tic_a30b9f876fb7188f85b4c2b9d7fd7943e}{elapsed}}()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01825\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Gather\ P2P\ :\ "{}}\ <<\ gatherCounter.\mbox{\hyperlink{class_f_tic_a30b9f876fb7188f85b4c2b9d7fd7943e}{elapsed}}()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01826\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Wait\ :\ "{}}\ <<\ waitCounter.\mbox{\hyperlink{class_f_tic_a30b9f876fb7188f85b4c2b9d7fd7943e}{elapsed}}()\ <<\ \textcolor{stringliteral}{"{}\ s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01827\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller.flush());}
\DoxyCodeLine{01828\ }
\DoxyCodeLine{01829\ \ \ \ \ \}}
\DoxyCodeLine{01830\ }
\DoxyCodeLine{01831\ }
\DoxyCodeLine{01832\ \ \ \ \ \textcolor{keywordtype}{int}\ getNeighborsIndexesPeriodic(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\&\ center,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ boxLimite,\ MortonIndex\ indexes[26],\ \textcolor{keywordtype}{int}\ indexInArray[26],\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inDirection)\textcolor{keyword}{\ const}\{}
\DoxyCodeLine{01833\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(center.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()\ !=\ 0\ \&\&\ center.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()\ !=\ 0\ \&\&\ center.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()\ !=\ 0\ \&\&}
\DoxyCodeLine{01834\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ center.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()\ !=\ boxLimite\ -\/1\ \&\&\ center.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()\ !=\ boxLimite\ -\/1\ \ \&\&\ center.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()\ !=\ boxLimite\ -\/1\ )\{}
\DoxyCodeLine{01835\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ getNeighborsIndexes(center,\ indexes,\ indexInArray);}
\DoxyCodeLine{01836\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01837\ }
\DoxyCodeLine{01838\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idxNeig\ =\ 0;}
\DoxyCodeLine{01839\ }
\DoxyCodeLine{01840\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ startX\ =\ (TestPeriodicCondition(inDirection,\ DirMinusX)\ ||\ center.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()\ !=\ 0\ ?-\/1:0);}
\DoxyCodeLine{01841\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ endX\ =\ (TestPeriodicCondition(inDirection,\ DirPlusX)\ ||\ center.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()\ !=\ boxLimite\ -\/\ 1\ ?1:0);}
\DoxyCodeLine{01842\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ startY\ =\ (TestPeriodicCondition(inDirection,\ DirMinusY)\ ||\ center.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()\ !=\ 0\ ?-\/1:0);}
\DoxyCodeLine{01843\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ endY\ =\ (TestPeriodicCondition(inDirection,\ DirPlusY)\ ||\ center.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()\ !=\ boxLimite\ -\/\ 1\ ?1:0);}
\DoxyCodeLine{01844\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ startZ\ =\ (TestPeriodicCondition(inDirection,\ DirMinusZ)\ ||\ center.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()\ !=\ 0\ ?-\/1:0);}
\DoxyCodeLine{01845\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ endZ\ =\ (TestPeriodicCondition(inDirection,\ DirPlusZ)\ ||\ center.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()\ !=\ boxLimite\ -\/\ 1\ ?1:0);}
\DoxyCodeLine{01846\ }
\DoxyCodeLine{01847\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ test\ all\ cells\ around}}
\DoxyCodeLine{01848\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxX\ =\ startX\ ;\ idxX\ <=\ endX\ ;\ ++idxX)\{}
\DoxyCodeLine{01849\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxY\ =\ startY\ ;\ idxY\ <=\ endY\ ;\ ++idxY)\{}
\DoxyCodeLine{01850\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxZ\ =\ startZ\ ;\ idxZ\ <=\ endZ\ ;\ ++idxZ)\{}
\DoxyCodeLine{01851\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ we\ are\ not\ on\ the\ current\ cell}}
\DoxyCodeLine{01852\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ idxX\ ||\ idxY\ ||\ idxZ\ )\{}
\DoxyCodeLine{01853\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ other(center.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()\ +\ idxX,center.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()\ +\ idxY,center.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()\ +\ idxZ);}
\DoxyCodeLine{01854\ }
\DoxyCodeLine{01855\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ other.getX()\ <\ 0\ )\ other.setX(\ other.getX()\ +\ boxLimite\ );}
\DoxyCodeLine{01856\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ boxLimite\ <=\ other.getX()\ )\ other.setX(\ other.getX()\ -\/\ boxLimite\ );}
\DoxyCodeLine{01857\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ other.getY()\ <\ 0\ )\ other.setY(\ other.getY()\ +\ boxLimite\ );}
\DoxyCodeLine{01858\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ boxLimite\ <=\ other.getY()\ )\ other.setY(\ other.getY()\ -\/\ boxLimite\ );}
\DoxyCodeLine{01859\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ other.getZ()\ <\ 0\ )\ other.setZ(\ other.getZ()\ +\ boxLimite\ );}
\DoxyCodeLine{01860\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ boxLimite\ <=\ other.getZ()\ )\ other.setZ(\ other.getZ()\ -\/\ boxLimite\ );}
\DoxyCodeLine{01861\ }
\DoxyCodeLine{01862\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ indexes[idxNeig]\ =\ other.getMortonIndex(this-\/>OctreeHeight\ -\/\ 1);}
\DoxyCodeLine{01863\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ indexInArray[idxNeig]\ =\ ((idxX+1)*3\ \ +\ (idxY+1))*3\ +\ (idxZ+1);}
\DoxyCodeLine{01864\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++idxNeig;}
\DoxyCodeLine{01865\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01866\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01867\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01868\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01869\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ idxNeig;}
\DoxyCodeLine{01870\ \ \ \ \ \}}
\DoxyCodeLine{01871\ }
\DoxyCodeLine{01872\ \ \ \ \ \textcolor{keywordtype}{int}\ getNeighborsIndexes(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\&\ center,\ MortonIndex\ indexes[26],\ \textcolor{keywordtype}{int}\ indexInArray[26])\textcolor{keyword}{\ const}\{}
\DoxyCodeLine{01873\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idxNeig\ =\ 0;}
\DoxyCodeLine{01874\ }
\DoxyCodeLine{01875\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ test\ all\ cells\ around}}
\DoxyCodeLine{01876\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxX\ =\ -\/1\ ;\ idxX\ <=\ 1\ ;\ ++idxX)\{}
\DoxyCodeLine{01877\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxY\ =\ -\/1\ ;\ idxY\ <=\ 1\ ;\ ++idxY)\{}
\DoxyCodeLine{01878\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxZ\ =\ -\/1\ ;\ idxZ\ <=\ 1\ ;\ ++idxZ)\{}
\DoxyCodeLine{01879\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ we\ are\ not\ on\ the\ current\ cell}}
\DoxyCodeLine{01880\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ idxX\ ||\ idxY\ ||\ idxZ\ )\{}
\DoxyCodeLine{01881\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ other(center.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()\ +\ idxX,center.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()\ +\ idxY,center.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()\ +\ idxZ);}
\DoxyCodeLine{01882\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ indexes[idxNeig]\ =\ other.getMortonIndex(this-\/>OctreeHeight\ -\/\ 1);}
\DoxyCodeLine{01883\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ indexInArray[idxNeig]\ =\ ((idxX+1)*3\ \ +\ (idxY+1))*3\ +\ (idxZ+1);}
\DoxyCodeLine{01884\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++idxNeig;}
\DoxyCodeLine{01885\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01886\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01887\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01888\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01889\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ idxNeig;}
\DoxyCodeLine{01890\ \ \ \ \ \}}
\DoxyCodeLine{01891\ }
\DoxyCodeLine{01892\ }
\DoxyCodeLine{01893\ \ \ \ \ \textcolor{keywordtype}{int}\ getPeriodicInteractionNeighbors(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\&\ workingCell,\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inLevel,\ MortonIndex\ inNeighbors[\textcolor{comment}{/*189+26+1*/}216],\ \textcolor{keywordtype}{int}\ inNeighborsPosition[\textcolor{comment}{/*189+26+1*/}216],}
\DoxyCodeLine{01894\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inDirection,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ neighSeparation)\textcolor{keyword}{\ const}\{}
\DoxyCodeLine{01895\ }
\DoxyCodeLine{01896\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Then\ take\ each\ child\ of\ the\ parent's\ neighbors\ if\ not\ in\ directNeighbors}}
\DoxyCodeLine{01897\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Father\ coordinate}}
\DoxyCodeLine{01898\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ parentCell(workingCell.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()>>1,workingCell.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()>>1,workingCell.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()>>1);}
\DoxyCodeLine{01899\ }
\DoxyCodeLine{01900\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Limite\ at\ parent\ level\ number\ of\ box\ (split\ by\ 2\ by\ level)}}
\DoxyCodeLine{01901\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ boxLimite\ =\ \mbox{\hyperlink{struct_f_math_a26cf6a39b9dd3fb24bb8acafa55a321e}{FMath::pow2}}(inLevel-\/1);}
\DoxyCodeLine{01902\ }
\DoxyCodeLine{01903\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ not\ on\ a\ border\ we\ can\ use\ normal\ interaction\ list\ method}}
\DoxyCodeLine{01904\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !(parentCell.getX()\ ==\ 0\ ||\ parentCell.getY()\ ==\ 0\ ||\ parentCell.getZ()\ ==\ 0\ ||}
\DoxyCodeLine{01905\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ parentCell.getX()\ ==\ boxLimite\ -\/\ 1\ ||\ parentCell.getY()\ ==\ boxLimite\ -\/\ 1\ ||\ parentCell.getZ()\ ==\ boxLimite\ -\/\ 1\ )\ )\ \{}
\DoxyCodeLine{01906\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ getInteractionNeighbors(\ workingCell,\ inLevel,\ inNeighbors,\ inNeighborsPosition,\ neighSeparation);}
\DoxyCodeLine{01907\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01908\ }
\DoxyCodeLine{01909\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ startX\ =\ \ (TestPeriodicCondition(inDirection,\ DirMinusX)\ ||\ parentCell.getX()\ !=\ 0\ ?-\/1:0);}
\DoxyCodeLine{01910\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ endX\ =\ \ \ \ (TestPeriodicCondition(inDirection,\ DirPlusX)\ \ ||\ parentCell.getX()\ !=\ boxLimite\ -\/\ 1\ ?1:0);}
\DoxyCodeLine{01911\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ startY\ =\ \ (TestPeriodicCondition(inDirection,\ DirMinusY)\ ||\ parentCell.getY()\ !=\ 0\ ?-\/1:0);}
\DoxyCodeLine{01912\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ endY\ =\ \ \ \ (TestPeriodicCondition(inDirection,\ DirPlusY)\ \ ||\ parentCell.getY()\ !=\ boxLimite\ -\/\ 1\ ?1:0);}
\DoxyCodeLine{01913\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ startZ\ =\ \ (TestPeriodicCondition(inDirection,\ DirMinusZ)\ ||\ parentCell.getZ()\ !=\ 0\ ?-\/1:0);}
\DoxyCodeLine{01914\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ endZ\ =\ \ \ \ (TestPeriodicCondition(inDirection,\ DirPlusZ)\ \ ||\ parentCell.getZ()\ !=\ boxLimite\ -\/\ 1\ ?1:0);}
\DoxyCodeLine{01915\ }
\DoxyCodeLine{01916\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idxNeighbors\ =\ 0;}
\DoxyCodeLine{01917\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ test\ all\ cells\ around}}
\DoxyCodeLine{01918\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxX\ =\ startX\ ;\ idxX\ <=\ endX\ ;\ ++idxX)\{}
\DoxyCodeLine{01919\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxY\ =\ startY\ ;\ idxY\ <=\ endY\ ;\ ++idxY)\{}
\DoxyCodeLine{01920\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxZ\ =\ startZ\ ;\ idxZ\ <=\ endZ\ ;\ ++idxZ)\{}
\DoxyCodeLine{01921\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ we\ are\ not\ on\ the\ current\ cell}}
\DoxyCodeLine{01922\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ idxX\ ||\ idxY\ ||\ idxZ\ )\{}
\DoxyCodeLine{01923\ }
\DoxyCodeLine{01924\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ otherParent(parentCell.getX()\ +\ idxX,parentCell.getY()\ +\ idxY,parentCell.getZ()\ +\ idxZ);}
\DoxyCodeLine{01925\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ otherParentInBox(otherParent);}
\DoxyCodeLine{01926\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ periodic}}
\DoxyCodeLine{01927\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ otherParentInBox.getX()\ <\ 0\ )\{}
\DoxyCodeLine{01928\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ otherParentInBox.setX(\ otherParentInBox.getX()\ +\ boxLimite\ );}
\DoxyCodeLine{01929\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01930\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ boxLimite\ <=\ otherParentInBox.getX()\ )\{}
\DoxyCodeLine{01931\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ otherParentInBox.setX(\ otherParentInBox.getX()\ -\/\ boxLimite\ );}
\DoxyCodeLine{01932\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01933\ }
\DoxyCodeLine{01934\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ otherParentInBox.getY()\ <\ 0\ )\{}
\DoxyCodeLine{01935\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ otherParentInBox.setY(\ otherParentInBox.getY()\ +\ boxLimite\ );}
\DoxyCodeLine{01936\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01937\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ boxLimite\ <=\ otherParentInBox.getY()\ )\{}
\DoxyCodeLine{01938\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ otherParentInBox.setY(\ otherParentInBox.getY()\ -\/\ boxLimite\ );}
\DoxyCodeLine{01939\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01940\ }
\DoxyCodeLine{01941\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ otherParentInBox.getZ()\ <\ 0\ )\{}
\DoxyCodeLine{01942\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ otherParentInBox.setZ(\ otherParentInBox.getZ()\ +\ boxLimite\ );}
\DoxyCodeLine{01943\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01944\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ boxLimite\ <=\ otherParentInBox.getZ()\ )\{}
\DoxyCodeLine{01945\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ otherParentInBox.setZ(\ otherParentInBox.getZ()\ -\/\ boxLimite\ );}
\DoxyCodeLine{01946\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01947\ }
\DoxyCodeLine{01948\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ mortonOtherParent\ =\ otherParentInBox.getMortonIndex();}
\DoxyCodeLine{01949\ }
\DoxyCodeLine{01950\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ each\ child}}
\DoxyCodeLine{01951\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxCousin\ =\ 0\ ;\ idxCousin\ <\ 8\ ;\ ++idxCousin)\{}
\DoxyCodeLine{01952\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ xdiff\ \ =\ ((otherParent.getX()<<1)\ |\ (\ (idxCousin>>2)\ \&\ 1))\ -\/\ workingCell.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}();}
\DoxyCodeLine{01953\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ ydiff\ \ =\ ((otherParent.getY()<<1)\ |\ (\ (idxCousin>>1)\ \&\ 1))\ -\/\ workingCell.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}();}
\DoxyCodeLine{01954\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ zdiff\ \ =\ ((otherParent.getZ()<<1)\ |\ (idxCousin\&1))\ \ \ \ \ \ \ \ \ -\/\ workingCell.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}();}
\DoxyCodeLine{01955\ }
\DoxyCodeLine{01956\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Test\ if\ it\ is\ a\ direct\ neighbor}}
\DoxyCodeLine{01957\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(xdiff)\ >\ neighSeparation\ ||\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(ydiff)\ >\ neighSeparation\ ||\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(zdiff)\ >\ neighSeparation)\{}
\DoxyCodeLine{01958\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ add\ to\ neighbors}}
\DoxyCodeLine{01959\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ inNeighborsPosition[idxNeighbors]\ =\ (((xdiff+3)\ *\ 7)\ +\ (ydiff+3))\ *\ 7\ +\ zdiff\ +\ 3;}
\DoxyCodeLine{01960\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ inNeighbors[idxNeighbors++]\ =\ (mortonOtherParent\ <<\ 3)\ |\ idxCousin;}
\DoxyCodeLine{01961\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01962\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01963\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01964\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01965\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01966\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01967\ }
\DoxyCodeLine{01968\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ idxNeighbors;}
\DoxyCodeLine{01969\ \ \ \ \ \}}
\DoxyCodeLine{01970\ }
\DoxyCodeLine{01971\ \ \ \ \ \textcolor{keywordtype}{int}\ getInteractionNeighbors(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\&\ workingCell,\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inLevel,\ MortonIndex\ inNeighbors[\textcolor{comment}{/*189+26+1*/}216],\ \textcolor{keywordtype}{int}\ inNeighborsPosition[\textcolor{comment}{/*189+26+1*/}216],}
\DoxyCodeLine{01972\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ neighSeparation)\textcolor{keyword}{\ const}\{}
\DoxyCodeLine{01973\ }
\DoxyCodeLine{01974\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Then\ take\ each\ child\ of\ the\ parent's\ neighbors\ if\ not\ in\ directNeighbors}}
\DoxyCodeLine{01975\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Father\ coordinate}}
\DoxyCodeLine{01976\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ parentCell(workingCell.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}()>>1,workingCell.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}()>>1,workingCell.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()>>1);}
\DoxyCodeLine{01977\ }
\DoxyCodeLine{01978\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idxNeighbors\ =\ 0;}
\DoxyCodeLine{01979\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ test\ all\ cells\ around}}
\DoxyCodeLine{01980\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxX\ =\ -\/1\ ;\ idxX\ <=\ 1\ ;\ ++idxX)\{}
\DoxyCodeLine{01981\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxY\ =\ -\/1\ ;\ idxY\ <=\ 1\ ;\ ++idxY)\{}
\DoxyCodeLine{01982\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxZ\ =\ -\/1\ ;\ idxZ\ <=\ 1\ ;\ ++idxZ)\{}
\DoxyCodeLine{01983\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ we\ are\ not\ on\ the\ current\ cell}}
\DoxyCodeLine{01984\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ idxX\ ||\ idxY\ ||\ idxZ\ )\{}
\DoxyCodeLine{01985\ }
\DoxyCodeLine{01986\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ otherParent(parentCell.getX()\ +\ idxX,parentCell.getY()\ +\ idxY,parentCell.getZ()\ +\ idxZ);}
\DoxyCodeLine{01987\ }
\DoxyCodeLine{01988\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ mortonOtherParent\ =\ otherParent.getMortonIndex();}
\DoxyCodeLine{01989\ }
\DoxyCodeLine{01990\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ each\ child}}
\DoxyCodeLine{01991\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxCousin\ =\ 0\ ;\ idxCousin\ <\ 8\ ;\ ++idxCousin)\{}
\DoxyCodeLine{01992\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ xdiff\ \ =\ ((otherParent.getX()<<1)\ |\ (\ (idxCousin>>2)\ \&\ 1))\ -\/\ workingCell.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}();}
\DoxyCodeLine{01993\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ ydiff\ \ =\ ((otherParent.getY()<<1)\ |\ (\ (idxCousin>>1)\ \&\ 1))\ -\/\ workingCell.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}();}
\DoxyCodeLine{01994\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ zdiff\ \ =\ ((otherParent.getZ()<<1)\ |\ (idxCousin\&1))\ -\/\ workingCell.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}();}
\DoxyCodeLine{01995\ }
\DoxyCodeLine{01996\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Test\ if\ it\ is\ a\ direct\ neighbor}}
\DoxyCodeLine{01997\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(xdiff)\ >\ neighSeparation\ ||\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(ydiff)\ >\ neighSeparation\ ||\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(zdiff)\ >\ neighSeparation)\{}
\DoxyCodeLine{01998\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ add\ to\ neighbors}}
\DoxyCodeLine{01999\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ inNeighborsPosition[idxNeighbors]\ =\ (((\ (xdiff+3)\ *\ 7)\ +\ (ydiff+3)))\ *\ 7\ +\ zdiff\ +\ 3;}
\DoxyCodeLine{02000\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ inNeighbors[idxNeighbors++]\ =\ (mortonOtherParent\ <<\ 3)\ |\ idxCousin;}
\DoxyCodeLine{02001\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02002\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02003\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02005\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02006\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02007\ }
\DoxyCodeLine{02008\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ idxNeighbors;}
\DoxyCodeLine{02009\ \ \ \ \ \}}
\DoxyCodeLine{02010\ }
\DoxyCodeLine{02012\ \ \ \ \ \textcolor{comment}{//\ Periodic\ levels\ =\ levels\ <=\ 0}}
\DoxyCodeLine{02014\ }
\DoxyCodeLine{02015\ }
\DoxyCodeLine{02022\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a6b69b7dbc69c97122306d80df5627668}{neighIndex}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ x,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ y,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ z)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02023\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (((x+3)*7)\ +\ (y+3))*7\ +\ (z\ +\ 3);}
\DoxyCodeLine{02024\ \ \ \ \ \}}
\DoxyCodeLine{02025\ }
\DoxyCodeLine{02037\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a6513b1c31411732e14f10b30f918d9d1}{processPeriodicLevels}}()\{}
\DoxyCodeLine{02038\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller.write(\textcolor{stringliteral}{"{}\(\backslash\)tStart\ Periodic\ Pass\(\backslash\)n"{}}).write(FLog::Flush);\ );}
\DoxyCodeLine{02039\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ counterTime);}
\DoxyCodeLine{02040\ }
\DoxyCodeLine{02041\ \ \ \ \ \textcolor{comment}{//\ the\ root\ level\ of\ the\ octree\ in\ the\ virtual\ array\ of\ cells}}
\DoxyCodeLine{02042\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ rootLevel\ =\ offsetRealTree-\/1\ ;}
\DoxyCodeLine{02043\ \ \ \ \ rootCellFromProc.setLevel(rootLevel+1);}
\DoxyCodeLine{02044\ \ \ \ \ }
\DoxyCodeLine{02045\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ nbLevelsAboveRoot\ !=\ -\/1\ )\{}
\DoxyCodeLine{02046\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ will\ use\ offsetRealTree-\/1\ cells\ but\ for\ simplicity\ allocate\ offsetRealTree}}
\DoxyCodeLine{02047\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ upperCells[offsetRealTree-\/1]\ is\ root\ cell}}
\DoxyCodeLine{02048\ \ \ \ \ \ \ \ \ \ \ \ \ CellClass*\textcolor{keyword}{const}\ upperCells\ =\ \textcolor{keyword}{new}\ CellClass[offsetRealTree];}
\DoxyCodeLine{02049\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ upperCells[offsetRealTree-\/1]\ =\ rootCellFromProc;}
\DoxyCodeLine{02051\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02052\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CellClass*\ virtualChild[8];}
\DoxyCodeLine{02054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ offsetRealTree-\/1\ ;\ idxLevel\ >\ 1\ \ ;\ -\/-\/idxLevel)\{}
\DoxyCodeLine{02055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_aba85f46562a9dc576bca7d39ce202159}{FMemUtils::setall}}(virtualChild,\&upperCells[idxLevel],8);}
\DoxyCodeLine{02056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ kernels[0]-\/>M2M(\ \&upperCells[idxLevel-\/1],\ virtualChild,\ idxLevel);}
\DoxyCodeLine{02057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02058\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02059\ \ \ \ \ \ \ \ \ \ \ \ \ CellClass*\textcolor{keyword}{const}\ downerCells\ =\ \textcolor{keyword}{new}\ CellClass[offsetRealTree];}
\DoxyCodeLine{02060\ }
\DoxyCodeLine{02061\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ idxUpperLevel\ =\ 2;}
\DoxyCodeLine{02063\ }
\DoxyCodeLine{02064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CellClass*\ neighbors[342];}
\DoxyCodeLine{02065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ neighborPositions[342];}
\DoxyCodeLine{02066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ counter\ =\ 0;}
\DoxyCodeLine{02067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxX\ =\ -\/3\ ;\ idxX\ <=\ 2\ ;\ ++idxX)\{}
\DoxyCodeLine{02068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxY\ =\ -\/3\ ;\ idxY\ <=\ 2\ ;\ ++idxY)\{}
\DoxyCodeLine{02069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxZ\ =\ -\/3\ ;\ idxZ\ <=\ 2\ ;\ ++idxZ)\{}
\DoxyCodeLine{02070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(idxX)\ >\ 1\ ||\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(idxY)\ >\ 1\ ||\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(idxZ)\ >\ 1)\{}
\DoxyCodeLine{02071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ neighbors[counter]\ =\ \&upperCells[idxUpperLevel-\/1];}
\DoxyCodeLine{02072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ neighborPositions[counter]\ =\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a6b69b7dbc69c97122306d80df5627668}{neighIndex}}(idxX,idxY,idxZ);}
\DoxyCodeLine{02073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++counter;}
\DoxyCodeLine{02074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ compute\ M2L}}
\DoxyCodeLine{02079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ kernels[0]-\/>M2L(\ \&downerCells[idxUpperLevel-\/1]\ ,\ neighbors,\ neighborPositions,\ counter,\ idxUpperLevel);}
\DoxyCodeLine{02080\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02081\ }
\DoxyCodeLine{02082\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxUpperLevel\ =\ 3\ ;\ idxUpperLevel\ <=\ offsetRealTree\ ;\ ++idxUpperLevel)\{}
\DoxyCodeLine{02083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CellClass*\ neighbors[342];}
\DoxyCodeLine{02084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ neighborPositions[342];}
\DoxyCodeLine{02085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ counter\ =\ 0;}
\DoxyCodeLine{02086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxX\ =\ -\/2\ ;\ idxX\ <=\ 3\ ;\ ++idxX)\{}
\DoxyCodeLine{02087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxY\ =\ -\/2\ ;\ idxY\ <=\ 3\ ;\ ++idxY)\{}
\DoxyCodeLine{02088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxZ\ =\ -\/2\ ;\ idxZ\ <=\ 3\ ;\ ++idxZ)\{}
\DoxyCodeLine{02089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(idxX)\ >\ 1\ ||\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(idxY)\ >\ 1\ ||\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(idxZ)\ >\ 1)\{}
\DoxyCodeLine{02090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ neighbors[counter]\ =\ \&upperCells[idxUpperLevel-\/1];}
\DoxyCodeLine{02091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ neighborPositions[counter]\ =\ \mbox{\hyperlink{class_f_fmm_algorithm_thread_proc_periodic_a6b69b7dbc69c97122306d80df5627668}{neighIndex}}(idxX,idxY,idxZ);}
\DoxyCodeLine{02092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++counter;}
\DoxyCodeLine{02093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02097\ }
\DoxyCodeLine{02098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ compute\ M2L}}
\DoxyCodeLine{02099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ kernels[0]-\/>M2L(\ \&downerCells[idxUpperLevel-\/1]\ ,\ neighbors,\ neighborPositions,\ counter,\ idxUpperLevel);}
\DoxyCodeLine{02100\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02101\ }
\DoxyCodeLine{02102\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CellClass*\ virtualChild[8];}
\DoxyCodeLine{02104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ memset(virtualChild,\ 0,\ \textcolor{keyword}{sizeof}(CellClass*)\ *\ 8);}
\DoxyCodeLine{02105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 2\ ;\ idxLevel\ <\ offsetRealTree-\/1\ \ ;\ ++idxLevel)\{}
\DoxyCodeLine{02106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ virtualChild[0]\ =\ \&downerCells[idxLevel];}
\DoxyCodeLine{02107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ kernels[0]-\/>L2L(\ \&downerCells[idxLevel-\/1],\ virtualChild,\ idxLevel);}
\DoxyCodeLine{02108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02109\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02110\ }
\DoxyCodeLine{02111\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CellClass*\ virtualChild[8];}
\DoxyCodeLine{02113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ memset(virtualChild,\ 0,\ \textcolor{keyword}{sizeof}(CellClass*)\ *\ 8);}
\DoxyCodeLine{02114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ idxLevel\ =\ offsetRealTree-\/1;}
\DoxyCodeLine{02115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ virtualChild[7]\ =\ \&downerCells[idxLevel];}
\DoxyCodeLine{02116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ kernels[0]-\/>L2L(\ \&downerCells[idxLevel-\/1],\ virtualChild,\ idxLevel);}
\DoxyCodeLine{02117\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02118\ }
\DoxyCodeLine{02119\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ L2L\ from\ 0\ to\ level\ 1}}
\DoxyCodeLine{02120\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rootCellFromProc\ =\ downerCells[offsetRealTree-\/1];}
\DoxyCodeLine{02122\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02123\ }
\DoxyCodeLine{02124\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ upperCells;}
\DoxyCodeLine{02125\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ downerCells;}
\DoxyCodeLine{02126\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02127\ }
\DoxyCodeLine{02128\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)tFinished\ (@Periodic\ =\ "{}}\ \ <<\ counterTime.\mbox{\hyperlink{class_f_tic_ade3afdb1aa198635ebbc5ee8b7f4f081}{tacAndElapsed}}()\ <<\ \textcolor{stringliteral}{"{}s)\(\backslash\)n"{}}\ );}
\DoxyCodeLine{02129\ \ \ \ \ \}}
\DoxyCodeLine{02130\ }
\DoxyCodeLine{02131\ }
\DoxyCodeLine{02132\ \};}
\DoxyCodeLine{02133\ }
\DoxyCodeLine{02134\ }
\DoxyCodeLine{02135\ }
\DoxyCodeLine{02136\ }
\DoxyCodeLine{02137\ }
\DoxyCodeLine{02138\ }
\DoxyCodeLine{02139\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//FFMMALGORITHMTHREAD\_HPP}}

\end{DoxyCode}
