\doxysection{FGroup\+Task\+Starpu\+Mpi\+Algorithm.\+hpp}
\hypertarget{_f_group_task_starpu_mpi_algorithm_8hpp_source}{}\label{_f_group_task_starpu_mpi_algorithm_8hpp_source}\index{third\_party/ScalFMM/include/ScalFMM/GroupTree/Core/FGroupTaskStarpuMpiAlgorithm.hpp@{third\_party/ScalFMM/include/ScalFMM/GroupTree/Core/FGroupTaskStarpuMpiAlgorithm.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Keep\ in\ private\ GIT}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#ifndef\ FGROUPTASKSTARPUMPIALGORITHM\_HPP}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#define\ FGROUPTASKSTARPUMPIALGORITHM\_HPP}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FGlobal.hpp"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}../../Core/FCoreCommon.hpp"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FQuickSort.hpp"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}../../Containers/FTreeCoordinate.hpp"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FLog.hpp"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FTic.hpp"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FAssert.hpp"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FAlignedMemory.hpp"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FAssert.hpp"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FEnv.hpp"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FMpi.hpp"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}FOutOfBlockInteraction.hpp"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <omp.h>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <unordered\_map>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <set>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <starpu.h>}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <starpu\_mpi.h>}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}../StarPUUtils/FStarPUUtils.hpp"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}../StarPUUtils/FStarPUFmmPriorities.hpp"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}../StarPUUtils/FStarPUFmmPrioritiesV2.hpp"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}../StarPUUtils/FStarPUReduxCpu.hpp"{}}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}../StarPUUtils/FStarPUCpuWrapper.hpp"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ "{}../StarPUUtils/FStarPUCudaWrapper.hpp"{}}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ "{}../Cuda/FCudaEmptyKernel.hpp"{}}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#include\ "{}../Cuda/FCudaGroupAttachedLeaf.hpp"{}}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#include\ "{}../Cuda/FCudaGroupOfParticles.hpp"{}}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#include\ "{}../Cuda/FCudaGroupOfCells.hpp"{}}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#include\ "{}../Cuda/FCudaEmptyCellSymb.hpp"{}}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#include\ "{}../StarPUUtils/FStarPUOpenClWrapper.hpp"{}}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\#include\ "{}../OpenCl/FOpenCLDeviceWrapper.hpp"{}}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#include\ "{}../OpenCl/FEmptyOpenCLCode.hpp"{}}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\#include\ "{}../StarPUUtils/FStarPUReduxCpu.hpp"{}}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_SIMGRID\_TASKNAMEPARAMS}}
\DoxyCodeLine{00053\ \textcolor{preprocessor}{\#include\ "{}../StarPUUtils/FStarPUTaskNameParams.hpp"{}}}
\DoxyCodeLine{00054\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class\ }OctreeClass,\ \textcolor{keyword}{class\ }CellContainerClass,\ \textcolor{keyword}{class\ }KernelClass,\ \textcolor{keyword}{class\ }ParticleGroupClass,\ \textcolor{keyword}{class\ }StarPUCpuWrapperClass}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ ,\ \textcolor{keyword}{class\ }StarPUCudaWrapperClass\ =\ \mbox{\hyperlink{class_f_star_p_u_cuda_wrapper}{FStarPUCudaWrapper<KernelClass,\ FCudaEmptyCellSymb,\ int,\ int,\ FCudaGroupOfCells<FCudaEmptyCellSymb,\ int,\ int>}},}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_cuda_group_of_particles}{FCudaGroupOfParticles<int,\ 0,\ 0,\ int>}},\ \mbox{\hyperlink{class_f_cuda_group_attached_leaf}{FCudaGroupAttachedLeaf<int,\ 0,\ 0,\ int>}},\ \mbox{\hyperlink{class_f_cuda_empty_kernel}{FCudaEmptyKernel<int>}}\ >}
\DoxyCodeLine{00060\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00061\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ ,\ \textcolor{keyword}{class\ }StarPUOpenClWrapperClass\ =\ \mbox{\hyperlink{class_f_star_p_u_open_cl_wrapper}{FStarPUOpenClWrapper<KernelClass,\ FOpenCLDeviceWrapper<KernelClass>}}>}
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ >}
\DoxyCodeLine{00065\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm}{FGroupTaskStarPUMpiAlgorithm}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_f_abstract_algorithm}{FAbstractAlgorithm}}\ \{}
\DoxyCodeLine{00066\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm}{FGroupTaskStarPUMpiAlgorithm}}<OctreeClass,\ CellContainerClass,\ KernelClass,\ ParticleGroupClass,\ StarPUCpuWrapperClass}
\DoxyCodeLine{00068\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00069\ \ \ \ \ ,\ StarPUCudaWrapperClass}
\DoxyCodeLine{00070\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00071\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00072\ \ \ \ \ ,\ StarPUOpenClWrapperClass}
\DoxyCodeLine{00073\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00074\ \ \ \ \ >\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm}{ThisClass}};}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keywordtype}{int}\ getTag(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inLevel,\ \textcolor{keyword}{const}\ MortonIndex\ mindex,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ idxBloc,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ mode,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ otherProc)\textcolor{keyword}{\ const}\{}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ shift\ =\ 0,\ s\_mindex\ =\ 0;}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ height\ =\ tree-\/>getHeight();}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ h\_mindex\ =\ idxBloc;}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(height)\ \{\ shift\ +=\ 1;\ height\ >>=\ 1;\ \}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(h\_mindex)\ \{\ s\_mindex\ +=\ 1;\ h\_mindex\ >>=\ 1;\ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ FAssertLF((s\_mindex\ +\ shift\ +\ 8)\ <=\ 32,\ \textcolor{stringliteral}{"{}Tag\ overflow\ !!"{}});}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ tag\ =\ int(((((idxBloc<<shift)\ +\ inLevel)\ <<\ 3)\ +\ mode)\ <<\ 5);}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ *tag\_ub\ =\ 0;}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ ok\ =\ 0;}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ MPI\_Comm\_get\_attr(MPI\_COMM\_WORLD,\ MPI\_TAG\_UB,\ \&tag\_ub,\ \&ok);}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ FAssertLF(tag\ <\ *tag\_ub,\ \textcolor{stringliteral}{"{}Tag\ overflow:\ Tag\ greater\ than\ MPI\_TAG\_UB"{}});}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }TagInfo\{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ level;}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MortonIndex\ mindex;}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idxBloc;}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ mode;}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ operator==(TagInfo\ \textcolor{keyword}{const}\&\ a)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00096\ \textcolor{keyword}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (a.idxBloc\ ==\ idxBloc\ \&\&\ a.level\ ==\ level\ \&\&\ a.mindex\ ==\ mindex\ \&\&\ a.mode\ ==\ mode);}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ std::unordered\_map<int,\ TagInfo>\ previousTag;}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TagInfo\ currentInfo\ =\ \{inLevel,\ mindex,\ idxBloc,\ mode\};}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ found\ =\ previousTag.find(tag);}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(found\ !=\ previousTag.end())\{}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TagInfo\ prev\ =\ found-\/>second;}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ assert(currentInfo\ ==\ prev);}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ previousTag[tag]\ =\ currentInfo;}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ tag;}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_mpi_1_1_f_comm}{FMpi::FComm}}\&\ comm;}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ OtherBlockClass>}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_f_group_task_star_p_u_mpi_algorithm_1_1_block_interactions}{BlockInteractions}}\{}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ OtherBlockClass*\ otherBlock;}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ otherBlockId;}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ std::vector<OutOfBlockInteraction>\ interactions;}
\DoxyCodeLine{00122\ \ \ \ \ \};}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_f_group_task_star_p_u_mpi_algorithm_1_1_cell_handles}{CellHandles}}\{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ starpu\_data\_handle\_t\ symb;}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ starpu\_data\_handle\_t\ up;}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ starpu\_data\_handle\_t\ down;}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ intervalSize;}
\DoxyCodeLine{00129\ \ \ \ \ \};}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_f_group_task_star_p_u_mpi_algorithm_1_1_particle_handles}{ParticleHandles}}\{}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ starpu\_data\_handle\_t\ symb;}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ starpu\_data\_handle\_t\ down;}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ intervalSize;}
\DoxyCodeLine{00135\ \ \ \ \ \};}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ std::vector<\ std::vector<\ std::vector<BlockInteractions<CellContainerClass>>>>\ externalInteractionsAllLevel;}
\DoxyCodeLine{00138\ \ \ \ \ std::vector<\ std::vector<BlockInteractions<ParticleGroupClass>>>\ externalInteractionsLeafLevel;}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ OctreeClass*\textcolor{keyword}{const}\ tree;\ \ \ \ \ \ \ \textcolor{comment}{//<\ The\ Tree}}
\DoxyCodeLine{00141\ \ \ \ \ KernelClass*\textcolor{keyword}{const}\ originalCpuKernel;}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ std::vector<CellHandles>*\ cellHandles;}
\DoxyCodeLine{00144\ \ \ \ \ std::vector<ParticleHandles>\ particleHandles;}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \ \ starpu\_codelet\ p2m\_cl;}
\DoxyCodeLine{00147\ \ \ \ \ starpu\_codelet\ m2m\_cl;}
\DoxyCodeLine{00148\ \ \ \ \ starpu\_codelet\ l2l\_cl;}
\DoxyCodeLine{00149\ \ \ \ \ starpu\_codelet\ l2l\_cl\_nocommute;}
\DoxyCodeLine{00150\ \ \ \ \ starpu\_codelet\ l2p\_cl;}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \ \ starpu\_codelet\ m2l\_cl\_in;}
\DoxyCodeLine{00153\ \ \ \ \ starpu\_codelet\ m2l\_cl\_inout;}
\DoxyCodeLine{00154\ \ \ \ \ starpu\_codelet\ m2l\_cl\_inout\_mpi;}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ starpu\_codelet\ p2p\_cl\_in;}
\DoxyCodeLine{00157\ \ \ \ \ starpu\_codelet\ p2p\_cl\_inout;}
\DoxyCodeLine{00158\ \ \ \ \ starpu\_codelet\ p2p\_cl\_inout\_mpi;}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_REDUX}}
\DoxyCodeLine{00162\ \ \ \ \ starpu\_codelet\ p2p\_redux\_init;}
\DoxyCodeLine{00163\ \ \ \ \ starpu\_codelet\ p2p\_redux\_perform;}
\DoxyCodeLine{00164\ \ \ \ \ starpu\_codelet\ p2p\_redux\_read;}
\DoxyCodeLine{00165\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ noCommuteAtLastLevel;}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ noCommuteBetweenLevel;}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00171\ \ \ \ \ StarPUCpuWrapperClass\ cpuWrapper;}
\DoxyCodeLine{00172\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00173\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00174\ \ \ \ \ StarPUCudaWrapperClass\ cudaWrapper;}
\DoxyCodeLine{00175\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00176\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00177\ \ \ \ \ StarPUOpenClWrapperClass\ openclWrapper;}
\DoxyCodeLine{00178\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \mbox{\hyperlink{class_f_star_p_u_ptr_interface}{FStarPUPtrInterface}}\ wrappers;}
\DoxyCodeLine{00181\ \ \ \ \ \mbox{\hyperlink{class_f_star_p_u_ptr_interface}{FStarPUPtrInterface}}*\ wrapperptr;}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \textcolor{preprocessor}{\#ifdef\ STARPU\_SUPPORT\_ARBITER}}
\DoxyCodeLine{00184\ \ \ \ \ starpu\_arbiter\_t\ arbiterGlobal;}
\DoxyCodeLine{00185\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_TASK\_NAME}}
\DoxyCodeLine{00188\ \ \ \ \ std::vector<std::unique\_ptr<char[]>>\ m2mTaskNames;}
\DoxyCodeLine{00189\ \ \ \ \ std::vector<std::unique\_ptr<char[]>>\ m2lTaskNames;}
\DoxyCodeLine{00190\ \ \ \ \ std::vector<std::unique\_ptr<char[]>>\ m2lOuterTaskNames;}
\DoxyCodeLine{00191\ \ \ \ \ std::vector<std::unique\_ptr<char[]>>\ l2lTaskNames;}
\DoxyCodeLine{00192\ \ \ \ \ std::unique\_ptr<char[]>\ p2mTaskNames;}
\DoxyCodeLine{00193\ \ \ \ \ std::unique\_ptr<char[]>\ l2pTaskNames;}
\DoxyCodeLine{00194\ \ \ \ \ std::unique\_ptr<char[]>\ p2pTaskNames;}
\DoxyCodeLine{00195\ \ \ \ \ std::unique\_ptr<char[]>\ p2pOuterTaskNames;}
\DoxyCodeLine{00196\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00197\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keyword}{typedef}\ FStarPUFmmPrioritiesV2\ PrioClass;\textcolor{comment}{//\ FStarPUFmmPriorities}}
\DoxyCodeLine{00199\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00202\ \ \ \ \ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm}{FGroupTaskStarPUMpiAlgorithm}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_mpi_1_1_f_comm}{FMpi::FComm}}\&\ inComm,\ OctreeClass*\textcolor{keyword}{const}\ inTree,\ KernelClass*\ inKernels)}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ :\ \ \ comm(inComm),\ tree(inTree),\ originalCpuKernel(inKernels),}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ cellHandles(nullptr),}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ noCommuteAtLastLevel(FEnv::GetBool(\textcolor{stringliteral}{"{}SCALFMM\_NO\_COMMUTE\_LAST\_L2L"{}},\ true)),}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ noCommuteBetweenLevel(FEnv::GetBool(\textcolor{stringliteral}{"{}SCALFMM\_NO\_COMMUTE\_M2L\_L2L"{}},\ false)),}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_CPU}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ cpuWrapper(tree-\/>getHeight()),}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ cudaWrapper(tree-\/>getHeight()),}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ openclWrapper(tree-\/>getHeight()),}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ wrapperptr(\&wrappers)\{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ FAssertLF(tree,\ \textcolor{stringliteral}{"{}tree\ cannot\ be\ null"{}});}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ FAssertLF(inKernels,\ \textcolor{stringliteral}{"{}kernels\ cannot\ be\ null"{}});}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ FAbstractAlgorithm::setNbLevelsInTree(tree-\/>getHeight());}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }starpu\_conf\ conf;}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ FAssertLF(starpu\_conf\_init(\&conf)\ ==\ 0);}
\DoxyCodeLine{00224\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ PrioClass::Controller().init(\&conf,\ tree-\/>getHeight(),\ inKernels);}
\DoxyCodeLine{00226\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ FAssertLF(starpu\_init(\&conf)\ ==\ 0);}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ FAssertLF(starpu\_mpi\_init\ (\ 0,\ 0,\ 0\ )\ ==\ 0);}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ *tag\_ub\ =\ 0;}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ ok\ =\ 0;}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ MPI\_Comm\_get\_attr(MPI\_COMM\_WORLD,\ MPI\_TAG\_UB,\ \&tag\_ub,\ \&ok);}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ starpu\_malloc\_set\_align(32);}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_t\ initMutex;}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_init(\&initMutex,\ NULL);}
\DoxyCodeLine{00238\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ FStarPUUtils::ExecOnWorkers(STARPU\_CPU,\ [\&]()\{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_lock(\&initMutex);}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ cpuWrapper.initKernel(starpu\_worker\_get\_id(),\ inKernels);}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_unlock(\&initMutex);}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ wrappers.set(FSTARPU\_CPU\_IDX,\ \&cpuWrapper);}
\DoxyCodeLine{00245\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00246\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ FStarPUUtils::ExecOnWorkers(STARPU\_CUDA,\ [\&]()\{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_lock(\&initMutex);}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ cudaWrapper.initKernel(starpu\_worker\_get\_id(),\ inKernels);}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_unlock(\&initMutex);}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ wrappers.set(FSTARPU\_CUDA\_IDX,\ \&cudaWrapper);}
\DoxyCodeLine{00253\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00254\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ FStarPUUtils::ExecOnWorkers(STARPU\_OPENCL,\ [\&]()\{}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_lock(\&initMutex);}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ openclWrapper.initKernel(starpu\_worker\_get\_id(),\ inKernels);}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_unlock(\&initMutex);}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ wrappers.set(FSTARPU\_OPENCL\_IDX,\ \&openclWrapper);}
\DoxyCodeLine{00261\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_destroy(\&initMutex);}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ starpu\_pause();}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ cellHandles\ \ \ =\ \textcolor{keyword}{new}\ std::vector<CellHandles>[tree-\/>getHeight()];}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \textcolor{preprocessor}{\#ifdef\ STARPU\_SUPPORT\_ARBITER}}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ arbiterGlobal\ =\ starpu\_arbiter\_create();}
\DoxyCodeLine{00270\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ initCodelet();}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ initCodeletMpi();}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ rebuildInteractions();}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}FGroupTaskStarPUAlgorithm\ (Max\ Worker\ "{}}\ <<\ starpu\_worker\_get\_count()\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}});}
\DoxyCodeLine{00276\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}FGroupTaskStarPUAlgorithm\ (Max\ CPU\ "{}}\ <<\ starpu\_cpu\_worker\_get\_count()\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}});}
\DoxyCodeLine{00278\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00279\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}FGroupTaskStarPUAlgorithm\ (Max\ OpenCL\ "{}}\ <<\ starpu\_opencl\_worker\_get\_count()\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}});}
\DoxyCodeLine{00281\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00282\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}FGroupTaskStarPUAlgorithm\ (Max\ CUDA\ "{}}\ <<\ starpu\_cuda\_worker\_get\_count()\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}});}
\DoxyCodeLine{00284\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}SCALFMM\_NO\_COMMUTE\_LAST\_L2L\ "{}}\ <<\ noCommuteAtLastLevel\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}SCALFMM\_NO\_COMMUTE\_M2L\_L2L\ "{}}\ <<\ noCommuteBetweenLevel\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ buildTaskNames();}
\DoxyCodeLine{00289\ \ \ \ \ \}}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{keywordtype}{void}\ buildTaskNames()\{}
\DoxyCodeLine{00292\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_TASK\_NAME}}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ namesLength\ =\ 128;}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ m2mTaskNames.resize(tree-\/>getHeight());}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ m2lTaskNames.resize(tree-\/>getHeight());}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ m2lOuterTaskNames.resize(tree-\/>getHeight());}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ l2lTaskNames.resize(tree-\/>getHeight());}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 0\ ;\ idxLevel\ <\ tree-\/>getHeight()\ ;\ ++idxLevel)\{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ m2mTaskNames[idxLevel].reset(\textcolor{keyword}{new}\ \textcolor{keywordtype}{char}[namesLength]);}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ snprintf(m2mTaskNames[idxLevel].get(),\ namesLength,\ \textcolor{stringliteral}{"{}M2M-\/level-\/\%d"{}},\ idxLevel);}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ m2lTaskNames[idxLevel].reset(\textcolor{keyword}{new}\ \textcolor{keywordtype}{char}[namesLength]);}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \ \ snprintf(m2lTaskNames[idxLevel].get(),\ namesLength,\ \textcolor{stringliteral}{"{}M2L-\/level-\/\%d"{}},\ idxLevel);}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ m2lOuterTaskNames[idxLevel].reset(\textcolor{keyword}{new}\ \textcolor{keywordtype}{char}[namesLength]);}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ snprintf(m2lOuterTaskNames[idxLevel].get(),\ namesLength,\ \textcolor{stringliteral}{"{}M2L-\/out-\/level-\/\%d"{}},\ idxLevel);}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ l2lTaskNames[idxLevel].reset(\textcolor{keyword}{new}\ \textcolor{keywordtype}{char}[namesLength]);}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ \ \ snprintf(l2lTaskNames[idxLevel].get(),\ namesLength,\ \textcolor{stringliteral}{"{}L2L-\/level-\/\%d"{}},\ idxLevel);}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ p2mTaskNames.reset(\textcolor{keyword}{new}\ \textcolor{keywordtype}{char}[namesLength]);}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ snprintf(p2mTaskNames.get(),\ namesLength,\ \textcolor{stringliteral}{"{}P2M"{}});}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ l2pTaskNames.reset(\textcolor{keyword}{new}\ \textcolor{keywordtype}{char}[namesLength]);}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ snprintf(l2pTaskNames.get(),\ namesLength,\ \textcolor{stringliteral}{"{}L2P"{}});}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ p2pTaskNames.reset(\textcolor{keyword}{new}\ \textcolor{keywordtype}{char}[namesLength]);}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ snprintf(p2pTaskNames.get(),\ namesLength,\ \textcolor{stringliteral}{"{}P2P"{}});}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ p2pOuterTaskNames.reset(\textcolor{keyword}{new}\ \textcolor{keywordtype}{char}[namesLength]);}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ snprintf(p2pOuterTaskNames.get(),\ namesLength,\ \textcolor{stringliteral}{"{}P2P-\/out"{}});}
\DoxyCodeLine{00317\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00318\ \ \ \ \ \}}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \ \ \textcolor{keywordtype}{void}\ syncData()\{}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 0\ ;\ idxLevel\ <\ tree-\/>getHeight()\ ;\ ++idxLevel)\{}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxHandle\ =\ 0\ ;\ idxHandle\ <\ int(cellHandles[idxLevel].size())\ ;\ ++idxHandle)\{}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_acquire(cellHandles[idxLevel][idxHandle].symb,\ STARPU\_R);}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_release(cellHandles[idxLevel][idxHandle].symb);}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_acquire(cellHandles[idxLevel][idxHandle].up,\ STARPU\_R);}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_release(cellHandles[idxLevel][idxHandle].up);}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_acquire(cellHandles[idxLevel][idxHandle].down,\ STARPU\_R);}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_release(cellHandles[idxLevel][idxHandle].down);}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxHandle\ =\ 0\ ;\ idxHandle\ <\ int(particleHandles.size())\ ;\ ++idxHandle)\{}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_acquire(particleHandles[idxHandle].symb,\ STARPU\_R);}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_release(particleHandles[idxHandle].symb);}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_acquire(particleHandles[idxHandle].down,\ STARPU\_R);}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_release(particleHandles[idxHandle].down);}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00339\ \ \ \ \ \}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \ \ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm}{\string~FGroupTaskStarPUMpiAlgorithm}}()\{}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ starpu\_resume();}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a8c9870196537254592681db15a518ed2}{cleanHandle}}();}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ cleanHandleMpi();}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ cellHandles;}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_t\ releaseMutex;}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_init(\&releaseMutex,\ NULL);}
\DoxyCodeLine{00350\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ FStarPUUtils::ExecOnWorkers(STARPU\_CPU,\ [\&]()\{}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_lock(\&releaseMutex);}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \ \ cpuWrapper.releaseKernel(starpu\_worker\_get\_id());}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_unlock(\&releaseMutex);}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ wrappers.set(FSTARPU\_CPU\_IDX,\ \&cpuWrapper);}
\DoxyCodeLine{00357\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00358\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ FStarPUUtils::ExecOnWorkers(STARPU\_CUDA,\ [\&]()\{}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_lock(\&releaseMutex);}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ cudaWrapper.releaseKernel(starpu\_worker\_get\_id());}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_unlock(\&releaseMutex);}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ wrappers.set(FSTARPU\_CUDA\_IDX,\ \&cudaWrapper);}
\DoxyCodeLine{00365\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00366\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ FStarPUUtils::ExecOnWorkers(STARPU\_OPENCL,\ [\&]()\{}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_lock(\&releaseMutex);}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \ \ \ \ openclWrapper.releaseKernel(starpu\_worker\_get\_id());}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_unlock(\&releaseMutex);}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ wrappers.set(FSTARPU\_OPENCL\_IDX,\ \&openclWrapper);}
\DoxyCodeLine{00373\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ starpu\_pthread\_mutex\_destroy(\&releaseMutex);}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ }
\DoxyCodeLine{00377\ \textcolor{preprocessor}{\#ifdef\ STARPU\_SUPPORT\_ARBITER}}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ starpu\_arbiter\_destroy(arbiterGlobal);}
\DoxyCodeLine{00379\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ starpu\_mpi\_shutdown();}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ starpu\_shutdown();}
\DoxyCodeLine{00382\ \ \ \ \ \}}
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ \ \ \ \ \textcolor{keywordtype}{void}\ rebuildInteractions()\{}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ FAssertLF(getenv(\textcolor{stringliteral}{"{}OMP\_WAIT\_POLICY"{}})\ ==\ \textcolor{keyword}{nullptr}}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ strcmp(getenv(\textcolor{stringliteral}{"{}OMP\_WAIT\_POLICY"{}}),\ \textcolor{stringliteral}{"{}PASSIVE"{}})\ ==\ 0}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ strcmp(getenv(\textcolor{stringliteral}{"{}OMP\_WAIT\_POLICY"{}}),\ \textcolor{stringliteral}{"{}passive"{}})\ ==\ 0);}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00389\ \textcolor{preprocessor}{\#pragma\ omp\ parallel}}
\DoxyCodeLine{00390\ \textcolor{preprocessor}{\#pragma\ omp\ single}}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_aff29c7d0ad17cefe0495b2ef1b348fc2}{buildExternalInteractionVecs}}();}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a0a79415321e4c161739259623ea34fcd}{buildHandles}}();}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \textcolor{preprocessor}{\#pragma\ omp\ parallel}}
\DoxyCodeLine{00395\ \textcolor{preprocessor}{\#pragma\ omp\ single}}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ buildRemoteInteractionsAndHandles();}
\DoxyCodeLine{00397\ \ \ \ \ \}}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00400\ \ \ \ \ \textcolor{keywordtype}{void}\ forEachCpuWorker(std::function<\textcolor{keywordtype}{void}(\textcolor{keywordtype}{void})>\ func)\{}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ starpu\_resume();}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ FStarPUUtils::ExecOnWorkers(STARPU\_CPU,\ func);}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ starpu\_pause();}
\DoxyCodeLine{00404\ \ \ \ \ \}}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{keywordtype}{void}\ forEachCpuWorker(std::function<\textcolor{keywordtype}{void}(KernelClass*)>\ func)\{}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ starpu\_resume();}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ FStarPUUtils::ExecOnWorkers(STARPU\_CPU,\ [\&]()\{}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ \ func(cpuWrapper.getKernel(starpu\_worker\_get\_id()));}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ starpu\_pause();}
\DoxyCodeLine{00412\ \ \ \ \ \}}
\DoxyCodeLine{00413\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00414\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00415\ \ \ \ \ \textcolor{keywordtype}{void}\ forEachCudaWorker(std::function<\textcolor{keywordtype}{void}(\textcolor{keywordtype}{void})>\ func)\{}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ starpu\_resume();}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ FStarPUUtils::ExecOnWorkers(STARPU\_CUDA,\ func);}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ starpu\_pause();}
\DoxyCodeLine{00419\ \ \ \ \ \}}
\DoxyCodeLine{00420\ \ \ \ \ \textcolor{keywordtype}{void}\ forEachCudaWorker(std::function<\textcolor{keywordtype}{void}(\textcolor{keywordtype}{void}*)>\ func)\{}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ starpu\_resume();}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ FStarPUUtils::ExecOnWorkers(STARPU\_CUDA,\ [\&]()\{}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ func(cudaWrapper.getKernel(starpu\_worker\_get\_id()));}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ starpu\_pause();}
\DoxyCodeLine{00426\ \ \ \ \ \}}
\DoxyCodeLine{00427\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00428\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00429\ \ \ \ \ \textcolor{keywordtype}{void}\ forEachOpenCLWorker(std::function<\textcolor{keywordtype}{void}(\textcolor{keywordtype}{void})>\ func)\{}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ starpu\_resume();}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ FStarPUUtils::ExecOnWorkers(STARPU\_OPENCL,\ func);}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ starpu\_pause();}
\DoxyCodeLine{00433\ \ \ \ \ \}}
\DoxyCodeLine{00434\ \ \ \ \ \textcolor{keywordtype}{void}\ forEachOpenCLWorker(std::function<\textcolor{keywordtype}{void}(\textcolor{keywordtype}{void}*)>\ func)\{}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ starpu\_resume();}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ FStarPUUtils::ExecOnWorkers(STARPU\_OPENCL,\ [\&]()\{}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ \ \ func(openclWrapper.getKernel(starpu\_worker\_get\_id()));}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ starpu\_pause();}
\DoxyCodeLine{00440\ \ \ \ \ \}}
\DoxyCodeLine{00441\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00448\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a041d36d4ea9e6bb425ed5c9b7ce6e9b0}{executeCore}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ operationsToProceed)\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)tStart\ FGroupTaskStarPUMpiAlgorithm\(\backslash\)n"{}}\ );}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ directOnly\ =\ (tree-\/>getHeight()\ <=\ 2);}
\DoxyCodeLine{00451\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ FTIME\_TASKS(cpuWrapper.taskTimeRecorder.start());}
\DoxyCodeLine{00453\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00454\ }
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ FLOG(\mbox{\hyperlink{class_f_tic}{FTic}}\ timerSoumission);}
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ starpu\_resume();}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ postRecvAllocatedBlocks();}
\DoxyCodeLine{00459\ }
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ operationsToProceed\ \&\ FFmmP2P\ )\ insertParticlesSend();}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ operationsToProceed\ \&\ FFmmP2P\ )\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a7a5a4b62e687f54aaea1065c9e7e8ee8}{directPass}}();}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ operationsToProceed\ \&\ FFmmP2P\ )\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a0afee8f5cab97a6908a3460df2a35cd5}{directPassMpi}}();}
\DoxyCodeLine{00463\ }
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(operationsToProceed\ \&\ FFmmP2M\ \&\&\ !directOnly)\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a78c597d17d7b821cfe25b5c394c22ac2}{bottomPass}}();}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(operationsToProceed\ \&\ FFmmM2M\ \&\&\ !directOnly)\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_abb958c2b0283800fe7b96d576818912c}{upwardPass}}();}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(operationsToProceed\ \&\ FFmmM2L\ \&\&\ !directOnly)\ insertCellsSend();}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(operationsToProceed\ \&\ FFmmM2L\ \&\&\ !directOnly)\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_ac988a24f8b1b8653d35d2a89dcf9cdec}{transferPass}}(\mbox{\hyperlink{class_f_abstract_algorithm_ade49cb5ede82d078261e576a9d809dc2}{FAbstractAlgorithm::upperWorkingLevel}},\ \mbox{\hyperlink{class_f_abstract_algorithm_a694b8888186be58e38691ce08b177d46}{FAbstractAlgorithm::lowerWorkingLevel}}-\/1\ ,\ \textcolor{keyword}{true},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(operationsToProceed\ \&\ FFmmM2L\ \&\&\ !directOnly)\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_ac988a24f8b1b8653d35d2a89dcf9cdec}{transferPass}}(\mbox{\hyperlink{class_f_abstract_algorithm_a694b8888186be58e38691ce08b177d46}{FAbstractAlgorithm::lowerWorkingLevel}}-\/1,\ \mbox{\hyperlink{class_f_abstract_algorithm_a694b8888186be58e38691ce08b177d46}{FAbstractAlgorithm::lowerWorkingLevel}},\ \textcolor{keyword}{false},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(operationsToProceed\ \&\ FFmmM2L\ \&\&\ !directOnly)\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_ad5cf0410312d1cc497bff50deb89e16b}{transferPassMpi}}();}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(operationsToProceed\ \&\ FFmmL2L\ \&\&\ !directOnly)\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a164598a5ad44cd97effeca45d38b0617}{downardPass}}();}
\DoxyCodeLine{00471\ }
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(operationsToProceed\ \&\ FFmmM2L\ \&\&\ !directOnly)\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_ac988a24f8b1b8653d35d2a89dcf9cdec}{transferPass}}(\mbox{\hyperlink{class_f_abstract_algorithm_a694b8888186be58e38691ce08b177d46}{FAbstractAlgorithm::lowerWorkingLevel}}-\/1,\ \mbox{\hyperlink{class_f_abstract_algorithm_a694b8888186be58e38691ce08b177d46}{FAbstractAlgorithm::lowerWorkingLevel}},\ \textcolor{keyword}{true},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ operationsToProceed\ \&\ FFmmL2P\ \&\&\ !directOnly)\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a4bd5a7c960dff137571ee45ca2d3fd4c}{mergePass}}();}
\DoxyCodeLine{00475\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_REDUX}}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ operationsToProceed\ \&\ FFmmL2P\ \&\&\ !directOnly)\ readParticle();}
\DoxyCodeLine{00477\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Submitting\ the\ tasks\ took\ "{}}\ <<\ timerSoumission.\mbox{\hyperlink{class_f_tic_ade3afdb1aa198635ebbc5ee8b7f4f081}{tacAndElapsed}}()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ starpu\_task\_wait\_for\_all();}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timerSync;\ );}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ syncData();}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Moving\ data\ to\ the\ host\ took\ "{}}\ <<\ timerSync.tacAndElapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ starpu\_pause();}
\DoxyCodeLine{00484\ }
\DoxyCodeLine{00485\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ FTIME\_TASKS(cpuWrapper.taskTimeRecorder.end());}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ FTIME\_TASKS(cpuWrapper.taskTimeRecorder.saveToDisk(\textcolor{stringliteral}{"{}/tmp/taskstime-\/FGroupTaskStarPUAlgorithm.txt"{}}));}
\DoxyCodeLine{00488\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00489\ \ \ \ \ \}}
\DoxyCodeLine{00490\ }
\DoxyCodeLine{00491\ \ \ \ \ \textcolor{keywordtype}{void}\ initCodelet()\{}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ memset(\&p2m\_cl,\ 0,\ \textcolor{keyword}{sizeof}(p2m\_cl));}
\DoxyCodeLine{00493\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportP2M(FSTARPU\_CPU\_IDX))\{}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ \ \ p2m\_cl.cpu\_funcs[0]\ =\ StarPUCpuWrapperClass::bottomPassCallback;}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \ \ p2m\_cl.where\ |=\ STARPU\_CPU;}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00498\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00499\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportP2M(FSTARPU\_CUDA\_IDX))\{}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ \ \ \ p2m\_cl.cuda\_funcs[0]\ =\ StarPUCudaWrapperClass::bottomPassCallback;}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ \ \ p2m\_cl.where\ |=\ STARPU\_CUDA;}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00504\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00505\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportP2M(FSTARPU\_OPENCL\_IDX))\{}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \ \ \ \ p2m\_cl.opencl\_funcs[0]\ =\ StarPUOpenClWrapperClass::bottomPassCallback;}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \ \ \ \ p2m\_cl.where\ |=\ STARPU\_OPENCL;}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00510\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ p2m\_cl.nbuffers\ =\ 3;}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ p2m\_cl.modes[0]\ =\ STARPU\_R;}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ p2m\_cl.modes[1]\ =\ STARPU\_RW;}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ p2m\_cl.modes[2]\ =\ STARPU\_R;}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ p2m\_cl.name\ =\ \textcolor{stringliteral}{"{}p2m\_cl"{}};}
\DoxyCodeLine{00516\ }
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(\&m2m\_cl,\ 0,\ \textcolor{keyword}{sizeof}(m2m\_cl));}
\DoxyCodeLine{00518\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportM2M(FSTARPU\_CPU\_IDX))\{}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ \ \ \ \ m2m\_cl.cpu\_funcs[0]\ =\ StarPUCpuWrapperClass::upwardPassCallback;}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \ \ \ \ m2m\_cl.where\ |=\ STARPU\_CPU;}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00523\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00524\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportM2M(FSTARPU\_CUDA\_IDX))\{}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \ \ \ \ m2m\_cl.cuda\_funcs[0]\ =\ StarPUCudaWrapperClass::upwardPassCallback;}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \ \ \ \ m2m\_cl.where\ |=\ STARPU\_CUDA;}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00529\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00530\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportM2M(FSTARPU\_OPENCL\_IDX))\{}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \ \ \ \ m2m\_cl.opencl\_funcs[0]\ =\ StarPUOpenClWrapperClass::upwardPassCallback;}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \ \ \ \ m2m\_cl.where\ |=\ STARPU\_OPENCL;}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00535\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ m2m\_cl.nbuffers\ =\ 4;}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ m2m\_cl.dyn\_modes\ =\ (starpu\_data\_access\_mode*)malloc(m2m\_cl.nbuffers*\textcolor{keyword}{sizeof}(starpu\_data\_access\_mode));}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ m2m\_cl.dyn\_modes[0]\ =\ STARPU\_R;}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ m2m\_cl.dyn\_modes[1]\ =\ starpu\_data\_access\_mode(STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED);}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ m2m\_cl.name\ =\ \textcolor{stringliteral}{"{}m2m\_cl"{}};}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ m2m\_cl.dyn\_modes[2]\ =\ STARPU\_R;}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ m2m\_cl.dyn\_modes[3]\ =\ STARPU\_R;}
\DoxyCodeLine{00543\ }
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(\&l2l\_cl,\ 0,\ \textcolor{keyword}{sizeof}(l2l\_cl));}
\DoxyCodeLine{00545\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportL2L(FSTARPU\_CPU\_IDX))\{}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \ \ l2l\_cl.cpu\_funcs[0]\ =\ StarPUCpuWrapperClass::downardPassCallback;}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ l2l\_cl.where\ |=\ STARPU\_CPU;}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00550\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00551\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportL2L(FSTARPU\_CUDA\_IDX))\{}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \ \ \ \ l2l\_cl.cuda\_funcs[0]\ =\ StarPUCudaWrapperClass::downardPassCallback;}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ l2l\_cl.where\ |=\ STARPU\_CUDA;}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00556\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00557\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportL2L(FSTARPU\_OPENCL\_IDX))\{}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \ \ \ \ l2l\_cl.opencl\_funcs[0]\ =\ StarPUOpenClWrapperClass::downardPassCallback;}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \ \ \ \ l2l\_cl.where\ |=\ STARPU\_OPENCL;}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00562\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ l2l\_cl.nbuffers\ =\ 4;}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ l2l\_cl.dyn\_modes\ =\ (starpu\_data\_access\_mode*)malloc(l2l\_cl.nbuffers*\textcolor{keyword}{sizeof}(starpu\_data\_access\_mode));}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ l2l\_cl.dyn\_modes[0]\ =\ STARPU\_R;}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ l2l\_cl.dyn\_modes[1]\ =\ STARPU\_R;}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ l2l\_cl.name\ =\ \textcolor{stringliteral}{"{}l2l\_cl"{}};}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ l2l\_cl.dyn\_modes[2]\ =\ STARPU\_R;}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ l2l\_cl.dyn\_modes[3]\ =\ starpu\_data\_access\_mode(STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED);}
\DoxyCodeLine{00570\ }
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(\&l2l\_cl\_nocommute,\ 0,\ \textcolor{keyword}{sizeof}(l2l\_cl\_nocommute));}
\DoxyCodeLine{00572\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportL2L(FSTARPU\_CPU\_IDX))\{}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \ \ \ \ l2l\_cl\_nocommute.cpu\_funcs[0]\ =\ StarPUCpuWrapperClass::downardPassCallback;}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \ \ \ \ l2l\_cl\_nocommute.where\ |=\ STARPU\_CPU;}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00577\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00578\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportL2L(FSTARPU\_CUDA\_IDX))\{}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \ \ \ \ l2l\_cl\_nocommute.cuda\_funcs[0]\ =\ StarPUCudaWrapperClass::downardPassCallback;}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \ \ \ \ l2l\_cl\_nocommute.where\ |=\ STARPU\_CUDA;}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00583\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00584\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportL2L(FSTARPU\_OPENCL\_IDX))\{}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \ \ \ \ l2l\_cl\_nocommute.opencl\_funcs[0]\ =\ StarPUOpenClWrapperClass::downardPassCallback;}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \ \ \ \ l2l\_cl\_nocommute.where\ |=\ STARPU\_OPENCL;}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00589\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ l2l\_cl\_nocommute.nbuffers\ =\ 4;}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ l2l\_cl\_nocommute.dyn\_modes\ =\ (starpu\_data\_access\_mode*)malloc(l2l\_cl\_nocommute.nbuffers*\textcolor{keyword}{sizeof}(starpu\_data\_access\_mode));}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ l2l\_cl\_nocommute.dyn\_modes[0]\ =\ STARPU\_R;}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ l2l\_cl\_nocommute.dyn\_modes[1]\ =\ STARPU\_R;}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ l2l\_cl\_nocommute.name\ =\ \textcolor{stringliteral}{"{}l2l\_cl"{}};}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ l2l\_cl\_nocommute.dyn\_modes[2]\ =\ STARPU\_R;}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ l2l\_cl\_nocommute.dyn\_modes[3]\ =\ STARPU\_RW;}
\DoxyCodeLine{00597\ }
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(\&l2p\_cl,\ 0,\ \textcolor{keyword}{sizeof}(l2p\_cl));}
\DoxyCodeLine{00599\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportL2P(FSTARPU\_CPU\_IDX))\{}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \ \ \ \ l2p\_cl.cpu\_funcs[0]\ =\ StarPUCpuWrapperClass::mergePassCallback;}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \ \ \ \ l2p\_cl.where\ |=\ STARPU\_CPU;}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00604\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00605\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportL2P(FSTARPU\_CUDA\_IDX))\{}
\DoxyCodeLine{00607\ \ \ \ \ \ \ \ \ \ \ \ \ l2p\_cl.cuda\_funcs[0]\ =\ StarPUCudaWrapperClass::mergePassCallback;}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ \ \ \ \ l2p\_cl.where\ |=\ STARPU\_CUDA;}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00610\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00611\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportL2P(FSTARPU\_OPENCL\_IDX))\{}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ \ \ \ \ l2p\_cl.opencl\_funcs[0]\ =\ StarPUOpenClWrapperClass::mergePassCallback;}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \ \ \ \ l2p\_cl.where\ |=\ STARPU\_OPENCL;}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00616\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ l2p\_cl.nbuffers\ =\ 4;}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ l2p\_cl.modes[0]\ =\ STARPU\_R;}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ l2p\_cl.modes[1]\ =\ STARPU\_R;}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ l2p\_cl.modes[2]\ =\ STARPU\_R;}
\DoxyCodeLine{00621\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_REDUX}}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ l2p\_cl.modes[3]\ =\ STARPU\_REDUX;}
\DoxyCodeLine{00623\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ l2p\_cl.modes[3]\ =\ starpu\_data\_access\_mode(STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED);}
\DoxyCodeLine{00625\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ l2p\_cl.name\ =\ \textcolor{stringliteral}{"{}l2p\_cl"{}};}
\DoxyCodeLine{00627\ }
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(\&p2p\_cl\_in,\ 0,\ \textcolor{keyword}{sizeof}(p2p\_cl\_in));}
\DoxyCodeLine{00629\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportP2P(FSTARPU\_CPU\_IDX))\{}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_in.cpu\_funcs[0]\ =\ StarPUCpuWrapperClass::directInPassCallback;}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_in.where\ |=\ STARPU\_CPU;}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00634\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00635\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportP2P(FSTARPU\_CUDA\_IDX))\{}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_in.cuda\_funcs[0]\ =\ StarPUCudaWrapperClass::directInPassCallback;}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_in.where\ |=\ STARPU\_CUDA;}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00640\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00641\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportP2P(FSTARPU\_OPENCL\_IDX))\{}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_in.opencl\_funcs[0]\ =\ StarPUOpenClWrapperClass::directInPassCallback;}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_in.where\ |=\ STARPU\_OPENCL;}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00646\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ p2p\_cl\_in.nbuffers\ =\ 2;}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ p2p\_cl\_in.modes[0]\ =\ STARPU\_R;}
\DoxyCodeLine{00649\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_REDUX}}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ p2p\_cl\_in.modes[1]\ =\ STARPU\_REDUX;}
\DoxyCodeLine{00651\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ p2p\_cl\_in.modes[1]\ =\ starpu\_data\_access\_mode(STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED);}
\DoxyCodeLine{00653\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ p2p\_cl\_in.name\ =\ \textcolor{stringliteral}{"{}p2p\_cl\_in"{}};}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(\&p2p\_cl\_inout,\ 0,\ \textcolor{keyword}{sizeof}(p2p\_cl\_inout));}
\DoxyCodeLine{00656\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportP2PExtern(FSTARPU\_CPU\_IDX))\{}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_inout.cpu\_funcs[0]\ =\ StarPUCpuWrapperClass::directInoutPassCallback;}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_inout.where\ |=\ STARPU\_CPU;}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00661\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00662\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportP2PExtern(FSTARPU\_CUDA\_IDX))\{}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_inout.cuda\_funcs[0]\ =\ StarPUCudaWrapperClass::directInoutPassCallback;}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_inout.where\ |=\ STARPU\_CUDA;}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00667\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00668\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportP2PExtern(FSTARPU\_OPENCL\_IDX))\{}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_inout.opencl\_funcs[0]\ =\ StarPUOpenClWrapperClass::directInoutPassCallback;}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_inout.where\ |=\ STARPU\_OPENCL;}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00673\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ p2p\_cl\_inout.nbuffers\ =\ 4;}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ p2p\_cl\_inout.modes[0]\ =\ STARPU\_R;}
\DoxyCodeLine{00676\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_REDUX}}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ p2p\_cl\_inout.modes[1]\ =\ STARPU\_REDUX;}
\DoxyCodeLine{00678\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \ \ p2p\_cl\_inout.modes[1]\ =\ starpu\_data\_access\_mode(STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED);}
\DoxyCodeLine{00680\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ p2p\_cl\_inout.modes[2]\ =\ STARPU\_R;}
\DoxyCodeLine{00682\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_REDUX}}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ p2p\_cl\_inout.modes[3]\ =\ STARPU\_REDUX;}
\DoxyCodeLine{00684\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ p2p\_cl\_inout.modes[3]\ =\ starpu\_data\_access\_mode(STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED);}
\DoxyCodeLine{00686\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ p2p\_cl\_inout.name\ =\ \textcolor{stringliteral}{"{}p2p\_cl\_inout"{}};}
\DoxyCodeLine{00688\ }
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(\&m2l\_cl\_in,\ 0,\ \textcolor{keyword}{sizeof}(m2l\_cl\_in));}
\DoxyCodeLine{00690\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportM2L(FSTARPU\_CPU\_IDX))\{}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_in.cpu\_funcs[0]\ =\ StarPUCpuWrapperClass::transferInPassCallback;}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_in.where\ |=\ STARPU\_CPU;}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00695\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00696\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportM2L(FSTARPU\_CUDA\_IDX))\{}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_in.cuda\_funcs[0]\ =\ StarPUCudaWrapperClass::transferInPassCallback;}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_in.where\ |=\ STARPU\_CUDA;}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00701\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00702\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportM2L(FSTARPU\_OPENCL\_IDX))\{}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_in.opencl\_funcs[0]\ =\ StarPUOpenClWrapperClass::transferInPassCallback;}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_in.where\ |=\ STARPU\_OPENCL;}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00707\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ m2l\_cl\_in.nbuffers\ =\ 3;}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ m2l\_cl\_in.modes[0]\ =\ STARPU\_R;}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ m2l\_cl\_in.modes[1]\ =\ STARPU\_R;}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ m2l\_cl\_in.modes[2]\ =\ starpu\_data\_access\_mode(STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED);}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ m2l\_cl\_in.name\ =\ \textcolor{stringliteral}{"{}m2l\_cl\_in"{}};}
\DoxyCodeLine{00713\ }
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(\&m2l\_cl\_inout,\ 0,\ \textcolor{keyword}{sizeof}(m2l\_cl\_inout));}
\DoxyCodeLine{00715\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportM2LExtern(FSTARPU\_CPU\_IDX))\{}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_inout.cpu\_funcs[0]\ =\ StarPUCpuWrapperClass::transferInoutPassCallback;}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_inout.where\ |=\ STARPU\_CPU;}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00720\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00721\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportM2LExtern(FSTARPU\_CUDA\_IDX))\{}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_inout.cuda\_funcs[0]\ =\ StarPUCudaWrapperClass::transferInoutPassCallback;}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_inout.where\ |=\ STARPU\_CUDA;}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00726\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00727\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportM2LExtern(FSTARPU\_OPENCL\_IDX))\{}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_inout.opencl\_funcs[0]\ =\ StarPUOpenClWrapperClass::transferInoutPassCallback;}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_inout.where\ |=\ STARPU\_OPENCL;}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00732\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ m2l\_cl\_inout.nbuffers\ =\ 4;}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ m2l\_cl\_inout.modes[0]\ =\ STARPU\_R;}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ m2l\_cl\_inout.modes[1]\ =\ starpu\_data\_access\_mode(STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED);}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ m2l\_cl\_inout.modes[2]\ =\ STARPU\_R;}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ m2l\_cl\_inout.modes[3]\ =\ STARPU\_R;}
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ m2l\_cl\_inout.name\ =\ \textcolor{stringliteral}{"{}m2l\_cl\_inout"{}};}
\DoxyCodeLine{00739\ }
\DoxyCodeLine{00740\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_REDUX}}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(\&p2p\_redux\_init,\ 0,\ \textcolor{keyword}{sizeof}(p2p\_redux\_init));}
\DoxyCodeLine{00742\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ p2p\_redux\_init.cpu\_funcs[0]\ =\ FStarPUReduxCpu::InitData<typename\ ParticleGroupClass::ParticleDataType>;}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ p2p\_redux\_init.where\ |=\ STARPU\_CPU;}
\DoxyCodeLine{00745\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ p2p\_redux\_init.nbuffers\ =\ 1;}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ p2p\_redux\_init.modes[0]\ =\ STARPU\_RW;}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ p2p\_redux\_init.name\ =\ \textcolor{stringliteral}{"{}p2p\_redux\_init"{}};}
\DoxyCodeLine{00749\ }
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(\&p2p\_redux\_perform,\ 0,\ \textcolor{keyword}{sizeof}(p2p\_redux\_perform));}
\DoxyCodeLine{00751\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ p2p\_redux\_perform.cpu\_funcs[0]\ =\ FStarPUReduxCpu::ReduceData<typename\ ParticleGroupClass::ParticleDataType>;}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ p2p\_redux\_perform.where\ |=\ STARPU\_CPU;}
\DoxyCodeLine{00754\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ p2p\_redux\_perform.nbuffers\ =\ 2;}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ p2p\_redux\_perform.modes[0]\ =\ STARPU\_RW;}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ p2p\_redux\_perform.modes[1]\ =\ STARPU\_R;}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ p2p\_redux\_perform.name\ =\ \textcolor{stringliteral}{"{}p2p\_redux\_perform"{}};}
\DoxyCodeLine{00759\ }
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(\&p2p\_redux\_read,\ 0,\ \textcolor{keyword}{sizeof}(p2p\_redux\_read));}
\DoxyCodeLine{00761\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportL2P(FSTARPU\_CPU\_IDX))\{}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_redux\_read.cpu\_funcs[0]\ =\ FStarPUReduxCpu::EmptyCodelet<typename\ ParticleGroupClass::ParticleDataType>;}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_redux\_read.where\ |=\ STARPU\_CPU;}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00766\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00767\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportL2P(FSTARPU\_CUDA\_IDX))\{}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_redux\_read.cuda\_funcs[0]\ =\ FStarPUReduxCpu::EmptyCodelet<typename\ ParticleGroupClass::ParticleDataType>;}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_redux\_read.where\ |=\ STARPU\_CUDA;}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00772\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00773\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportL2P(FSTARPU\_OPENCL\_IDX))\{}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_redux\_read.opencl\_funcs[0]\ =\ FStarPUReduxCpu::EmptyCodelet<typename\ ParticleGroupClass::ParticleDataType>;}
\DoxyCodeLine{00776\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_redux\_read.where\ |=\ STARPU\_OPENCL;}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00778\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ p2p\_redux\_read.nbuffers\ =\ 1;}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ p2p\_redux\_read.modes[0]\ =\ STARPU\_R;}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ p2p\_redux\_read.name\ =\ \textcolor{stringliteral}{"{}p2p\_redux\_read"{}};}
\DoxyCodeLine{00782\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00783\ \ \ \ \ \}}
\DoxyCodeLine{00784\ }
\DoxyCodeLine{00786\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a8c9870196537254592681db15a518ed2}{cleanHandle}}()\{}
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 0\ ;\ idxLevel\ <\ tree-\/>getHeight()\ ;\ ++idxLevel)\{}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxHandle\ =\ 0\ ;\ idxHandle\ <\ int(cellHandles[idxLevel].size())\ ;\ ++idxHandle)\{}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_unregister(cellHandles[idxLevel][idxHandle].symb);}
\DoxyCodeLine{00790\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_unregister(cellHandles[idxLevel][idxHandle].up);}
\DoxyCodeLine{00791\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_unregister(cellHandles[idxLevel][idxHandle].down);}
\DoxyCodeLine{00792\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \ \ \ \ \ \ cellHandles[idxLevel].clear();}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxHandle\ =\ 0\ ;\ idxHandle\ <\ int(particleHandles.size())\ ;\ ++idxHandle)\{}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_unregister(particleHandles[idxHandle].symb);}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_unregister(particleHandles[idxHandle].down);}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \ \ \ \ particleHandles.clear();}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00802\ \ \ \ \ \}}
\DoxyCodeLine{00803\ }
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00806\ \ \ \ \ \textcolor{keywordtype}{void}\ initCodeletMpi()\{}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ memset(\&p2p\_cl\_inout\_mpi,\ 0,\ \textcolor{keyword}{sizeof}(p2p\_cl\_inout\_mpi));}
\DoxyCodeLine{00808\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportP2PMpi(FSTARPU\_CPU\_IDX))\{}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_inout\_mpi.where\ |=\ STARPU\_CPU;}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_inout\_mpi.cpu\_funcs[0]\ =\ StarPUCpuWrapperClass::directInoutPassCallbackMpi;}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00813\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00814\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00815\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportP2PMpi(FSTARPU\_CUDA\_IDX))\{}
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_inout\_mpi.where\ |=\ STARPU\_CUDA;}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_inout\_mpi.cuda\_funcs[0]\ =\ StarPUCudaWrapperClass::directInoutPassCallbackMpi;}
\DoxyCodeLine{00818\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00819\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00820\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00821\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportP2PMpi(FSTARPU\_OPENCL\_IDX))\{}
\DoxyCodeLine{00822\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_inout\_mpi.where\ |=\ STARPU\_OPENCL;}
\DoxyCodeLine{00823\ \ \ \ \ \ \ \ \ \ \ \ \ p2p\_cl\_inout\_mpi.opencl\_funcs[0]\ =\ StarPUOpenClWrapperClass::directInoutPassCallbackMpi;}
\DoxyCodeLine{00824\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00825\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \ \ p2p\_cl\_inout\_mpi.nbuffers\ =\ 3;}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ p2p\_cl\_inout\_mpi.modes[0]\ =\ STARPU\_R;}
\DoxyCodeLine{00828\ \ \ \ \ \ \ \ \ p2p\_cl\_inout\_mpi.modes[1]\ =\ starpu\_data\_access\_mode(STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED);}
\DoxyCodeLine{00829\ \ \ \ \ \ \ \ \ p2p\_cl\_inout\_mpi.modes[2]\ =\ STARPU\_R;}
\DoxyCodeLine{00830\ \ \ \ \ \ \ \ \ p2p\_cl\_inout\_mpi.name\ =\ \textcolor{stringliteral}{"{}p2p\_cl\_inout\_mpi"{}};}
\DoxyCodeLine{00831\ }
\DoxyCodeLine{00832\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(\&m2l\_cl\_inout\_mpi,\ 0,\ \textcolor{keyword}{sizeof}(m2l\_cl\_inout\_mpi));}
\DoxyCodeLine{00833\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_CPU}}
\DoxyCodeLine{00834\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportM2LMpi(FSTARPU\_CPU\_IDX))\{}
\DoxyCodeLine{00835\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_inout\_mpi.where\ |=\ STARPU\_CPU;}
\DoxyCodeLine{00836\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_inout\_mpi.cpu\_funcs[0]\ =\ StarPUCpuWrapperClass::transferInoutPassCallbackMpi;}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00838\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00839\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_CUDA\_KERNEL}}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportM2LMpi(FSTARPU\_CUDA\_IDX))\{}
\DoxyCodeLine{00841\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_inout\_mpi.where\ |=\ STARPU\_CUDA;}
\DoxyCodeLine{00842\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_inout\_mpi.cuda\_funcs[0]\ =\ StarPUCudaWrapperClass::transferInoutPassCallbackMpi;}
\DoxyCodeLine{00843\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00844\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00845\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_ENABLE\_OPENCL\_KERNEL}}
\DoxyCodeLine{00846\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(originalCpuKernel-\/>supportM2LMpi(FSTARPU\_OPENCL\_IDX))\{}
\DoxyCodeLine{00847\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_inout\_mpi.where\ |=\ STARPU\_OPENCL;}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \ \ \ \ \ \ m2l\_cl\_inout\_mpi.opencl\_funcs[0]\ =\ StarPUOpenClWrapperClass::transferInoutPassCallbackMpi;}
\DoxyCodeLine{00849\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00850\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \ \ m2l\_cl\_inout\_mpi.nbuffers\ =\ 4;}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ m2l\_cl\_inout\_mpi.modes[0]\ =\ STARPU\_R;}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ m2l\_cl\_inout\_mpi.modes[1]\ =\ starpu\_data\_access\_mode(STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED);}
\DoxyCodeLine{00854\ \ \ \ \ \ \ \ \ m2l\_cl\_inout\_mpi.modes[2]\ =\ STARPU\_R;}
\DoxyCodeLine{00855\ \ \ \ \ \ \ \ \ m2l\_cl\_inout\_mpi.modes[3]\ =\ STARPU\_R;}
\DoxyCodeLine{00856\ \ \ \ \ \ \ \ \ m2l\_cl\_inout\_mpi.name\ =\ \textcolor{stringliteral}{"{}m2l\_cl\_inout\_mpi"{}};}
\DoxyCodeLine{00857\ \ \ \ \ \}}
\DoxyCodeLine{00858\ }
\DoxyCodeLine{00859\ \ \ \ \ std::vector<std::pair<MortonIndex,MortonIndex>>\ processesIntervalPerLevels;}
\DoxyCodeLine{00860\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_f_group_task_star_p_u_mpi_algorithm_1_1_block_descriptor}{BlockDescriptor}}\{}
\DoxyCodeLine{00861\ \ \ \ \ \ \ \ \ MortonIndex\ firstIndex;}
\DoxyCodeLine{00862\ \ \ \ \ \ \ \ \ MortonIndex\ lastIndex;}
\DoxyCodeLine{00863\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ globalIdx;}
\DoxyCodeLine{00864\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ owner;}
\DoxyCodeLine{00865\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ bufferSize;}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bufferSizeSymb;}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bufferSizeUp;}
\DoxyCodeLine{00868\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bufferSizeDown;}
\DoxyCodeLine{00869\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ leavesBufferSize;}
\DoxyCodeLine{00870\ \ \ \ \ \};}
\DoxyCodeLine{00871\ \ \ \ \ std::vector<std::vector<BlockDescriptor>>\ processesBlockInfos;}
\DoxyCodeLine{00872\ \ \ \ \ std::vector<int>\ nbBlocksPerLevelAll;}
\DoxyCodeLine{00873\ \ \ \ \ std::vector<int>\ nbBlocksBeforeMinPerLevel;}
\DoxyCodeLine{00874\ }
\DoxyCodeLine{00875\ \ \ \ \ std::vector<\ std::vector<\ std::vector<BlockInteractions<CellContainerClass>>>>\ externalInteractionsAllLevelMpi;}
\DoxyCodeLine{00876\ \ \ \ \ std::vector<\ std::vector<BlockInteractions<ParticleGroupClass>>>\ externalInteractionsLeafLevelMpi;}
\DoxyCodeLine{00877\ }
\DoxyCodeLine{00878\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_f_group_task_star_p_u_mpi_algorithm_1_1_remote_handle}{RemoteHandle}}\{}
\DoxyCodeLine{00879\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_f_group_task_star_p_u_mpi_algorithm_1_1_remote_handle}{RemoteHandle}}()\ :\ ptrSymb(\textcolor{keyword}{nullptr}),\ ptrUp(\textcolor{keyword}{nullptr}),\ ptrDown(\textcolor{keyword}{nullptr})\{}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ \ \ \ \ memset(\&handleSymb,\ 0,\ \textcolor{keyword}{sizeof}(handleSymb));}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ \ \ \ \ memset(\&handleUp,\ 0,\ \textcolor{keyword}{sizeof}(handleUp));}
\DoxyCodeLine{00882\ \ \ \ \ \ \ \ \ \ \ \ \ memset(\&handleDown,\ 0,\ \textcolor{keyword}{sizeof}(handleDown));}
\DoxyCodeLine{00883\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00884\ }
\DoxyCodeLine{00885\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *\ ptrSymb;}
\DoxyCodeLine{00886\ \ \ \ \ \ \ \ \ starpu\_data\_handle\_t\ handleSymb;}
\DoxyCodeLine{00887\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *\ ptrUp;}
\DoxyCodeLine{00888\ \ \ \ \ \ \ \ \ starpu\_data\_handle\_t\ handleUp;}
\DoxyCodeLine{00889\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *\ ptrDown;}
\DoxyCodeLine{00890\ \ \ \ \ \ \ \ \ starpu\_data\_handle\_t\ handleDown;}
\DoxyCodeLine{00891\ }
\DoxyCodeLine{00892\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ intervalSize;}
\DoxyCodeLine{00893\ \ \ \ \ \};}
\DoxyCodeLine{00894\ }
\DoxyCodeLine{00895\ \ \ \ \ std::vector<std::vector<RemoteHandle>>\ remoteCellGroups;}
\DoxyCodeLine{00896\ \ \ \ \ std::vector<RemoteHandle>\ remoteParticleGroupss;}
\DoxyCodeLine{00897\ }
\DoxyCodeLine{00898\ \ \ \ \ \textcolor{keywordtype}{void}\ buildRemoteInteractionsAndHandles()\{}
\DoxyCodeLine{00899\ \ \ \ \ \ \ \ \ cleanHandleMpi();}
\DoxyCodeLine{00900\ }
\DoxyCodeLine{00901\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ have\ information\ about\ all\ other\ blocks}}
\DoxyCodeLine{00902\ \ \ \ \ \ \ \ \ std::unique\_ptr<int[]>\ nbBlocksPerLevel(\textcolor{keyword}{new}\ \textcolor{keywordtype}{int}[tree-\/>getHeight()]);}
\DoxyCodeLine{00903\ \ \ \ \ \ \ \ \ nbBlocksPerLevel[0]\ =\ 0;}
\DoxyCodeLine{00904\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 1\ ;\ idxLevel\ <\ tree-\/>getHeight()\ ;\ ++idxLevel)\{}
\DoxyCodeLine{00905\ \ \ \ \ \ \ \ \ \ \ \ \ nbBlocksPerLevel[idxLevel]\ =\ tree-\/>getNbCellGroupAtLevel(idxLevel);}
\DoxyCodeLine{00906\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00907\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Exchange\ the\ number\ of\ blocks\ per\ proc}}
\DoxyCodeLine{00908\ \ \ \ \ \ \ \ \ nbBlocksPerLevelAll.resize(tree-\/>getHeight()\ *\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a8608b660084f464599aa35c411100854}{processCount}}());}
\DoxyCodeLine{00909\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a9a6f670ec0771204ba8bd5e8bc1637ba}{FMpi::Assert}}(MPI\_Allgather(nbBlocksPerLevel.get(),\ tree-\/>getHeight(),\ MPI\_INT,}
\DoxyCodeLine{00910\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nbBlocksPerLevelAll.data(),\ tree-\/>getHeight(),\ MPI\_INT,}
\DoxyCodeLine{00911\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}()),\ \_\_LINE\_\_);}
\DoxyCodeLine{00912\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ number\ of\ blocks\ before\ mine}}
\DoxyCodeLine{00913\ \ \ \ \ \ \ \ \ nbBlocksBeforeMinPerLevel.resize(tree-\/>getHeight());}
\DoxyCodeLine{00914\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 1\ ;\ idxLevel\ <\ tree-\/>getHeight()\ ;\ ++idxLevel)\{}
\DoxyCodeLine{00915\ \ \ \ \ \ \ \ \ \ \ \ \ nbBlocksBeforeMinPerLevel[idxLevel]\ =\ 0;}
\DoxyCodeLine{00916\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProc\ =\ 0\ ;\ idxProc\ <\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a3f21607da8f2938bd39de261c4cff703}{processId}}()\ ;\ ++idxProc)\{}
\DoxyCodeLine{00917\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nbBlocksBeforeMinPerLevel[idxLevel]\ +=\ nbBlocksPerLevelAll[idxProc*tree-\/>getHeight()\ +\ idxLevel];}
\DoxyCodeLine{00918\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00919\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00920\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Prepare\ the\ block\ infos}}
\DoxyCodeLine{00921\ \ \ \ \ \ \ \ \ processesBlockInfos.resize(tree-\/>getHeight());}
\DoxyCodeLine{00922\ \ \ \ \ \ \ \ \ std::unique\_ptr<int[]>\ recvBlocksCount(\textcolor{keyword}{new}\ \textcolor{keywordtype}{int}[comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a8608b660084f464599aa35c411100854}{processCount}}()]);}
\DoxyCodeLine{00923\ \ \ \ \ \ \ \ \ std::unique\_ptr<int[]>\ recvBlockDispl(\textcolor{keyword}{new}\ \textcolor{keywordtype}{int}[comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a8608b660084f464599aa35c411100854}{processCount}}()]);}
\DoxyCodeLine{00924\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Exchange\ the\ block\ info\ per\ level}}
\DoxyCodeLine{00925\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 1\ ;\ idxLevel\ <\ tree-\/>getHeight()\ ;\ ++idxLevel)\{}
\DoxyCodeLine{00926\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Count\ the\ total\ number\ of\ blocks}}
\DoxyCodeLine{00927\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nbBlocksInLevel\ =\ 0;}
\DoxyCodeLine{00928\ \ \ \ \ \ \ \ \ \ \ \ \ recvBlockDispl[0]\ =\ 0;}
\DoxyCodeLine{00929\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProc\ =\ 0\ ;\ idxProc\ <\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a8608b660084f464599aa35c411100854}{processCount}}()\ ;\ ++idxProc)\{}
\DoxyCodeLine{00930\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nbBlocksInLevel\ +=\ nbBlocksPerLevelAll[idxProc*tree-\/>getHeight()\ +\ idxLevel];}
\DoxyCodeLine{00931\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Count\ and\ displacement\ for\ the\ MPI\ all\ gatherv}}
\DoxyCodeLine{00932\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recvBlocksCount[idxProc]\ =\ nbBlocksPerLevelAll[idxProc*tree-\/>getHeight()\ +\ idxLevel]\ *\ int(\textcolor{keyword}{sizeof}(BlockDescriptor));}
\DoxyCodeLine{00933\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idxProc)\ recvBlockDispl[idxProc]\ =\ recvBlockDispl[idxProc-\/1]\ +\ recvBlocksCount[idxProc-\/1];}
\DoxyCodeLine{00934\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00935\ \ \ \ \ \ \ \ \ \ \ \ \ processesBlockInfos[idxLevel].resize(nbBlocksInLevel);}
\DoxyCodeLine{00936\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Fill\ my\ blocks}}
\DoxyCodeLine{00937\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<BlockDescriptor>\ myBlocksAtLevel;}
\DoxyCodeLine{00938\ \ \ \ \ \ \ \ \ \ \ \ \ myBlocksAtLevel.resize(nbBlocksPerLevel[idxLevel]);}
\DoxyCodeLine{00939\ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(tree-\/>getNbCellGroupAtLevel(idxLevel)\ ==\ \textcolor{keywordtype}{int}(myBlocksAtLevel.size()));}
\DoxyCodeLine{00940\ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(nbBlocksPerLevel[idxLevel]\ ==\ nbBlocksPerLevelAll[comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a3f21607da8f2938bd39de261c4cff703}{processId}}()*tree-\/>getHeight()\ +\ idxLevel]);}
\DoxyCodeLine{00941\ }
\DoxyCodeLine{00942\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbCellGroupAtLevel(idxLevel)\ ;\ ++idxGroup)\{}
\DoxyCodeLine{00943\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CellContainerClass*\textcolor{keyword}{const}\ currentCells\ =\ tree-\/>getCellGroup(idxLevel,\ idxGroup);}
\DoxyCodeLine{00944\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myBlocksAtLevel[idxGroup].firstIndex\ =\ currentCells-\/>getStartingIndex();}
\DoxyCodeLine{00945\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myBlocksAtLevel[idxGroup].lastIndex\ \ =\ currentCells-\/>getEndingIndex();}
\DoxyCodeLine{00946\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myBlocksAtLevel[idxGroup].owner\ =\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a3f21607da8f2938bd39de261c4cff703}{processId}}();}
\DoxyCodeLine{00947\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myBlocksAtLevel[idxGroup].globalIdx\ =\ nbBlocksBeforeMinPerLevel[idxLevel]\ +\ idxGroup;}
\DoxyCodeLine{00948\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myBlocksAtLevel[idxGroup].bufferSizeSymb\ =\ currentCells-\/>getBufferSizeInByte();}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myBlocksAtLevel[idxGroup].bufferSizeUp\ \ \ =\ currentCells-\/>getMultipoleBufferSizeInByte();}
\DoxyCodeLine{00950\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myBlocksAtLevel[idxGroup].bufferSizeDown\ =\ currentCells-\/>getLocalBufferSizeInByte();}
\DoxyCodeLine{00951\ }
\DoxyCodeLine{00952\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idxLevel\ ==\ tree-\/>getHeight()\ -\/\ 1)\{}
\DoxyCodeLine{00953\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myBlocksAtLevel[idxGroup].leavesBufferSize\ =\ tree-\/>getParticleGroup(idxGroup)-\/>getBufferSizeInByte();}
\DoxyCodeLine{00954\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00955\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{00956\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myBlocksAtLevel[idxGroup].leavesBufferSize\ =\ 0;}
\DoxyCodeLine{00957\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00958\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00959\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Exchange\ with\ all\ other}}
\DoxyCodeLine{00960\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a9a6f670ec0771204ba8bd5e8bc1637ba}{FMpi::Assert}}(MPI\_Allgatherv(myBlocksAtLevel.data(),\ \textcolor{keywordtype}{int}(myBlocksAtLevel.size()*\textcolor{keyword}{sizeof}(BlockDescriptor)),\ MPI\_BYTE,}
\DoxyCodeLine{00961\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processesBlockInfos[idxLevel].data(),\ recvBlocksCount.get(),\ recvBlockDispl.get(),\ MPI\_BYTE,}
\DoxyCodeLine{00962\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}()),\ \_\_LINE\_\_);}
\DoxyCodeLine{00963\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00964\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Prepare\ remate\ ptr\ and\ handles}}
\DoxyCodeLine{00965\ \ \ \ \ \ \ \ \ remoteCellGroups.resize(\ tree-\/>getHeight()\ );}
\DoxyCodeLine{00966\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 1\ ;\ idxLevel\ <\ tree-\/>getHeight()\ ;\ ++idxLevel)\{}
\DoxyCodeLine{00967\ \ \ \ \ \ \ \ \ \ \ \ \ remoteCellGroups[idxLevel].resize(\ processesBlockInfos[idxLevel].size());}
\DoxyCodeLine{00968\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00969\ \ \ \ \ \ \ \ \ remoteParticleGroupss.resize(processesBlockInfos[tree-\/>getHeight()-\/1].size());}
\DoxyCodeLine{00970\ }
\DoxyCodeLine{00971\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ From\ now\ we\ have\ the\ number\ of\ blocks\ for\ all\ process}}
\DoxyCodeLine{00972\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ also\ have\ the\ size\ of\ the\ blocks\ therefor\ we\ can}}
\DoxyCodeLine{00973\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ create\ the\ handles\ we\ need}}
\DoxyCodeLine{00974\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ will\ now\ detect\ the\ relation\ between\ our\ blocks\ and\ others}}
\DoxyCodeLine{00975\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ During\ the\ M2M\ (which\ is\ the\ same\ for\ the\ L2L)}}
\DoxyCodeLine{00976\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ During\ the\ M2L\ and\ during\ the\ P2P}}
\DoxyCodeLine{00977\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ I\ need\ to\ insert\ the\ task\ that\ read\ my\ data\ or\ that\ write\ the\ data\ I\ need.}}
\DoxyCodeLine{00978\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ M2L}}
\DoxyCodeLine{00979\ \ \ \ \ \ \ \ \ externalInteractionsAllLevelMpi.clear();}
\DoxyCodeLine{00980\ \ \ \ \ \ \ \ \ externalInteractionsAllLevelMpi.resize(tree-\/>getHeight());}
\DoxyCodeLine{00981\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ tree-\/>getHeight()-\/1\ ;\ idxLevel\ >=\ 2\ ;\ -\/-\/idxLevel)\{}
\DoxyCodeLine{00982\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ From\ this\ level\ there\ are\ no\ more\ blocks}}
\DoxyCodeLine{00983\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(tree-\/>getNbCellGroupAtLevel(idxLevel)\ ==\ 0)\{}
\DoxyCodeLine{00984\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ stop\ here}}
\DoxyCodeLine{00985\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00986\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00987\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ What\ are\ my\ morton\ interval\ at\ this\ level}}
\DoxyCodeLine{00988\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ myFirstIndex\ =\ tree-\/>getCellGroup(idxLevel,\ 0)-\/>getStartingIndex();}
\DoxyCodeLine{00989\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ myLastIndex\ =\ tree-\/>getCellGroup(idxLevel,\ tree-\/>getNbCellGroupAtLevel(idxLevel)-\/1)-\/>getEndingIndex();}
\DoxyCodeLine{00990\ }
\DoxyCodeLine{00991\ \ \ \ \ \ \ \ \ \ \ \ \ externalInteractionsAllLevelMpi[idxLevel].resize(tree-\/>getNbCellGroupAtLevel(idxLevel));}
\DoxyCodeLine{00992\ }
\DoxyCodeLine{00993\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbCellGroupAtLevel(idxLevel)\ ;\ ++idxGroup)\{}
\DoxyCodeLine{00994\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CellContainerClass*\ currentCells\ =\ tree-\/>getCellGroup(idxLevel,\ idxGroup);}
\DoxyCodeLine{00995\ }
\DoxyCodeLine{00996\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<BlockInteractions<CellContainerClass>>*\ externalInteractions\ =\ \&externalInteractionsAllLevelMpi[idxLevel][idxGroup];}
\DoxyCodeLine{00997\ }
\DoxyCodeLine{00998\ \textcolor{preprocessor}{\#pragma\ omp\ task\ default(none)\ firstprivate(idxGroup,\ currentCells,\ idxLevel,\ externalInteractions)}}
\DoxyCodeLine{00999\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01000\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<OutOfBlockInteraction>\ outsideInteractions;}
\DoxyCodeLine{01001\ }
\DoxyCodeLine{01002\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxCell\ =\ 0\ ;\ idxCell\ <\ currentCells-\/>getNumberOfCellsInBlock()\ ;\ ++idxCell)\{}
\DoxyCodeLine{01003\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ mindex\ =\ currentCells-\/>getCellMortonIndex(idxCell);}
\DoxyCodeLine{01004\ }
\DoxyCodeLine{01005\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MortonIndex\ interactionsIndexes[189];}
\DoxyCodeLine{01006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ interactionsPosition[189];}
\DoxyCodeLine{01007\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ coord(mindex);}
\DoxyCodeLine{01008\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ counter\ =\ coord.getInteractionNeighbors(idxLevel,interactionsIndexes,interactionsPosition);}
\DoxyCodeLine{01009\ }
\DoxyCodeLine{01010\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxInter\ =\ 0\ ;\ idxInter\ <\ counter\ ;\ ++idxInter)\{}
\DoxyCodeLine{01011\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ interactions\ need\ a\ block\ owned\ by\ someoneelse}}
\DoxyCodeLine{01012\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(interactionsIndexes[idxInter]\ <\ myFirstIndex\ ||\ myLastIndex\ <=\ interactionsIndexes[idxInter])\{}
\DoxyCodeLine{01013\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_out_of_block_interaction}{OutOfBlockInteraction}}\ property;}
\DoxyCodeLine{01014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.insideIndex\ =\ mindex;}
\DoxyCodeLine{01015\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.outIndex\ \ \ \ =\ interactionsIndexes[idxInter];}
\DoxyCodeLine{01016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.relativeOutPosition\ =\ interactionsPosition[idxInter];}
\DoxyCodeLine{01017\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.insideIdxInBlock\ =\ idxCell;}
\DoxyCodeLine{01018\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.outsideIdxInBlock\ =\ -\/1;}
\DoxyCodeLine{01019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outsideInteractions.push\_back(property);}
\DoxyCodeLine{01020\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01021\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01022\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01023\ }
\DoxyCodeLine{01024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Manage\ outofblock\ interaction}}
\DoxyCodeLine{01025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_quick_sort}{FQuickSort<OutOfBlockInteraction,\ int>::QsSequential}}(outsideInteractions.data(),\textcolor{keywordtype}{int}(outsideInteractions.size()));}
\DoxyCodeLine{01026\ }
\DoxyCodeLine{01027\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ currentOutInteraction\ =\ 0;}
\DoxyCodeLine{01028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxOtherGroup\ =\ 0\ ;\ idxOtherGroup\ <\ int(processesBlockInfos[idxLevel].size())}
\DoxyCodeLine{01029\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ currentOutInteraction\ <\ int(outsideInteractions.size())\ ;\ ++idxOtherGroup)\{}
\DoxyCodeLine{01030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ my\ blocks}}
\DoxyCodeLine{01031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idxOtherGroup\ ==\ nbBlocksBeforeMinPerLevel[idxLevel])\{}
\DoxyCodeLine{01032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idxOtherGroup\ +=\ tree-\/>getNbCellGroupAtLevel(idxLevel);}
\DoxyCodeLine{01033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idxOtherGroup\ ==\ \textcolor{keywordtype}{int}(processesBlockInfos[idxLevel].size()))\{}
\DoxyCodeLine{01034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(idxOtherGroup\ <\ \textcolor{keywordtype}{int}(processesBlockInfos[idxLevel].size()));}
\DoxyCodeLine{01037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01038\ }
\DoxyCodeLine{01039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ blockStartIdxOther\ =\ processesBlockInfos[idxLevel][idxOtherGroup].firstIndex;}
\DoxyCodeLine{01040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ blockEndIdxOther\ \ \ =\ processesBlockInfos[idxLevel][idxOtherGroup].lastIndex;}
\DoxyCodeLine{01041\ }
\DoxyCodeLine{01042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(currentOutInteraction\ <\ \textcolor{keywordtype}{int}(outsideInteractions.size())\ \&\&\ outsideInteractions[currentOutInteraction].outIndex\ <\ blockStartIdxOther)\{}
\DoxyCodeLine{01043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentOutInteraction\ +=\ 1;}
\DoxyCodeLine{01044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01045\ }
\DoxyCodeLine{01046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ lastOutInteraction\ =\ currentOutInteraction;}
\DoxyCodeLine{01047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(lastOutInteraction\ <\ \textcolor{keywordtype}{int}(outsideInteractions.size())\ \&\&\ outsideInteractions[lastOutInteraction].outIndex\ <\ blockEndIdxOther)\{}
\DoxyCodeLine{01048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lastOutInteraction\ +=\ 1;}
\DoxyCodeLine{01049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01050\ }
\DoxyCodeLine{01051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ interactions}}
\DoxyCodeLine{01052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ nbInteractionsBetweenBlocks\ =\ (lastOutInteraction-\/currentOutInteraction);}
\DoxyCodeLine{01053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(nbInteractionsBetweenBlocks)\{}
\DoxyCodeLine{01054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteCellGroups[idxLevel][idxOtherGroup].ptrSymb\ ==\ \textcolor{keyword}{nullptr})\{}
\DoxyCodeLine{01055\ \textcolor{preprocessor}{\#pragma\ omp\ critical(CreateM2LRemotes)}}
\DoxyCodeLine{01056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteCellGroups[idxLevel][idxOtherGroup].ptrSymb\ ==\ \textcolor{keyword}{nullptr})\{}
\DoxyCodeLine{01058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ nbBytesInBlockSymb\ =\ processesBlockInfos[idxLevel][idxOtherGroup].bufferSizeSymb;}
\DoxyCodeLine{01059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*\ memoryBlockSymb\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)FAlignedMemory::AllocateBytes<32>(nbBytesInBlockSymb);}
\DoxyCodeLine{01060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ remoteCellGroups[idxLevel][idxOtherGroup].ptrSymb\ =\ memoryBlockSymb;}
\DoxyCodeLine{01061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_variable\_data\_register(\&remoteCellGroups[idxLevel][idxOtherGroup].handleSymb,\ 0,}
\DoxyCodeLine{01062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uintptr\_t)remoteCellGroups[idxLevel][idxOtherGroup].ptrSymb,\ nbBytesInBlockSymb);}
\DoxyCodeLine{01063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ nbBytesInBlockUp\ =\ processesBlockInfos[idxLevel][idxOtherGroup].bufferSizeUp;}
\DoxyCodeLine{01064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*\ memoryBlockUp\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)FAlignedMemory::AllocateBytes<32>(nbBytesInBlockUp);}
\DoxyCodeLine{01065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ remoteCellGroups[idxLevel][idxOtherGroup].ptrUp\ =\ memoryBlockUp;}
\DoxyCodeLine{01066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_variable\_data\_register(\&remoteCellGroups[idxLevel][idxOtherGroup].handleUp,\ 0,}
\DoxyCodeLine{01067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uintptr\_t)remoteCellGroups[idxLevel][idxOtherGroup].ptrUp,\ nbBytesInBlockUp);}
\DoxyCodeLine{01068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01071\ }
\DoxyCodeLine{01072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ externalInteractions-\/>emplace\_back();}
\DoxyCodeLine{01073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ BlockInteractions<CellContainerClass>*\ interactions\ =\ \&externalInteractions-\/>back();}
\DoxyCodeLine{01074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//interactions-\/>otherBlock\ =\ remoteCellGroups[idxLevel][idxOtherGroup].ptr;}}
\DoxyCodeLine{01075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactions-\/>otherBlockId\ =\ idxOtherGroup;}
\DoxyCodeLine{01076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactions-\/>interactions.resize(nbInteractionsBetweenBlocks);}
\DoxyCodeLine{01077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::copy(outsideInteractions.begin()\ +\ currentOutInteraction,}
\DoxyCodeLine{01078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outsideInteractions.begin()\ +\ lastOutInteraction,}
\DoxyCodeLine{01079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactions-\/>interactions.begin());}
\DoxyCodeLine{01080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01081\ }
\DoxyCodeLine{01082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentOutInteraction\ =\ lastOutInteraction;}
\DoxyCodeLine{01083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01085\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01086\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01087\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ P2P}}
\DoxyCodeLine{01088\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ create\ one\ big\ vector\ per\ block}}
\DoxyCodeLine{01089\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01090\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ myFirstIndex\ =\ tree-\/>getParticleGroup(0)-\/>getStartingIndex();}
\DoxyCodeLine{01091\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ myLastIndex\ =\ tree-\/>getParticleGroup(tree-\/>getNbParticleGroup()-\/1)-\/>getEndingIndex();}
\DoxyCodeLine{01092\ }
\DoxyCodeLine{01093\ \ \ \ \ \ \ \ \ \ \ \ \ externalInteractionsLeafLevelMpi.clear();}
\DoxyCodeLine{01094\ \ \ \ \ \ \ \ \ \ \ \ \ externalInteractionsLeafLevelMpi.resize(tree-\/>getNbParticleGroup());}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbParticleGroup()\ ;\ ++idxGroup)\{}
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ the\ vector}}
\DoxyCodeLine{01097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ParticleGroupClass*\ containers\ =\ tree-\/>getParticleGroup(idxGroup);}
\DoxyCodeLine{01098\ }
\DoxyCodeLine{01099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<BlockInteractions<ParticleGroupClass>>*\ externalInteractions\ =\ \&externalInteractionsLeafLevelMpi[idxGroup];}
\DoxyCodeLine{01100\ }
\DoxyCodeLine{01101\ \textcolor{preprocessor}{\#pragma\ omp\ task\ default(none)\ firstprivate(idxGroup,\ containers,\ externalInteractions)}}
\DoxyCodeLine{01102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ Can\ be\ a\ task(inout:iterCells)}}
\DoxyCodeLine{01103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<OutOfBlockInteraction>\ outsideInteractions;}
\DoxyCodeLine{01104\ }
\DoxyCodeLine{01105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLeaf\ =\ 0\ ;\ idxLeaf\ <\ containers-\/>getNumberOfLeavesInBlock()\ ;\ ++idxLeaf)\{}
\DoxyCodeLine{01106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ParticleContainerClass\ particles\ =\ containers-\/>template\ getLeaf<ParticleContainerClass>(mindex);}}
\DoxyCodeLine{01107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ mindex\ =\ containers-\/>getLeafMortonIndex(idxLeaf);}
\DoxyCodeLine{01108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(containers-\/>exists(mindex))\{}
\DoxyCodeLine{01109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MortonIndex\ interactionsIndexes[26];}
\DoxyCodeLine{01110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ interactionsPosition[26];}
\DoxyCodeLine{01111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ coord(mindex);}
\DoxyCodeLine{01112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ counter\ =\ coord.getNeighborsIndexes(tree-\/>getHeight(),interactionsIndexes,interactionsPosition);}
\DoxyCodeLine{01113\ }
\DoxyCodeLine{01114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxInter\ =\ 0\ ;\ idxInter\ <\ counter\ ;\ ++idxInter)\{}
\DoxyCodeLine{01115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(interactionsIndexes[idxInter]\ <\ myFirstIndex\ ||}
\DoxyCodeLine{01116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myLastIndex\ <=\ interactionsIndexes[idxInter])\{}
\DoxyCodeLine{01117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_out_of_block_interaction}{OutOfBlockInteraction}}\ property;}
\DoxyCodeLine{01118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.insideIndex\ =\ mindex;}
\DoxyCodeLine{01119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.outIndex\ \ \ \ =\ interactionsIndexes[idxInter];}
\DoxyCodeLine{01120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.relativeOutPosition\ =\ interactionsPosition[idxInter];}
\DoxyCodeLine{01121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.outsideIdxInBlock\ =\ -\/1;}
\DoxyCodeLine{01122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.insideIdxInBlock\ =\ idxLeaf;}
\DoxyCodeLine{01123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outsideInteractions.push\_back(property);}
\DoxyCodeLine{01124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01128\ }
\DoxyCodeLine{01129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Sort\ to\ match\ external\ order}}
\DoxyCodeLine{01130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_quick_sort}{FQuickSort<OutOfBlockInteraction,\ int>::QsSequential}}(outsideInteractions.data(),\textcolor{keywordtype}{int}(outsideInteractions.size()));}
\DoxyCodeLine{01131\ }
\DoxyCodeLine{01132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ currentOutInteraction\ =\ 0;}
\DoxyCodeLine{01133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxOtherGroup\ =\ 0\ ;\ idxOtherGroup\ <\ int(processesBlockInfos[tree-\/>getHeight()-\/1].size())}
\DoxyCodeLine{01134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ currentOutInteraction\ <\ int(outsideInteractions.size())\ ;\ ++idxOtherGroup)\{}
\DoxyCodeLine{01135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ my\ blocks}}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idxOtherGroup\ ==\ nbBlocksBeforeMinPerLevel[tree-\/>getHeight()-\/1])\{}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idxOtherGroup\ +=\ tree-\/>getNbCellGroupAtLevel(tree-\/>getHeight()-\/1);}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idxOtherGroup\ ==\ \textcolor{keywordtype}{int}(processesBlockInfos[tree-\/>getHeight()-\/1].size()))\{}
\DoxyCodeLine{01139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(idxOtherGroup\ <\ \textcolor{keywordtype}{int}(processesBlockInfos[tree-\/>getHeight()-\/1].size()));}
\DoxyCodeLine{01142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01143\ }
\DoxyCodeLine{01144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ blockStartIdxOther\ =\ processesBlockInfos[tree-\/>getHeight()-\/1][idxOtherGroup].firstIndex;}
\DoxyCodeLine{01145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ blockEndIdxOther\ \ \ =\ processesBlockInfos[tree-\/>getHeight()-\/1][idxOtherGroup].lastIndex;}
\DoxyCodeLine{01146\ }
\DoxyCodeLine{01147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(currentOutInteraction\ <\ \textcolor{keywordtype}{int}(outsideInteractions.size())\ \&\&\ outsideInteractions[currentOutInteraction].outIndex\ <\ blockStartIdxOther)\{}
\DoxyCodeLine{01148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentOutInteraction\ +=\ 1;}
\DoxyCodeLine{01149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01150\ }
\DoxyCodeLine{01151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ lastOutInteraction\ =\ currentOutInteraction;}
\DoxyCodeLine{01152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(lastOutInteraction\ <\ \textcolor{keywordtype}{int}(outsideInteractions.size())\ \&\&\ outsideInteractions[lastOutInteraction].outIndex\ <\ blockEndIdxOther)\{}
\DoxyCodeLine{01153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lastOutInteraction\ +=\ 1;}
\DoxyCodeLine{01154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01155\ }
\DoxyCodeLine{01156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ nbInteractionsBetweenBlocks\ =\ (lastOutInteraction-\/currentOutInteraction);}
\DoxyCodeLine{01157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(nbInteractionsBetweenBlocks)\{}
\DoxyCodeLine{01158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteParticleGroupss[idxOtherGroup].ptrSymb\ ==\ \textcolor{keyword}{nullptr})\{}
\DoxyCodeLine{01159\ \textcolor{preprocessor}{\#pragma\ omp\ critical(CreateM2LRemotes)}}
\DoxyCodeLine{01160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteParticleGroupss[idxOtherGroup].ptrSymb\ ==\ \textcolor{keyword}{nullptr})\{}
\DoxyCodeLine{01162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ nbBytesInBlock\ =\ processesBlockInfos[tree-\/>getHeight()-\/1][idxOtherGroup].leavesBufferSize;}
\DoxyCodeLine{01163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*\ memoryBlock\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)FAlignedMemory::AllocateBytes<32>(nbBytesInBlock);}
\DoxyCodeLine{01164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ remoteParticleGroupss[idxOtherGroup].ptrSymb\ =\ memoryBlock;}
\DoxyCodeLine{01165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_variable\_data\_register(\&remoteParticleGroupss[idxOtherGroup].handleSymb,\ 0,}
\DoxyCodeLine{01166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uintptr\_t)remoteParticleGroupss[idxOtherGroup].ptrSymb,\ nbBytesInBlock);}
\DoxyCodeLine{01167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01170\ }
\DoxyCodeLine{01171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ externalInteractions-\/>emplace\_back();}
\DoxyCodeLine{01172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ BlockInteractions<ParticleGroupClass>*\ interactions\ =\ \&externalInteractions-\/>back();}
\DoxyCodeLine{01173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//interactions-\/>otherBlock\ =\ remoteParticleGroupss[idxOtherGroup].ptr;}}
\DoxyCodeLine{01174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactions-\/>otherBlockId\ =\ idxOtherGroup;}
\DoxyCodeLine{01175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactions-\/>interactions.resize(nbInteractionsBetweenBlocks);}
\DoxyCodeLine{01176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::copy(outsideInteractions.begin()\ +\ currentOutInteraction,}
\DoxyCodeLine{01177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outsideInteractions.begin()\ +\ lastOutInteraction,}
\DoxyCodeLine{01178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactions-\/>interactions.begin());}
\DoxyCodeLine{01179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01180\ }
\DoxyCodeLine{01181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentOutInteraction\ =\ lastOutInteraction;}
\DoxyCodeLine{01182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01184\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01185\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01186\ \ \ \ \ \}}
\DoxyCodeLine{01187\ }
\DoxyCodeLine{01188\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_f_group_task_star_p_u_mpi_algorithm_1_1_mpi_dependency}{MpiDependency}}\{}
\DoxyCodeLine{01189\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ src;}
\DoxyCodeLine{01190\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ dest;}
\DoxyCodeLine{01191\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ level;}
\DoxyCodeLine{01192\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ globalBlockId;}
\DoxyCodeLine{01193\ \ \ \ \ \};}
\DoxyCodeLine{01194\ }
\DoxyCodeLine{01195\ \ \ \ \ std::vector<MpiDependency>\ toSend;}
\DoxyCodeLine{01196\ }
\DoxyCodeLine{01197\ \ \ \ \ \textcolor{keywordtype}{void}\ postRecvAllocatedBlocks()\{}
\DoxyCodeLine{01198\ \ \ \ \ \ \ \ \ std::vector<MpiDependency>\ toRecv;}
\DoxyCodeLine{01199\ \ \ \ \ \ \ \ \ FAssertLF(tree-\/>getHeight()\ ==\ \textcolor{keywordtype}{int}(remoteCellGroups.size()));}
\DoxyCodeLine{01200\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ directOnly\ =\ (tree-\/>getHeight()\ <=\ 2);}
\DoxyCodeLine{01201\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ do\ not\ perform\ the\ real\ send\ here\ because\ it\ will\ be\ mixed\ with\ starpu\ call\ to\ MPI}}
\DoxyCodeLine{01202\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!directOnly)\{}
\DoxyCodeLine{01203\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ \mbox{\hyperlink{class_f_abstract_algorithm_ade49cb5ede82d078261e576a9d809dc2}{FAbstractAlgorithm::upperWorkingLevel}}\ ;\ idxLevel\ <\ \mbox{\hyperlink{class_f_abstract_algorithm_a694b8888186be58e38691ce08b177d46}{FAbstractAlgorithm::lowerWorkingLevel}}\ ;\ ++idxLevel)\{}
\DoxyCodeLine{01204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxHandle\ =\ 0\ ;\ idxHandle\ <\ int(remoteCellGroups[idxLevel].size())\ ;\ ++idxHandle)\{}
\DoxyCodeLine{01205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteCellGroups[idxLevel][idxHandle].ptrSymb)\{}
\DoxyCodeLine{01206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(remoteCellGroups[idxLevel][idxHandle].ptrUp);}
\DoxyCodeLine{01207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ starpu\_mpi\_irecv\_detached\ cannot\ be\ sent\ here}}
\DoxyCodeLine{01208\ }
\DoxyCodeLine{01209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ toRecv.push\_back(\{processesBlockInfos[idxLevel][idxHandle].owner,}
\DoxyCodeLine{01210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a3f21607da8f2938bd39de261c4cff703}{processId}}(),\ idxLevel,\ idxHandle\});}
\DoxyCodeLine{01211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01213\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01214\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01215\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01216\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxHandle\ =\ 0\ ;\ idxHandle\ <\ int(remoteParticleGroupss.size())\ ;\ ++idxHandle)\{}
\DoxyCodeLine{01217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteParticleGroupss[idxHandle].ptrSymb)\{}
\DoxyCodeLine{01218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ starpu\_mpi\_irecv\_detached\ cannot\ be\ sent\ here}}
\DoxyCodeLine{01219\ }
\DoxyCodeLine{01220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ toRecv.push\_back(\{processesBlockInfos[tree-\/>getHeight()-\/1][idxHandle].owner,}
\DoxyCodeLine{01221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a3f21607da8f2938bd39de261c4cff703}{processId}}(),\ tree-\/>getHeight(),\ idxHandle\});}
\DoxyCodeLine{01222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01223\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01224\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01225\ }
\DoxyCodeLine{01226\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_quick_sort}{FQuickSort<MpiDependency,\ int>::QsSequential}}(toRecv.data(),\textcolor{keywordtype}{int}(toRecv.size()),[](\textcolor{keyword}{const}\ MpiDependency\&\ d1,\ \textcolor{keyword}{const}\ MpiDependency\&\ d2)\{}
\DoxyCodeLine{01227\ \ \ \ \ \ \ \ \ \ \ \ \ return\ d1.src\ <=\ d2.src;}
\DoxyCodeLine{01228\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{01229\ }
\DoxyCodeLine{01230\ \ \ \ \ \ \ \ \ std::unique\_ptr<int[]>\ nbBlocksToRecvFromEach(\textcolor{keyword}{new}\ \textcolor{keywordtype}{int}[comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a8608b660084f464599aa35c411100854}{processCount}}()]);}
\DoxyCodeLine{01231\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a005b2bd1925d50a688606ed5877c5aec}{memset}}(nbBlocksToRecvFromEach.get(),\ 0,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int})*comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a8608b660084f464599aa35c411100854}{processCount}}());}
\DoxyCodeLine{01232\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxDep\ =\ 0\ ;\ idxDep\ <\ int(toRecv.size())\ ;\ ++idxDep)\{}
\DoxyCodeLine{01233\ \ \ \ \ \ \ \ \ \ \ \ \ nbBlocksToRecvFromEach[toRecv[idxDep].src]\ +=\ 1;}
\DoxyCodeLine{01234\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01235\ }
\DoxyCodeLine{01236\ \ \ \ \ \ \ \ \ FAssertLF(nbBlocksToRecvFromEach[comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a3f21607da8f2938bd39de261c4cff703}{processId}}()]\ ==\ 0);}
\DoxyCodeLine{01237\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{01238\ }
\DoxyCodeLine{01239\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProc\ =\ 0\ ;\ idxProc\ <\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a8608b660084f464599aa35c411100854}{processCount}}()\ ;\ ++idxProc)\{}
\DoxyCodeLine{01240\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idxProc\ ==\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a3f21607da8f2938bd39de261c4cff703}{processId}}())\{}
\DoxyCodeLine{01241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ How\ much\ to\ send\ to\ each}}
\DoxyCodeLine{01242\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<int[]>\ nbBlocksToSendToEach(\textcolor{keyword}{new}\ \textcolor{keywordtype}{int}[comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a8608b660084f464599aa35c411100854}{processCount}}()]);}
\DoxyCodeLine{01243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a9a6f670ec0771204ba8bd5e8bc1637ba}{FMpi::Assert}}(MPI\_Gather(\&nbBlocksToRecvFromEach[idxProc],\ 1,}
\DoxyCodeLine{01244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_INT,\ nbBlocksToSendToEach.get(),\ 1,}
\DoxyCodeLine{01245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_INT,\ idxProc,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}()\ ),\ \_\_LINE\_\_);}
\DoxyCodeLine{01246\ }
\DoxyCodeLine{01247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<int[]>\ displs(\textcolor{keyword}{new}\ \textcolor{keywordtype}{int}[comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a8608b660084f464599aa35c411100854}{processCount}}()]);}
\DoxyCodeLine{01248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ displs[0]\ =\ 0;}
\DoxyCodeLine{01249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProcOther\ =\ 1\ ;\ idxProcOther\ <\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a8608b660084f464599aa35c411100854}{processCount}}()\ ;\ ++idxProcOther)\{}
\DoxyCodeLine{01250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ displs[idxProcOther]\ =\ displs[idxProcOther-\/1]\ +\ nbBlocksToSendToEach[idxProcOther-\/1];}
\DoxyCodeLine{01251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ toSend.resize(displs[comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a8608b660084f464599aa35c411100854}{processCount}}()-\/1]\ +\ nbBlocksToSendToEach[comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a8608b660084f464599aa35c411100854}{processCount}}()-\/1]);}
\DoxyCodeLine{01253\ }
\DoxyCodeLine{01254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ work\ in\ bytes}}
\DoxyCodeLine{01255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxProcOther\ =\ 0\ ;\ idxProcOther\ <\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a8608b660084f464599aa35c411100854}{processCount}}()\ ;\ ++idxProcOther)\{}
\DoxyCodeLine{01256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nbBlocksToSendToEach[idxProcOther]\ *=\ int(\textcolor{keyword}{sizeof}(MpiDependency));}
\DoxyCodeLine{01257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ displs[idxProcOther]\ *=\ int(\textcolor{keyword}{sizeof}(MpiDependency));}
\DoxyCodeLine{01258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01259\ }
\DoxyCodeLine{01260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a9a6f670ec0771204ba8bd5e8bc1637ba}{FMpi::Assert}}(MPI\_Gatherv(\ \textcolor{keyword}{nullptr},\ 0,\ MPI\_BYTE,}
\DoxyCodeLine{01261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ toSend.data(),}
\DoxyCodeLine{01262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nbBlocksToSendToEach.get(),\ displs.get(),}
\DoxyCodeLine{01263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_BYTE,\ idxProc,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}()),\ \_\_LINE\_\_);}
\DoxyCodeLine{01264\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01265\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{01266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a9a6f670ec0771204ba8bd5e8bc1637ba}{FMpi::Assert}}(MPI\_Gather(\&nbBlocksToRecvFromEach[idxProc],\ 1,}
\DoxyCodeLine{01267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_INT,\ 0,\ 0,\ MPI\_INT,\ idxProc,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}()\ ),\ \_\_LINE\_\_);}
\DoxyCodeLine{01268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_a9a6f670ec0771204ba8bd5e8bc1637ba}{FMpi::Assert}}(MPI\_Gatherv(}
\DoxyCodeLine{01269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&toRecv[offset],\ \textcolor{keywordtype}{int}(nbBlocksToRecvFromEach[idxProc]*\textcolor{keyword}{sizeof}(MpiDependency)),\ MPI\_BYTE,}
\DoxyCodeLine{01270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ 0,\ 0,\ MPI\_BYTE,\ idxProc,\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}()\ ),\ \_\_LINE\_\_);}
\DoxyCodeLine{01271\ }
\DoxyCodeLine{01272\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ offset\ +=\ nbBlocksToRecvFromEach[idxProc];}
\DoxyCodeLine{01273\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01274\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01275\ \ \ \ \ \ \ \ \ FLOG(FLog::Controller.flush()\ );}
\DoxyCodeLine{01276\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ can\ do\ it\ here}}
\DoxyCodeLine{01277\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!directOnly)\{}
\DoxyCodeLine{01278\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ \mbox{\hyperlink{class_f_abstract_algorithm_ade49cb5ede82d078261e576a9d809dc2}{FAbstractAlgorithm::upperWorkingLevel}}\ ;\ idxLevel\ <\ \mbox{\hyperlink{class_f_abstract_algorithm_a694b8888186be58e38691ce08b177d46}{FAbstractAlgorithm::lowerWorkingLevel}}\ ;\ ++idxLevel)\{}
\DoxyCodeLine{01279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxHandle\ =\ 0\ ;\ idxHandle\ <\ int(remoteCellGroups[idxLevel].size())\ ;\ ++idxHandle)\{}
\DoxyCodeLine{01280\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteCellGroups[idxLevel][idxHandle].ptrSymb)\{}
\DoxyCodeLine{01281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(remoteCellGroups[idxLevel][idxHandle].ptrUp);}
\DoxyCodeLine{01282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}[SMpi]\ "{}}\ <<\ idxLevel\ <<\ \textcolor{stringliteral}{"{}\ Post\ a\ recv\ during\ M2L\ for\ Idx\ "{}}\ <<\ processesBlockInfos[idxLevel][idxHandle].firstIndex\ <<}
\DoxyCodeLine{01283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ and\ dest\ is\ "{}}\ <<\ processesBlockInfos[idxLevel][idxHandle].owner\ <<\ \textcolor{stringliteral}{"{}\ tag\ "{}}\ <<\ getTag(idxLevel,\ processesBlockInfos[idxLevel][idxHandle].firstIndex,\ processesBlockInfos[idxLevel][idxHandle].globalIdx,\ 0,\ processesBlockInfos[idxLevel][idxHandle].owner)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{01284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}[SMpi]\ "{}}\ <<\ idxLevel\ <<\ \textcolor{stringliteral}{"{}\ Post\ a\ recv\ during\ M2L\ for\ Idx\ "{}}\ <<\ processesBlockInfos[idxLevel][idxHandle].firstIndex\ <<}
\DoxyCodeLine{01285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ and\ dest\ is\ "{}}\ <<\ processesBlockInfos[idxLevel][idxHandle].owner\ <<\ \textcolor{stringliteral}{"{}\ tag\ "{}}\ <<\ getTag(idxLevel,\ processesBlockInfos[idxLevel][idxHandle].firstIndex,\ processesBlockInfos[idxLevel][idxHandle].globalIdx,\ 1,\ processesBlockInfos[idxLevel][idxHandle].owner)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{01286\ }
\DoxyCodeLine{01287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_mpi\_irecv\_detached(\ remoteCellGroups[idxLevel][idxHandle].handleSymb,}
\DoxyCodeLine{01288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processesBlockInfos[idxLevel][idxHandle].owner,}
\DoxyCodeLine{01289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getTag(idxLevel,processesBlockInfos[idxLevel][idxHandle].firstIndex,\ processesBlockInfos[idxLevel][idxHandle].globalIdx,\ 0,\ processesBlockInfos[idxLevel][idxHandle].owner),}
\DoxyCodeLine{01290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ 0,\ 0\ );}
\DoxyCodeLine{01291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_mpi\_irecv\_detached(\ remoteCellGroups[idxLevel][idxHandle].handleUp,}
\DoxyCodeLine{01292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processesBlockInfos[idxLevel][idxHandle].owner,}
\DoxyCodeLine{01293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getTag(idxLevel,processesBlockInfos[idxLevel][idxHandle].firstIndex,\ processesBlockInfos[idxLevel][idxHandle].globalIdx,\ 1,\ processesBlockInfos[idxLevel][idxHandle].owner),}
\DoxyCodeLine{01294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ 0,\ 0\ );}
\DoxyCodeLine{01295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01297\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01298\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01299\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01300\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxHandle\ =\ 0\ ;\ idxHandle\ <\ int(remoteParticleGroupss.size())\ ;\ ++idxHandle)\{}
\DoxyCodeLine{01301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteParticleGroupss[idxHandle].ptrSymb)\{}
\DoxyCodeLine{01302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}[SMpi]\ Post\ a\ recv\ during\ P2P\ for\ Idx\ "{}}\ <<\ processesBlockInfos[tree-\/>getHeight()-\/1][idxHandle].firstIndex\ <<}
\DoxyCodeLine{01303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ and\ dest\ is\ "{}}\ <<\ processesBlockInfos[tree-\/>getHeight()-\/1][idxHandle].owner\ <<\ \textcolor{stringliteral}{"{}\ tag\ "{}}\ <<\ getTag(tree-\/>getHeight(),\ processesBlockInfos[tree-\/>getHeight()-\/1][idxHandle].firstIndex,\ processesBlockInfos[tree-\/>getHeight()-\/1][idxHandle].globalIdx,\ 0,\ processesBlockInfos[tree-\/>getHeight()-\/1][idxHandle].owner)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{01304\ }
\DoxyCodeLine{01305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_mpi\_irecv\_detached(\ remoteParticleGroupss[idxHandle].handleSymb,}
\DoxyCodeLine{01306\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processesBlockInfos[tree-\/>getHeight()-\/1][idxHandle].owner,}
\DoxyCodeLine{01307\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getTag(tree-\/>getHeight(),processesBlockInfos[tree-\/>getHeight()-\/1][idxHandle].firstIndex,\ processesBlockInfos[tree-\/>getHeight()-\/1][idxHandle].globalIdx,\ 0,\ processesBlockInfos[tree-\/>getHeight()-\/1][idxHandle].owner),}
\DoxyCodeLine{01308\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ 0,\ 0\ );}
\DoxyCodeLine{01309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01310\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01311\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01312\ \ \ \ \ \}}
\DoxyCodeLine{01313\ }
\DoxyCodeLine{01314\ \ \ \ \ \textcolor{keywordtype}{void}\ insertParticlesSend()\{}
\DoxyCodeLine{01315\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxSd\ =\ 0\ ;\ idxSd\ <\ int(toSend.size())\ ;\ ++idxSd)\{}
\DoxyCodeLine{01316\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MpiDependency\ sd\ =\ toSend[idxSd];}
\DoxyCodeLine{01317\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(sd.level\ ==\ tree-\/>getHeight())\{}
\DoxyCodeLine{01318\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ localId\ =\ sd.globalBlockId\ -\/\ nbBlocksBeforeMinPerLevel[tree-\/>getHeight()-\/1];}
\DoxyCodeLine{01319\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(sd.src\ ==\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a3f21607da8f2938bd39de261c4cff703}{processId}}());}
\DoxyCodeLine{01320\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(0\ <=\ localId);}
\DoxyCodeLine{01321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(localId\ <\ tree-\/>getNbParticleGroup());}
\DoxyCodeLine{01322\ }
\DoxyCodeLine{01323\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}[SMpi]\ Post\ a\ send\ during\ P2P\ for\ Idx\ "{}}\ <<\ tree-\/>getParticleGroup(localId)-\/>getStartingIndex()\ <<}
\DoxyCodeLine{01324\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ and\ dest\ is\ "{}}\ <<\ sd.dest\ <<\ \textcolor{stringliteral}{"{}\ tag\ "{}}\ <<\ getTag(tree-\/>getHeight(),\ tree-\/>getParticleGroup(localId)-\/>getStartingIndex(),\ nbBlocksBeforeMinPerLevel[tree-\/>getHeight()-\/1]\ +\ localId,\ 0,\ sd.dest)\ <<\ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{01325\ }
\DoxyCodeLine{01326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_mpi\_isend\_detached(\ particleHandles[localId].symb,\ sd.dest,}
\DoxyCodeLine{01327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getTag(tree-\/>getHeight(),\ tree-\/>getParticleGroup(localId)-\/>getStartingIndex(),\ nbBlocksBeforeMinPerLevel[tree-\/>getHeight()-\/1]\ +\ localId,\ 0,\ sd.dest),}
\DoxyCodeLine{01328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ 0\textcolor{comment}{/*callback*/},\ 0\textcolor{comment}{/*arg*/}\ );}
\DoxyCodeLine{01329\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01330\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01331\ \ \ \ \ \ \ \ \ FLOG(FLog::Controller.flush()\ );}
\DoxyCodeLine{01332\ \ \ \ \ \}}
\DoxyCodeLine{01333\ }
\DoxyCodeLine{01334\ \ \ \ \ \textcolor{keywordtype}{void}\ insertCellsSend()\{}
\DoxyCodeLine{01335\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxSd\ =\ 0\ ;\ idxSd\ <\ int(toSend.size())\ ;\ ++idxSd)\{}
\DoxyCodeLine{01336\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MpiDependency\ sd\ =\ toSend[idxSd];}
\DoxyCodeLine{01337\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(sd.level\ !=\ tree-\/>getHeight())\{}
\DoxyCodeLine{01338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ localId\ =\ sd.globalBlockId\ -\/\ nbBlocksBeforeMinPerLevel[sd.level];}
\DoxyCodeLine{01339\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(sd.src\ ==\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a3f21607da8f2938bd39de261c4cff703}{processId}}());}
\DoxyCodeLine{01340\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(0\ <=\ localId);}
\DoxyCodeLine{01341\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(localId\ <\ tree-\/>getNbCellGroupAtLevel(sd.level));}
\DoxyCodeLine{01342\ }
\DoxyCodeLine{01343\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}[SMpi]\ "{}}\ <<\ sd.level\ <<\ \textcolor{stringliteral}{"{}\ Post\ a\ send\ during\ M2L\ for\ Idx\ "{}}\ <<\ tree-\/>getCellGroup(sd.level,\ localId)-\/>getStartingIndex()\ <<}
\DoxyCodeLine{01344\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ and\ dest\ is\ "{}}\ <<\ sd.dest\ <<\ \textcolor{stringliteral}{"{}\ tag\ "{}}\ <<\ getTag(sd.level,\ tree-\/>getCellGroup(sd.level,\ localId)-\/>getStartingIndex(),\ nbBlocksBeforeMinPerLevel[sd.level]\ +\ localId,\ 0,\ sd.dest)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{01345\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}[SMpi]\ "{}}\ <<\ sd.level\ <<\ \textcolor{stringliteral}{"{}\ Post\ a\ send\ during\ M2L\ for\ Idx\ "{}}\ <<\ tree-\/>getCellGroup(sd.level,\ localId)-\/>getStartingIndex()\ <<}
\DoxyCodeLine{01346\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ and\ dest\ is\ "{}}\ <<\ sd.dest\ <<\ \textcolor{stringliteral}{"{}\ tag\ "{}}\ <<\ getTag(sd.level,\ tree-\/>getCellGroup(sd.level,\ localId)-\/>getStartingIndex(),\ nbBlocksBeforeMinPerLevel[sd.level]\ +\ localId,\ 1,\ sd.dest)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{01347\ }
\DoxyCodeLine{01348\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_mpi\_isend\_detached(\ cellHandles[sd.level][localId].symb,\ sd.dest,}
\DoxyCodeLine{01349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getTag(sd.level,\ tree-\/>getCellGroup(sd.level,\ localId)-\/>getStartingIndex(),\ nbBlocksBeforeMinPerLevel[sd.level]\ +\ localId,\ 0,\ sd.dest),}
\DoxyCodeLine{01350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ 0\textcolor{comment}{/*callback*/},\ 0\textcolor{comment}{/*arg*/}\ );}
\DoxyCodeLine{01351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_mpi\_isend\_detached(\ cellHandles[sd.level][localId].up,\ sd.dest,}
\DoxyCodeLine{01352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getTag(sd.level,\ tree-\/>getCellGroup(sd.level,\ localId)-\/>getStartingIndex(),\ nbBlocksBeforeMinPerLevel[sd.level]\ +\ localId,\ 1,\ sd.dest),}
\DoxyCodeLine{01353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ 0\textcolor{comment}{/*callback*/},\ 0\textcolor{comment}{/*arg*/}\ );}
\DoxyCodeLine{01354\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01355\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01356\ \ \ \ \ \ \ \ \ FLOG(FLog::Controller.flush()\ );}
\DoxyCodeLine{01357\ \ \ \ \ \}}
\DoxyCodeLine{01358\ }
\DoxyCodeLine{01359\ \ \ \ \ \textcolor{keywordtype}{void}\ cleanHandleMpi()\{}
\DoxyCodeLine{01360\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 0\ ;\ idxLevel\ <\ int(remoteCellGroups.size())\ ;\ ++idxLevel)\{}
\DoxyCodeLine{01361\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxHandle\ =\ 0\ ;\ idxHandle\ <\ int(remoteCellGroups[idxLevel].size())\ ;\ ++idxHandle)\{}
\DoxyCodeLine{01362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteCellGroups[idxLevel][idxHandle].ptrSymb)\{}
\DoxyCodeLine{01363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_unregister(remoteCellGroups[idxLevel][idxHandle].handleSymb);}
\DoxyCodeLine{01364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAlignedMemory::DeallocBytes(remoteCellGroups[idxLevel][idxHandle].ptrSymb);}
\DoxyCodeLine{01365\ }
\DoxyCodeLine{01366\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteCellGroups[idxLevel][idxHandle].ptrUp)\{}
\DoxyCodeLine{01367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_unregister(remoteCellGroups[idxLevel][idxHandle].handleUp);}
\DoxyCodeLine{01368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAlignedMemory::DeallocBytes(remoteCellGroups[idxLevel][idxHandle].ptrUp);}
\DoxyCodeLine{01369\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01370\ }
\DoxyCodeLine{01371\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteCellGroups[idxLevel][idxHandle].ptrDown)\{}
\DoxyCodeLine{01372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_unregister(remoteCellGroups[idxLevel][idxHandle].handleDown);}
\DoxyCodeLine{01373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAlignedMemory::DeallocBytes(remoteCellGroups[idxLevel][idxHandle].ptrDown);}
\DoxyCodeLine{01374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01376\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01377\ \ \ \ \ \ \ \ \ \ \ \ \ remoteCellGroups[idxLevel].clear();}
\DoxyCodeLine{01378\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01379\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01380\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxHandle\ =\ 0\ ;\ idxHandle\ <\ int(remoteParticleGroupss.size())\ ;\ ++idxHandle)\{}
\DoxyCodeLine{01381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteParticleGroupss[idxHandle].ptrSymb)\{}
\DoxyCodeLine{01382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_unregister(remoteParticleGroupss[idxHandle].handleSymb);}
\DoxyCodeLine{01383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAlignedMemory::DeallocBytes(remoteParticleGroupss[idxHandle].ptrSymb);}
\DoxyCodeLine{01384\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01385\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01386\ \ \ \ \ \ \ \ \ \ \ \ \ remoteParticleGroupss.clear();}
\DoxyCodeLine{01387\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01388\ \ \ \ \ \}}
\DoxyCodeLine{01389\ }
\DoxyCodeLine{01391\ }
\DoxyCodeLine{01395\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a0a79415321e4c161739259623ea34fcd}{buildHandles}}()\{}
\DoxyCodeLine{01396\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a8c9870196537254592681db15a518ed2}{cleanHandle}}();}
\DoxyCodeLine{01397\ }
\DoxyCodeLine{01398\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ 2\ ;\ idxLevel\ <\ tree-\/>getHeight()\ ;\ ++idxLevel)\{}
\DoxyCodeLine{01399\ \ \ \ \ \ \ \ \ \ \ \ \ cellHandles[idxLevel].resize(tree-\/>getNbCellGroupAtLevel(idxLevel));}
\DoxyCodeLine{01400\ }
\DoxyCodeLine{01401\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbCellGroupAtLevel(idxLevel)\ ;\ ++idxGroup)\{}
\DoxyCodeLine{01402\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CellContainerClass*\ currentCells\ =\ tree-\/>getCellGroup(idxLevel,\ idxGroup);}
\DoxyCodeLine{01403\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_variable\_data\_register(\&cellHandles[idxLevel][idxGroup].symb,\ 0,}
\DoxyCodeLine{01404\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uintptr\_t)currentCells-\/>getRawBuffer(),\ currentCells-\/>getBufferSizeInByte());}
\DoxyCodeLine{01405\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_variable\_data\_register(\&cellHandles[idxLevel][idxGroup].up,\ 0,}
\DoxyCodeLine{01406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uintptr\_t)currentCells-\/>getRawMultipoleBuffer(),\ currentCells-\/>getMultipoleBufferSizeInByte());}
\DoxyCodeLine{01407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_variable\_data\_register(\&cellHandles[idxLevel][idxGroup].down,\ 0,}
\DoxyCodeLine{01408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uintptr\_t)currentCells-\/>getRawLocalBuffer(),\ currentCells-\/>getLocalBufferSizeInByte());}
\DoxyCodeLine{01409\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cellHandles[idxLevel][idxGroup].intervalSize\ =\ int(currentCells-\/>getNumberOfCellsInBlock());}
\DoxyCodeLine{01410\ \textcolor{preprocessor}{\#ifdef\ STARPU\_SUPPORT\_ARBITER}}
\DoxyCodeLine{01411\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_assign\_arbiter(cellHandles[idxLevel][idxGroup].up,\ arbiterGlobal);}
\DoxyCodeLine{01412\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_assign\_arbiter(cellHandles[idxLevel][idxGroup].down,\ arbiterGlobal);}
\DoxyCodeLine{01413\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01414\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01415\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01416\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01417\ \ \ \ \ \ \ \ \ \ \ \ \ particleHandles.resize(tree-\/>getNbParticleGroup());}
\DoxyCodeLine{01418\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbParticleGroup()\ ;\ ++idxGroup)\{}
\DoxyCodeLine{01419\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ParticleGroupClass*\ containers\ =\ tree-\/>getParticleGroup(idxGroup);}
\DoxyCodeLine{01420\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_variable\_data\_register(\&particleHandles[idxGroup].symb,\ 0,}
\DoxyCodeLine{01421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uintptr\_t)containers-\/>getRawBuffer(),\ containers-\/>getBufferSizeInByte());}
\DoxyCodeLine{01422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_variable\_data\_register(\&particleHandles[idxGroup].down,\ 0,}
\DoxyCodeLine{01423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uintptr\_t)containers-\/>getRawAttributesBuffer(),\ containers-\/>getAttributesBufferSizeInByte());}
\DoxyCodeLine{01424\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_REDUX}}
\DoxyCodeLine{01425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_set\_reduction\_methods(particleHandles[idxGroup].down,\ \&p2p\_redux\_perform,}
\DoxyCodeLine{01426\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&p2p\_redux\_init);}
\DoxyCodeLine{01427\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{01428\ \textcolor{preprocessor}{\#ifdef\ STARPU\_SUPPORT\_ARBITER}}
\DoxyCodeLine{01429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_data\_assign\_arbiter(particleHandles[idxGroup].down,\ arbiterGlobal);}
\DoxyCodeLine{01430\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ STARPU\_SUPPORT\_ARBITER}}
\DoxyCodeLine{01431\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ STARPU\_USE\_REDUX}}
\DoxyCodeLine{01432\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ particleHandles[idxGroup].intervalSize\ =\ int(containers-\/>getNumberOfLeavesInBlock());}
\DoxyCodeLine{01433\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01434\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01435\ \ \ \ \ \}}
\DoxyCodeLine{01436\ }
\DoxyCodeLine{01443\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_aff29c7d0ad17cefe0495b2ef1b348fc2}{buildExternalInteractionVecs}}()\{}
\DoxyCodeLine{01444\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timer;\ \mbox{\hyperlink{class_f_tic}{FTic}}\ leafTimer;\ \mbox{\hyperlink{class_f_tic}{FTic}}\ cellTimer;\ );}
\DoxyCodeLine{01445\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ interactions}}
\DoxyCodeLine{01446\ \ \ \ \ \ \ \ \ externalInteractionsAllLevel.clear();}
\DoxyCodeLine{01447\ \ \ \ \ \ \ \ \ externalInteractionsLeafLevel.clear();}
\DoxyCodeLine{01448\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ One\ per\ level\ +\ leaf\ level}}
\DoxyCodeLine{01449\ \ \ \ \ \ \ \ \ externalInteractionsAllLevel.resize(tree-\/>getHeight());}
\DoxyCodeLine{01450\ }
\DoxyCodeLine{01451\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ First\ leaf\ level}}
\DoxyCodeLine{01452\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01453\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ create\ one\ big\ vector\ per\ block}}
\DoxyCodeLine{01454\ \ \ \ \ \ \ \ \ \ \ \ \ externalInteractionsLeafLevel.resize(tree-\/>getNbParticleGroup());}
\DoxyCodeLine{01455\ }
\DoxyCodeLine{01456\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbParticleGroup()\ ;\ ++idxGroup)\{}
\DoxyCodeLine{01457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ the\ vector}}
\DoxyCodeLine{01458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ParticleGroupClass*\ containers\ =\ tree-\/>getParticleGroup(idxGroup);}
\DoxyCodeLine{01459\ }
\DoxyCodeLine{01460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<BlockInteractions<ParticleGroupClass>>*\ externalInteractions\ =\ \&externalInteractionsLeafLevel[idxGroup];}
\DoxyCodeLine{01461\ }
\DoxyCodeLine{01462\ \textcolor{preprocessor}{\#pragma\ omp\ task\ default(none)\ firstprivate(idxGroup,\ containers,\ externalInteractions)}}
\DoxyCodeLine{01463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ Can\ be\ a\ task(inout:iterCells)}}
\DoxyCodeLine{01464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<OutOfBlockInteraction>\ outsideInteractions;}
\DoxyCodeLine{01465\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ blockStartIdx\ =\ containers-\/>getStartingIndex();}
\DoxyCodeLine{01466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ blockEndIdx\ \ \ =\ containers-\/>getEndingIndex();}
\DoxyCodeLine{01467\ }
\DoxyCodeLine{01468\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ leafIdx\ =\ 0\ ;\ leafIdx\ <\ containers-\/>getNumberOfLeavesInBlock()\ ;\ ++leafIdx)\{}
\DoxyCodeLine{01469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ mindex\ =\ containers-\/>getLeafMortonIndex(leafIdx);}
\DoxyCodeLine{01470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ParticleContainerClass\ particles\ =\ containers-\/>template\ getLeaf<ParticleContainerClass>(leafIdx);}}
\DoxyCodeLine{01471\ }
\DoxyCodeLine{01472\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MortonIndex\ interactionsIndexes[26];}
\DoxyCodeLine{01473\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ interactionsPosition[26];}
\DoxyCodeLine{01474\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ coord(mindex);}
\DoxyCodeLine{01475\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ counter\ =\ coord.\mbox{\hyperlink{class_f_tree_coordinate_ac74ca299cacd624e1aca5b49e4b62709}{getNeighborsIndexes}}(tree-\/>getHeight(),interactionsIndexes,interactionsPosition);}
\DoxyCodeLine{01476\ }
\DoxyCodeLine{01477\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxInter\ =\ 0\ ;\ idxInter\ <\ counter\ ;\ ++idxInter)\{}
\DoxyCodeLine{01478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ blockStartIdx\ <=\ interactionsIndexes[idxInter]\ \&\&\ interactionsIndexes[idxInter]\ <\ blockEndIdx\ )\{}
\DoxyCodeLine{01479\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Inside\ block\ interaction,\ do\ nothing}}
\DoxyCodeLine{01480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01481\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(interactionsIndexes[idxInter]\ <\ mindex)\{}
\DoxyCodeLine{01482\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_out_of_block_interaction}{OutOfBlockInteraction}}\ property;}
\DoxyCodeLine{01483\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.insideIndex\ =\ mindex;}
\DoxyCodeLine{01484\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.outIndex\ \ \ \ =\ interactionsIndexes[idxInter];}
\DoxyCodeLine{01485\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.relativeOutPosition\ =\ interactionsPosition[idxInter];}
\DoxyCodeLine{01486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.insideIdxInBlock\ =\ leafIdx;}
\DoxyCodeLine{01487\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.outsideIdxInBlock\ =\ -\/1;}
\DoxyCodeLine{01488\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outsideInteractions.push\_back(property);}
\DoxyCodeLine{01489\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01490\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01491\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01492\ }
\DoxyCodeLine{01493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Sort\ to\ match\ external\ order}}
\DoxyCodeLine{01494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_quick_sort}{FQuickSort<OutOfBlockInteraction,\ int>::QsSequential}}(outsideInteractions.data(),\textcolor{keywordtype}{int}(outsideInteractions.size()));}
\DoxyCodeLine{01495\ }
\DoxyCodeLine{01496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ currentOutInteraction\ =\ 0;}
\DoxyCodeLine{01497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLeftGroup\ =\ 0\ ;\ idxLeftGroup\ <\ idxGroup\ \&\&\ currentOutInteraction\ <\ int(outsideInteractions.size())\ ;\ ++idxLeftGroup)\{}
\DoxyCodeLine{01498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ParticleGroupClass*\ leftContainers\ =\ tree-\/>getParticleGroup(idxLeftGroup);}
\DoxyCodeLine{01499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ blockStartIdxOther\ \ \ \ =\ leftContainers-\/>getStartingIndex();}
\DoxyCodeLine{01500\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ blockEndIdxOther\ \ \ \ \ \ =\ leftContainers-\/>getEndingIndex();}
\DoxyCodeLine{01501\ }
\DoxyCodeLine{01502\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(currentOutInteraction\ <\ \textcolor{keywordtype}{int}(outsideInteractions.size())}
\DoxyCodeLine{01503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ (outsideInteractions[currentOutInteraction].outIndex\ <\ blockStartIdxOther}
\DoxyCodeLine{01504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ leftContainers-\/>getLeafIndex(outsideInteractions[currentOutInteraction].outIndex)\ ==\ -\/1)}
\DoxyCodeLine{01505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ outsideInteractions[currentOutInteraction].outIndex\ <\ blockEndIdxOther)\{}
\DoxyCodeLine{01506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentOutInteraction\ +=\ 1;}
\DoxyCodeLine{01507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01508\ }
\DoxyCodeLine{01509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ lastOutInteraction\ =\ currentOutInteraction;}
\DoxyCodeLine{01510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ copyExistingInteraction\ =\ currentOutInteraction;}
\DoxyCodeLine{01511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(lastOutInteraction\ <\ \textcolor{keywordtype}{int}(outsideInteractions.size())\ \&\&\ outsideInteractions[lastOutInteraction].outIndex\ <\ blockEndIdxOther)\{}
\DoxyCodeLine{01512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ leafPos\ =\ leftContainers-\/>getLeafIndex(outsideInteractions[lastOutInteraction].outIndex);}
\DoxyCodeLine{01513\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(leafPos\ !=\ -\/1)\{}
\DoxyCodeLine{01514\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(copyExistingInteraction\ !=\ lastOutInteraction)\{}
\DoxyCodeLine{01515\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outsideInteractions[copyExistingInteraction]\ =\ outsideInteractions[lastOutInteraction];}
\DoxyCodeLine{01516\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outsideInteractions[copyExistingInteraction].outsideIdxInBlock\ =\ leafPos;}
\DoxyCodeLine{01518\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ copyExistingInteraction\ +=\ 1;}
\DoxyCodeLine{01519\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01520\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lastOutInteraction\ +=\ 1;}
\DoxyCodeLine{01521\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01522\ }
\DoxyCodeLine{01523\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ nbInteractionsBetweenBlocks\ =\ (copyExistingInteraction-\/currentOutInteraction);}
\DoxyCodeLine{01524\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(nbInteractionsBetweenBlocks)\{}
\DoxyCodeLine{01525\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ externalInteractions-\/>emplace\_back();}
\DoxyCodeLine{01526\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_f_group_task_star_p_u_mpi_algorithm_1_1_block_interactions}{BlockInteractions<ParticleGroupClass>}}*\ interactions\ =\ \&externalInteractions-\/>back();}
\DoxyCodeLine{01527\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactions-\/>otherBlock\ =\ leftContainers;}
\DoxyCodeLine{01528\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactions-\/>otherBlockId\ =\ idxLeftGroup;}
\DoxyCodeLine{01529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactions-\/>interactions.resize(nbInteractionsBetweenBlocks);}
\DoxyCodeLine{01530\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::copy(outsideInteractions.begin()\ +\ currentOutInteraction,}
\DoxyCodeLine{01531\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outsideInteractions.begin()\ +\ copyExistingInteraction,}
\DoxyCodeLine{01532\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactions-\/>interactions.begin());}
\DoxyCodeLine{01533\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01534\ }
\DoxyCodeLine{01535\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentOutInteraction\ =\ lastOutInteraction;}
\DoxyCodeLine{01536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01537\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01538\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01539\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01540\ \ \ \ \ \ \ \ \ FLOG(\ leafTimer.tac();\ );}
\DoxyCodeLine{01541\ \ \ \ \ \ \ \ \ FLOG(\ cellTimer.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}();\ );}
\DoxyCodeLine{01542\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01543\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ tree-\/>getHeight()-\/1\ ;\ idxLevel\ >=\ 2\ ;\ -\/-\/idxLevel)\{}
\DoxyCodeLine{01544\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ externalInteractionsAllLevel[idxLevel].resize(tree-\/>getNbCellGroupAtLevel(idxLevel));}
\DoxyCodeLine{01545\ }
\DoxyCodeLine{01546\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbCellGroupAtLevel(idxLevel)\ ;\ ++idxGroup)\{}
\DoxyCodeLine{01547\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CellContainerClass*\ currentCells\ =\ tree-\/>getCellGroup(idxLevel,\ idxGroup);}
\DoxyCodeLine{01548\ }
\DoxyCodeLine{01549\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<BlockInteractions<CellContainerClass>>*\ externalInteractions\ =\ \&externalInteractionsAllLevel[idxLevel][idxGroup];}
\DoxyCodeLine{01550\ }
\DoxyCodeLine{01551\ \textcolor{preprocessor}{\#pragma\ omp\ task\ default(none)\ firstprivate(idxGroup,\ currentCells,\ idxLevel,\ externalInteractions)}}
\DoxyCodeLine{01552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01553\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<OutOfBlockInteraction>\ outsideInteractions;}
\DoxyCodeLine{01554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ blockStartIdx\ =\ currentCells-\/>getStartingIndex();}
\DoxyCodeLine{01555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ blockEndIdx\ \ \ =\ currentCells-\/>getEndingIndex();}
\DoxyCodeLine{01556\ }
\DoxyCodeLine{01557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ cellIdx\ =\ 0\ ;\ cellIdx\ <\ currentCells-\/>getNumberOfCellsInBlock()\ ;\ ++cellIdx)\{}
\DoxyCodeLine{01558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ mindex\ =\ currentCells-\/>getCellMortonIndex(cellIdx);}
\DoxyCodeLine{01559\ }
\DoxyCodeLine{01560\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MortonIndex\ interactionsIndexes[189];}
\DoxyCodeLine{01561\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ interactionsPosition[189];}
\DoxyCodeLine{01562\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ coord(mindex);}
\DoxyCodeLine{01563\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ counter\ =\ coord.\mbox{\hyperlink{class_f_tree_coordinate_ad9a4eeadc6666916ebfb35fa9f794abd}{getInteractionNeighbors}}(idxLevel,interactionsIndexes,interactionsPosition);}
\DoxyCodeLine{01564\ }
\DoxyCodeLine{01565\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxInter\ =\ 0\ ;\ idxInter\ <\ counter\ ;\ ++idxInter)\{}
\DoxyCodeLine{01566\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ blockStartIdx\ <=\ interactionsIndexes[idxInter]\ \&\&\ interactionsIndexes[idxInter]\ <\ blockEndIdx\ )\{}
\DoxyCodeLine{01567\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Nothing\ to\ do}}
\DoxyCodeLine{01568\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(interactionsIndexes[idxInter]\ <\ mindex)\{}
\DoxyCodeLine{01570\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_out_of_block_interaction}{OutOfBlockInteraction}}\ property;}
\DoxyCodeLine{01571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.insideIndex\ =\ mindex;}
\DoxyCodeLine{01572\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.outIndex\ \ \ \ =\ interactionsIndexes[idxInter];}
\DoxyCodeLine{01573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.relativeOutPosition\ =\ interactionsPosition[idxInter];}
\DoxyCodeLine{01574\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.insideIdxInBlock\ =\ cellIdx;}
\DoxyCodeLine{01575\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{property}.outsideIdxInBlock\ =\ -\/1;}
\DoxyCodeLine{01576\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outsideInteractions.push\_back(property);}
\DoxyCodeLine{01577\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01578\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01579\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01580\ }
\DoxyCodeLine{01581\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Manage\ outofblock\ interaction}}
\DoxyCodeLine{01582\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_quick_sort}{FQuickSort<OutOfBlockInteraction,\ int>::QsSequential}}(outsideInteractions.data(),\textcolor{keywordtype}{int}(outsideInteractions.size()));}
\DoxyCodeLine{01583\ }
\DoxyCodeLine{01584\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ currentOutInteraction\ =\ 0;}
\DoxyCodeLine{01585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLeftGroup\ =\ 0\ ;\ idxLeftGroup\ <\ idxGroup\ \&\&\ currentOutInteraction\ <\ int(outsideInteractions.size())\ ;\ ++idxLeftGroup)\{}
\DoxyCodeLine{01586\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CellContainerClass*\ leftCells\ \ \ =\ tree-\/>getCellGroup(idxLevel,\ idxLeftGroup);}
\DoxyCodeLine{01587\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ blockStartIdxOther\ =\ leftCells-\/>getStartingIndex();}
\DoxyCodeLine{01588\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ blockEndIdxOther\ \ \ =\ leftCells-\/>getEndingIndex();}
\DoxyCodeLine{01589\ }
\DoxyCodeLine{01590\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(currentOutInteraction\ <\ \textcolor{keywordtype}{int}(outsideInteractions.size())}
\DoxyCodeLine{01591\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ (outsideInteractions[currentOutInteraction].outIndex\ <\ blockStartIdxOther}
\DoxyCodeLine{01592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ leftCells-\/>getCellIndex(outsideInteractions[currentOutInteraction].outIndex)\ ==\ -\/1)}
\DoxyCodeLine{01593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ outsideInteractions[currentOutInteraction].outIndex\ <\ blockEndIdxOther)\{}
\DoxyCodeLine{01594\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentOutInteraction\ +=\ 1;}
\DoxyCodeLine{01595\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01596\ }
\DoxyCodeLine{01597\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ lastOutInteraction\ =\ currentOutInteraction;}
\DoxyCodeLine{01598\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ copyExistingInteraction\ =\ currentOutInteraction;}
\DoxyCodeLine{01599\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(lastOutInteraction\ <\ \textcolor{keywordtype}{int}(outsideInteractions.size())\ \&\&\ outsideInteractions[lastOutInteraction].outIndex\ <\ blockEndIdxOther)\{}
\DoxyCodeLine{01600\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ cellPos\ =\ leftCells-\/>getCellIndex(outsideInteractions[lastOutInteraction].outIndex);}
\DoxyCodeLine{01601\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(cellPos\ !=\ -\/1)\{}
\DoxyCodeLine{01602\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(copyExistingInteraction\ !=\ lastOutInteraction)\{}
\DoxyCodeLine{01603\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outsideInteractions[copyExistingInteraction]\ =\ outsideInteractions[lastOutInteraction];}
\DoxyCodeLine{01604\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01605\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outsideInteractions[copyExistingInteraction].outsideIdxInBlock\ =\ cellPos;}
\DoxyCodeLine{01606\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ copyExistingInteraction\ +=\ 1;}
\DoxyCodeLine{01607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01608\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lastOutInteraction\ +=\ 1;}
\DoxyCodeLine{01609\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01610\ }
\DoxyCodeLine{01611\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ interactions}}
\DoxyCodeLine{01612\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ nbInteractionsBetweenBlocks\ =\ (copyExistingInteraction-\/currentOutInteraction);}
\DoxyCodeLine{01613\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(nbInteractionsBetweenBlocks)\{}
\DoxyCodeLine{01614\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ externalInteractions-\/>emplace\_back();}
\DoxyCodeLine{01615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_f_group_task_star_p_u_mpi_algorithm_1_1_block_interactions}{BlockInteractions<CellContainerClass>}}*\ interactions\ =\ \&externalInteractions-\/>back();}
\DoxyCodeLine{01616\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactions-\/>otherBlock\ =\ leftCells;}
\DoxyCodeLine{01617\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactions-\/>otherBlockId\ =\ idxLeftGroup;}
\DoxyCodeLine{01618\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactions-\/>interactions.resize(nbInteractionsBetweenBlocks);}
\DoxyCodeLine{01619\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::copy(outsideInteractions.begin()\ +\ currentOutInteraction,}
\DoxyCodeLine{01620\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outsideInteractions.begin()\ +\ copyExistingInteraction,}
\DoxyCodeLine{01621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactions-\/>interactions.begin());}
\DoxyCodeLine{01622\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01623\ }
\DoxyCodeLine{01624\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentOutInteraction\ =\ lastOutInteraction;}
\DoxyCodeLine{01625\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01626\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01627\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01628\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01629\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01630\ \ \ \ \ \ \ \ \ FLOG(\ cellTimer.\mbox{\hyperlink{class_f_tic_a3efff71f7c95acd38451bfab08fa4583}{tac}}();\ );}
\DoxyCodeLine{01631\ }
\DoxyCodeLine{01632\ \textcolor{preprocessor}{\#pragma\ omp\ taskwait}}
\DoxyCodeLine{01633\ }
\DoxyCodeLine{01634\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ Prepare\ in\ "{}}\ <<\ timer.tacAndElapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01635\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\(\backslash\)t\ Prepare\ at\ leaf\ level\ in\ \ \ "{}}\ <<\ leafTimer.elapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01636\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\(\backslash\)t\ Prepare\ at\ other\ levels\ in\ "{}}\ <<\ cellTimer.\mbox{\hyperlink{class_f_tic_a30b9f876fb7188f85b4c2b9d7fd7943e}{elapsed}}()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01637\ \ \ \ \ \}}
\DoxyCodeLine{01638\ }
\DoxyCodeLine{01642\ }
\DoxyCodeLine{01643\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a78c597d17d7b821cfe25b5c394c22ac2}{bottomPass}}()\{}
\DoxyCodeLine{01644\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timer;\ );}
\DoxyCodeLine{01645\ }
\DoxyCodeLine{01646\ \ \ \ \ \ \ \ \ FAssertLF(cellHandles[tree-\/>getHeight()-\/1].size()\ ==\ particleHandles.size());}
\DoxyCodeLine{01647\ }
\DoxyCodeLine{01648\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbParticleGroup()\ ;\ ++idxGroup)\{}
\DoxyCodeLine{01649\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_insert\_task(\&p2m\_cl,}
\DoxyCodeLine{01650\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{01651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&cellHandles[tree-\/>getHeight()-\/1][idxGroup].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{01652\ \ \ \ \ \ \ \ \ \#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}
\DoxyCodeLine{01653\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_PRIORITY,\ PrioClass::Controller().getInsertionPosP2M(),}
\DoxyCodeLine{01654\ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{01655\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ cellHandles[tree-\/>getHeight()-\/1][idxGroup].symb,}
\DoxyCodeLine{01656\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_RW,\ cellHandles[tree-\/>getHeight()-\/1][idxGroup].up,}
\DoxyCodeLine{01657\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ particleHandles[idxGroup].symb,}
\DoxyCodeLine{01658\ \ \ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_TASK\_NAME}
\DoxyCodeLine{01659\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_NAME,\ p2mTaskNames.get(),}
\DoxyCodeLine{01660\ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{01661\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{01662\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01663\ }
\DoxyCodeLine{01664\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ bottomPass\ in\ "{}}\ <<\ timer.tacAndElapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01665\ \ \ \ \ \}}
\DoxyCodeLine{01666\ }
\DoxyCodeLine{01670\ }
\DoxyCodeLine{01671\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_abb958c2b0283800fe7b96d576818912c}{upwardPass}}()\{}
\DoxyCodeLine{01672\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timer;\ );}
\DoxyCodeLine{01673\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ \mbox{\hyperlink{struct_f_math_a43635af3d44bb1868015681ce994df7b}{FMath::Min}}(tree-\/>getHeight()\ -\/\ 2,\ \mbox{\hyperlink{class_f_abstract_algorithm_a694b8888186be58e38691ce08b177d46}{FAbstractAlgorithm::lowerWorkingLevel}}\ -\/\ 1)\ ;\ idxLevel\ >=\ \mbox{\hyperlink{class_f_abstract_algorithm_ade49cb5ede82d078261e576a9d809dc2}{FAbstractAlgorithm::upperWorkingLevel}}\ ;\ -\/-\/idxLevel)\{}
\DoxyCodeLine{01674\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idxSubGroup\ =\ 0;}
\DoxyCodeLine{01675\ }
\DoxyCodeLine{01676\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbCellGroupAtLevel(idxLevel)}
\DoxyCodeLine{01677\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ idxSubGroup\ <\ tree-\/>getNbCellGroupAtLevel(idxLevel+1)\ ;\ ++idxGroup)\{}
\DoxyCodeLine{01678\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CellContainerClass*\textcolor{keyword}{const}\ currentCells\ =\ tree-\/>getCellGroup(idxLevel,\ idxGroup);}
\DoxyCodeLine{01679\ }
\DoxyCodeLine{01680\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ current\ group\ if\ needed}}
\DoxyCodeLine{01681\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ tree-\/>getCellGroup(idxLevel+1,\ idxSubGroup)-\/>getEndingIndex()\ <=\ (currentCells-\/>getStartingIndex()<<3)\ )\{}
\DoxyCodeLine{01682\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++idxSubGroup;}
\DoxyCodeLine{01683\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(\ idxSubGroup\ !=\ tree-\/>getNbCellGroupAtLevel(idxLevel+1)\ );}
\DoxyCodeLine{01684\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(\ (tree-\/>getCellGroup(idxLevel+1,\ idxSubGroup)-\/>getStartingIndex()>>3)\ ==\ currentCells-\/>getStartingIndex()\ );}
\DoxyCodeLine{01685\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01686\ }
\DoxyCodeLine{01687\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01688\ }
\DoxyCodeLine{01689\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }starpu\_task*\ \textcolor{keyword}{const}\ task\ =\ starpu\_task\_create();}
\DoxyCodeLine{01690\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles\ =\ (starpu\_data\_handle\_t*)malloc(\textcolor{keyword}{sizeof}(starpu\_data\_handle\_t)*20);}
\DoxyCodeLine{01691\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[0]\ =\ cellHandles[idxLevel][idxGroup].symb;}
\DoxyCodeLine{01692\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[1]\ =\ cellHandles[idxLevel][idxGroup].up;}
\DoxyCodeLine{01693\ }
\DoxyCodeLine{01694\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[2]\ =\ cellHandles[idxLevel+1][idxSubGroup].symb;}
\DoxyCodeLine{01695\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[3]\ =\ cellHandles[idxLevel+1][idxSubGroup].up;}
\DoxyCodeLine{01696\ }
\DoxyCodeLine{01697\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ the\ right\ codelet}}
\DoxyCodeLine{01698\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\ =\ \&m2m\_cl;}
\DoxyCodeLine{01699\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ args\ values}}
\DoxyCodeLine{01700\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *arg\_buffer;}
\DoxyCodeLine{01701\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ arg\_buffer\_size;}
\DoxyCodeLine{01702\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_codelet\_pack\_args((\textcolor{keywordtype}{void}**)\&arg\_buffer,\ \&arg\_buffer\_size,}
\DoxyCodeLine{01703\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{01704\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&idxLevel,\ \textcolor{keyword}{sizeof}(idxLevel),}
\DoxyCodeLine{01705\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&cellHandles[idxLevel][idxGroup].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{01706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{01707\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\ =\ arg\_buffer;}
\DoxyCodeLine{01708\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\_size\ =\ arg\_buffer\_size;}
\DoxyCodeLine{01709\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\_free\ =\ 1;}
\DoxyCodeLine{01710\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}}
\DoxyCodeLine{01711\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>priority\ =\ PrioClass::Controller().getInsertionPosM2M(idxLevel);}
\DoxyCodeLine{01712\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01713\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_TASK\_NAME}}
\DoxyCodeLine{01714\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>name\ =\ m2mTaskNames[idxLevel].get();}
\DoxyCodeLine{01715\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01716\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(starpu\_task\_submit(task)\ ==\ 0);}
\DoxyCodeLine{01717\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01718\ }
\DoxyCodeLine{01719\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(tree-\/>getCellGroup(idxLevel+1,\ idxSubGroup)-\/>getEndingIndex()\ <=\ (((currentCells-\/>getEndingIndex()-\/1)<<3)+7)}
\DoxyCodeLine{01720\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ (idxSubGroup+1)\ !=\ tree-\/>getNbCellGroupAtLevel(idxLevel+1)}
\DoxyCodeLine{01721\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ tree-\/>getCellGroup(idxLevel+1,\ idxSubGroup+1)-\/>getStartingIndex()\ <=\ ((currentCells-\/>getEndingIndex()-\/1)<<3)+7\ )\{}
\DoxyCodeLine{01722\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idxSubGroup\ +=\ 1;}
\DoxyCodeLine{01723\ }
\DoxyCodeLine{01724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }starpu\_task*\ \textcolor{keyword}{const}\ task\ =\ starpu\_task\_create();}
\DoxyCodeLine{01725\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles\ =\ (starpu\_data\_handle\_t*)malloc(\textcolor{keyword}{sizeof}(starpu\_data\_handle\_t)*20);}
\DoxyCodeLine{01726\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[0]\ =\ cellHandles[idxLevel][idxGroup].symb;}
\DoxyCodeLine{01727\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[1]\ =\ cellHandles[idxLevel][idxGroup].up;}
\DoxyCodeLine{01728\ }
\DoxyCodeLine{01729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[2]\ =\ cellHandles[idxLevel+1][idxSubGroup].symb;}
\DoxyCodeLine{01730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[3]\ =\ cellHandles[idxLevel+1][idxSubGroup].up;}
\DoxyCodeLine{01731\ }
\DoxyCodeLine{01732\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ the\ right\ codelet}}
\DoxyCodeLine{01733\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\ =\ \&m2m\_cl;}
\DoxyCodeLine{01734\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ args\ values}}
\DoxyCodeLine{01735\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *arg\_buffer;}
\DoxyCodeLine{01736\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ arg\_buffer\_size;}
\DoxyCodeLine{01737\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_codelet\_pack\_args((\textcolor{keywordtype}{void}**)\&arg\_buffer,\ \&arg\_buffer\_size,}
\DoxyCodeLine{01738\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{01739\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&idxLevel,\ \textcolor{keyword}{sizeof}(idxLevel),}
\DoxyCodeLine{01740\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&cellHandles[idxLevel][idxGroup].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{01741\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{01742\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\ =\ arg\_buffer;}
\DoxyCodeLine{01743\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\_size\ =\ arg\_buffer\_size;}
\DoxyCodeLine{01744\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\_free\ =\ 1;}
\DoxyCodeLine{01745\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}}
\DoxyCodeLine{01746\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>priority\ =\ PrioClass::Controller().getInsertionPosM2M(idxLevel);}
\DoxyCodeLine{01747\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01748\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_TASK\_NAME}}
\DoxyCodeLine{01749\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>name\ =\ m2mTaskNames[idxLevel].get();}
\DoxyCodeLine{01750\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01751\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(starpu\_task\_submit(task)\ ==\ 0);}
\DoxyCodeLine{01752\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01753\ }
\DoxyCodeLine{01754\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01755\ }
\DoxyCodeLine{01757\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Exchange\ for\ mpi}}
\DoxyCodeLine{01759\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Manage\ the\ external\ operations}}
\DoxyCodeLine{01760\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ what\ to\ recv}}
\DoxyCodeLine{01761\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(tree-\/>getNbCellGroupAtLevel(idxLevel))\{}
\DoxyCodeLine{01762\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Take\ last\ block\ at\ this\ level}}
\DoxyCodeLine{01763\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CellContainerClass*\ currentCells\ =\ tree-\/>getCellGroup(idxLevel,\ tree-\/>getNbCellGroupAtLevel(idxLevel)-\/1);}
\DoxyCodeLine{01764\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Take\ the\ last\ cell\ index\ of\ the\ last\ block}}
\DoxyCodeLine{01765\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ myLastIdx\ =\ currentCells-\/>getEndingIndex()-\/1;}
\DoxyCodeLine{01766\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ the\ descriptor\ of\ the\ first\ block\ that\ belong\ to\ someone\ else\ at\ lower\ level}}
\DoxyCodeLine{01767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ firstOtherBlock\ =\ nbBlocksBeforeMinPerLevel[idxLevel+1]\ +\ tree-\/>getNbCellGroupAtLevel(idxLevel+1);}
\DoxyCodeLine{01768\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(processesBlockInfos[idxLevel+1][firstOtherBlock-\/1].owner\ ==\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a3f21607da8f2938bd39de261c4cff703}{processId}}());}
\DoxyCodeLine{01769\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Iterate\ while\ the\ block\ has\ our\ cell\ has\ parent}}
\DoxyCodeLine{01770\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idxBlockToRecv\ =\ 0;}
\DoxyCodeLine{01771\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(firstOtherBlock\ +\ idxBlockToRecv\ <\ \textcolor{keywordtype}{int}(processesBlockInfos[idxLevel+1].size())\ \&\&}
\DoxyCodeLine{01772\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myLastIdx\ ==\ (processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].firstIndex\ >>\ 3))\{}
\DoxyCodeLine{01773\ }
\DoxyCodeLine{01774\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteCellGroups[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].ptrSymb\ ==\ \textcolor{keyword}{nullptr})\{}
\DoxyCodeLine{01775\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ nbBytesInBlockSymb\ =\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].bufferSizeSymb;}
\DoxyCodeLine{01776\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*\ memoryBlockSymb\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)FAlignedMemory::AllocateBytes<32>(nbBytesInBlockSymb);}
\DoxyCodeLine{01777\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ remoteCellGroups[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].ptrSymb\ =\ memoryBlockSymb;}
\DoxyCodeLine{01778\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_variable\_data\_register(\&remoteCellGroups[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].handleSymb,\ 0,}
\DoxyCodeLine{01779\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uintptr\_t)remoteCellGroups[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].ptrSymb,\ nbBytesInBlockSymb);}
\DoxyCodeLine{01780\ }
\DoxyCodeLine{01781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ nbBytesInBlockUp\ =\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].bufferSizeUp;}
\DoxyCodeLine{01782\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*\ memoryBlockUp\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)FAlignedMemory::AllocateBytes<32>(nbBytesInBlockUp);}
\DoxyCodeLine{01783\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ remoteCellGroups[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].ptrUp\ =\ memoryBlockUp;}
\DoxyCodeLine{01784\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_variable\_data\_register(\&remoteCellGroups[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].handleUp,\ 0,}
\DoxyCodeLine{01785\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uintptr\_t)remoteCellGroups[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].ptrUp,\ nbBytesInBlockUp);}
\DoxyCodeLine{01786\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01787\ }
\DoxyCodeLine{01788\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}[SMpi]\ "{}}\ <<\ idxLevel\ <<\ \textcolor{stringliteral}{"{}\ Post\ a\ recv\ during\ M2M\ for\ Idx\ "{}}\ <<\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].firstIndex\ <<}
\DoxyCodeLine{01789\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ and\ owner\ is\ "{}}\ <<\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].owner\ <<\ \textcolor{stringliteral}{"{}\ tag\ "{}}\ <<\ getTag(idxLevel,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].firstIndex,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].globalIdx,\ 0,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].owner)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{01790\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}[SMpi]\ "{}}\ <<\ idxLevel\ <<\ \textcolor{stringliteral}{"{}\ Post\ a\ recv\ during\ M2M\ for\ Idx\ "{}}\ <<\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].firstIndex\ <<}
\DoxyCodeLine{01791\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ and\ owner\ is\ "{}}\ <<\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].owner\ <<\ \textcolor{stringliteral}{"{}\ tag\ "{}}\ <<\ getTag(idxLevel,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].firstIndex,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].globalIdx,\ 1,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].owner)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{01792\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller.flush());}
\DoxyCodeLine{01793\ }
\DoxyCodeLine{01794\ }
\DoxyCodeLine{01795\ }
\DoxyCodeLine{01796\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_mpi\_irecv\_detached\ (\ remoteCellGroups[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].handleSymb,}
\DoxyCodeLine{01797\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].owner,}
\DoxyCodeLine{01798\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getTag(idxLevel+1,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].firstIndex,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].globalIdx,\ 0,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].owner),}
\DoxyCodeLine{01799\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ 0\textcolor{comment}{/*callback*/},\ 0\textcolor{comment}{/*arg*/}\ );}
\DoxyCodeLine{01800\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_mpi\_irecv\_detached\ (\ remoteCellGroups[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].handleUp,}
\DoxyCodeLine{01801\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].owner,}
\DoxyCodeLine{01802\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getTag(idxLevel+1,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].firstIndex,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].globalIdx,\ 1,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToRecv].owner),}
\DoxyCodeLine{01803\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ 0\textcolor{comment}{/*callback*/},\ 0\textcolor{comment}{/*arg*/}\ );}
\DoxyCodeLine{01804\ }
\DoxyCodeLine{01805\ }
\DoxyCodeLine{01806\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idxBlockToRecv\ +=\ 1;}
\DoxyCodeLine{01807\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01808\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(idxBlockToRecv\ <\ 8);}
\DoxyCodeLine{01809\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(idxBlockToRecv)\{\textcolor{comment}{//\ Perform\ the\ work}}
\DoxyCodeLine{01810\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ at\ max\ 8\ groups}}
\DoxyCodeLine{01811\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nbSubCellGroups\ =\ 0;}
\DoxyCodeLine{01812\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(nbSubCellGroups\ <\ idxBlockToRecv)\{}
\DoxyCodeLine{01813\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }starpu\_task*\ \textcolor{keyword}{const}\ task\ =\ starpu\_task\_create();}
\DoxyCodeLine{01814\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles\ =\ (starpu\_data\_handle\_t*)malloc(\textcolor{keyword}{sizeof}(starpu\_data\_handle\_t)*20);}
\DoxyCodeLine{01815\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[0]\ =\ cellHandles[idxLevel][tree-\/>getNbCellGroupAtLevel(idxLevel)-\/1].symb;}
\DoxyCodeLine{01816\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[1]\ =\ cellHandles[idxLevel][tree-\/>getNbCellGroupAtLevel(idxLevel)-\/1].up;}
\DoxyCodeLine{01817\ }
\DoxyCodeLine{01818\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[2]\ =\ remoteCellGroups[idxLevel+1][firstOtherBlock\ +\ nbSubCellGroups].handleSymb;}
\DoxyCodeLine{01819\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[3]\ =\ remoteCellGroups[idxLevel+1][firstOtherBlock\ +\ nbSubCellGroups].handleUp;}
\DoxyCodeLine{01820\ }
\DoxyCodeLine{01821\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ the\ right\ codelet}}
\DoxyCodeLine{01822\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\ =\ \&m2m\_cl;}
\DoxyCodeLine{01823\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ args\ values}}
\DoxyCodeLine{01824\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *arg\_buffer;}
\DoxyCodeLine{01825\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ arg\_buffer\_size;}
\DoxyCodeLine{01826\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_codelet\_pack\_args((\textcolor{keywordtype}{void}**)\&arg\_buffer,\ \&arg\_buffer\_size,}
\DoxyCodeLine{01827\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{01828\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&idxLevel,\ \textcolor{keyword}{sizeof}(idxLevel),}
\DoxyCodeLine{01829\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&cellHandles[idxLevel][tree-\/>getNbCellGroupAtLevel(idxLevel)-\/1].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{01830\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{01831\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\ =\ arg\_buffer;}
\DoxyCodeLine{01832\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\_size\ =\ arg\_buffer\_size;}
\DoxyCodeLine{01833\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}}
\DoxyCodeLine{01834\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>priority\ =\ PrioClass::Controller().getInsertionPosM2M(idxLevel);}
\DoxyCodeLine{01835\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01836\ \textcolor{preprocessor}{\ \ \ \ \#ifdef\ STARPU\_USE\_TASK\_NAME}}
\DoxyCodeLine{01837\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>name\ =\ m2mTaskNames[idxLevel].get();}
\DoxyCodeLine{01838\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{01839\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nbSubCellGroups\ +=\ 1;}
\DoxyCodeLine{01840\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(starpu\_task\_submit(task)\ ==\ 0);}
\DoxyCodeLine{01841\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01842\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01843\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01844\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ what\ to\ send}}
\DoxyCodeLine{01845\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(tree-\/>getNbCellGroupAtLevel(idxLevel+1)}
\DoxyCodeLine{01846\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ nbBlocksBeforeMinPerLevel[idxLevel]\ !=\ 0)\{}
\DoxyCodeLine{01847\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Take\ the\ first\ lower\ block}}
\DoxyCodeLine{01848\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CellContainerClass*\ currentCells\ =\ tree-\/>getCellGroup(idxLevel+1,\ 0);}
\DoxyCodeLine{01849\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Take\ its\ first\ index}}
\DoxyCodeLine{01850\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ myFirstChildIdx\ =\ currentCells-\/>getStartingIndex();}
\DoxyCodeLine{01851\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ missingParentIdx\ =\ (myFirstChildIdx>>3);}
\DoxyCodeLine{01852\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ no\ parent\ or\ the\ first\ parent\ is\ not\ the\ good\ one}}
\DoxyCodeLine{01853\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(tree-\/>getNbCellGroupAtLevel(idxLevel)\ ==\ 0}
\DoxyCodeLine{01854\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ tree-\/>getCellGroup(idxLevel,\ 0)-\/>getStartingIndex()\ !=\ missingParentIdx)\{}
\DoxyCodeLine{01855\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Look\ if\ the\ parent\ is\ owned\ by\ another\ block}}
\DoxyCodeLine{01856\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ firstOtherBlock\ =\ nbBlocksBeforeMinPerLevel[idxLevel]-\/1;}
\DoxyCodeLine{01857\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(processesBlockInfos[idxLevel][firstOtherBlock].lastIndex-\/1\ ==\ missingParentIdx);}
\DoxyCodeLine{01858\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ dest\ =\ processesBlockInfos[idxLevel][firstOtherBlock].owner;}
\DoxyCodeLine{01859\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ lowerIdxToSend\ =\ 0;}
\DoxyCodeLine{01860\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(lowerIdxToSend\ !=\ tree-\/>getNbCellGroupAtLevel(idxLevel+1)}
\DoxyCodeLine{01861\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ missingParentIdx\ ==\ (tree-\/>getCellGroup(idxLevel+1,\ lowerIdxToSend)-\/>getStartingIndex()>>3))\{}
\DoxyCodeLine{01862\ }
\DoxyCodeLine{01863\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}[SMpi]\ "{}}\ <<\ idxLevel\ <<\ \textcolor{stringliteral}{"{}\ Post\ a\ send\ during\ M2M\ for\ Idx\ "{}}\ <<\ tree-\/>getCellGroup(idxLevel+1,\ lowerIdxToSend)-\/>getStartingIndex()\ <<}
\DoxyCodeLine{01864\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ and\ dest\ is\ "{}}\ <<\ dest\ <<\ \textcolor{stringliteral}{"{}\ tag\ "{}}\ <<\ getTag(idxLevel,\ tree-\/>getCellGroup(idxLevel+1,\ lowerIdxToSend)-\/>getStartingIndex(),\ nbBlocksBeforeMinPerLevel[idxLevel+1]\ +\ lowerIdxToSend,\ 0,\ dest)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{01865\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}[SMpi]\ "{}}\ <<\ idxLevel\ <<\ \textcolor{stringliteral}{"{}\ Post\ a\ send\ during\ M2M\ for\ Idx\ "{}}\ <<\ tree-\/>getCellGroup(idxLevel+1,\ lowerIdxToSend)-\/>getStartingIndex()\ <<}
\DoxyCodeLine{01866\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ and\ dest\ is\ "{}}\ <<\ dest\ <<\ \textcolor{stringliteral}{"{}\ tag\ "{}}\ <<\ getTag(idxLevel,\ tree-\/>getCellGroup(idxLevel+1,\ lowerIdxToSend)-\/>getStartingIndex(),\ nbBlocksBeforeMinPerLevel[idxLevel+1]\ +\ lowerIdxToSend,\ 1,\ dest)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{01867\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller.flush());}
\DoxyCodeLine{01868\ }
\DoxyCodeLine{01869\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_mpi\_isend\_detached(\ cellHandles[idxLevel+1][lowerIdxToSend].symb,\ dest,}
\DoxyCodeLine{01870\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getTag(idxLevel+1,\ tree-\/>getCellGroup(idxLevel+1,\ lowerIdxToSend)-\/>getStartingIndex(),\ nbBlocksBeforeMinPerLevel[idxLevel+1]\ +\ lowerIdxToSend,\ 0,\ dest),}
\DoxyCodeLine{01871\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ 0\textcolor{comment}{/*callback*/},\ 0\textcolor{comment}{/*arg*/}\ );}
\DoxyCodeLine{01872\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_mpi\_isend\_detached(\ cellHandles[idxLevel+1][lowerIdxToSend].up,\ dest,}
\DoxyCodeLine{01873\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getTag(idxLevel+1,\ tree-\/>getCellGroup(idxLevel+1,\ lowerIdxToSend)-\/>getStartingIndex(),\ nbBlocksBeforeMinPerLevel[idxLevel+1]\ +\ lowerIdxToSend,\ 1,\ dest),}
\DoxyCodeLine{01874\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ 0\textcolor{comment}{/*callback*/},\ 0\textcolor{comment}{/*arg*/}\ );}
\DoxyCodeLine{01875\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lowerIdxToSend\ +=\ 1;}
\DoxyCodeLine{01876\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01877\ }
\DoxyCodeLine{01878\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01879\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01881\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01882\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ upwardPass\ in\ "{}}\ <<\ timer.tacAndElapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01883\ \ \ \ \ \}}
\DoxyCodeLine{01884\ }
\DoxyCodeLine{01888\ }
\DoxyCodeLine{01889\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_ad5cf0410312d1cc497bff50deb89e16b}{transferPassMpi}}()\{}
\DoxyCodeLine{01890\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timer;\ );}
\DoxyCodeLine{01891\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ \mbox{\hyperlink{class_f_abstract_algorithm_a694b8888186be58e38691ce08b177d46}{FAbstractAlgorithm::lowerWorkingLevel}}-\/1\ ;\ idxLevel\ >=\ \mbox{\hyperlink{class_f_abstract_algorithm_ade49cb5ede82d078261e576a9d809dc2}{FAbstractAlgorithm::upperWorkingLevel}}\ ;\ -\/-\/idxLevel)\{}
\DoxyCodeLine{01892\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbCellGroupAtLevel(idxLevel)\ ;\ ++idxGroup)\{}
\DoxyCodeLine{01893\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxInteraction\ =\ 0;\ idxInteraction\ <\ int(externalInteractionsAllLevelMpi[idxLevel][idxGroup].size())\ ;\ ++idxInteraction)\{}
\DoxyCodeLine{01894\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ interactionid\ =\ externalInteractionsAllLevelMpi[idxLevel][idxGroup][idxInteraction].otherBlockId;}
\DoxyCodeLine{01895\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<OutOfBlockInteraction>*\ outsideInteractions\ =\ \&externalInteractionsAllLevelMpi[idxLevel][idxGroup][idxInteraction].interactions;}
\DoxyCodeLine{01896\ }
\DoxyCodeLine{01897\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_insert\_task(\&m2l\_cl\_inout\_mpi,}
\DoxyCodeLine{01898\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{01899\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&idxLevel,\ \textcolor{keyword}{sizeof}(idxLevel),}
\DoxyCodeLine{01900\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&outsideInteractions,\ \textcolor{keyword}{sizeof}(outsideInteractions),}
\DoxyCodeLine{01901\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&cellHandles[idxLevel][idxGroup].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{01902\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}
\DoxyCodeLine{01903\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_PRIORITY,\ PrioClass::Controller().getInsertionPosM2LExtern(idxLevel),}
\DoxyCodeLine{01904\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{01905\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ cellHandles[idxLevel][idxGroup].symb,}
\DoxyCodeLine{01906\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED),\ cellHandles[idxLevel][idxGroup].down,}
\DoxyCodeLine{01907\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ remoteCellGroups[idxLevel][interactionid].handleSymb,}
\DoxyCodeLine{01908\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ remoteCellGroups[idxLevel][interactionid].handleUp,}
\DoxyCodeLine{01909\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_TASK\_NAME}
\DoxyCodeLine{01910\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_NAME,\ m2lOuterTaskNames[idxLevel].get(),}
\DoxyCodeLine{01911\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{01912\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{01913\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01914\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01915\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01916\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ transferPassMpi\ in\ "{}}\ <<\ timer.tacAndElapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01917\ \ \ \ \ \}}
\DoxyCodeLine{01918\ }
\DoxyCodeLine{01922\ }
\DoxyCodeLine{01923\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_ac988a24f8b1b8653d35d2a89dcf9cdec}{transferPass}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ fromLevel,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ toLevel,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ inner,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ outer)\{}
\DoxyCodeLine{01924\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timer;\ );}
\DoxyCodeLine{01925\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timerInBlock;\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timerOutBlock;\ );}
\DoxyCodeLine{01926\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ fromLevel\ ;\ idxLevel\ <\ toLevel\ ;\ ++idxLevel)\{}
\DoxyCodeLine{01927\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(inner)\{}
\DoxyCodeLine{01928\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(\ timerInBlock.tic()\ );}
\DoxyCodeLine{01929\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbCellGroupAtLevel(idxLevel)\ ;\ ++idxGroup)\{}
\DoxyCodeLine{01930\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_insert\_task(\&m2l\_cl\_in,}
\DoxyCodeLine{01931\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{01932\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&idxLevel,\ \textcolor{keyword}{sizeof}(idxLevel),}
\DoxyCodeLine{01933\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&cellHandles[idxLevel][idxGroup].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{01934\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}
\DoxyCodeLine{01935\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_PRIORITY,\ PrioClass::Controller().getInsertionPosM2L(idxLevel),}
\DoxyCodeLine{01936\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{01937\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ cellHandles[idxLevel][idxGroup].symb,}
\DoxyCodeLine{01938\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ cellHandles[idxLevel][idxGroup].up,}
\DoxyCodeLine{01939\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED),\ cellHandles[idxLevel][idxGroup].down,}
\DoxyCodeLine{01940\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_TASK\_NAME}
\DoxyCodeLine{01941\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_NAME,\ m2lTaskNames[idxLevel].get(),}
\DoxyCodeLine{01942\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{01943\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{01944\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01945\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(\ timerInBlock.tac()\ );}
\DoxyCodeLine{01946\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01947\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(outer)\{}
\DoxyCodeLine{01948\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(\ timerOutBlock.tic()\ );}
\DoxyCodeLine{01949\ }
\DoxyCodeLine{01950\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbCellGroupAtLevel(idxLevel)\ ;\ ++idxGroup)\{}
\DoxyCodeLine{01951\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxInteraction\ =\ 0;\ idxInteraction\ <\ int(externalInteractionsAllLevel[idxLevel][idxGroup].size())\ ;\ ++idxInteraction)\{}
\DoxyCodeLine{01952\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ interactionid\ =\ externalInteractionsAllLevel[idxLevel][idxGroup][idxInteraction].otherBlockId;}
\DoxyCodeLine{01953\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<OutOfBlockInteraction>*\ outsideInteractions\ =\ \&externalInteractionsAllLevel[idxLevel][idxGroup][idxInteraction].interactions;}
\DoxyCodeLine{01954\ }
\DoxyCodeLine{01955\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ mode\ =\ 1;}
\DoxyCodeLine{01956\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_insert\_task(\&m2l\_cl\_inout,}
\DoxyCodeLine{01957\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{01958\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&idxLevel,\ \textcolor{keyword}{sizeof}(idxLevel),}
\DoxyCodeLine{01959\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&outsideInteractions,\ \textcolor{keyword}{sizeof}(outsideInteractions),}
\DoxyCodeLine{01960\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&cellHandles[idxLevel][idxGroup].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{01961\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&mode,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{01962\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}
\DoxyCodeLine{01963\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_PRIORITY,\ PrioClass::Controller().getInsertionPosM2LExtern(idxLevel),}
\DoxyCodeLine{01964\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{01965\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ cellHandles[idxLevel][idxGroup].symb,}
\DoxyCodeLine{01966\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED),\ cellHandles[idxLevel][idxGroup].down,}
\DoxyCodeLine{01967\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ cellHandles[idxLevel][interactionid].symb,}
\DoxyCodeLine{01968\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ cellHandles[idxLevel][interactionid].up,}
\DoxyCodeLine{01969\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_TASK\_NAME}
\DoxyCodeLine{01970\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_NAME,\ m2lOuterTaskNames[idxLevel].get(),}
\DoxyCodeLine{01971\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{01972\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{01973\ }
\DoxyCodeLine{01974\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mode\ =\ 2;}
\DoxyCodeLine{01975\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_insert\_task(\&m2l\_cl\_inout,}
\DoxyCodeLine{01976\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{01977\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&idxLevel,\ \textcolor{keyword}{sizeof}(idxLevel),}
\DoxyCodeLine{01978\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&outsideInteractions,\ \textcolor{keyword}{sizeof}(outsideInteractions),}
\DoxyCodeLine{01979\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&cellHandles[idxLevel][idxGroup].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{01980\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&mode,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{01981\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}
\DoxyCodeLine{01982\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_PRIORITY,\ PrioClass::Controller().getInsertionPosM2LExtern(idxLevel),}
\DoxyCodeLine{01983\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{01984\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ cellHandles[idxLevel][interactionid].symb,}
\DoxyCodeLine{01985\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED),\ cellHandles[idxLevel][interactionid].down,}
\DoxyCodeLine{01986\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ cellHandles[idxLevel][idxGroup].symb,}
\DoxyCodeLine{01987\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ cellHandles[idxLevel][idxGroup].up,}
\DoxyCodeLine{01988\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_TASK\_NAME}
\DoxyCodeLine{01989\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_NAME,\ m2lOuterTaskNames[idxLevel].get(),}
\DoxyCodeLine{01990\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{01991\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{01992\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01993\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01994\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(\ timerOutBlock.tac()\ );}
\DoxyCodeLine{01995\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01996\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01997\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ transferPass\ in\ "{}}\ <<\ timer.tacAndElapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01998\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\(\backslash\)t\ inblock\ in\ \ "{}}\ <<\ timerInBlock.elapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01999\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\(\backslash\)t\ outblock\ in\ "{}}\ <<\ timerOutBlock.elapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{02000\ \ \ \ \ \}}
\DoxyCodeLine{02001\ }
\DoxyCodeLine{02005\ }
\DoxyCodeLine{02006\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a164598a5ad44cd97effeca45d38b0617}{downardPass}}()\{}
\DoxyCodeLine{02007\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timer;\ );}
\DoxyCodeLine{02008\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ \mbox{\hyperlink{class_f_abstract_algorithm_ade49cb5ede82d078261e576a9d809dc2}{FAbstractAlgorithm::upperWorkingLevel}}\ ;\ idxLevel\ <\ \mbox{\hyperlink{class_f_abstract_algorithm_a694b8888186be58e38691ce08b177d46}{FAbstractAlgorithm::lowerWorkingLevel}}\ -\/\ 1\ ;\ ++idxLevel)\{}
\DoxyCodeLine{02010\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Exchange\ for\ MPI}}
\DoxyCodeLine{02012\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Manage\ the\ external\ operations}}
\DoxyCodeLine{02013\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ what\ to\ send}}
\DoxyCodeLine{02014\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(tree-\/>getNbCellGroupAtLevel(idxLevel))\{}
\DoxyCodeLine{02015\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Take\ last\ block\ at\ this\ level}}
\DoxyCodeLine{02016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ idxLastBlock\ =\ tree-\/>getNbCellGroupAtLevel(idxLevel)-\/1;}
\DoxyCodeLine{02017\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CellContainerClass*\ currentCells\ =\ tree-\/>getCellGroup(idxLevel,\ idxLastBlock);}
\DoxyCodeLine{02018\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Take\ the\ last\ cell\ index\ of\ the\ last\ block}}
\DoxyCodeLine{02019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ myLastIdx\ =\ currentCells-\/>getEndingIndex()-\/1;}
\DoxyCodeLine{02020\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ the\ descriptor\ of\ the\ first\ block\ that\ belong\ to\ someone\ else\ at\ lower\ level}}
\DoxyCodeLine{02021\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ firstOtherBlock\ =\ nbBlocksBeforeMinPerLevel[idxLevel+1]\ +\ tree-\/>getNbCellGroupAtLevel(idxLevel+1);}
\DoxyCodeLine{02022\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(processesBlockInfos[idxLevel+1][firstOtherBlock-\/1].owner\ ==\ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_a3f21607da8f2938bd39de261c4cff703}{processId}}());}
\DoxyCodeLine{02023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Iterate\ while\ the\ block\ has\ our\ cell\ has\ parent}}
\DoxyCodeLine{02024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idxBlockToSend\ =\ 0;}
\DoxyCodeLine{02025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ lastProcSend\ \ \ =\ 0;}
\DoxyCodeLine{02026\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(firstOtherBlock\ +\ idxBlockToSend\ <\ \textcolor{keywordtype}{int}(processesBlockInfos[idxLevel+1].size())\ \&\&}
\DoxyCodeLine{02027\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myLastIdx\ ==\ (processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToSend].firstIndex\ >>\ 3))\{}
\DoxyCodeLine{02028\ }
\DoxyCodeLine{02029\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(lastProcSend\ !=\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToSend].owner)\{}
\DoxyCodeLine{02030\ }
\DoxyCodeLine{02031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}[SMpi]\ "{}}\ <<\ idxLevel\ <<\ \textcolor{stringliteral}{"{}\ Post\ a\ send\ during\ L2L\ for\ Idx\ "{}}\ <<\ tree-\/>getCellGroup(idxLevel,\ idxLastBlock)-\/>getStartingIndex()\ <<}
\DoxyCodeLine{02032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ and\ dest\ is\ "{}}\ <<\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToSend].owner}
\DoxyCodeLine{02033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ size\ "{}}\ <<\ tree-\/>getCellGroup(idxLevel,\ idxLastBlock)-\/>getBufferSizeInByte()}
\DoxyCodeLine{02034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ tag\ "{}}\ <<\ getTag(idxLevel,\ tree-\/>getCellGroup(idxLevel,\ idxLastBlock)-\/>getStartingIndex(),\ nbBlocksBeforeMinPerLevel[idxLevel]\ +\ idxLastBlock,\ 0,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToSend].owner)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{02035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}[SMpi]\ "{}}\ <<\ idxLevel\ <<\ \textcolor{stringliteral}{"{}\ Post\ a\ send\ during\ L2L\ for\ Idx\ "{}}\ <<\ tree-\/>getCellGroup(idxLevel,\ idxLastBlock)-\/>getStartingIndex()\ <<}
\DoxyCodeLine{02036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ and\ dest\ is\ "{}}\ <<\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToSend].owner}
\DoxyCodeLine{02037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ size\ "{}}\ <<\ tree-\/>getCellGroup(idxLevel,\ idxLastBlock)-\/>getLocalBufferSizeInByte()}
\DoxyCodeLine{02038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ tag\ "{}}\ <<\ getTag(idxLevel,\ tree-\/>getCellGroup(idxLevel,\ idxLastBlock)-\/>getStartingIndex(),\ nbBlocksBeforeMinPerLevel[idxLevel]\ +\ idxLastBlock,\ 2,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToSend].owner)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{02039\ }
\DoxyCodeLine{02040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_mpi\_isend\_detached(\ cellHandles[idxLevel][idxLastBlock].symb,}
\DoxyCodeLine{02041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToSend].owner,}
\DoxyCodeLine{02042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getTag(idxLevel,\ tree-\/>getCellGroup(idxLevel,\ idxLastBlock)-\/>getStartingIndex(),\ nbBlocksBeforeMinPerLevel[idxLevel]\ +\ idxLastBlock,\ 0,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToSend].owner),}
\DoxyCodeLine{02043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ 0\textcolor{comment}{/*callback*/},\ 0\textcolor{comment}{/*arg*/}\ );}
\DoxyCodeLine{02044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_mpi\_isend\_detached(\ cellHandles[idxLevel][idxLastBlock].down,}
\DoxyCodeLine{02045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToSend].owner,}
\DoxyCodeLine{02046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getTag(idxLevel,\ tree-\/>getCellGroup(idxLevel,\ idxLastBlock)-\/>getStartingIndex(),\ nbBlocksBeforeMinPerLevel[idxLevel]\ +\ idxLastBlock,\ 2,\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToSend].owner),}
\DoxyCodeLine{02047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ 0\textcolor{comment}{/*callback*/},\ 0\textcolor{comment}{/*arg*/}\ );}
\DoxyCodeLine{02048\ }
\DoxyCodeLine{02049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lastProcSend\ =\ processesBlockInfos[idxLevel+1][firstOtherBlock\ +\ idxBlockToSend].owner;}
\DoxyCodeLine{02050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idxBlockToSend\ +=\ 1;}
\DoxyCodeLine{02052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02053\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02054\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ what\ to\ recv}}
\DoxyCodeLine{02055\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(tree-\/>getNbCellGroupAtLevel(idxLevel+1)}
\DoxyCodeLine{02056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ nbBlocksBeforeMinPerLevel[idxLevel]\ !=\ 0)\{}
\DoxyCodeLine{02057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Take\ the\ first\ lower\ block}}
\DoxyCodeLine{02058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CellContainerClass*\ currentCells\ =\ tree-\/>getCellGroup(idxLevel+1,\ 0);}
\DoxyCodeLine{02059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Take\ its\ first\ index}}
\DoxyCodeLine{02060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ myFirstChildIdx\ =\ currentCells-\/>getStartingIndex();}
\DoxyCodeLine{02061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ missingParentIdx\ =\ (myFirstChildIdx>>3);}
\DoxyCodeLine{02062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ no\ parent\ or\ the\ first\ parent\ is\ not\ the\ good\ one}}
\DoxyCodeLine{02063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(tree-\/>getNbCellGroupAtLevel(idxLevel)\ ==\ 0}
\DoxyCodeLine{02064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ tree-\/>getCellGroup(idxLevel,\ 0)-\/>getStartingIndex()\ !=\ missingParentIdx)\{}
\DoxyCodeLine{02065\ }
\DoxyCodeLine{02066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Look\ if\ the\ parent\ is\ owned\ by\ another\ block}}
\DoxyCodeLine{02067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ firstOtherBlock\ =\ nbBlocksBeforeMinPerLevel[idxLevel]-\/1;}
\DoxyCodeLine{02068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(processesBlockInfos[idxLevel][firstOtherBlock].lastIndex-\/1\ ==\ missingParentIdx);}
\DoxyCodeLine{02069\ }
\DoxyCodeLine{02070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteCellGroups[idxLevel][firstOtherBlock].ptrSymb\ ==\ \textcolor{keyword}{nullptr})\{}
\DoxyCodeLine{02071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ nbBytesInBlock\ =\ processesBlockInfos[idxLevel][firstOtherBlock].bufferSizeSymb;}
\DoxyCodeLine{02072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*\ memoryBlock\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)FAlignedMemory::AllocateBytes<32>(nbBytesInBlock);}
\DoxyCodeLine{02073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ remoteCellGroups[idxLevel][firstOtherBlock].ptrSymb\ =\ memoryBlock;}
\DoxyCodeLine{02074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_variable\_data\_register(\&remoteCellGroups[idxLevel][firstOtherBlock].handleSymb,\ 0,}
\DoxyCodeLine{02075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uintptr\_t)remoteCellGroups[idxLevel][firstOtherBlock].ptrSymb,\ nbBytesInBlock);}
\DoxyCodeLine{02076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(remoteCellGroups[idxLevel][firstOtherBlock].ptrDown\ ==\ \textcolor{keyword}{nullptr})\{}
\DoxyCodeLine{02078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ nbBytesInBlock\ =\ processesBlockInfos[idxLevel][firstOtherBlock].bufferSizeDown;}
\DoxyCodeLine{02079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*\ memoryBlock\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)FAlignedMemory::AllocateBytes<32>(nbBytesInBlock);}
\DoxyCodeLine{02080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ remoteCellGroups[idxLevel][firstOtherBlock].ptrDown\ =\ memoryBlock;}
\DoxyCodeLine{02081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_variable\_data\_register(\&remoteCellGroups[idxLevel][firstOtherBlock].handleDown,\ 0,}
\DoxyCodeLine{02082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uintptr\_t)remoteCellGroups[idxLevel][firstOtherBlock].ptrDown,\ nbBytesInBlock);}
\DoxyCodeLine{02083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02084\ }
\DoxyCodeLine{02085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}[SMpi]\ "{}}\ <<\ idxLevel\ <<\ \textcolor{stringliteral}{"{}\ Post\ a\ recv\ during\ L2L\ for\ Idx\ "{}}\ <<\ processesBlockInfos[idxLevel][firstOtherBlock].firstIndex\ <<}
\DoxyCodeLine{02086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ and\ owner\ "{}}\ <<\ processesBlockInfos[idxLevel][firstOtherBlock].owner}
\DoxyCodeLine{02087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ size\ "{}}\ <<\ processesBlockInfos[idxLevel][firstOtherBlock].bufferSizeSymb}
\DoxyCodeLine{02088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ tag\ "{}}\ <<\ getTag(idxLevel,\ processesBlockInfos[idxLevel][firstOtherBlock].firstIndex,\ processesBlockInfos[idxLevel][firstOtherBlock].globalIdx,\ 0,\ processesBlockInfos[idxLevel][firstOtherBlock].owner)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{02089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FLOG(FLog::Controller\ <<\ \textcolor{stringliteral}{"{}[SMpi]\ "{}}\ <<\ idxLevel\ <<\ \textcolor{stringliteral}{"{}\ Post\ a\ recv\ during\ L2L\ for\ Idx\ "{}}\ <<\ processesBlockInfos[idxLevel][firstOtherBlock].firstIndex\ <<}
\DoxyCodeLine{02090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ and\ owner\ "{}}\ <<\ processesBlockInfos[idxLevel][firstOtherBlock].owner}
\DoxyCodeLine{02091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ size\ "{}}\ <<\ processesBlockInfos[idxLevel][firstOtherBlock].bufferSizeDown}
\DoxyCodeLine{02092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ tag\ "{}}\ <<\ getTag(idxLevel,\ processesBlockInfos[idxLevel][firstOtherBlock].firstIndex,\ processesBlockInfos[idxLevel][firstOtherBlock].globalIdx,\ 2,\ processesBlockInfos[idxLevel][firstOtherBlock].owner)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{02093\ }
\DoxyCodeLine{02094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_mpi\_irecv\_detached\ (\ remoteCellGroups[idxLevel][firstOtherBlock].handleSymb,}
\DoxyCodeLine{02095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processesBlockInfos[idxLevel][firstOtherBlock].owner,}
\DoxyCodeLine{02096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getTag(idxLevel,\ processesBlockInfos[idxLevel][firstOtherBlock].firstIndex,\ processesBlockInfos[idxLevel][firstOtherBlock].globalIdx,\ 0,\ processesBlockInfos[idxLevel][firstOtherBlock].owner),}
\DoxyCodeLine{02097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ 0\textcolor{comment}{/*callback*/},\ 0\textcolor{comment}{/*arg*/}\ );}
\DoxyCodeLine{02098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_mpi\_irecv\_detached\ (\ remoteCellGroups[idxLevel][firstOtherBlock].handleDown,}
\DoxyCodeLine{02099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processesBlockInfos[idxLevel][firstOtherBlock].owner,}
\DoxyCodeLine{02100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getTag(idxLevel,\ processesBlockInfos[idxLevel][firstOtherBlock].firstIndex,\ processesBlockInfos[idxLevel][firstOtherBlock].globalIdx,\ 2,\ processesBlockInfos[idxLevel][firstOtherBlock].owner),}
\DoxyCodeLine{02101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm.\mbox{\hyperlink{class_f_mpi_1_1_f_comm_afcb765b869e75a6bc6d458cd79bd34a2}{getComm}}(),\ 0\textcolor{comment}{/*callback*/},\ 0\textcolor{comment}{/*arg*/}\ );}
\DoxyCodeLine{02102\ }
\DoxyCodeLine{02103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ parentStartingIdx\ =\ processesBlockInfos[idxLevel][firstOtherBlock].firstIndex;}
\DoxyCodeLine{02105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ MortonIndex\ parentEndingIdx\ =\ processesBlockInfos[idxLevel][firstOtherBlock].lastIndex;}
\DoxyCodeLine{02106\ }
\DoxyCodeLine{02107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idxSubGroup\ =\ 0;}
\DoxyCodeLine{02108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ current\ group\ if\ needed}}
\DoxyCodeLine{02109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ tree-\/>getCellGroup(idxLevel+1,\ idxSubGroup)-\/>getEndingIndex()\ <=\ (parentStartingIdx<<3)\ )\{}
\DoxyCodeLine{02110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++idxSubGroup;}
\DoxyCodeLine{02111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(\ idxSubGroup\ !=\ tree-\/>getNbCellGroupAtLevel(idxLevel+1)\ );}
\DoxyCodeLine{02112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(\ (tree-\/>getCellGroup(idxLevel+1,\ idxSubGroup)-\/>getStartingIndex()>>3)\ ==\ parentStartingIdx\ );}
\DoxyCodeLine{02113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ at\ max\ 8\ groups}}
\DoxyCodeLine{02115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nbSubCellGroups\ =\ 0;}
\DoxyCodeLine{02116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }starpu\_task*\ \textcolor{keyword}{const}\ task\ =\ starpu\_task\_create();}
\DoxyCodeLine{02118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles\ =\ (starpu\_data\_handle\_t*)malloc(\textcolor{keyword}{sizeof}(starpu\_data\_handle\_t)*20);}
\DoxyCodeLine{02119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[0]\ =\ remoteCellGroups[idxLevel][firstOtherBlock].handleSymb;}
\DoxyCodeLine{02120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[1]\ =\ remoteCellGroups[idxLevel][firstOtherBlock].handleDown;}
\DoxyCodeLine{02121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[2]\ =\ cellHandles[idxLevel+1][idxSubGroup].symb;}
\DoxyCodeLine{02122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[3]\ =\ cellHandles[idxLevel+1][idxSubGroup].down;}
\DoxyCodeLine{02123\ }
\DoxyCodeLine{02124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ the\ right\ codelet}}
\DoxyCodeLine{02125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\ =\ \&l2l\_cl;}
\DoxyCodeLine{02126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ args\ values}}
\DoxyCodeLine{02127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *arg\_buffer;}
\DoxyCodeLine{02128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ arg\_buffer\_size;}
\DoxyCodeLine{02129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_codelet\_pack\_args((\textcolor{keywordtype}{void}**)\&arg\_buffer,\ \&arg\_buffer\_size,}
\DoxyCodeLine{02130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{02131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&idxLevel,\ \textcolor{keyword}{sizeof}(idxLevel),}
\DoxyCodeLine{02132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&remoteCellGroups[idxLevel][firstOtherBlock].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),\textcolor{comment}{//\ TODO\ !}}
\DoxyCodeLine{02133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{02134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\ =\ arg\_buffer;}
\DoxyCodeLine{02135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\_size\ =\ arg\_buffer\_size;}
\DoxyCodeLine{02136\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}}
\DoxyCodeLine{02137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>priority\ =\ PrioClass::Controller().getInsertionPosL2L(idxLevel);}
\DoxyCodeLine{02138\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02139\ \textcolor{preprocessor}{\ \ \ \ \#ifdef\ STARPU\_USE\_TASK\_NAME}}
\DoxyCodeLine{02140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>name\ =\ l2lTaskNames[idxLevel].get();}
\DoxyCodeLine{02141\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{02142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(starpu\_task\_submit(task)\ ==\ 0);}
\DoxyCodeLine{02143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02144\ }
\DoxyCodeLine{02145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nbSubCellGroups\ +=\ 1;}
\DoxyCodeLine{02146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(tree-\/>getCellGroup(idxLevel+1,\ idxSubGroup)-\/>getEndingIndex()\ <=\ ((parentEndingIdx<<3)+7)}
\DoxyCodeLine{02147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ (idxSubGroup\ +\ 1)\ !=\ tree-\/>getNbCellGroupAtLevel(idxLevel+1)}
\DoxyCodeLine{02148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ tree-\/>getCellGroup(idxLevel+1,\ idxSubGroup+1)-\/>getStartingIndex()\ <=\ (parentEndingIdx<<3)+7\ )\{}
\DoxyCodeLine{02149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idxSubGroup\ +=\ 1;}
\DoxyCodeLine{02150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }starpu\_task*\ \textcolor{keyword}{const}\ task\ =\ starpu\_task\_create();}
\DoxyCodeLine{02151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles\ =\ (starpu\_data\_handle\_t*)malloc(\textcolor{keyword}{sizeof}(starpu\_data\_handle\_t)*20);}
\DoxyCodeLine{02152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[0]\ =\ remoteCellGroups[idxLevel][firstOtherBlock].handleSymb;}
\DoxyCodeLine{02153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[1]\ =\ remoteCellGroups[idxLevel][firstOtherBlock].handleDown;}
\DoxyCodeLine{02154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[2]\ =\ cellHandles[idxLevel+1][idxSubGroup].symb;}
\DoxyCodeLine{02155\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[3]\ =\ cellHandles[idxLevel+1][idxSubGroup].down;}
\DoxyCodeLine{02156\ }
\DoxyCodeLine{02157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ the\ right\ codelet}}
\DoxyCodeLine{02158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\ =\ \&l2l\_cl;}
\DoxyCodeLine{02159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ args\ values}}
\DoxyCodeLine{02160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *arg\_buffer;}
\DoxyCodeLine{02161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ arg\_buffer\_size;}
\DoxyCodeLine{02162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_codelet\_pack\_args((\textcolor{keywordtype}{void}**)\&arg\_buffer,\ \&arg\_buffer\_size,}
\DoxyCodeLine{02163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{02164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&idxLevel,\ \textcolor{keyword}{sizeof}(idxLevel),}
\DoxyCodeLine{02165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&remoteCellGroups[idxLevel][firstOtherBlock].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),\textcolor{comment}{//\ TODO\ !}}
\DoxyCodeLine{02166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{02167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\ =\ arg\_buffer;}
\DoxyCodeLine{02168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\_size\ =\ arg\_buffer\_size;}
\DoxyCodeLine{02169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\_free\ =\ 1;}
\DoxyCodeLine{02170\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}}
\DoxyCodeLine{02171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>priority\ =\ PrioClass::Controller().getInsertionPosL2L(idxLevel);}
\DoxyCodeLine{02172\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02173\ \textcolor{preprocessor}{\ \ \ \ \#ifdef\ STARPU\_USE\_TASK\_NAME}}
\DoxyCodeLine{02174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>name\ =\ l2lTaskNames[idxLevel].get();}
\DoxyCodeLine{02175\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{02176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(starpu\_task\_submit(task)\ ==\ 0);}
\DoxyCodeLine{02177\ }
\DoxyCodeLine{02178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nbSubCellGroups\ +=\ 1;}
\DoxyCodeLine{02179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(\ nbSubCellGroups\ <=\ 9\ );}
\DoxyCodeLine{02180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02183\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02185\ }
\DoxyCodeLine{02186\ }
\DoxyCodeLine{02187\ }
\DoxyCodeLine{02188\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idxSubGroup\ =\ 0;}
\DoxyCodeLine{02189\ }
\DoxyCodeLine{02190\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbCellGroupAtLevel(idxLevel)}
\DoxyCodeLine{02191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ idxSubGroup\ <\ tree-\/>getNbCellGroupAtLevel(idxLevel+1)\ ;\ ++idxGroup)\{}
\DoxyCodeLine{02192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CellContainerClass*\textcolor{keyword}{const}\ currentCells\ =\ tree-\/>getCellGroup(idxLevel,\ idxGroup);}
\DoxyCodeLine{02193\ }
\DoxyCodeLine{02194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ current\ group\ if\ needed}}
\DoxyCodeLine{02195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ tree-\/>getCellGroup(idxLevel+1,\ idxSubGroup)-\/>getEndingIndex()\ <=\ (currentCells-\/>getStartingIndex()<<3)\ )\{}
\DoxyCodeLine{02196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++idxSubGroup;}
\DoxyCodeLine{02197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(\ idxSubGroup\ !=\ tree-\/>getNbCellGroupAtLevel(idxLevel+1)\ );}
\DoxyCodeLine{02198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(\ (tree-\/>getCellGroup(idxLevel+1,\ idxSubGroup)-\/>getStartingIndex()>>3)\ ==\ currentCells-\/>getStartingIndex()\ );}
\DoxyCodeLine{02199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ at\ max\ 8\ groups}}
\DoxyCodeLine{02201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }starpu\_task*\ \textcolor{keyword}{const}\ task\ =\ starpu\_task\_create();}
\DoxyCodeLine{02203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles\ =\ (starpu\_data\_handle\_t*)malloc(\textcolor{keyword}{sizeof}(starpu\_data\_handle\_t)*20);}
\DoxyCodeLine{02204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[0]\ =\ cellHandles[idxLevel][idxGroup].symb;}
\DoxyCodeLine{02205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[1]\ =\ cellHandles[idxLevel][idxGroup].down;}
\DoxyCodeLine{02206\ }
\DoxyCodeLine{02207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[2]\ =\ cellHandles[idxLevel+1][idxSubGroup].symb;}
\DoxyCodeLine{02208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[3]\ =\ cellHandles[idxLevel+1][idxSubGroup].down;}
\DoxyCodeLine{02209\ }
\DoxyCodeLine{02210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ the\ right\ codelet}}
\DoxyCodeLine{02211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}((noCommuteAtLastLevel\ \&\&\ (idxLevel\ ==\ \mbox{\hyperlink{class_f_abstract_algorithm_a694b8888186be58e38691ce08b177d46}{FAbstractAlgorithm::lowerWorkingLevel}}\ -\/\ 2))\ ||\ noCommuteBetweenLevel)\{}
\DoxyCodeLine{02212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\ =\ \&l2l\_cl\_nocommute;}
\DoxyCodeLine{02213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{02215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\ =\ \&l2l\_cl;}
\DoxyCodeLine{02216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ args\ values}}
\DoxyCodeLine{02218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *arg\_buffer;}
\DoxyCodeLine{02219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ arg\_buffer\_size;}
\DoxyCodeLine{02220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_codelet\_pack\_args((\textcolor{keywordtype}{void}**)\&arg\_buffer,\ \&arg\_buffer\_size,}
\DoxyCodeLine{02221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{02222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&idxLevel,\ \textcolor{keyword}{sizeof}(idxLevel),}
\DoxyCodeLine{02223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&cellHandles[idxLevel][idxGroup].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{02224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{02225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\ =\ arg\_buffer;}
\DoxyCodeLine{02226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\_size\ =\ arg\_buffer\_size;}
\DoxyCodeLine{02227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\_free\ =\ 1;}
\DoxyCodeLine{02228\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}}
\DoxyCodeLine{02229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>priority\ =\ PrioClass::Controller().getInsertionPosL2L(idxLevel);}
\DoxyCodeLine{02230\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02231\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_TASK\_NAME}}
\DoxyCodeLine{02232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>name\ =\ l2lTaskNames[idxLevel].get();}
\DoxyCodeLine{02233\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(starpu\_task\_submit(task)\ ==\ 0);}
\DoxyCodeLine{02235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(tree-\/>getCellGroup(idxLevel+1,\ idxSubGroup)-\/>getEndingIndex()\ <=\ (((currentCells-\/>getEndingIndex()-\/1)<<3)+7)}
\DoxyCodeLine{02237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ (idxSubGroup+1)\ !=\ tree-\/>getNbCellGroupAtLevel(idxLevel+1)}
\DoxyCodeLine{02238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ tree-\/>getCellGroup(idxLevel+1,\ idxSubGroup+1)-\/>getStartingIndex()\ <=\ ((currentCells-\/>getEndingIndex()-\/1)<<3)+7\ )\{}
\DoxyCodeLine{02239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idxSubGroup\ +=\ 1;}
\DoxyCodeLine{02240\ }
\DoxyCodeLine{02241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }starpu\_task*\ \textcolor{keyword}{const}\ task\ =\ starpu\_task\_create();}
\DoxyCodeLine{02242\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles\ =\ (starpu\_data\_handle\_t*)malloc(\textcolor{keyword}{sizeof}(starpu\_data\_handle\_t)*20);}
\DoxyCodeLine{02243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[0]\ =\ cellHandles[idxLevel][idxGroup].symb;}
\DoxyCodeLine{02244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[1]\ =\ cellHandles[idxLevel][idxGroup].down;}
\DoxyCodeLine{02245\ }
\DoxyCodeLine{02246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[2]\ =\ cellHandles[idxLevel+1][idxSubGroup].symb;}
\DoxyCodeLine{02247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>dyn\_handles[3]\ =\ cellHandles[idxLevel+1][idxSubGroup].down;}
\DoxyCodeLine{02248\ }
\DoxyCodeLine{02249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ the\ right\ codelet}}
\DoxyCodeLine{02250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}((noCommuteAtLastLevel\ \&\&\ (idxLevel\ ==\ \mbox{\hyperlink{class_f_abstract_algorithm_a694b8888186be58e38691ce08b177d46}{FAbstractAlgorithm::lowerWorkingLevel}}\ -\/\ 2))\ ||\ noCommuteBetweenLevel)\{}
\DoxyCodeLine{02251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\ =\ \&l2l\_cl\_nocommute;}
\DoxyCodeLine{02252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{02254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\ =\ \&l2l\_cl;}
\DoxyCodeLine{02255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ put\ args\ values}}
\DoxyCodeLine{02257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *arg\_buffer;}
\DoxyCodeLine{02258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ arg\_buffer\_size;}
\DoxyCodeLine{02259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_codelet\_pack\_args((\textcolor{keywordtype}{void}**)\&arg\_buffer,\ \&arg\_buffer\_size,}
\DoxyCodeLine{02260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{02261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&idxLevel,\ \textcolor{keyword}{sizeof}(idxLevel),}
\DoxyCodeLine{02262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&cellHandles[idxLevel][idxGroup].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{02263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{02264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\ =\ arg\_buffer;}
\DoxyCodeLine{02265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\_size\ =\ arg\_buffer\_size;}
\DoxyCodeLine{02266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>cl\_arg\_free\ =\ 1;}
\DoxyCodeLine{02267\ \textcolor{preprocessor}{\#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}}
\DoxyCodeLine{02268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>priority\ =\ PrioClass::Controller().getInsertionPosL2L(idxLevel);}
\DoxyCodeLine{02269\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02270\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_TASK\_NAME}}
\DoxyCodeLine{02271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task-\/>name\ =\ l2lTaskNames[idxLevel].get();}
\DoxyCodeLine{02272\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FAssertLF(starpu\_task\_submit(task)\ ==\ 0);}
\DoxyCodeLine{02274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02275\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02276\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02277\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ downardPass\ in\ "{}}\ <<\ timer.tacAndElapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{02278\ \ \ \ \ \}}
\DoxyCodeLine{02282\ }
\DoxyCodeLine{02283\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a0afee8f5cab97a6908a3460df2a35cd5}{directPassMpi}}()\{}
\DoxyCodeLine{02284\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timer;\ );}
\DoxyCodeLine{02285\ }
\DoxyCodeLine{02286\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbParticleGroup()\ ;\ ++idxGroup)\{}
\DoxyCodeLine{02287\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxInteraction\ =\ 0;\ idxInteraction\ <\ int(externalInteractionsLeafLevelMpi[idxGroup].size())\ ;\ ++idxInteraction)\{}
\DoxyCodeLine{02288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ interactionid\ =\ externalInteractionsLeafLevelMpi[idxGroup][idxInteraction].otherBlockId;}
\DoxyCodeLine{02289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<OutOfBlockInteraction>*\ outsideInteractions\ =\ \&externalInteractionsLeafLevelMpi[idxGroup][idxInteraction].interactions;}
\DoxyCodeLine{02290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_insert\_task(\&p2p\_cl\_inout\_mpi,}
\DoxyCodeLine{02291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{02292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&outsideInteractions,\ \textcolor{keyword}{sizeof}(outsideInteractions),}
\DoxyCodeLine{02293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&particleHandles[idxGroup].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{02294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}
\DoxyCodeLine{02295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_PRIORITY,\ PrioClass::Controller().getInsertionPosP2PExtern(),}
\DoxyCodeLine{02296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{02297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ particleHandles[idxGroup].symb,}
\DoxyCodeLine{02298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED),\ particleHandles[idxGroup].down,}
\DoxyCodeLine{02299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ remoteParticleGroupss[interactionid].handleSymb,}
\DoxyCodeLine{02300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_TASK\_NAME}
\DoxyCodeLine{02301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_NAME,\ p2pOuterTaskNames.get(),}
\DoxyCodeLine{02302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{02303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{02304\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02305\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02306\ }
\DoxyCodeLine{02307\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ directPass\ in\ MPI\ "{}}\ <<\ timer.tacAndElapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{02308\ \ \ \ \ \}}
\DoxyCodeLine{02309\ }
\DoxyCodeLine{02313\ }
\DoxyCodeLine{02314\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a7a5a4b62e687f54aaea1065c9e7e8ee8}{directPass}}()\{}
\DoxyCodeLine{02315\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timer;\ );}
\DoxyCodeLine{02316\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timerInBlock;\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timerOutBlock;\ );}
\DoxyCodeLine{02317\ }
\DoxyCodeLine{02318\ \ \ \ \ \ \ \ \ FLOG(\ timerOutBlock.tic()\ );}
\DoxyCodeLine{02319\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbParticleGroup()\ ;\ ++idxGroup)\{}
\DoxyCodeLine{02320\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxInteraction\ =\ 0;\ idxInteraction\ <\ int(externalInteractionsLeafLevel[idxGroup].size())\ ;\ ++idxInteraction)\{}
\DoxyCodeLine{02321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ interactionid\ =\ externalInteractionsLeafLevel[idxGroup][idxInteraction].otherBlockId;}
\DoxyCodeLine{02322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<OutOfBlockInteraction>*\ outsideInteractions\ =\ \&externalInteractionsLeafLevel[idxGroup][idxInteraction].interactions;}
\DoxyCodeLine{02323\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_insert\_task(\&p2p\_cl\_inout,}
\DoxyCodeLine{02324\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{02325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&outsideInteractions,\ \textcolor{keyword}{sizeof}(outsideInteractions),}
\DoxyCodeLine{02326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&particleHandles[idxGroup].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{02327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}
\DoxyCodeLine{02328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_PRIORITY,\ PrioClass::Controller().getInsertionPosP2PExtern(),}
\DoxyCodeLine{02329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{02330\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ particleHandles[idxGroup].symb,}
\DoxyCodeLine{02331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_REDUX}
\DoxyCodeLine{02332\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_REDUX,\ particleHandles[idxGroup].down,}
\DoxyCodeLine{02333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#\textcolor{keywordflow}{else}}
\DoxyCodeLine{02334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED),\ particleHandles[idxGroup].down,}
\DoxyCodeLine{02335\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{02336\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ particleHandles[interactionid].symb,}
\DoxyCodeLine{02337\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_REDUX}
\DoxyCodeLine{02338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_REDUX,\ particleHandles[interactionid].down,}
\DoxyCodeLine{02339\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#\textcolor{keywordflow}{else}}
\DoxyCodeLine{02340\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED),\ particleHandles[interactionid].down,}
\DoxyCodeLine{02341\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{02342\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_TASK\_NAME}
\DoxyCodeLine{02343\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_NAME,\ p2pOuterTaskNames.get(),}
\DoxyCodeLine{02344\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{02345\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{02346\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02347\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02348\ \ \ \ \ \ \ \ \ FLOG(\ timerOutBlock.tac()\ );}
\DoxyCodeLine{02349\ \ \ \ \ \ \ \ \ FLOG(\ timerInBlock.tic()\ );}
\DoxyCodeLine{02350\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbParticleGroup()\ ;\ ++idxGroup)\{}
\DoxyCodeLine{02351\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_insert\_task(\&p2p\_cl\_in,}
\DoxyCodeLine{02352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{02353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&particleHandles[idxGroup].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{02354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}
\DoxyCodeLine{02355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_PRIORITY,\ PrioClass::Controller().getInsertionPosP2P(),}
\DoxyCodeLine{02356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{02357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ particleHandles[idxGroup].symb,}
\DoxyCodeLine{02358\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_REDUX}
\DoxyCodeLine{02359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_REDUX,\ particleHandles[idxGroup].down,}
\DoxyCodeLine{02360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#\textcolor{keywordflow}{else}}
\DoxyCodeLine{02361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED),\ particleHandles[idxGroup].down,}
\DoxyCodeLine{02362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{02363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_TASK\_NAME}
\DoxyCodeLine{02364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_NAME,\ p2pTaskNames.get(),}
\DoxyCodeLine{02365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{02366\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{02367\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02368\ \ \ \ \ \ \ \ \ FLOG(\ timerInBlock.tac()\ );}
\DoxyCodeLine{02369\ }
\DoxyCodeLine{02370\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ directPass\ in\ "{}}\ <<\ timer.tacAndElapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{02371\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\(\backslash\)t\ inblock\ \ in\ "{}}\ <<\ timerInBlock.elapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{02372\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\(\backslash\)t\ outblock\ in\ "{}}\ <<\ timerOutBlock.elapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{02373\ \ \ \ \ \}}
\DoxyCodeLine{02377\ }
\DoxyCodeLine{02378\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_group_task_star_p_u_mpi_algorithm_a4bd5a7c960dff137571ee45ca2d3fd4c}{mergePass}}()\{}
\DoxyCodeLine{02379\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timer;\ );}
\DoxyCodeLine{02380\ }
\DoxyCodeLine{02381\ \ \ \ \ \ \ \ \ FAssertLF(cellHandles[tree-\/>getHeight()-\/1].size()\ ==\ particleHandles.size());}
\DoxyCodeLine{02382\ }
\DoxyCodeLine{02383\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbParticleGroup()\ ;\ ++idxGroup)\{}
\DoxyCodeLine{02384\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_insert\_task(\&l2p\_cl,}
\DoxyCodeLine{02385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&wrapperptr,\ \textcolor{keyword}{sizeof}(wrapperptr),}
\DoxyCodeLine{02386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_VALUE,\ \&cellHandles[tree-\/>getHeight()-\/1][idxGroup].intervalSize,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),}
\DoxyCodeLine{02387\ \ \ \ \ \ \ \ \ \#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}
\DoxyCodeLine{02388\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_PRIORITY,\ PrioClass::Controller().getInsertionPosL2P(),}
\DoxyCodeLine{02389\ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{02390\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ cellHandles[tree-\/>getHeight()-\/1][idxGroup].symb,}
\DoxyCodeLine{02391\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ cellHandles[tree-\/>getHeight()-\/1][idxGroup].down,}
\DoxyCodeLine{02392\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ particleHandles[idxGroup].symb,}
\DoxyCodeLine{02393\ \ \ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_REDUX}
\DoxyCodeLine{02394\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_REDUX,\ particleHandles[idxGroup].down,}
\DoxyCodeLine{02395\ \ \ \ \ \ \ \ \ \#else}
\DoxyCodeLine{02396\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (STARPU\_RW|STARPU\_COMMUTE\_IF\_SUPPORTED),\ particleHandles[idxGroup].down,}
\DoxyCodeLine{02397\ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{02398\ \ \ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_TASK\_NAME}
\DoxyCodeLine{02399\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_NAME,\ l2pTaskNames.get(),}
\DoxyCodeLine{02400\ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{02401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{02402\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02403\ }
\DoxyCodeLine{02404\ \ \ \ \ \ \ \ \ FLOG(\ FLog::Controller\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t\ L2P\ in\ "{}}\ <<\ timer.tacAndElapsed()\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ );}
\DoxyCodeLine{02405\ \ \ \ \ \}}
\DoxyCodeLine{02406\ }
\DoxyCodeLine{02407\ }
\DoxyCodeLine{02408\ \textcolor{preprocessor}{\#ifdef\ STARPU\_USE\_REDUX}}
\DoxyCodeLine{02409\ \ \ \ \ \textcolor{keywordtype}{void}\ readParticle()\{}
\DoxyCodeLine{02410\ \ \ \ \ \ \ \ \ FLOG(\ \mbox{\hyperlink{class_f_tic}{FTic}}\ timer;\ );}
\DoxyCodeLine{02411\ }
\DoxyCodeLine{02412\ \ \ \ \ \ \ \ \ FAssertLF(cellHandles[tree-\/>getHeight()-\/1].size()\ ==\ particleHandles.size());}
\DoxyCodeLine{02413\ }
\DoxyCodeLine{02414\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxGroup\ =\ 0\ ;\ idxGroup\ <\ tree-\/>getNbParticleGroup()\ ;\ ++idxGroup)\{}
\DoxyCodeLine{02415\ \ \ \ \ \ \ \ \ \ \ \ \ starpu\_insert\_task(\&p2p\_redux\_read,}
\DoxyCodeLine{02416\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ SCALFMM\_STARPU\_USE\_PRIO}
\DoxyCodeLine{02417\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_PRIORITY,\ PrioClass::Controller().getInsertionPosL2P(),}
\DoxyCodeLine{02418\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{02419\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_R,\ particleHandles[idxGroup].down,}
\DoxyCodeLine{02420\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ STARPU\_USE\_TASK\_NAME}
\DoxyCodeLine{02421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STARPU\_NAME,\ \textcolor{stringliteral}{"{}read-\/particle"{}},}
\DoxyCodeLine{02422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{02423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{02424\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02425\ \ \ \ \ \}}
\DoxyCodeLine{02426\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02427\ \};}
\DoxyCodeLine{02428\ }
\DoxyCodeLine{02429\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ FGROUPTASKSTARPUMPIALGORITHM\_HPP}}

\end{DoxyCode}
