\doxysection{FInterp\+Matrix\+Kernel\+\_\+\+Tensorial\+Interactions.\+hpp}
\hypertarget{_f_interp_matrix_kernel___tensorial_interactions_8hpp_source}{}\label{_f_interp_matrix_kernel___tensorial_interactions_8hpp_source}\index{third\_party/ScalFMM/include/ScalFMM/Kernels/Interpolation/FInterpMatrixKernel\_TensorialInteractions.hpp@{third\_party/ScalFMM/include/ScalFMM/Kernels/Interpolation/FInterpMatrixKernel\_TensorialInteractions.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ See\ LICENCE\ file\ at\ project\ root}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#ifndef\ FINTERPMATRIXKERNEL\_TENSORIAL\_INTERACTIONS\_HPP}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#define\ FINTERPMATRIXKERNEL\_TENSORIAL\_INTERACTIONS\_HPP}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <stdexcept>}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}Utils/FPoint.hpp"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}Utils/FNoCopyable.hpp"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}Utils/FMath.hpp"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}Utils/FGlobal.hpp"{}}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}FInterpMatrixKernel.hpp"{}}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00071\ \textcolor{comment}{//\ Tensorial\ Matrix\ Kernels\ (NCMP>1)}}
\DoxyCodeLine{00072\ \textcolor{comment}{//}}
\DoxyCodeLine{00073\ \textcolor{comment}{//\ The\ definition\ of\ the\ potential\ p\ and\ force\ f\ are\ extended\ to\ the\ case}}
\DoxyCodeLine{00074\ \textcolor{comment}{//\ of\ tensorial\ interaction\ kernels:}}
\DoxyCodeLine{00075\ \textcolor{comment}{//\ p\_i(x)\ =\ K\_\{ip\}(x,y)w\_p(y),\ \(\backslash\)forall\ i=1..NPOT,\ p=1..NPV}}
\DoxyCodeLine{00076\ \textcolor{comment}{//\ f\_\{ik\}=\ w\_p(x)K\_\{ip,k\}(x,y)w\_p(y)\ "{}}}
\DoxyCodeLine{00077\ \textcolor{comment}{//}}
\DoxyCodeLine{00078\ \textcolor{comment}{//\ Since\ the\ interpolation\ scheme\ is\ such\ that}}
\DoxyCodeLine{00079\ \textcolor{comment}{//\ p\_i(x)\ \(\backslash\)approx\ S\string^m(x)\ L\string^\{m\}\_\{ip\}}}
\DoxyCodeLine{00080\ \textcolor{comment}{//\ f\_\{ik\}=\ w\_p(x)\ \(\backslash\)nabla\_k\ S\string^m(x)\ L\string^\{m\}\_\{ip\}}}
\DoxyCodeLine{00081\ \textcolor{comment}{//\ with}}
\DoxyCodeLine{00082\ \textcolor{comment}{//\ L\string^\{m\}\_\{ip\}\ =\ K\string^\{mn\}\_\{ip\}\ S\string^n(y)\ w\_p(y)\ (local\ expansion)}}
\DoxyCodeLine{00083\ \textcolor{comment}{//\ M\string^\{m\}\_\{p\}\ =\ S\string^n(y)\ w\_p(y)\ (multipole\ expansion)}}
\DoxyCodeLine{00084\ \textcolor{comment}{//\ then\ the\ multipole\ exp\ have\ NPV\ components\ and\ the\ local\ exp\ NPOT*NPV.}}
\DoxyCodeLine{00085\ \textcolor{comment}{//}}
\DoxyCodeLine{00086\ \textcolor{comment}{//\ NB1:\ Only\ the\ computation\ of\ forces\ requires\ that\ the\ sum\ over\ p\ is\ }}
\DoxyCodeLine{00087\ \textcolor{comment}{//\ performed\ at\ L2P\ step.\ It\ could\ be\ done\ at\ M2L\ step\ for\ the\ potential.}}
\DoxyCodeLine{00088\ \textcolor{comment}{//}}
\DoxyCodeLine{00089\ \textcolor{comment}{//\ NB2:\ An\ efficient\ application\ of\ the\ matrix\ kernel\ is\ highly\ kernel\ }}
\DoxyCodeLine{00090\ \textcolor{comment}{//\ dependent,\ we\ recommand\ overriding\ the\ P2M/M2L/L2P\ function\ of\ the\ kernel\ }}
\DoxyCodeLine{00091\ \textcolor{comment}{//\ you\ are\ using\ in\ order\ to\ have\ opsimal\ performances\ +\ set\ your\ own\ NRHS/NLHS.}}
\DoxyCodeLine{00092\ \textcolor{comment}{//}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00098\ \textcolor{comment}{//\ PB:\ IMPORTANT!\ This\ matrix\ kernel\ does\ not\ present\ the\ symmetries\ }}
\DoxyCodeLine{00099\ \textcolor{comment}{//\ required\ by\ ChebSym\ kernel\ =>\ only\ suited\ for\ Unif\ interpolation}}
\DoxyCodeLine{00100\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal>}
\DoxyCodeLine{00101\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_f_interp_matrix_kernel___r___i_j}{FInterpMatrixKernel\_R\_IJ}}\ :\ \mbox{\hyperlink{struct_f_interp_abstract_matrix_kernel}{FInterpAbstractMatrixKernel}}<FReal>}
\DoxyCodeLine{00102\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ KERNEL\_FUNCTION\_TYPE\ Type\ =\ NON\_HOMOGENEOUS;}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ NK\ \ \ =\ 3*3;\ \textcolor{comment}{//<\ total\ number\ of\ components}}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ NCMP\ =\ 6;\ \ \ \textcolor{comment}{//<\ number\ of\ independent\ components}}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ NPV\ \ =\ 3;\ \ \ \textcolor{comment}{//<\ dim\ of\ physical\ values}}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ NPOT\ =\ 3;\ \ \ \textcolor{comment}{//<\ dim\ of\ potentials}}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ NRHS\ =\ NPV;\ \textcolor{comment}{//<\ dim\ of\ mult\ exp}}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ NLHS\ =\ NPOT*NPV;\ \textcolor{comment}{//<\ dim\ of\ loc\ exp\ (no\ csummation\ over\ j\ during\ M2L)}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{comment}{//\ store\ indices\ (i,j)\ corresponding\ to\ sym\ idx}}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{struct_f_interp_matrix_kernel___r___i_j_a499660d8129a2491ff0566137d1f9d68}{indexTab}}[\textcolor{comment}{/*2*NCMP=12*/}];}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{comment}{//\ store\ positions\ in\ sym\ tensor\ (when\ looping\ over\ NRHSxNLHS)}}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ applyTab[\textcolor{comment}{/*NK=9*/}];}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{comment}{//\ indices\ to\ be\ set\ at\ construction\ if\ component-\/wise\ evaluation\ is\ performed}}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \_i,\_j;}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{comment}{//\ Material\ Parameters}}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keyword}{const}\ FReal\ \_CoreWidth2;\ \textcolor{comment}{//\ if\ >0\ then\ kernel\ is\ NON\ homogeneous}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \ \ \mbox{\hyperlink{struct_f_interp_matrix_kernel___r___i_j}{FInterpMatrixKernel\_R\_IJ}}(\textcolor{keyword}{const}\ FReal\ CoreWidth\ =\ 0.0,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ d\ =\ 0)}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ :\ \_i(\mbox{\hyperlink{struct_f_interp_matrix_kernel___r___i_j_a499660d8129a2491ff0566137d1f9d68}{indexTab}}[d]),\ \_j(\mbox{\hyperlink{struct_f_interp_matrix_kernel___r___i_j_a499660d8129a2491ff0566137d1f9d68}{indexTab}}[d+NCMP]),\ \_CoreWidth2(CoreWidth*CoreWidth)}
\DoxyCodeLine{00125\ \ \ \ \ \{\}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{comment}{//\ copy\ ctor}}
\DoxyCodeLine{00128\ \ \ \ \ \mbox{\hyperlink{struct_f_interp_matrix_kernel___r___i_j}{FInterpMatrixKernel\_R\_IJ}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{struct_f_interp_matrix_kernel___r___i_j}{FInterpMatrixKernel\_R\_IJ}}\&\ other)}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ :\ \_i(other.\_i),\ \_j(other.\_j),\ \_CoreWidth2(other.\_CoreWidth2)}
\DoxyCodeLine{00130\ \ \ \ \ \{\}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ getID()\ \{\ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}R\_IJ"{}};\ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ printInfo()\ \{\ }
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}K\_ij(x,y)=r\_\{,ij\}=d\string^2/dx\_idx\_j(r),\ with\ r=|x-\/y|\_a=sqrt(a\string^2\ +\ (x\_i-\/y\_i)\string^2)."{}}\ <<\ std::endl;\ }
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Compute\ potentials\ p\_i(x)=sum\_\{y,j\}(K\_ij(x,y)w\_j(y))"{}}\ <<\ std::endl;\ }
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\ \ \ \ \ \ \ \ forces\ f\_\{ik\}(x)=-\/d/dx\_k(sum\_\{y,j\}(w\_j(x)K\_ij(x,y)w\_j(y)))"{}}\ <<\ std::endl;\ }
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ std::cout\ <<\ std::endl;}
\DoxyCodeLine{00139\ \ \ \ \ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{comment}{//\ returns\ position\ in\ reduced\ storage\ from\ position\ in\ full\ 3x3\ matrix}}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \ \textcolor{keywordtype}{int}\ getPosition(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00143\ \textcolor{keyword}{\ \ \ \ }\{\textcolor{keywordflow}{return}\ applyTab[n];\}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{comment}{//\ returns\ Core\ Width\ squared}}
\DoxyCodeLine{00146\ \ \ \ \ FReal\ getCoreWidth2()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00147\ \textcolor{keyword}{\ \ \ \ }\{\textcolor{keywordflow}{return}\ \_CoreWidth2;\}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{comment}{//\ returns\ coefficient\ of\ mutual\ interaction}}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{comment}{//\ 1\ for\ symmetric\ kernels}}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{comment}{//\ -\/1\ for\ antisymmetric\ kernels}}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{comment}{//\ somethings\ else\ if\ other\ property\ of\ symmetry}}
\DoxyCodeLine{00153\ \ \ \ \ FReal\ getMutualCoefficient()\textcolor{keyword}{\ const}\{\ \textcolor{keywordflow}{return}\ FReal(1.);\ \}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{comment}{//\ evaluate\ interaction}}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ValueClass>}
\DoxyCodeLine{00157\ \ \ \ \ FReal\ evaluate(\textcolor{keyword}{const}\ ValueClass\&\ xt,\ \textcolor{keyword}{const}\ ValueClass\&\ yt,\ \textcolor{keyword}{const}\ ValueClass\&\ zt,\ }
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\&\ xs,\ \textcolor{keyword}{const}\ ValueClass\&\ ys,\ \textcolor{keyword}{const}\ ValueClass\&\ zs)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00159\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ diffx\ =\ (xt-\/xs);}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ diffy\ =\ (yt-\/ys);}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ diffz\ =\ (zt-\/zs);}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ r2\ =\ diffx*diffx+diffy*diffy+diffz*diffz;}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ one\_over\_r\ =\ FMath::One<ValueClass>()/\mbox{\hyperlink{struct_f_math_a2494d4d6618d79e61324a0dfa372855f}{FMath::Sqrt}}(r2\ +\ FMath::ConvertTo<ValueClass,FReal>(\_CoreWidth2));}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ one\_over\_r3\ =\ one\_over\_r*one\_over\_r*one\_over\_r;}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ ValueClass\ ri,rj;}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\_i==0)\ ri=diffx;}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\_i==1)\ ri=diffy;}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\_i==2)\ ri=diffz;}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Update\ i!"{}});}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\_j==0)\ rj=diffx;}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\_j==1)\ rj=diffy;}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\_j==2)\ rj=diffz;}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Update\ j!"{}});}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\_i==\_j)}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ one\_over\_r\ -\/\ ri\ *\ ri\ *\ one\_over\_r3;}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/\ ri\ *\ rj\ *\ one\_over\_r3;}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \ \ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{comment}{//\ evaluate\ interaction\ (blockwise)}}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ValueClass>}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordtype}{void}\ evaluateBlock(\textcolor{keyword}{const}\ ValueClass\&\ xt,\ \textcolor{keyword}{const}\ ValueClass\&\ yt,\ \textcolor{keyword}{const}\ ValueClass\&\ zt,\ }
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\&\ xs,\ \textcolor{keyword}{const}\ ValueClass\&\ ys,\ \textcolor{keyword}{const}\ ValueClass\&\ zs,}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ValueClass*\ block)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00190\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ diffx\ =\ (xt-\/xs);}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ diffy\ =\ (yt-\/ys);}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ diffz\ =\ (zt-\/zs);}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ r2\ =\ diffx*diffx+diffy*diffy+diffz*diffz;}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ one\_over\_r\ =\ FMath::One<ValueClass>()/\mbox{\hyperlink{struct_f_math_a2494d4d6618d79e61324a0dfa372855f}{FMath::Sqrt}}(r2\ +\ FMath::ConvertTo<ValueClass,FReal>(\_CoreWidth2));}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ one\_over\_r3\ =\ one\_over\_r*one\_over\_r*one\_over\_r;}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ r[3]\ =\ \{diffx,diffy,diffz\};}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ d=0;d<NCMP;++d)\{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ \mbox{\hyperlink{struct_f_interp_matrix_kernel___r___i_j_a499660d8129a2491ff0566137d1f9d68}{indexTab}}[d];}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ \mbox{\hyperlink{struct_f_interp_matrix_kernel___r___i_j_a499660d8129a2491ff0566137d1f9d68}{indexTab}}[d+NCMP];}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i==j)}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ block[d]\ =\ one\_over\_r\ -\/\ r[i]\ *\ r[i]\ *\ one\_over\_r3;}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ block[d]\ =\ -\/\ r[i]\ *\ r[j]\ *\ one\_over\_r3;}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00209\ \ \ \ \ \}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{comment}{//\ evaluate\ interaction\ and\ derivative\ (blockwise)}}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{comment}{//\ [TODO]\ Fix!\ Add\ corewidth!}}
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ValueClass>}
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{keywordtype}{void}\ evaluateBlockAndDerivative(\textcolor{keyword}{const}\ ValueClass\&\ xt,\ \textcolor{keyword}{const}\ ValueClass\&\ yt,\ \textcolor{keyword}{const}\ ValueClass\&\ zt,}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\&\ xs,\ \textcolor{keyword}{const}\ ValueClass\&\ ys,\ \textcolor{keyword}{const}\ ValueClass\&\ zs,}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ValueClass\ block[NCMP],\ ValueClass\ blockDerivative[NCMP][3])\textcolor{keyword}{\ const}}
\DoxyCodeLine{00217\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ diffx\ =\ (xt-\/xs);}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ diffy\ =\ (yt-\/ys);}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ diffz\ =\ (zt-\/zs);}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ r2[3]\ =\ \{diffx*diffx,diffy*diffy,diffz*diffz\};}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ one\_over\_r2\ =\ FMath::One<ValueClass>()\ /\ (r2[0]\ +\ r2[1]\ +\ r2[2]\ +\ FMath::ConvertTo<ValueClass,FReal>(\_CoreWidth2));}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ one\_over\_r\ \ =\ \mbox{\hyperlink{struct_f_math_a2494d4d6618d79e61324a0dfa372855f}{FMath::Sqrt}}(one\_over\_r2);}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ one\_over\_r3\ =\ one\_over\_r2*one\_over\_r;}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ r[3]\ =\ \{diffx,diffy,diffz\};}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ Three\ =\ FMath::ConvertTo<ValueClass,FReal>(3.);}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ValueClass\ MinusOne\ =\ -\/\ FMath::One<ValueClass>();}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ d=0;d<NCMP;++d)\{}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ \mbox{\hyperlink{struct_f_interp_matrix_kernel___r___i_j_a499660d8129a2491ff0566137d1f9d68}{indexTab}}[d];}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ \mbox{\hyperlink{struct_f_interp_matrix_kernel___r___i_j_a499660d8129a2491ff0566137d1f9d68}{indexTab}}[d+NCMP];}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ evaluate\ kernel}}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i==j)}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ block[d]\ =\ one\_over\_r\ -\/\ r2[i]\ *\ one\_over\_r3;}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ block[d]\ =\ -\/\ r[i]\ *\ r[j]\ *\ one\_over\_r3;}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ evaluate\ derivative}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ k\ =\ 0\ ;\ k\ <\ 3\ ;\ ++k)\{}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i==j)\{}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(j==k)\ \textcolor{comment}{//i=j=k}}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ blockDerivative[d][k]\ =\ Three\ *\ (\ MinusOne\ +\ r2[i]\ *\ one\_over\_r2\ )\ *\ r[i]\ *\ one\_over\_r3;}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//i=j!=k}}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ blockDerivative[d][k]\ =\ (\ MinusOne\ +\ Three\ *\ r2[i]\ *\ one\_over\_r2\ )\ *\ r[k]\ *\ one\_over\_r3;}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{\ \textcolor{comment}{//(i!=j)}}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i==k)\ \textcolor{comment}{//i=k!=j}}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ blockDerivative[d][k]\ =\ (\ MinusOne\ +\ Three\ *\ r2[i]\ *\ one\_over\_r2\ )\ *\ r[j]\ *\ one\_over\_r3;}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(j==k)\ \textcolor{comment}{//i!=k=j}}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ blockDerivative[d][k]\ =\ (\ MinusOne\ +\ Three\ *\ r2[j]\ *\ one\_over\_r2\ )\ *\ r[i]\ *\ one\_over\_r3;}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//i!=k!=j}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ blockDerivative[d][k]\ =\ Three\ *\ r[i]\ *\ r[j]\ *\ r[k]\ *\ one\_over\_r2\ *\ one\_over\_r3;}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \}\textcolor{comment}{//\ k}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \}\textcolor{comment}{//\ NCMP}}
\DoxyCodeLine{00260\ \ \ \ \ \}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \ \ FReal\ getScaleFactor(\textcolor{keyword}{const}\ FReal\ RootCellWidth,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ TreeLevel)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00263\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ CellWidth(RootCellWidth\ /\ FReal(\mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(2,\ TreeLevel)));}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ getScaleFactor(CellWidth);}
\DoxyCodeLine{00266\ \ \ \ \ \}}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{comment}{//\ R\_\{,ij\}\ is\ homogeneous\ to\ [L]/[L]\string^\{-\/2\}=[L]\string^\{-\/1\}}}
\DoxyCodeLine{00269\ \ \ \ \ \textcolor{comment}{//\ =>\ scales\ like\ ONE\_OVER\_R}}
\DoxyCodeLine{00270\ \ \ \ \ FReal\ getScaleFactor(\textcolor{keyword}{const}\ FReal\ CellWidth)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00271\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ FReal(2.)\ /\ CellWidth;}
\DoxyCodeLine{00273\ \ \ \ \ \}}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \ \ FReal\ evaluate(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ pt,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ ps)\textcolor{keyword}{\ const}\{}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ evaluate<FReal>(pt.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}(),\ pt.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}(),\ pt.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}(),\ ps.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}(),\ ps.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}(),\ ps.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}());}
\DoxyCodeLine{00279\ \ \ \ \ \}}
\DoxyCodeLine{00280\ \ \ \ \ \textcolor{keywordtype}{void}\ evaluateBlock(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ pt,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ ps,\ FReal*\ block)\textcolor{keyword}{\ const}\{}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ evaluateBlock<FReal>(pt.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}(),\ pt.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}(),\ pt.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}(),\ ps.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}(),\ ps.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}(),\ ps.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}(),\ block);}
\DoxyCodeLine{00282\ \ \ \ \ \}}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{keywordtype}{void}\ evaluateBlockAndDerivative(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ pt,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ ps,}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ block[NCMP],\ FReal\ blockDerivative[NCMP][3])\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ evaluateBlockAndDerivative<FReal>(pt.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}(),\ pt.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}(),\ pt.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}(),\ ps.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}(),\ ps.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}(),\ ps.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}(),\ block,\ blockDerivative);}
\DoxyCodeLine{00286\ \ \ \ \ \}}
\DoxyCodeLine{00287\ \};}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00290\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal>}
\DoxyCodeLine{00291\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{struct_f_interp_matrix_kernel___r___i_j}{FInterpMatrixKernel\_R\_IJ<FReal>::indexTab}}[]=\{0,0,0,1,1,2,}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,1,2,1,2,2\};}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal>}
\DoxyCodeLine{00295\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{struct_f_interp_matrix_kernel___r___i_j}{FInterpMatrixKernel\_R\_IJ<FReal>::applyTab}}[]=\{0,1,2,}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1,3,4,}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 2,4,5\};}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ FINTERPMATRIXKERNEL\_TENSORIAL\_INTERACTIONS\_HPP}}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ \textcolor{comment}{//\ [-\/-\/END-\/-\/]}}
\DoxyCodeLine{00309\ }

\end{DoxyCode}
