\doxysection{FMpi\+Buffer\+Writer.\+hpp}
\hypertarget{_f_mpi_buffer_writer_8hpp_source}{}\label{_f_mpi_buffer_writer_8hpp_source}\index{third\_party/ScalFMM/include/ScalFMM/Containers/FMpiBufferWriter.hpp@{third\_party/ScalFMM/include/ScalFMM/Containers/FMpiBufferWriter.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ See\ LICENCE\ file\ at\ project\ root}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#ifndef\ FMPIBUFFERWRITER\_HPP}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#define\ FMPIBUFFERWRITER\_HPP}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}../Utils/FMpi.hpp"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}FAbstractBuffer.hpp"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}../Utils/FAssert.hpp"{}}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_f_mpi_buffer_writer}{FMpiBufferWriter}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_f_abstract_buffer_writer}{FAbstractBufferWriter}}\ \{}
\DoxyCodeLine{00018\ \ \ \ \ FSize\ arrayCapacity;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//<\ Allocated\ Space}}
\DoxyCodeLine{00019\ \ \ \ \ std::unique\_ptr<char[]>\ array;\ \ \textcolor{comment}{//<\ Allocated\ Array}}
\DoxyCodeLine{00020\ \ \ \ \ FSize\ currentIndex;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//<\ Currently\ filled\ space}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keywordtype}{void}\ expandIfNeeded(\textcolor{keyword}{const}\ FSize\ requestedSpace)\ \{}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ arrayCapacity\ <\ currentIndex\ +\ requestedSpace)\{}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \ \ \ \ arrayCapacity\ =\ FSize(\textcolor{keywordtype}{double}(currentIndex\ +\ requestedSpace\ +\ 1)\ *\ 1.5);}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}*\ arrayTmp\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{char}[arrayCapacity];}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \ \ \ \ memcpy(arrayTmp,\ array.get(),\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char})*currentIndex);}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \ \ \ \ array.reset(arrayTmp);}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00030\ \ \ \ \ \}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{class_f_mpi_buffer_writer_a9d0cc92d9df605236c36014fb3e0ddd5}{FMpiBufferWriter}}(\textcolor{keyword}{const}\ FSize\ inDefaultCapacity\ =\ 1024):}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ arrayCapacity(inDefaultCapacity),}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ array(new\ char[inDefaultCapacity]),}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ currentIndex(0)}
\DoxyCodeLine{00038\ \ \ \ \ \{\}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_mpi_buffer_writer_a360a6c90c96f28dfe7287d22e0f04fd7}{resize}}(\textcolor{keyword}{const}\ FSize\ newCapacity)\{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(newCapacity\ !=\ arrayCapacity)\{}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ arrayCapacity\ =\ newCapacity;}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}*\ arrayTmp\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{char}[arrayCapacity];}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ currentIndex\ =\ (currentIndex\ <\ arrayCapacity\ ?\ currentIndex\ :\ arrayCapacity-\/1);}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ memcpy(arrayTmp,\ array.get(),\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char})*currentIndex);}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ array.reset(arrayTmp);}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00050\ \ \ \ \ \}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{class_f_mpi_buffer_writer_a53c00bc635ce7653fd00dddd7a62b8ca}{\string~FMpiBufferWriter}}()\{}
\DoxyCodeLine{00054\ \ \ \ \ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{class_f_mpi_buffer_writer_a00e0998ee250133df7dcd5d9660e4ea8}{data}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ array.get();}
\DoxyCodeLine{00059\ \ \ \ \ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{class_f_mpi_buffer_writer_ab54a2aff5dfafde0f5d03bb34ba2cd64}{data}}()\textcolor{keyword}{\ const\ override\ \ }\{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ array.get();}
\DoxyCodeLine{00064\ \ \ \ \ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00067\ \ \ \ \ FSize\ \mbox{\hyperlink{class_f_mpi_buffer_writer_afc7f9cb6ee1c0bdcccfffaf187907858}{getSize}}()\textcolor{keyword}{\ const\ override\ \ }\{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ currentIndex;}
\DoxyCodeLine{00069\ \ \ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00072\ \ \ \ \ FSize\ \mbox{\hyperlink{class_f_mpi_buffer_writer_add434d98d42f830992583e7daa3ee53c}{getCapacity}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ arrayCapacity;}
\DoxyCodeLine{00074\ \ \ \ \ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ClassType>}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_mpi_buffer_writer_a0afc1bae9ec489108a86d6588e10cf2b}{write}}(\textcolor{keyword}{const}\ ClassType\&\ \textcolor{keywordtype}{object})\{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ expandIfNeeded(\textcolor{keyword}{sizeof}(ClassType));}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ memcpy(\&array[currentIndex],\ \&\textcolor{keywordtype}{object},\ \textcolor{keyword}{sizeof}(ClassType));}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ currentIndex\ +=\ \textcolor{keyword}{sizeof}(ClassType);}
\DoxyCodeLine{00082\ \ \ \ \ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ClassType>}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_mpi_buffer_writer_a797659fa8db52add24f380ef290462fa}{write}}(\textcolor{keyword}{const}\ ClassType\&\&\ \textcolor{keywordtype}{object})\{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ expandIfNeeded(\textcolor{keyword}{sizeof}(ClassType));}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ memcpy(\&array[currentIndex],\ \&\textcolor{keywordtype}{object},\ \textcolor{keyword}{sizeof}(ClassType));}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ currentIndex\ +=\ \textcolor{keyword}{sizeof}(ClassType);}
\DoxyCodeLine{00092\ \ \ \ \ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ClassType>}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_mpi_buffer_writer_a67d766a9b2e16206b809c5d3bfb69a3c}{writeAt}}(\textcolor{keyword}{const}\ FSize\ position,\ \textcolor{keyword}{const}\ ClassType\&\ \textcolor{keywordtype}{object})\{}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ FAssertLF(position+FSize(\textcolor{keyword}{sizeof}(ClassType))\ <=\ currentIndex);}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ memcpy(\&array[position],\ \&\textcolor{keywordtype}{object},\ \textcolor{keyword}{sizeof}(ClassType));}
\DoxyCodeLine{00099\ \ \ \ \ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ClassType>}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_mpi_buffer_writer_a6ff45ccef920c817aae9b68cd6a1761f}{write}}(\textcolor{keyword}{const}\ ClassType*\ \textcolor{keyword}{const}\ objects,\ \textcolor{keyword}{const}\ FSize\ inSize)\{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ expandIfNeeded(\textcolor{keyword}{sizeof}(ClassType)\ *\ inSize);}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ memcpy(\&array[currentIndex],\ objects,\ \textcolor{keyword}{sizeof}(ClassType)*inSize);}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ currentIndex\ +=\ \textcolor{keyword}{sizeof}(ClassType)*inSize;}
\DoxyCodeLine{00109\ \ \ \ \ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ClassType>}
\DoxyCodeLine{00113\ \ \ \ \ \mbox{\hyperlink{class_f_mpi_buffer_writer}{FMpiBufferWriter}}\&\ \mbox{\hyperlink{class_f_mpi_buffer_writer_a12d40cdf6f7d1c04c0a0de7791740a20}{operator<<}}(\textcolor{keyword}{const}\ ClassType\&\ \textcolor{keywordtype}{object})\{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_mpi_buffer_writer_a0afc1bae9ec489108a86d6588e10cf2b}{write}}(\textcolor{keywordtype}{object});}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00116\ \ \ \ \ \}}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_mpi_buffer_writer_a33be7e6032246aa5cd83c3d0b42d8c52}{reset}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ currentIndex\ =\ 0;}
\DoxyCodeLine{00121\ \ \ \ \ \}}
\DoxyCodeLine{00122\ \};}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ FBUFFERWRITER\_HPP}}

\end{DoxyCode}
