\doxysection{FRotation\+Original\+Kernel.\+hpp}
\hypertarget{_f_rotation_original_kernel_8hpp_source}{}\label{_f_rotation_original_kernel_8hpp_source}\index{third\_party/ScalFMM/include/ScalFMM/Kernels/Rotation/FRotationOriginalKernel.hpp@{third\_party/ScalFMM/include/ScalFMM/Kernels/Rotation/FRotationOriginalKernel.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ See\ LICENCE\ file\ at\ project\ root}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#ifndef\ FROTATIONORIGINALKERNEL\_HPP}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#define\ FROTATIONORIGINALKERNEL\_HPP}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}../../Components/FAbstractKernels.hpp"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FSmartPointer.hpp"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FComplex.hpp"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FMemUtils.hpp"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FSpherical.hpp"{}}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}../P2P/FP2PR.hpp"{}}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00037\ \textcolor{keyword}{template}<\ \textcolor{keyword}{class}\ FReal,\ \textcolor{keyword}{class}\ CellClass,\ \textcolor{keyword}{class}\ ContainerClass,\ \textcolor{keywordtype}{int}\ P>}
\DoxyCodeLine{00038\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_f_rotation_original_kernel}{FRotationOriginalKernel}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_f_abstract_kernels}{FAbstractKernels}}<CellClass,ContainerClass>\ \{}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{comment}{//<\ Size\ of\ the\ data\ array\ computed\ using\ a\ suite\ relation}}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ SizeArray\ =\ ((P+2)*(P+1))/2;}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{comment}{//\ Object\ attributes}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{const}\ FReal\ boxWidth;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//<\ the\ box\ width\ at\ leaf\ level}}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \ \ treeHeight;\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//<\ The\ height\ of\ the\ tree}}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keyword}{const}\ FReal\ widthAtLeafLevel;\ \ \ \ \ \ \ \textcolor{comment}{//<\ width\ of\ box\ at\ leaf\ level}}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keyword}{const}\ FReal\ widthAtLeafLevelDiv2;\ \ \ \textcolor{comment}{//<\ width\ of\ box\ at\ leaf\ leve\ div\ 2}}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ boxCorner;\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//<\ position\ of\ the\ box\ corner}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{class_f_smart_pointer}{FSmartPointer<FSpherical<FReal>}}>\ childrenPosition;\ \ \ \ \ \textcolor{comment}{//<\ The\ transfers\ between\ level}}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{class_f_smart_pointer}{FSmartPointer<FSpherical<FReal>}}>\ interactionsPosition;\ \textcolor{comment}{//<\ The\ transfers\ at\ a\ same\ level}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{comment}{//\ d\_lmk}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordtype}{int}\ atLm(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ l,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ m)\{}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ summation\ series\ over\ l\ +\ m\ =>\ (l*(l+1))/2\ +\ m}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ((l*(l+1))>>1)\ +\ m;}
\DoxyCodeLine{00064\ \ \ \ \ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keyword}{template}\ <\ \textcolor{keyword}{class}\ T\ >}
\DoxyCodeLine{00068\ \ \ \ \ T\ Sgn(\textcolor{keyword}{const}\ T\ a)\{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(a\ <\ 0)\ \textcolor{keywordflow}{return}\ T(-\/1);}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(a\ >\ 0)\ \textcolor{keywordflow}{return}\ T(1);}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ T(0);}
\DoxyCodeLine{00072\ \ \ \ \ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00075\ \ \ \ \ FReal\ fact(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ a)\{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(a<0)\ printf(\textcolor{stringliteral}{"{}Error\ factorial\ negative!!\ a=\%d\(\backslash\)n"{}},a);}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ FReal\ result\ =\ 1;}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 1\ ;\ i\ <=\ a\ ;\ ++i)\{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ result\ *=\ FReal(i);}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00082\ \ \ \ \ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00085\ \ \ \ \ FReal\ combin(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\&\ a,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\&\ b)\{}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(a-\/b<0)\ printf(\textcolor{stringliteral}{"{}Error\ combi\ negative!!\ a=\%d\ b=\%d\(\backslash\)n"{}},a,b);}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ fact(a)\ /\ (fact(b)*fact(a-\/b));}
\DoxyCodeLine{00088\ \ \ \ \ \}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00104\ \ \ \ \ FReal\ d\_lmk\_analytical(\textcolor{keyword}{const}\ FReal\ cosTheta,\ \textcolor{keyword}{const}\ FReal\ sinTheta,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ l\ ,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ m,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ k)\{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ l\ >=\ 0\ \&\&\ -\/l\ <=\ k\ \&\&\ k\ <=\ l\ \&\&\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(k)\ <=\ m\ \&\&\ m\ <=\ l\ )\{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ sum\ =\ 0;}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ n\ =\ \mbox{\hyperlink{struct_f_math_ada359f2b021ce4b999c0fd7a6e9daae6}{FMath::Max}}(-\/(m+k),0)\ ;\ n\ <=\ \mbox{\hyperlink{struct_f_math_a43635af3d44bb1868015681ce994df7b}{FMath::Min}}(l-\/m,l-\/k)\ ;\ ++n)\{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ sum\ +=\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(-\/1.0),\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(l-\/m-\/n))\ *\ combin(l-\/k,\ n)\ *\ combin(l+k,\ l-\/m-\/n)\ *\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(1.0)+cosTheta,\mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(n))\ *\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(1.0)-\/cosTheta,\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(l-\/m-\/n));}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (FReal(1.0)/\mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(2.0),\mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(l)))\ *\ \mbox{\hyperlink{struct_f_math_a2494d4d6618d79e61324a0dfa372855f}{FMath::Sqrt}}((fact(l-\/m)*fact(l+m))/(fact(l-\/k)*fact(l+k)))}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ *\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(1.0)\ +\ FReal(Sgn(k))*cosTheta,\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(k))\ *\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(sinTheta,\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(m\ -\/\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(k)))\ *\ sum;}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ P\string^\{l\}\_\{m,k\}\ =\ (-\/1)\string^\{m+k\}\ P\string^\{l\}\_\{k,m\}\ ,\ l\ \(\backslash\)ge\ 0,\ -\/l\ \(\backslash\)leq\ m\ \(\backslash\)le\ 0,\ |m|\ \(\backslash\)leq\ k\ \(\backslash\)leq\ l}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ (l\ >\ 0\ \&\&\ -\/l\ <=\ m\ \&\&\ m\ <\ 0\ \&\&\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(m)\ <=\ k\ \&\&\ k\ <=\ l)}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ \ (l\ >\ 0\ \&\&\ 0\ <=\ m\ \&\&\ m\ <\ l\ \&\&\ m\ <\ k\ \&\&\ k\ <=\ l\ ))\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(-\/1.0),\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(m+k))\ *\ d\_lmk\_analytical(cosTheta,sinTheta,\ l,\ k\ ,m);}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ P\string^\{l\}\_\{m,k\}\ =\ (-\/1)\string^\{m+k\}\ P\string^\{l\}\_\{k,m\}\ ,\ l\ \(\backslash\)ge\ 0,\ 0\ \(\backslash\)leq\ m\ \(\backslash\)le\ l,\ m\ \(\backslash\)le\ k\ \(\backslash\)leq\ l}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ l\ >\ 0\ \&\&\ -\/l\ <=\ m\ \&\&\ m\ <\ l\ \&\&\ -\/l\ <=\ k\ \&\&\ k\ <\ -\/m\ )\{}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(-\/1.0),\ \mbox{\hyperlink{struct_f_math_ac005cd270abc850853ba71d1e38a2f28}{FMath::Abs}}(m+k))\ *\ d\_lmk\_analytical(cosTheta,sinTheta,\ l,\ -\/m,\ -\/k);}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error\ that\ should\ not\ be\ possible!\(\backslash\)n"{}});}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ FReal(0.0);}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00126\ \ \ \ \ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{comment}{//\ legendre}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordtype}{void}\ computeLegendre(FReal\ legendre[],\ \textcolor{keyword}{const}\ FReal\ inCosTheta,\ \textcolor{keyword}{const}\ FReal\ inSinTheta)\{}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ invSinTheta\ =\ -\/inSinTheta;}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ legendre[atLm(0,0)]\ =\ 1.0;\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ P\_0,0(1)\ =\ 1}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ legendre[atLm(1,0)]\ =\ inCosTheta;\ \ \ \ \ \ \textcolor{comment}{//\ P\_1,0\ =\ cos(theta)}}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ legendre[atLm(1,1)]\ =\ invSinTheta;\ \ \ \ \ \textcolor{comment}{//\ P\_1,1\ =\ -\/sin(theta)}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ using\ recurrence}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ l\ =\ 2;\ l\ <=\ P\ ;\ ++l\ )\{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keywordtype}{int}\ m\ =\ 0;\ m\ <\ l\ -\/\ 1\ ;\ ++m\ )\{}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ P\_\{l,m\}\ =\ \(\backslash\)frac\{(2l-\/1)\ cos(\ \(\backslash\)theta\ )\ P\_\{l-\/1,m\}\ -\/\ (l+m-\/1)\ P\_\{l-\/2,m\}x\}\{(l-\/k)\}}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ legendre[atLm(l,m)]\ =\ (FReal(2*l-\/1)\ *\ inCosTheta\ *\ legendre[atLm(l-\/1,m)]\ -\/\ FReal(\ l\ +\ m\ -\/\ 1\ )\ *\ legendre[atLm(l-\/2,m)]\ )}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ /\ FReal(\ l\ -\/\ m\ );}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ P\_\{l,l-\/1\}\ =\ (2l-\/1)\ cos(\ \(\backslash\)theta\ )\ P\_\{l-\/1,l-\/1\}}}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ legendre[atLm(l,l-\/1)]\ =\ FReal(2*l-\/1)\ *\ inCosTheta\ *\ legendre[atLm(l-\/1,l-\/1)];}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ P\_\{l,l\}\ =\ (2l-\/1)\ sin(\ \(\backslash\)theta\ )\ P\_\{l-\/1,l-\/1\}}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ legendre[atLm(l,l)]\ =\ FReal(2*l-\/1)\ *\ invSinTheta\ *\ legendre[atLm(l-\/1,l-\/1)];}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00165\ \ \ \ \ \}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{comment}{//\ Real\ rotation}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keywordtype}{void}\ rotateMultipoleAroundZ(\mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ vec[],\ \textcolor{keyword}{const}\ FReal\ phi)\{}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ cell\_rotate[SizeArray];}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ l\ =\ 0\ ;\ l\ <=\ P\ ;\ ++l)\{}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ m\ =\ 0\ ;\ m\ <=\ l\ ;\ ++m\ )\{}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ O\_\{l,m\}(\ \(\backslash\)alpha,\ \(\backslash\)beta\ +\ \(\backslash\)phi\ )\ =\ e\string^\{-\/i\ \(\backslash\)phi\ m\}\ O\_\{l,m\}(\ \(\backslash\)alpha,\ \(\backslash\)beta\ )}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ exp\_minus\_imphi(\mbox{\hyperlink{struct_f_math_a914d36d095fd8cd600ec18e932664fe3}{FMath::Cos}}(-\/phi\ *\ FReal(m)),\ \mbox{\hyperlink{struct_f_math_a5bdcccf9bf4d10eee66f711044904ace}{FMath::Sin}}(-\/phi\ *\ FReal(m)));}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cell\_rotate[atLm(l,m)].\mbox{\hyperlink{class_f_complex_ac0243f8ed4c18c1f639b62f0ecc1bf49}{equalMul}}(exp\_minus\_imphi\ ,\ vec[atLm(l,m)]);}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a85a4b506a3e71e70cfb0c4e38320182e}{FMemUtils::copyall}}(vec,cell\_rotate,SizeArray);}
\DoxyCodeLine{00191\ \ \ \ \ \}}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keywordtype}{void}\ rotateTaylorAroundZ(\mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ vec[],\ \textcolor{keyword}{const}\ FReal\ phi)\{}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ cell\_rotate[SizeArray];}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ l\ =\ 0\ ;\ l\ <=\ P\ ;\ ++l)\{}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ m\ =\ 0\ ;\ m\ <=\ l\ ;\ ++m\ )\{}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ M\_\{l,m\}(\ \(\backslash\)alpha,\ \(\backslash\)beta\ +\ \(\backslash\)phi\ )\ =\ e\string^\{i\ \(\backslash\)phi\ m\}\ M\_\{l,m\}(\ \(\backslash\)alpha,\ \(\backslash\)beta\ )}}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ exp\_imphi(\mbox{\hyperlink{struct_f_math_a914d36d095fd8cd600ec18e932664fe3}{FMath::Cos}}(phi\ *\ FReal(m)),\ \mbox{\hyperlink{struct_f_math_a5bdcccf9bf4d10eee66f711044904ace}{FMath::Sin}}(phi\ *\ FReal(m)));}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cell\_rotate[atLm(l,m)].\mbox{\hyperlink{class_f_complex_ac0243f8ed4c18c1f639b62f0ecc1bf49}{equalMul}}(exp\_imphi\ ,\ vec[atLm(l,m)]);}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a85a4b506a3e71e70cfb0c4e38320182e}{FMemUtils::copyall}}(vec,cell\_rotate,SizeArray);}
\DoxyCodeLine{00213\ \ \ \ \ \}}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keywordtype}{void}\ rotateMultipoleAroundY(\mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ vec[],\ \textcolor{keyword}{const}\ FReal\ theta)\{}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ cell\_rotate[SizeArray];}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ l\ =\ 0\ ;\ l\ <=\ P\ ;\ ++l)\{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ m\ =\ 0\ ;\ m\ <=\ l\ ;\ ++m\ )\{}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ w\_lkm\_real\ =\ 0.0;}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ w\_lkm\_imag\ =\ 0.0;}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ k\ =\ -\/l\ ;\ k\ <\ 0\ ;\ ++k)\{}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ O\_\{l,-\/m\}\ =\ \(\backslash\)bar\{\ O\_\{l,m\}\ \}\ (-\/1)\string^m}}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ d\_lmk\ =\ d\_lmk\_analytical(\mbox{\hyperlink{struct_f_math_a914d36d095fd8cd600ec18e932664fe3}{FMath::Cos}}(theta),\mbox{\hyperlink{struct_f_math_a5bdcccf9bf4d10eee66f711044904ace}{FMath::Sin}}(theta),l,m,k);}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \(\backslash\)sqrt\{\ \(\backslash\)frac\{(l-\/k)!(l+k)!\}\{(l-\/|m|)!(l+|m|)!\}\ \}}}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ factor\ =\ \mbox{\hyperlink{struct_f_math_a2494d4d6618d79e61324a0dfa372855f}{FMath::Sqrt}}((fact(l-\/k)*fact(l+k))/(fact(l-\/abs(m))*fact(l+abs(m))));}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\_lkm\_real\ +=\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(-\/1.0),-\/k)\ *\ factor\ *\ d\_lmk\ *\ vec[atLm(l,-\/k)].\mbox{\hyperlink{class_f_complex_a33ec217df0f06432eec174977e0c87ff}{getReal}}();\ \textcolor{comment}{//\ k<0\ =>\ Conjugate\ *\ -\/1\string^k}}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\_lkm\_imag\ -\/=\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(-\/1.0),-\/k)\ *\ factor\ *\ d\_lmk\ *\ vec[atLm(l,-\/k)].\mbox{\hyperlink{class_f_complex_ab4db8e82d8c014c17b06089163a3c204}{getImag}}();\ \textcolor{comment}{//\ k<0\ =>\ Conjugate\ *\ -\/1\string^k}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ k\ =\ 0\ ;\ k\ <=\ l\ ;\ ++k)\{}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ d\_lmk\ =\ d\_lmk\_analytical(\mbox{\hyperlink{struct_f_math_a914d36d095fd8cd600ec18e932664fe3}{FMath::Cos}}(theta),\mbox{\hyperlink{struct_f_math_a5bdcccf9bf4d10eee66f711044904ace}{FMath::Sin}}(theta),l,m,k);}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \(\backslash\)sqrt\{\ \(\backslash\)frac\{(l-\/k)!(l+k)!\}\{(l-\/|m|)!(l+|m|)!\}\ \}}}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ factor\ =\ \mbox{\hyperlink{struct_f_math_a2494d4d6618d79e61324a0dfa372855f}{FMath::Sqrt}}((fact(l-\/k)*fact(l+k))/(fact(l-\/abs(m))*fact(l+abs(m))));}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\_lkm\_real\ +=\ factor\ *\ d\_lmk\ *\ vec[atLm(l,k)].\mbox{\hyperlink{class_f_complex_a33ec217df0f06432eec174977e0c87ff}{getReal}}();}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\_lkm\_imag\ +=\ factor\ *\ d\_lmk\ *\ vec[atLm(l,k)].\mbox{\hyperlink{class_f_complex_ab4db8e82d8c014c17b06089163a3c204}{getImag}}();}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cell\_rotate[atLm(l,m)].\mbox{\hyperlink{class_f_complex_a0a39bf6c1f122ffcfc8da36c13952013}{setRealImag}}(w\_lkm\_real,\ w\_lkm\_imag);}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a85a4b506a3e71e70cfb0c4e38320182e}{FMemUtils::copyall}}(vec,cell\_rotate,SizeArray);}
\DoxyCodeLine{00253\ \ \ \ \ \}}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00267\ \ \ \ \ \textcolor{keywordtype}{void}\ rotateTaylorAroundY(\mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ vec[],\ \textcolor{keyword}{const}\ FReal\ theta)\{}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ cell\_rotate[SizeArray];}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ l\ =\ 0\ ;\ l\ <=\ P\ ;\ ++l)\{}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ m\ =\ 0\ ;\ m\ <=\ l\ ;\ ++m\ )\{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ w\_lkm\_real\ =\ 0.0;}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ w\_lkm\_imag\ =\ 0.0;}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ k\ =\ -\/l\ ;\ k\ <\ 0\ ;\ ++k)\{}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ M\_\{l,-\/m\}\ =\ \(\backslash\)bar\{\ M\_\{l,m\}\ \}\ (-\/1)\string^m}}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ d\_lmk\ =\ d\_lmk\_analytical(\mbox{\hyperlink{struct_f_math_a914d36d095fd8cd600ec18e932664fe3}{FMath::Cos}}(theta),\mbox{\hyperlink{struct_f_math_a5bdcccf9bf4d10eee66f711044904ace}{FMath::Sin}}(theta),l,m,k);}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \(\backslash\)sqrt\{\ \(\backslash\)frac\{(l-\/|m|)!(l+|m|)!\}\{(l-\/k)!(l+k)!\}\ \}}}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ factor\ =\ \mbox{\hyperlink{struct_f_math_a2494d4d6618d79e61324a0dfa372855f}{FMath::Sqrt}}((fact(l-\/abs(m))*fact(l+abs(m)))/(fact(l-\/k)*fact(l+k)));}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\_lkm\_real\ +=\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(-\/1.0),-\/k)\ *\ factor\ *\ d\_lmk\ *\ vec[atLm(l,-\/k)].\mbox{\hyperlink{class_f_complex_a33ec217df0f06432eec174977e0c87ff}{getReal}}();\ \textcolor{comment}{//\ k<0\ =>\ Conjugate\ *\ -\/1\string^k}}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\_lkm\_imag\ -\/=\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(-\/1.0),-\/k)\ *\ factor\ *\ d\_lmk\ *\ vec[atLm(l,-\/k)].\mbox{\hyperlink{class_f_complex_ab4db8e82d8c014c17b06089163a3c204}{getImag}}();\ \textcolor{comment}{//\ k<0\ =>\ Conjugate\ *\ -\/1\string^k}}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ k\ =\ 0\ ;\ k\ <=\ l\ ;\ ++k)\{}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ d\_lmk\ =\ d\_lmk\_analytical(\mbox{\hyperlink{struct_f_math_a914d36d095fd8cd600ec18e932664fe3}{FMath::Cos}}(theta),\mbox{\hyperlink{struct_f_math_a5bdcccf9bf4d10eee66f711044904ace}{FMath::Sin}}(theta),l,m,k);}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \(\backslash\)sqrt\{\ \(\backslash\)frac\{(l-\/|m|)!(l+|m|)!\}\{(l-\/k)!(l+k)!\}\ \}}}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ factor\ =\ \mbox{\hyperlink{struct_f_math_a2494d4d6618d79e61324a0dfa372855f}{FMath::Sqrt}}((fact(l-\/abs(m))*fact(l+abs(m)))/(fact(l-\/k)*fact(l+k)));}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\_lkm\_real\ +=\ factor\ *\ d\_lmk\ *\ vec[atLm(l,k)].\mbox{\hyperlink{class_f_complex_a33ec217df0f06432eec174977e0c87ff}{getReal}}();}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\_lkm\_imag\ +=\ factor\ *\ d\_lmk\ *\ vec[atLm(l,k)].\mbox{\hyperlink{class_f_complex_ab4db8e82d8c014c17b06089163a3c204}{getImag}}();}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cell\_rotate[atLm(l,m)].\mbox{\hyperlink{class_f_complex_a0a39bf6c1f122ffcfc8da36c13952013}{setRealImag}}(w\_lkm\_real,\ w\_lkm\_imag);}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a85a4b506a3e71e70cfb0c4e38320182e}{FMemUtils::copyall}}(vec,cell\_rotate,SizeArray);}
\DoxyCodeLine{00293\ \ \ \ \ \}}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{keywordtype}{void}\ rotateMultipole(\mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ vec[],\ \textcolor{keyword}{const}\ FReal\ azimuth,\ \textcolor{keyword}{const}\ FReal\ inclination)\{}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ rotateMultipoleAroundZ(vec,(FMath::FPiDiv2<FReal>()\ +\ azimuth));}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ rotateMultipoleAroundY(vec,inclination);}
\DoxyCodeLine{00305\ \ \ \ \ \}}
\DoxyCodeLine{00313\ \ \ \ \ \textcolor{keywordtype}{void}\ deRotateMultipole(\mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ vec[],\ \textcolor{keyword}{const}\ FReal\ azimuth,\ \textcolor{keyword}{const}\ FReal\ inclination)\{}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ rotateMultipoleAroundY(vec,-\/inclination);}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ rotateMultipoleAroundZ(vec,-\/(FMath::FPiDiv2<FReal>()\ +\ azimuth));}
\DoxyCodeLine{00316\ \ \ \ \ \}}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00325\ \ \ \ \ \textcolor{keywordtype}{void}\ rotateTaylor(\mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ vec[],\ \textcolor{keyword}{const}\ FReal\ azimuth,\ \textcolor{keyword}{const}\ FReal\ inclination)\{}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ rotateTaylorAroundZ(vec,(FMath::FPiDiv2<FReal>()\ +\ azimuth));}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ rotateTaylorAroundY(vec,inclination);}
\DoxyCodeLine{00328\ \ \ \ \ \}}
\DoxyCodeLine{00336\ \ \ \ \ \textcolor{keywordtype}{void}\ deRotateTaylor(\mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ vec[],\ \textcolor{keyword}{const}\ FReal\ azimuth,\ \textcolor{keyword}{const}\ FReal\ inclination)\{}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ rotateTaylorAroundY(vec,-\/inclination);}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ rotateTaylorAroundZ(vec,-\/(FMath::FPiDiv2<FReal>()\ +\ azimuth));}
\DoxyCodeLine{00339\ \ \ \ \ \}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00342\ \ \ \ \ \textcolor{comment}{//\ Position\ precomputation}}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{keywordtype}{void}\ preComputePosition()\{}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ parent/children\ relation\ for\ M2M\ L2L}}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ childrenPosition\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_spherical}{FSpherical<FReal>}}[8\ *\ (treeHeight-\/1)];}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ subBoxWidth\ =\ widthAtLeafLevelDiv2;}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ each}}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ treeHeight-\/2\ ;\ idxLevel\ >\ 0\ ;\ -\/-\/idxLevel)\{}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxChild\ =\ 0\ ;\ idxChild\ <\ 8\ ;\ ++idxChild\ )\{}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ coord\ from\ child\ to\ parent}}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ x\ =\ FReal((idxChild\&4)?\ -\/subBoxWidth\ :\ subBoxWidth);}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ y\ =\ FReal((idxChild\&2)?\ -\/subBoxWidth\ :\ subBoxWidth);}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ z\ =\ FReal((idxChild\&1)?\ -\/subBoxWidth\ :\ subBoxWidth);}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ relativePosition(\ x\ ,\ y\ ,\ z\ );}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ childrenPosition[(idxLevel-\/1)*8\ +\ idxChild]\ =\ \mbox{\hyperlink{class_f_spherical}{FSpherical<FReal>}}(relativePosition);}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ subBoxWidth\ *=\ FReal(2.0);}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ interaction\ relations\ for\ M2L}}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ interactionsPosition\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_spherical}{FSpherical<FReal>}}[343\ *\ (treeHeight-\/1)];}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ boxWidthAtLevel\ =\ widthAtLeafLevel;}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLevel\ =\ treeHeight-\/1\ ;\ idxLevel\ >\ 0\ ;\ -\/-\/idxLevel)\{}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxX\ =\ -\/3\ ;\ idxX\ <=\ 3\ ;\ ++idxX\ )\{}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxY\ =\ -\/3\ ;\ idxY\ <=\ 3\ ;\ ++idxY\ )\{}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxZ\ =\ -\/3\ ;\ idxZ\ <=\ 3\ ;\ ++idxZ\ )\{}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ idxX\ !=\ 0\ ||\ idxY\ !=\ 0\ ||\ idxZ\ !=\ 0\ )\{}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ relativePosition(\ -\/FReal(idxX)*boxWidthAtLevel,}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/FReal(idxY)*boxWidthAtLevel,}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/FReal(idxZ)*boxWidthAtLevel);}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ position\ =\ (((\ (idxX+3)\ *\ 7)\ +\ (idxY+3)))\ *\ 7\ +\ idxZ\ +\ 3;}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactionsPosition[(idxLevel-\/1)*343\ +\ position]\ =\ \mbox{\hyperlink{class_f_spherical}{FSpherical<FReal>}}(relativePosition);}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxWidthAtLevel\ *=\ FReal(2.0);}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00386\ \ \ \ \ \}}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00389\ \ \ \ \ \mbox{\hyperlink{class_f_spherical}{FSpherical<FReal>}}\ getSphericalChild(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ idxLevel,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ position)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ childrenPosition[(idxLevel-\/1)*8\ +\ position];}
\DoxyCodeLine{00391\ \ \ \ \ \}}
\DoxyCodeLine{00392\ }
\DoxyCodeLine{00394\ \ \ \ \ \mbox{\hyperlink{class_f_spherical}{FSpherical<FReal>}}\ getSphericalInteraction(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ idxLevel,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ position)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ interactionsPosition[(idxLevel-\/1)*343\ +\ position];}
\DoxyCodeLine{00396\ \ \ \ \ \}}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00399\ \ \ \ \ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ getLeafCenter(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\ coordinate)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}(}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal(coordinate.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}())\ *\ widthAtLeafLevel\ +\ widthAtLeafLevelDiv2\ +\ boxCorner.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}(),}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal(coordinate.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}())\ *\ widthAtLeafLevel\ +\ widthAtLeafLevelDiv2\ +\ boxCorner.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}(),}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal(coordinate.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}())\ *\ widthAtLeafLevel\ +\ widthAtLeafLevelDiv2\ +\ boxCorner.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}());}
\DoxyCodeLine{00404\ \ \ \ \ \}}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00409\ \ \ \ \ \mbox{\hyperlink{class_f_rotation_original_kernel_a799aee24353a10ab4bef526f3faccedf}{FRotationOriginalKernel}}(\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inTreeHeight,\ \textcolor{keyword}{const}\ FReal\ inBoxWidth,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ inBoxCenter)\ :}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ boxWidth(inBoxWidth),}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ treeHeight(inTreeHeight),}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ widthAtLeafLevel(inBoxWidth/FReal(1\ <<\ (inTreeHeight-\/1))),}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ widthAtLeafLevelDiv2(widthAtLeafLevel/2),}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ boxCorner(inBoxCenter.getX()-\/(inBoxWidth/2),inBoxCenter.getY()-\/(inBoxWidth/2),inBoxCenter.getZ()-\/(inBoxWidth/2))}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ simply\ does\ the\ precomputation}}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ preComputePosition();}
\DoxyCodeLine{00418\ \ \ \ \ \}}
\DoxyCodeLine{00419\ }
\DoxyCodeLine{00421\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{class_f_rotation_original_kernel_ac8285fe51680063061b68fd16e2d6e6a}{\string~FRotationOriginalKernel}}()\{}
\DoxyCodeLine{00422\ \ \ \ \ \}}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00432\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_rotation_original_kernel_a213eb0a57beca6ea85fd0014b9d2f217}{P2M}}(CellClass*\ \textcolor{keyword}{const}\ inPole,\ \textcolor{keyword}{const}\ ContainerClass*\ \textcolor{keyword}{const}\ inParticles\ )\textcolor{keyword}{override\ }\{}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ i\_pow\_m[4]\ =\ \{0,\ FMath::FPiDiv2<FReal>(),\ FMath::FPi<FReal>(),\ -\/FMath::FPiDiv2<FReal>()\};}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ w\ is\ the\ multipole\ moment}}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}*\ FRestrict\ \textcolor{keyword}{const}\ w\ =\ inPole-\/>getMultipole();}
\DoxyCodeLine{00436\ }
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copying\ the\ position\ is\ faster\ than\ using\ cell\ position}}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ cellPosition\ =\ getLeafCenter(inPole-\/>getCoordinate());}
\DoxyCodeLine{00439\ }
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ a\ legendre\ array}}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ FReal\ legendre[SizeArray];}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ all\ particles\ in\ the\ leaf\ box}}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ physicalValues\ =\ inParticles-\/>getPhysicalValues();}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsX\ =\ inParticles-\/>getPositions()[0];}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsY\ =\ inParticles-\/>getPositions()[1];}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsZ\ =\ inParticles-\/>getPositions()[2];}
\DoxyCodeLine{00448\ }
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(FSize\ idxPart\ =\ 0\ ;\ idxPart\ <\ inParticles-\/>getNbParticles()\ ;\ ++\ idxPart)\{}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ P2M}}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ position(positionsX[idxPart],positionsY[idxPart],positionsZ[idxPart]);}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_spherical}{FSpherical<FReal>}}\ sph(position\ -\/\ cellPosition);}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ physical\ value\ (charge,\ mass)}}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ q\ =\ physicalValues[idxPart];}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ distance\ between\ the\ SH\ and\ the\ particle}}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ a\ =\ sph.\mbox{\hyperlink{class_f_spherical_afe70b334deb1d5feae782bda8851056d}{getR}}();}
\DoxyCodeLine{00458\ }
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ legendre\ polynomial}}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \ \ \ \ computeLegendre(legendre,\ sph.\mbox{\hyperlink{class_f_spherical_a7f3ca3427a17cf1b9e114aa1ed7049a3}{getCosTheta}}(),\ sph.\mbox{\hyperlink{class_f_spherical_accff4b45e34fd2b215715563a68a412f}{getSinTheta}}());}
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ w\{l,m\}(q,a)\ =\ q\ a\string^l/(l+|m|)!\ P\{l,m\}(cos(alpha))\ exp(-\/i\ m\ Beta)}}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ l\ =\ 0\ ;\ l\ <=\ P\ ;\ ++l\ )\{}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ m\ =\ 0\ ;\ m\ <=\ l\ ;\ ++m\ )\{}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ magnitude\ =\ q\ *\ (\mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(\ a\ ,\ l\ )/fact(l+m))}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\ legendre[atLm(l,m)];}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w[atLm(l,m)].\mbox{\hyperlink{class_f_complex_a239af6b36a7a875cf409af96ed286bf8}{incReal}}(magnitude\ *\ \mbox{\hyperlink{struct_f_math_a914d36d095fd8cd600ec18e932664fe3}{FMath::Cos}}(FReal(m)\ *\ sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}()\ +\ i\_pow\_m[m\ \&\ 0x3]));}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w[atLm(l,m)].\mbox{\hyperlink{class_f_complex_a5da751a7b9af375136091cad0bc8e1d9}{incImag}}(magnitude\ *\ \mbox{\hyperlink{struct_f_math_a5bdcccf9bf4d10eee66f711044904ace}{FMath::Sin}}(FReal(m)\ *\ sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}()\ +\ i\_pow\_m[m\ \&\ 0x3]));}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00472\ \ \ \ \ \}}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00485\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_rotation_original_kernel_a4657a3435e6e2232d33f5af5c4205628}{M2M}}(CellClass*\ \textcolor{keyword}{const}\ FRestrict\ inPole,\ \textcolor{keyword}{const}\ CellClass*\textcolor{keyword}{const}\ FRestrict\ *\textcolor{keyword}{const}\ FRestrict\ inChildren,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inLevel)\textcolor{keyword}{override\ }\{}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ A\ buffer\ to\ copy\ the\ source\ w\ allocated\ once}}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ source\_w[SizeArray];}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ all\ children}}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxChild\ =\ 0\ ;\ idxChild\ <\ 8\ ;\ ++idxChild)\{}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ child\ exists}}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(inChildren[idxChild])\{}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ the\ source}}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a85a4b506a3e71e70cfb0c4e38320182e}{FMemUtils::copyall}}(source\_w,\ inChildren[idxChild]-\/>getMultipole(),\ SizeArray);}
\DoxyCodeLine{00494\ }
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ rotate\ it\ forward}}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_spherical}{FSpherical<FReal>}}\ sph\ =\ getSphericalChild(inLevel,\ idxChild);}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rotateMultipole(source\_w,\ sph.\mbox{\hyperlink{class_f_spherical_ac47e9ee1557ed6e700cc985c9031a02b}{getPhiZero2Pi}}(),\ sph.\mbox{\hyperlink{class_f_spherical_a142b6af5616618a154c76983acdab34f}{getInclination}}());}
\DoxyCodeLine{00498\ }
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ b\ =\ -\/sph.\mbox{\hyperlink{class_f_spherical_afe70b334deb1d5feae782bda8851056d}{getR}}();}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Translate\ it}}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ target\_w[SizeArray];}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ l\ =\ 0\ ;\ l\ <=\ P\ ;\ ++l\ )\{}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ m\ =\ 0\ ;\ m\ <=\ l\ ;\ ++m\ )\{}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ w\{l,m\}(a+b)\ =\ sum(j=m:l,\ b\string^(l-\/j)/(l-\/j)!\ w\{j,m\}(a)}}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ w\_lm\_real\ =\ 0.0;}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ w\_lm\_imag\ =\ 0.0;}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ j\ =\ m\ ;\ j\ <=\ l\ ;\ ++j\ )\{}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ coef\ =\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(b,l-\/j)\ /\ fact(l-\/j);}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\_lm\_real\ +=\ coef\ *\ source\_w[atLm(j,m)].\mbox{\hyperlink{class_f_complex_a33ec217df0f06432eec174977e0c87ff}{getReal}}();}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\_lm\_imag\ +=\ coef\ *\ source\_w[atLm(j,m)].\mbox{\hyperlink{class_f_complex_ab4db8e82d8c014c17b06089163a3c204}{getImag}}();}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ target\_w[atLm(l,m)].\mbox{\hyperlink{class_f_complex_a0a39bf6c1f122ffcfc8da36c13952013}{setRealImag}}(w\_lm\_real,w\_lm\_imag);}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00515\ }
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rotate\ it\ back}}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ deRotateMultipole(target\_w,\ sph.\mbox{\hyperlink{class_f_spherical_ac47e9ee1557ed6e700cc985c9031a02b}{getPhiZero2Pi}}(),\ sph.\mbox{\hyperlink{class_f_spherical_a142b6af5616618a154c76983acdab34f}{getInclination}}());}
\DoxyCodeLine{00518\ }
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Sum\ the\ result}}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a5120d91235543eec7ee0ff0fc4bccebe}{FMemUtils::addall}}(\ inPole-\/>getMultipole(),\ target\_w,\ SizeArray);}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00523\ \ \ \ \ \}}
\DoxyCodeLine{00524\ }
\DoxyCodeLine{00536\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_rotation_original_kernel_a735ac75069992ffd47e9c18b542a1058}{M2L}}(CellClass*\ \textcolor{keyword}{const}\ FRestrict\ inLocal,\ \textcolor{keyword}{const}\ CellClass*\ inInteractions[],}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ neighborPositions[],\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inSize,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inLevel)\textcolor{keyword}{\ \ override\ }\{}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ To\ copy\ the\ multipole\ data\ allocated\ once}}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ source\_w[SizeArray];}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ all\ children}}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxExistingNeigh\ =\ 0\ ;\ idxExistingNeigh\ <\ inSize\ ;\ ++idxExistingNeigh)\{}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ idxNeigh\ =\ neighborPositions[idxExistingNeigh];}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ multipole\ data\ into\ buffer}}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a85a4b506a3e71e70cfb0c4e38320182e}{FMemUtils::copyall}}(source\_w,\ inInteractions[idxExistingNeigh]-\/>getMultipole(),\ SizeArray);}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rotate}}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_spherical}{FSpherical<FReal>}}\ sph\ =\ getSphericalInteraction(inLevel,\ idxNeigh);}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ rotateMultipole(source\_w,\ sph.\mbox{\hyperlink{class_f_spherical_ac47e9ee1557ed6e700cc985c9031a02b}{getPhiZero2Pi}}(),\ sph.\mbox{\hyperlink{class_f_spherical_a142b6af5616618a154c76983acdab34f}{getInclination}}());}
\DoxyCodeLine{00549\ }
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ b\ =\ sph.\mbox{\hyperlink{class_f_spherical_afe70b334deb1d5feae782bda8851056d}{getR}}();}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Transfer\ to\ u}}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ target\_u[SizeArray];}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ l\ =\ 0\ ;\ l\ <=\ P\ ;\ ++l\ )\{}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ m\ =\ 0\ ;\ m\ <=\ l\ ;\ ++m\ )\{}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ u\{l,m\}(a-\/b)\ =\ sum(j=|m|:P-\/l,\ (j+l)!/b\string^(j+l+1)\ w\{j,-\/m\}(a)}}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ u\_lm\_real\ =\ 0.0;}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ u\_lm\_imag\ =\ 0.0;}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ j\ =\ m\ ;\ j\ <=\ P-\/l\ ;\ ++j\ )\{}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ coef\ =\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(-\/1.0),m)\ *\ (\ fact(j+l)\ /\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(b,j+l+1));}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ because\ \{l,-\/m\}\ =>\ \{l,m\}\ conjugate\ -\/1\string^m\ with\ -\/i}}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u\_lm\_real\ +=\ coef\ *\ source\_w[atLm(j,m)].\mbox{\hyperlink{class_f_complex_a33ec217df0f06432eec174977e0c87ff}{getReal}}();}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u\_lm\_imag\ -\/=\ coef\ *\ source\_w[atLm(j,m)].\mbox{\hyperlink{class_f_complex_ab4db8e82d8c014c17b06089163a3c204}{getImag}}();}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ target\_u[atLm(l,m)].\mbox{\hyperlink{class_f_complex_a0a39bf6c1f122ffcfc8da36c13952013}{setRealImag}}(u\_lm\_real,u\_lm\_imag);}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00567\ }
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rotate\ it\ back}}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ deRotateTaylor(target\_u,\ sph.\mbox{\hyperlink{class_f_spherical_ac47e9ee1557ed6e700cc985c9031a02b}{getPhiZero2Pi}}(),\ sph.\mbox{\hyperlink{class_f_spherical_a142b6af5616618a154c76983acdab34f}{getInclination}}());}
\DoxyCodeLine{00570\ }
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Sum}}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a5120d91235543eec7ee0ff0fc4bccebe}{FMemUtils::addall}}(inLocal-\/>getLocal(),\ target\_u,\ SizeArray);}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00574\ \ \ \ \ \}}
\DoxyCodeLine{00575\ }
\DoxyCodeLine{00587\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_rotation_original_kernel_aecb8098cddbb2facc14cb14060011a94}{L2L}}(\textcolor{keyword}{const}\ CellClass*\ \textcolor{keyword}{const}\ FRestrict\ inLocal,\ CellClass*\ FRestrict\ *\textcolor{keyword}{const}\ FRestrict\ \ inChildren,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inLevel)\textcolor{keyword}{override\ }\{}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ To\ copy\ the\ source\ local\ allocated\ once}}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ source\_u[SizeArray];}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ all\ children}}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxChild\ =\ 0\ ;\ idxChild\ <\ 8\ ;\ ++idxChild)\{}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ child\ exists}}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(inChildren[idxChild])\{}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ the\ local\ data\ into\ the\ buffer}}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a85a4b506a3e71e70cfb0c4e38320182e}{FMemUtils::copyall}}(source\_u,\ inLocal-\/>getLocal(),\ SizeArray);}
\DoxyCodeLine{00596\ }
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rotate}}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_spherical}{FSpherical<FReal>}}\ sph\ =\ getSphericalChild(inLevel,\ idxChild);}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rotateTaylor(source\_u,\ sph.\mbox{\hyperlink{class_f_spherical_ac47e9ee1557ed6e700cc985c9031a02b}{getPhiZero2Pi}}(),\ sph.\mbox{\hyperlink{class_f_spherical_a142b6af5616618a154c76983acdab34f}{getInclination}}());}
\DoxyCodeLine{00600\ }
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ b\ =\ sph.\mbox{\hyperlink{class_f_spherical_afe70b334deb1d5feae782bda8851056d}{getR}}();}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Translate}}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ target\_u[SizeArray];}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ l\ =\ 0\ ;\ l\ <=\ P\ ;\ ++l\ )\{}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ m\ =\ 0\ ;\ m\ <=\ l\ ;\ ++m\ )\{}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ u\{l,m\}(r-\/b)\ =\ sum(j=0:P,\ b\string^(j-\/l)/(j-\/l)!\ u\{j,m\}(r);}}
\DoxyCodeLine{00607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ u\_lm\_real\ =\ 0.0;}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ u\_lm\_imag\ =\ 0.0;}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ j\ =\ l\ ;\ j\ <=\ P\ ;\ ++j\ )\{}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ coef\ =\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(b,j-\/l)\ /\ fact(j-\/l);}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u\_lm\_real\ +=\ coef\ *\ source\_u[atLm(j,m)].\mbox{\hyperlink{class_f_complex_a33ec217df0f06432eec174977e0c87ff}{getReal}}();}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u\_lm\_imag\ +=\ coef\ *\ source\_u[atLm(j,m)].\mbox{\hyperlink{class_f_complex_ab4db8e82d8c014c17b06089163a3c204}{getImag}}();}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ target\_u[atLm(l,m)].\mbox{\hyperlink{class_f_complex_a0a39bf6c1f122ffcfc8da36c13952013}{setRealImag}}(u\_lm\_real,u\_lm\_imag);}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00617\ }
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rotate}}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ deRotateTaylor(target\_u,\ sph.\mbox{\hyperlink{class_f_spherical_ac47e9ee1557ed6e700cc985c9031a02b}{getPhiZero2Pi}}(),\ sph.\mbox{\hyperlink{class_f_spherical_a142b6af5616618a154c76983acdab34f}{getInclination}}());}
\DoxyCodeLine{00620\ }
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Sum\ in\ child}}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_f_mem_utils_a5120d91235543eec7ee0ff0fc4bccebe}{FMemUtils::addall}}(inChildren[idxChild]-\/>getLocal(),\ target\_u,\ SizeArray);}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00625\ \ \ \ \ \}}
\DoxyCodeLine{00626\ }
\DoxyCodeLine{00645\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_rotation_original_kernel_ae303a3929d3ebf29c386241cba3b7e1d}{L2P}}(\textcolor{keyword}{const}\ CellClass*\ \textcolor{keyword}{const}\ inLocal,\ ContainerClass*\ \textcolor{keyword}{const}\ inParticles)\textcolor{keyword}{override}\{}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ i\_pow\_m[4]\ =\ \{0,\ FMath::FPiDiv2<FReal>(),\ FMath::FPi<FReal>(),\ -\/FMath::FPiDiv2<FReal>()\};}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Take\ the\ local\ value\ from\ the\ cell}}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}*\ FRestrict\ \textcolor{keyword}{const}\ u\ =\ inLocal-\/>getLocal();}
\DoxyCodeLine{00649\ }
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copying\ the\ position\ is\ faster\ than\ using\ cell\ position}}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ cellPosition\ =\ getLeafCenter(inLocal-\/>getCoordinate());}
\DoxyCodeLine{00652\ }
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ all\ particles\ in\ the\ leaf\ box}}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ physicalValues\ =\ inParticles-\/>getPhysicalValues();}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsX\ =\ inParticles-\/>getPositions()[0];}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsY\ =\ inParticles-\/>getPositions()[1];}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsZ\ =\ inParticles-\/>getPositions()[2];}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ FReal*\textcolor{keyword}{const}\ forcesX\ =\ inParticles-\/>getForcesX();}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ FReal*\textcolor{keyword}{const}\ forcesY\ =\ inParticles-\/>getForcesY();}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ FReal*\textcolor{keyword}{const}\ forcesZ\ =\ inParticles-\/>getForcesZ();}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ FReal*\textcolor{keyword}{const}\ potentials\ =\ inParticles-\/>getPotentials();}
\DoxyCodeLine{00662\ }
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(FSize\ idxPart\ =\ 0\ ;\ idxPart\ <\ inParticles-\/>getNbParticles()\ ;\ ++\ idxPart)\{}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ L2P}}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ position(positionsX[idxPart],positionsY[idxPart],positionsZ[idxPart]);}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_spherical}{FSpherical<FReal>}}\ sph(position\ -\/\ cellPosition);}
\DoxyCodeLine{00667\ }
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ distance\ between\ the\ SH\ and\ the\ particle}}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ r\ =\ sph.\mbox{\hyperlink{class_f_spherical_afe70b334deb1d5feae782bda8851056d}{getR}}();}
\DoxyCodeLine{00670\ }
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ legendre\ polynomial}}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ legendre[SizeArray];}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \ \ \ \ computeLegendre(legendre,\ sph.\mbox{\hyperlink{class_f_spherical_a7f3ca3427a17cf1b9e114aa1ed7049a3}{getCosTheta}}(),\ sph.\mbox{\hyperlink{class_f_spherical_accff4b45e34fd2b215715563a68a412f}{getSinTheta}}());}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ Fr\ =\ 0;}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ FO\ =\ 0;}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ Fp\ =\ 0;}
\DoxyCodeLine{00678\ }
\DoxyCodeLine{00679\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ l\ =\ 1\ ;\ l\ <=\ P\ ;\ ++l)\{}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ coef\ =\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(-\/1.0),l)\ *\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(r,l)\ *\ legendre[atLm(l,0)]\ /\ fact(l+0);}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ I\_real\ =\ coef\ *\ \mbox{\hyperlink{struct_f_math_a914d36d095fd8cd600ec18e932664fe3}{FMath::Cos}}(FReal(0)\ *\ sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}()\ +\ i\_pow\_m[0]);}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ I\_imag\ =\ coef\ *\ \mbox{\hyperlink{struct_f_math_a5bdcccf9bf4d10eee66f711044904ace}{FMath::Sin}}(FReal(0)\ *\ sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}()\ +\ i\_pow\_m[0]);}
\DoxyCodeLine{00684\ }
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Fr\ +=\ FReal(l)\ *\ (u[atLm(l,0)].\mbox{\hyperlink{class_f_complex_a33ec217df0f06432eec174977e0c87ff}{getReal}}()\ *\ I\_real\ -\/\ u[atLm(l,0)].\mbox{\hyperlink{class_f_complex_ab4db8e82d8c014c17b06089163a3c204}{getImag}}()\ *\ I\_imag);}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ coef\ =\ (\mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(-\/1.0),l)/fact(l+0))\ *\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(r,l)\ *\ ((FReal(l)\ *\ sph.\mbox{\hyperlink{class_f_spherical_a7f3ca3427a17cf1b9e114aa1ed7049a3}{getCosTheta}}()*legendre[atLm(l,0)]}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ FReal(l)\ *\ legendre[atLm(l-\/1,0)])\ /\ sph.\mbox{\hyperlink{class_f_spherical_accff4b45e34fd2b215715563a68a412f}{getSinTheta}}());}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ dI\_real\ =\ coef\ *\ \mbox{\hyperlink{struct_f_math_a914d36d095fd8cd600ec18e932664fe3}{FMath::Cos}}(FReal(0)\ *\ sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}()\ +\ i\_pow\_m[0\ \&\ 0x3]);}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ dI\_imag\ =\ coef\ *\ \mbox{\hyperlink{struct_f_math_a5bdcccf9bf4d10eee66f711044904ace}{FMath::Sin}}(FReal(0)\ *\ sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}()\ +\ i\_pow\_m[0\ \&\ 0x3]);}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ F(O)\ +=\ 2\ *\ Real(L\ dI/dO)}}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FO\ +=\ u[atLm(l,0)].\mbox{\hyperlink{class_f_complex_a33ec217df0f06432eec174977e0c87ff}{getReal}}()\ *\ dI\_real\ -\/\ u[atLm(l,0)].\mbox{\hyperlink{class_f_complex_ab4db8e82d8c014c17b06089163a3c204}{getImag}}()\ *\ dI\_imag;}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ m\ =\ 1\ ;\ m\ <=\ l\ ;\ ++m)\{}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ coef\ =\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(-\/1.0),l)\ *\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(r,l)\ *\ legendre[atLm(l,m)]\ /\ fact(l+m);}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ I\_real\ =\ coef\ *\ \mbox{\hyperlink{struct_f_math_a914d36d095fd8cd600ec18e932664fe3}{FMath::Cos}}(FReal(m)\ *\ sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}()\ +\ i\_pow\_m[m\ \&\ 0x3]);}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ I\_imag\ =\ coef\ *\ \mbox{\hyperlink{struct_f_math_a5bdcccf9bf4d10eee66f711044904ace}{FMath::Sin}}(FReal(m)\ *\ sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}()\ +\ i\_pow\_m[m\ \&\ 0x3]);}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ F(r)\ +=\ 2\ x\ l\ x\ Real(LI)}}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Fr\ +=\ 2\ *\ FReal(l)\ *\ (u[atLm(l,m)].\mbox{\hyperlink{class_f_complex_a33ec217df0f06432eec174977e0c87ff}{getReal}}()\ *\ I\_real\ -\/\ u[atLm(l,m)].\mbox{\hyperlink{class_f_complex_ab4db8e82d8c014c17b06089163a3c204}{getImag}}()\ *\ I\_imag);}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ F(p)\ +=\ -\/2\ x\ m\ x\ Imag(LI)}}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Fp\ -\/=\ 2\ *\ FReal(m)\ *\ (u[atLm(l,m)].\mbox{\hyperlink{class_f_complex_a33ec217df0f06432eec174977e0c87ff}{getReal}}()\ *\ I\_imag\ +\ u[atLm(l,m)].\mbox{\hyperlink{class_f_complex_ab4db8e82d8c014c17b06089163a3c204}{getImag}}()\ *\ I\_real);}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ legendre\_l\_minus\_1\ =\ (m\ ==\ l)\ ?\ 0\ :\ FReal(l+m)*legendre[atLm(l-\/1,m)];}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ coef\ =\ (\mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(-\/1.0),l)/fact(l+m))\ *\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(r,l)\ *\ ((FReal(l)\ *\ sph.\mbox{\hyperlink{class_f_spherical_a7f3ca3427a17cf1b9e114aa1ed7049a3}{getCosTheta}}()*legendre[atLm(l,m)]}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ legendre\_l\_minus\_1)\ /\ sph.\mbox{\hyperlink{class_f_spherical_accff4b45e34fd2b215715563a68a412f}{getSinTheta}}());}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ dI\_real\ =\ coef\ *\ \mbox{\hyperlink{struct_f_math_a914d36d095fd8cd600ec18e932664fe3}{FMath::Cos}}(FReal(m)\ *\ sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}()\ +\ i\_pow\_m[m\ \&\ 0x3]);}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ dI\_imag\ =\ coef\ *\ \mbox{\hyperlink{struct_f_math_a5bdcccf9bf4d10eee66f711044904ace}{FMath::Sin}}(FReal(m)\ *\ sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}()\ +\ i\_pow\_m[m\ \&\ 0x3]);}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ F(O)\ +=\ 2\ *\ Real(L\ dI/dO)}}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FO\ +=\ FReal(2.0)\ *\ (u[atLm(l,m)].\mbox{\hyperlink{class_f_complex_a33ec217df0f06432eec174977e0c87ff}{getReal}}()\ *\ dI\_real\ -\/\ u[atLm(l,m)].\mbox{\hyperlink{class_f_complex_ab4db8e82d8c014c17b06089163a3c204}{getImag}}()\ *\ dI\_imag);}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ div\ by\ r}}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Fr\ /=\ sph.\mbox{\hyperlink{class_f_spherical_afe70b334deb1d5feae782bda8851056d}{getR}}();}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FO\ /=\ sph.\mbox{\hyperlink{class_f_spherical_afe70b334deb1d5feae782bda8851056d}{getR}}();}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Fp\ /=\ sph.\mbox{\hyperlink{class_f_spherical_afe70b334deb1d5feae782bda8851056d}{getR}}()\ *\ sph.\mbox{\hyperlink{class_f_spherical_accff4b45e34fd2b215715563a68a412f}{getSinTheta}}();}
\DoxyCodeLine{00721\ }
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ copy\ variable\ from\ spherical\ position}}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ cosPhi\ \ \ \ \ =\ \mbox{\hyperlink{struct_f_math_a914d36d095fd8cd600ec18e932664fe3}{FMath::Cos}}(sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}());}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ sinPhi\ \ \ \ \ =\ \mbox{\hyperlink{struct_f_math_a5bdcccf9bf4d10eee66f711044904ace}{FMath::Sin}}(sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}());}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ physicalValue\ =\ physicalValues[idxPart];}
\DoxyCodeLine{00726\ }
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ compute\ forces}}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ forceX\ =\ (}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cosPhi\ *\ sph.\mbox{\hyperlink{class_f_spherical_accff4b45e34fd2b215715563a68a412f}{getSinTheta}}()\ *\ Fr\ \ +}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cosPhi\ *\ sph.\mbox{\hyperlink{class_f_spherical_a7f3ca3427a17cf1b9e114aa1ed7049a3}{getCosTheta}}()\ *\ FO\ +}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (-\/sinPhi)\ *\ Fp)\ *\ physicalValue;}
\DoxyCodeLine{00732\ }
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ forceY\ =\ (}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sinPhi\ *\ sph.\mbox{\hyperlink{class_f_spherical_accff4b45e34fd2b215715563a68a412f}{getSinTheta}}()\ *\ Fr\ \ +}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sinPhi\ *\ sph.\mbox{\hyperlink{class_f_spherical_a7f3ca3427a17cf1b9e114aa1ed7049a3}{getCosTheta}}()\ *\ FO\ +}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cosPhi\ *\ Fp)\ *\ physicalValue;}
\DoxyCodeLine{00737\ }
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ forceZ\ =\ (}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sph.\mbox{\hyperlink{class_f_spherical_a7f3ca3427a17cf1b9e114aa1ed7049a3}{getCosTheta}}()\ *\ Fr\ +}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (-\/sph.\mbox{\hyperlink{class_f_spherical_accff4b45e34fd2b215715563a68a412f}{getSinTheta}}())\ *\ FO)\ *\ physicalValue;}
\DoxyCodeLine{00741\ }
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ inc\ particles\ forces}}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ forcesX[idxPart]\ +=\ forceX;}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ forcesY[idxPart]\ +=\ forceY;}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ forcesZ[idxPart]\ +=\ forceZ;}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00747\ }
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ Result\ for\ potential}}
\DoxyCodeLine{00749\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ magnitude\ =\ 0;}
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ E\ =\ sum(\ l\ =\ 0:P,\ sum(m\ =\ -\/l:l,\ u\{l,m\}\ ))}}
\DoxyCodeLine{00751\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ l\ =\ 0\ ;\ l\ <=\ P\ ;\ ++l\ )\{}
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (l-\/|m|)!\ *\ P\{l,0\}\ /\ r\string^(l+1)}}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ coef\ =\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(-\/1.0),l)\ *\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(r,l)\ *\ legendre[atLm(l,0)]\ /\ fact(l+0);}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ I\_real\ =\ coef\ *\ \mbox{\hyperlink{struct_f_math_a914d36d095fd8cd600ec18e932664fe3}{FMath::Cos}}(FReal(0)\ *\ sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}()\ +\ i\_pow\_m[0]);}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ I\_imag\ =\ coef\ *\ \mbox{\hyperlink{struct_f_math_a5bdcccf9bf4d10eee66f711044904ace}{FMath::Sin}}(FReal(0)\ *\ sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}()\ +\ i\_pow\_m[0]);}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ magnitude\ +=\ u[atLm(l,0)].\mbox{\hyperlink{class_f_complex_a33ec217df0f06432eec174977e0c87ff}{getReal}}()\ *\ I\_real\ -\/\ u[atLm(l,0)].\mbox{\hyperlink{class_f_complex_ab4db8e82d8c014c17b06089163a3c204}{getImag}}()\ *\ I\_imag;}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ m\ =\ 1\ ;\ m\ <=\ l\ ;\ ++m\ )\{}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ coef\ =\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(FReal(-\/1.0),l)\ *\ \mbox{\hyperlink{struct_f_math_a29fd39b5d729c7e4118b4559548f5d1f}{FMath::pow}}(r,l)\ *\ legendre[atLm(l,m)]\ /\ fact(l+m);}
\DoxyCodeLine{00761\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ I\_real\ =\ coef\ *\ \mbox{\hyperlink{struct_f_math_a914d36d095fd8cd600ec18e932664fe3}{FMath::Cos}}(FReal(m)\ *\ sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}()\ +\ i\_pow\_m[m\ \&\ 0x3]);}
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ I\_imag\ =\ coef\ *\ \mbox{\hyperlink{struct_f_math_a5bdcccf9bf4d10eee66f711044904ace}{FMath::Sin}}(FReal(m)\ *\ sph.\mbox{\hyperlink{class_f_spherical_adf0db5a2f069c50c9c55be96457dd41d}{getPhi}}()\ +\ i\_pow\_m[m\ \&\ 0x3]);}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ magnitude\ +=\ FReal(2.0)\ *\ (\ u[atLm(l,m)].\mbox{\hyperlink{class_f_complex_a33ec217df0f06432eec174977e0c87ff}{getReal}}()\ *\ I\_real\ -\/\ u[atLm(l,m)].\mbox{\hyperlink{class_f_complex_ab4db8e82d8c014c17b06089163a3c204}{getImag}}()\ *\ I\_imag\ );}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ inc\ potential}}
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ potentials[idxPart]\ +=\ magnitude;}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00770\ \ \ \ \ \}}
\DoxyCodeLine{00771\ }
\DoxyCodeLine{00772\ }
\DoxyCodeLine{00779\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_rotation_original_kernel_a3475974fb9b04256304f5d48c630b941}{P2P}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\&\ inPosition,}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass*\ \textcolor{keyword}{const}\ FRestrict\ inTargets,\ \textcolor{keyword}{const}\ ContainerClass*\ \textcolor{keyword}{const}\ FRestrict\ inSources,}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass*\ \textcolor{keyword}{const}\ inNeighbors[],\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ neighborPositions[],}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inSize)\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(inTargets\ ==\ inSources)\{}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_f_p2_p_r_t}{FP2PRT<FReal>::template}}\ Inner<ContainerClass>(inTargets);}
\DoxyCodeLine{00785\ \ \ \ \ \ \ \ \ \ \ \ \ P2POuter(inPosition,\ inTargets,\ inNeighbors,\ neighborPositions,\ inSize);}
\DoxyCodeLine{00786\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ContainerClass*\ \textcolor{keyword}{const}\ srcPtr[1]\ =\ \{inSources\};}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_f_p2_p_r_t}{FP2PRT<FReal>::template}}\ FullRemote<ContainerClass>(inTargets,srcPtr,1);}
\DoxyCodeLine{00790\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_f_p2_p_r_t}{FP2PRT<FReal>::template}}\ FullRemote<ContainerClass>(inTargets,inNeighbors,inSize);}
\DoxyCodeLine{00791\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00792\ \ \ \ \ \}}
\DoxyCodeLine{00793\ }
\DoxyCodeLine{00794\ \ \ \ \ \textcolor{keywordtype}{void}\ P2POuter(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\&\ \textcolor{comment}{/*inLeafPosition*/},}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass*\ \textcolor{keyword}{const}\ FRestrict\ inTargets,}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass*\ \textcolor{keyword}{const}\ inNeighbors[],\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ neighborPositions[],}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inSize)\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nbNeighborsToCompute\ =\ 0;}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(nbNeighborsToCompute\ <\ inSize}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ neighborPositions[nbNeighborsToCompute]\ <\ 14)\{}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \ \ \ \ nbNeighborsToCompute\ +=\ 1;}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_f_p2_p_r_t}{FP2PRT<FReal>::template}}\ FullMutual<ContainerClass>(inTargets,inNeighbors,nbNeighborsToCompute);}
\DoxyCodeLine{00804\ \ \ \ \ \}}
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00806\ }
\DoxyCodeLine{00808\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_rotation_original_kernel_a5c56685f988166f20ab3e05b752e2dcd}{P2PRemote}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_tree_coordinate}{FTreeCoordinate}}\&\ \textcolor{comment}{/*inPosition*/},}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass*\ \textcolor{keyword}{const}\ FRestrict\ inTargets,\ \textcolor{keyword}{const}\ ContainerClass*\ \textcolor{keyword}{const}\ FRestrict\ \textcolor{comment}{/*inSources*/},}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ContainerClass*\ \textcolor{keyword}{const}\ inNeighbors[],\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ neighborPositions[],}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inSize)\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_f_p2_p_r_t}{FP2PRT<FReal>::template}}\ FullRemote<ContainerClass>(inTargets,inNeighbors,inSize);}
\DoxyCodeLine{00813\ \ \ \ \ \}}
\DoxyCodeLine{00814\ \};}
\DoxyCodeLine{00815\ }
\DoxyCodeLine{00816\ }
\DoxyCodeLine{00817\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ FROTATIONORIGINALKERNEL\_HPP}}

\end{DoxyCode}
