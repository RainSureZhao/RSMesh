\doxysection{FUnif\+Interpolator.\+hpp}
\hypertarget{_f_unif_interpolator_8hpp_source}{}\label{_f_unif_interpolator_8hpp_source}\index{third\_party/ScalFMM/include/ScalFMM/Kernels/Uniform/FUnifInterpolator.hpp@{third\_party/ScalFMM/include/ScalFMM/Kernels/Uniform/FUnifInterpolator.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ See\ LICENCE\ file\ at\ project\ root}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Keep\ in\ private\ GIT}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#ifndef\ FUNIFINTERPOLATOR\_HPP}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#define\ FUNIFINTERPOLATOR\_HPP}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}../Interpolation/FInterpMapping.hpp"{}}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}FUnifTensor.hpp"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}FUnifRoots.hpp"{}}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}Utils/FBlas.hpp"{}}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{template}\ <\ \textcolor{keyword}{class}\ FReal,\textcolor{keywordtype}{int}\ ORDER,\ \textcolor{keyword}{class}\ MatrixKernelClass,\ \textcolor{keywordtype}{int}\ NVALS\ =\ 1>}
\DoxyCodeLine{00029\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_f_unif_interpolator}{FUnifInterpolator}}\ :\ \mbox{\hyperlink{class_f_no_copyable}{FNoCopyable}}}
\DoxyCodeLine{00030\ \{}
\DoxyCodeLine{00031\ \ \ \textcolor{comment}{//\ compile\ time\ constants\ and\ types}}
\DoxyCodeLine{00032\ \ \ \textcolor{keyword}{enum}\ \{nnodes\ =\ \mbox{\hyperlink{struct_tensor_traits}{TensorTraits<ORDER>::nnodes}},}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ nRhs\ =\ MatrixKernelClass::NRHS,}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ nLhs\ =\ MatrixKernelClass::NLHS,}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ nPV\ =\ MatrixKernelClass::NPV,}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ nVals\ =\ NVALS\};}
\DoxyCodeLine{00037\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{struct_f_unif_roots}{FUnifRoots<FReal,\ ORDER>}}\ \ \ \mbox{\hyperlink{struct_f_unif_roots}{BasisType}};}
\DoxyCodeLine{00038\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_f_unif_tensor}{FUnifTensor<FReal,\ ORDER>}}\ \mbox{\hyperlink{class_f_unif_tensor}{TensorType}};}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ node\_ids[nnodes][3];}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \textcolor{comment}{//\ 8\ Non-\/leaf\ (i.e.\ M2M/L2L)\ interpolators}}
\DoxyCodeLine{00043\ \ \ \textcolor{comment}{//\ x1\ per\ level\ if\ box\ is\ extended}}
\DoxyCodeLine{00044\ \ \ \textcolor{comment}{//\ only\ 1\ is\ required\ for\ all\ levels\ if\ extension\ is\ 0}}
\DoxyCodeLine{00045\ \ \ FReal***\ ChildParentInterpolator;}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \textcolor{comment}{//\ Tree\ height\ (needed\ by\ M2M/L2L\ if\ cell\ width\ is\ extended)}}
\DoxyCodeLine{00048\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ TreeHeight;}
\DoxyCodeLine{00049\ \ \ \textcolor{comment}{//\ Root\ cell\ width\ (only\ used\ by\ M2M/L2L)}}
\DoxyCodeLine{00050\ \ \ \textcolor{keyword}{const}\ FReal\ RootCellWidth;}
\DoxyCodeLine{00051\ \ \ \textcolor{comment}{//\ Cell\ width\ extension\ (only\ used\ by\ M2M/L2L,\ kernel\ handles\ extension\ for\ P2M/L2P)}}
\DoxyCodeLine{00052\ \ \ \textcolor{keyword}{const}\ FReal\ CellWidthExtension;}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \textcolor{comment}{//\ permutations\ (only\ needed\ in\ the\ tensor\ product\ interpolation\ case)}}
\DoxyCodeLine{00056\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ perm[3][nnodes];}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \textcolor{comment}{//\ PB:\ use\ improved\ version\ of\ M2M/L2L}}
\DoxyCodeLine{00067\ \textcolor{comment}{/*}}
\DoxyCodeLine{00068\ \textcolor{comment}{\ \ void\ initM2MandL2L()}}
\DoxyCodeLine{00069\ \textcolor{comment}{\ \ \{}}
\DoxyCodeLine{00070\ \textcolor{comment}{\ \ \ \ FPoint<FReal>\ ParentRoots[nnodes],\ ChildRoots[nnodes];}}
\DoxyCodeLine{00071\ \textcolor{comment}{\ \ \ \ const\ FReal\ ParentWidth(2.);}}
\DoxyCodeLine{00072\ \textcolor{comment}{\ \ \ \ const\ FPoint<FReal>\ ParentCenter(0.,\ 0.,\ 0.);}}
\DoxyCodeLine{00073\ \textcolor{comment}{\ \ \ \ FUnifTensor<FReal,ORDER>::setRoots(ParentCenter,\ ParentWidth,\ ParentRoots);}}
\DoxyCodeLine{00074\ \textcolor{comment}{}}
\DoxyCodeLine{00075\ \textcolor{comment}{\ \ \ \ FPoint<FReal>\ ChildCenter;}}
\DoxyCodeLine{00076\ \textcolor{comment}{\ \ \ \ const\ FReal\ ChildWidth(1.);}}
\DoxyCodeLine{00077\ \textcolor{comment}{}}
\DoxyCodeLine{00078\ \textcolor{comment}{\ \ \ \ //\ loop:\ child\ cells}}
\DoxyCodeLine{00079\ \textcolor{comment}{\ \ \ \ for\ (unsigned\ int\ child=0;\ child<8;\ ++child)\ \{}}
\DoxyCodeLine{00080\ \textcolor{comment}{}}
\DoxyCodeLine{00081\ \textcolor{comment}{\ \ \ \ \ \ //\ allocate\ memory}}
\DoxyCodeLine{00082\ \textcolor{comment}{\ \ \ \ \ \ ChildParentInterpolator[child]\ =\ new\ FReal\ [nnodes\ *\ nnodes];}}
\DoxyCodeLine{00083\ \textcolor{comment}{}}
\DoxyCodeLine{00084\ \textcolor{comment}{\ \ \ \ \ \ //\ set\ child\ info}}
\DoxyCodeLine{00085\ \textcolor{comment}{\ \ \ \ \ \ FUnifTensor<FReal,ORDER>::setRelativeChildCenter(child,\ ChildCenter);}}
\DoxyCodeLine{00086\ \textcolor{comment}{\ \ \ \ \ \ FUnifTensor<FReal,ORDER>::setRoots(ChildCenter,\ ChildWidth,\ ChildRoots);}}
\DoxyCodeLine{00087\ \textcolor{comment}{}}
\DoxyCodeLine{00088\ \textcolor{comment}{\ \ \ \ \ \ //\ assemble\ child\ -\/\ parent\ -\/\ interpolator}}
\DoxyCodeLine{00089\ \textcolor{comment}{\ \ \ \ \ \ assembleInterpolator(nnodes,\ ChildRoots,\ ChildParentInterpolator[child]);}}
\DoxyCodeLine{00090\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00091\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00092\ \textcolor{comment}{*/}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00099\ \ \ \textcolor{keywordtype}{void}\ initTensorM2MandL2L(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ TreeLevel,\ \textcolor{keyword}{const}\ FReal\ ParentWidth)}
\DoxyCodeLine{00100\ \ \ \{}
\DoxyCodeLine{00101\ \ \ \ \ FReal\ ChildCoords[3][ORDER];}
\DoxyCodeLine{00102\ \ \ \ \ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ ChildCenter;}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{comment}{//\ Ratio\ of\ extended\ cell\ widths\ (definition:\ child\ ext\ /\ parent\ ext)}}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keyword}{const}\ FReal\ ExtendedCellRatio\ =}
\DoxyCodeLine{00106\ \ \ \ \ \ \ FReal(FReal(ParentWidth)/FReal(2.)\ +\ CellWidthExtension)\ /\ FReal(ParentWidth\ +\ CellWidthExtension);}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{comment}{//\ Child\ cell\ width}}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keyword}{const}\ FReal\ ChildWidth(FReal(2.)*ExtendedCellRatio);}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{comment}{//\ loop:\ child\ cells}}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ child=0;\ child<8;\ ++child)\ \{}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ \ \ \textcolor{comment}{//\ set\ child\ info}}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \mbox{\hyperlink{class_f_interp_tensor_a3e87e6a9c05e36db6e7e902d81ff1e66}{FUnifTensor<FReal,\ ORDER>::setRelativeChildCenter}}(child,\ ChildCenter,\ ExtendedCellRatio);}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \mbox{\hyperlink{class_f_interp_tensor_abc18f0f754049c342b5f808990ba95d0}{FUnifTensor<FReal,\ ORDER>::setPolynomialsRoots}}(ChildCenter,\ ChildWidth,\ ChildCoords);}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \ \ \textcolor{comment}{//\ allocate\ memory}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ ChildParentInterpolator[TreeLevel][child]\ =\ \textcolor{keyword}{new}\ FReal\ [3\ *\ ORDER*ORDER];}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \mbox{\hyperlink{class_f_unif_interpolator_ab5f15e3036f7b1fbf23a1325c0d7e578}{assembleInterpolator}}(ORDER,\ ChildCoords[0],\ ChildParentInterpolator[TreeLevel][child]);}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \mbox{\hyperlink{class_f_unif_interpolator_ab5f15e3036f7b1fbf23a1325c0d7e578}{assembleInterpolator}}(ORDER,\ ChildCoords[1],\ ChildParentInterpolator[TreeLevel][child]\ +\ 1\ *\ ORDER*ORDER);}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \mbox{\hyperlink{class_f_unif_interpolator_ab5f15e3036f7b1fbf23a1325c0d7e578}{assembleInterpolator}}(ORDER,\ ChildCoords[2],\ ChildParentInterpolator[TreeLevel][child]\ +\ 2\ *\ ORDER*ORDER);}
\DoxyCodeLine{00123\ \ \ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{comment}{//\ init\ permutations}}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i=0;\ i<ORDER;\ ++i)\ \{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j=0;\ j<ORDER;\ ++j)\ \{}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ k=0;\ k<ORDER;\ ++k)\ \{}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ index\ =\ k*ORDER*ORDER\ +\ j*ORDER\ +\ i;}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ perm[0][index]\ =\ k*ORDER*ORDER\ +\ j*ORDER\ +\ i;}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ perm[1][index]\ =\ i*ORDER*ORDER\ +\ k*ORDER\ +\ j;}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ perm[2][index]\ =\ j*ORDER*ORDER\ +\ i*ORDER\ +\ k;}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00136\ \ \ \ \ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00152\ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{class_f_unif_interpolator_af995e4a1842c56400021da236c677981}{FUnifInterpolator}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ inTreeHeight=3,}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ inRootCellWidth=FReal(1.),}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ inCellWidthExtension=FReal(0.))}
\DoxyCodeLine{00155\ \ \ :\ TreeHeight(inTreeHeight),}
\DoxyCodeLine{00156\ \ \ \ \ RootCellWidth(inRootCellWidth),}
\DoxyCodeLine{00157\ \ \ \ \ CellWidthExtension(inCellWidthExtension)}
\DoxyCodeLine{00158\ \ \ \{}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{comment}{//\ initialize\ root\ node\ ids}}
\DoxyCodeLine{00160\ \ \ \ \ \mbox{\hyperlink{class_f_interp_tensor_aeecba74045a1cd16382c87ab3acdb20a}{TensorType::setNodeIds}}(node\_ids);}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{comment}{//\ initialize\ interpolation\ operator\ for\ M2M\ and\ L2L\ (non\ leaf\ operations)}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{comment}{//\ allocate\ 8\ arrays\ per\ level}}
\DoxyCodeLine{00165\ \ \ \ \ ChildParentInterpolator\ =\ \textcolor{keyword}{new}\ FReal**[TreeHeight];}
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ \textcolor{keywordtype}{int}\ l=0;\ l<TreeHeight;\ ++l)\{}
\DoxyCodeLine{00167\ \ \ \ \ \ \ ChildParentInterpolator[l]\ =\ \textcolor{keyword}{new}\ FReal*[8];}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ c=0;\ c<8;\ ++c)}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ ChildParentInterpolator[l][c]=\textcolor{keyword}{nullptr};}
\DoxyCodeLine{00170\ \ \ \ \ \}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{comment}{//\ Set\ number\ of\ non-\/leaf\ ios\ that\ actually\ need\ to\ be\ computed}}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ reducedTreeHeight;\ \textcolor{comment}{//\ =\ 2\ +\ nb\ of\ computed\ nl\ ios}}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keywordflow}{if}(CellWidthExtension==0.)\ \textcolor{comment}{//\ if\ no\ cell\ extension,\ then\ ...}}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ reducedTreeHeight\ =\ std::min(3,\ TreeHeight);\ \textcolor{comment}{//\ cmp\ only\ 1\ non-\/leaf\ io}}
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ reducedTreeHeight\ =\ TreeHeight;\ \textcolor{comment}{//\ cmp\ 1\ non-\/leaf\ io\ per\ level}}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{comment}{//\ Init\ non-\/leaf\ interpolators}}
\DoxyCodeLine{00180\ \ \ \ \ FReal\ CellWidth\ =\ RootCellWidth\ /\ FReal(2.);\ \textcolor{comment}{//\ at\ level\ 1}}
\DoxyCodeLine{00181\ \ \ \ \ CellWidth\ /=\ FReal(2.);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ at\ level\ 2}}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ l=2;\ l<reducedTreeHeight;\ ++l)\ \{}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ \ \ \textcolor{comment}{//this\ -\/>\ initM2MandL2L(l,CellWidth);\ \ \ \ \ //\ non\ tensor-\/product\ interpolation}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \textcolor{keyword}{this}\ -\/>\ initTensorM2MandL2L(l,CellWidth);\ \textcolor{comment}{//\ tensor-\/product\ interpolation}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \ \ \ \ \textcolor{comment}{//\ update\ cell\ width}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ CellWidth\ /=\ FReal(2.);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ at\ level\ l+1}}
\DoxyCodeLine{00190\ \ \ \ \ \}}
\DoxyCodeLine{00191\ \ \ \}}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00197\ \ \ \mbox{\hyperlink{class_f_unif_interpolator_aa90bcddd68390d603cbcb3e7b4db3753}{\string~FUnifInterpolator}}()}
\DoxyCodeLine{00198\ \ \ \{}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ \textcolor{keywordtype}{int}\ l=0;\ l<TreeHeight;\ ++l)\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ child=0;\ child<8;\ ++child)\{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(ChildParentInterpolator[l][child]\ !=\ \textcolor{keyword}{nullptr})\{}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ ChildParentInterpolator[l][child];}
\DoxyCodeLine{00203\ \ \ \ \ \}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ ChildParentInterpolator[l];}
\DoxyCodeLine{00206\ \ \ \ \ \}}
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{keyword}{delete}\ []\ ChildParentInterpolator;}
\DoxyCodeLine{00208\ \ \ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00220\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_unif_interpolator_ab5f15e3036f7b1fbf23a1325c0d7e578}{assembleInterpolator}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ NumberOfLocalPoints,}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ *\textcolor{keyword}{const}\ LocalPoints,}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ Interpolator)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00223\ \textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{comment}{//\ values\ of\ Lagrange\ polynomials\ of\ source\ particle:\ L\_o(x\_i)}}
\DoxyCodeLine{00225\ \ \ \ \ FReal\ L\_of\_x[ORDER][3];}
\DoxyCodeLine{00226\ \ \ \ \ \textcolor{comment}{//\ loop:\ local\ points\ (mapped\ in\ [-\/1,1])}}
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ m=0;\ m<NumberOfLocalPoints;\ ++m)\ \{}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \textcolor{comment}{//\ evaluate\ Lagrange\ polynomials\ at\ local\ points}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ o=0;\ o<ORDER;\ ++o)\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ L\_of\_x[o][0]\ =\ \mbox{\hyperlink{struct_f_unif_roots_a6eebbab212e497f8202bb65518c4753f}{BasisType::L}}(o,\ LocalPoints[m].getX());}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ L\_of\_x[o][1]\ =\ \mbox{\hyperlink{struct_f_unif_roots_a6eebbab212e497f8202bb65518c4753f}{BasisType::L}}(o,\ LocalPoints[m].getY());}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ L\_of\_x[o][2]\ =\ \mbox{\hyperlink{struct_f_unif_roots_a6eebbab212e497f8202bb65518c4753f}{BasisType::L}}(o,\ LocalPoints[m].getZ());}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ \ \ \ \ \textcolor{comment}{//\ assemble\ interpolator}}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<nnodes;\ ++n)\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ Interpolator[n*NumberOfLocalPoints\ +\ m]\ =\ FReal(1.);}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ d=0;\ d<3;\ ++d)\ \{}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ node\_ids[n][d];}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ Lagrange\ case\ is\ much\ simpler\ than\ the\ Chebyshev\ case}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ as\ no\ summation\ is\ required}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ Interpolator[n*NumberOfLocalPoints\ +\ m]\ *=\ L\_of\_x[j][d];}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ \ \ \}}
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \ \ \}}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_unif_interpolator_ab5f15e3036f7b1fbf23a1325c0d7e578}{assembleInterpolator}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ M,\ \textcolor{keyword}{const}\ FReal\ *\textcolor{keyword}{const}\ x,\ FReal\ *\textcolor{keyword}{const}\ S)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00253\ \textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{00254\ \ \ \ \ \textcolor{comment}{//\ loop:\ local\ points\ (mapped\ in\ [-\/1,1])}}
\DoxyCodeLine{00255\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ m=0;\ m<M;\ ++m)\ \{}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \textcolor{comment}{//\ evaluate\ Lagrange\ polynomials\ at\ local\ points}}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ o=0;\ o<ORDER;\ ++o)}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ S[o*M\ +\ m]\ =\ \mbox{\hyperlink{struct_f_unif_roots_a6eebbab212e497f8202bb65518c4753f}{BasisType::L}}(o,\ x[m]);}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \ \ \ \ \}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \textcolor{keyword}{const}\ FReal\ *\textcolor{keyword}{const}\ *\ getChildParentInterpolator()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00267\ \textcolor{keyword}{\ \ }\{\ \textcolor{keywordflow}{return}\ ChildParentInterpolator;\ \}}
\DoxyCodeLine{00268\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ *\ getPermutationsM2ML2L(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00269\ \textcolor{keyword}{\ \ }\{\ \textcolor{keywordflow}{return}\ perm[i];\ \}}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00280\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ContainerClass>}
\DoxyCodeLine{00281\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_unif_interpolator_a3234e3ea88ad97b7263927d211879da6}{applyP2M}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ center,}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ width,}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ multipoleExpansion,}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ContainerClass\ *\textcolor{keyword}{const}\ sourceParticles)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00291\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ContainerClass>}
\DoxyCodeLine{00292\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_unif_interpolator_a262fb412654ba58ae36d8f697c9113b2}{applyL2P}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ center,}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ width,}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ *\textcolor{keyword}{const}\ localExpansion,}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass\ *\textcolor{keyword}{const}\ localParticles)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00301\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ContainerClass>}
\DoxyCodeLine{00302\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_unif_interpolator_a63eccb7e2da74d9f8a452838d1af1d75}{applyL2PGradient}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ center,}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ width,}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ *\textcolor{keyword}{const}\ localExpansion,}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass\ *\textcolor{keyword}{const}\ localParticles)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00311\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ContainerClass>}
\DoxyCodeLine{00312\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_unif_interpolator_a77895628b85264058935bedc129b6026}{applyL2PTotal}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ center,}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ width,}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ *\textcolor{keyword}{const}\ localExpansion,}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass\ *\textcolor{keyword}{const}\ localParticles)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ \textcolor{comment}{//\ PB:\ ORDER\string^6\ version\ of\ applyM2M/L2L}}
\DoxyCodeLine{00318\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00319\ \textcolor{comment}{\ \ \ \ void\ applyM2M(const\ unsigned\ int\ ChildIndex,}}
\DoxyCodeLine{00320\ \textcolor{comment}{\ \ \ \ const\ FReal\ *const\ ChildExpansion,}}
\DoxyCodeLine{00321\ \textcolor{comment}{\ \ \ \ FReal\ *const\ ParentExpansion)\ const}}
\DoxyCodeLine{00322\ \textcolor{comment}{\ \ \ \ \{}}
\DoxyCodeLine{00323\ \textcolor{comment}{\ \ \ \ FBlas::gemtva(nnodes,\ nnodes,\ FReal(1.),}}
\DoxyCodeLine{00324\ \textcolor{comment}{\ \ \ \ ChildParentInterpolator[ChildIndex],}}
\DoxyCodeLine{00325\ \textcolor{comment}{\ \ \ \ const\_cast<FReal*>(ChildExpansion),\ ParentExpansion);}}
\DoxyCodeLine{00326\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00327\ \textcolor{comment}{}}
\DoxyCodeLine{00328\ \textcolor{comment}{\ \ \ \ void\ applyL2L(const\ unsigned\ int\ ChildIndex,}}
\DoxyCodeLine{00329\ \textcolor{comment}{\ \ \ \ const\ FReal\ *const\ ParentExpansion,}}
\DoxyCodeLine{00330\ \textcolor{comment}{\ \ \ \ FReal\ *const\ ChildExpansion)\ const}}
\DoxyCodeLine{00331\ \textcolor{comment}{\ \ \ \ \{}}
\DoxyCodeLine{00332\ \textcolor{comment}{\ \ \ \ FBlas::gemva(nnodes,\ nnodes,\ FReal(1.),}}
\DoxyCodeLine{00333\ \textcolor{comment}{\ \ \ \ ChildParentInterpolator[ChildIndex],}}
\DoxyCodeLine{00334\ \textcolor{comment}{\ \ \ \ const\_cast<FReal*>(ParentExpansion),\ ChildExpansion);}}
\DoxyCodeLine{00335\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00336\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \ \ \textcolor{comment}{//\ PB:\ improved\ version\ of\ applyM2M/L2L\ also\ applies\ to\ Lagrange\ interpolation}}
\DoxyCodeLine{00339\ \ \ \textcolor{comment}{//\ PB:\ Multidim\ version\ handled\ in\ kernel\ !}}
\DoxyCodeLine{00340\ \ \ \textcolor{keywordtype}{void}\ applyM2M(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ ChildIndex,}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ *\textcolor{keyword}{const}\ ChildExpansion,}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ ParentExpansion,}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ TreeLevel\ =\ 2)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00344\ \textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{00345\ \ \ \ \ FReal\ Exp[nnodes],\ PermExp[nnodes];}
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{comment}{//\ ORDER*ORDER*ORDER\ *\ (2*ORDER-\/1)}}
\DoxyCodeLine{00347\ \ \ \ \ FBlas::gemtm(ORDER,\ ORDER,\ ORDER*ORDER,\ FReal(1.),}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ChildParentInterpolator[TreeLevel][ChildIndex],\ ORDER,}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const\_cast<}FReal*\textcolor{keyword}{>}(ChildExpansion),\ ORDER,\ PermExp,\ ORDER);}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<nnodes;\ ++n)\ \ \ Exp[n]\ =\ PermExp[perm[1][n]];}
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{comment}{//\ ORDER*ORDER*ORDER\ *\ (2*ORDER-\/1)}}
\DoxyCodeLine{00353\ \ \ \ \ FBlas::gemtm(ORDER,\ ORDER,\ ORDER*ORDER,\ FReal(1.),}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ChildParentInterpolator[TreeLevel][ChildIndex]\ +\ 2\ *\ ORDER*ORDER,\ ORDER,}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Exp,\ ORDER,\ PermExp,\ ORDER);}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<nnodes;\ ++n)\ \ \ Exp[perm[1][n]]\ =\ PermExp[perm[2][n]];}
\DoxyCodeLine{00358\ \ \ \ \ \textcolor{comment}{//\ ORDER*ORDER*ORDER\ *\ (2*ORDER-\/1)}}
\DoxyCodeLine{00359\ \ \ \ \ FBlas::gemtm(ORDER,\ ORDER,\ ORDER*ORDER,\ FReal(1.),}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ChildParentInterpolator[TreeLevel][ChildIndex]\ +\ 1\ *\ ORDER*ORDER,\ ORDER,}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Exp,\ ORDER,\ PermExp,\ ORDER);}
\DoxyCodeLine{00362\ }
\DoxyCodeLine{00363\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<nnodes;\ ++n)\ \ \ ParentExpansion[perm[2][n]]\ +=\ PermExp[n];}
\DoxyCodeLine{00364\ \ \ \}}
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \ \ \textcolor{keywordtype}{void}\ applyL2L(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ ChildIndex,}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ *\textcolor{keyword}{const}\ ParentExpansion,}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ ChildExpansion,}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ TreeLevel\ =\ 2)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00371\ \textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{00372\ \ \ \ \ FReal\ Exp[nnodes],\ PermExp[nnodes];}
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{comment}{//\ ORDER*ORDER*ORDER\ *\ (2*ORDER-\/1)}}
\DoxyCodeLine{00374\ \ \ \ \ FBlas::gemm(ORDER,\ ORDER,\ ORDER*ORDER,\ FReal(1.),}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ChildParentInterpolator[TreeLevel][ChildIndex],\ ORDER,}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const\_cast<}FReal*\textcolor{keyword}{>}(ParentExpansion),\ ORDER,\ PermExp,\ ORDER);}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<nnodes;\ ++n)\ \ \ Exp[n]\ =\ PermExp[perm[1][n]];}
\DoxyCodeLine{00379\ \ \ \ \ \textcolor{comment}{//\ ORDER*ORDER*ORDER\ *\ (2*ORDER-\/1)}}
\DoxyCodeLine{00380\ \ \ \ \ FBlas::gemm(ORDER,\ ORDER,\ ORDER*ORDER,\ FReal(1.),}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ChildParentInterpolator[TreeLevel][ChildIndex]\ +\ 2\ *\ ORDER*ORDER,\ ORDER,}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Exp,\ ORDER,\ PermExp,\ ORDER);}
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<nnodes;\ ++n)\ \ \ Exp[perm[1][n]]\ =\ PermExp[perm[2][n]];}
\DoxyCodeLine{00385\ \ \ \ \ \textcolor{comment}{//\ ORDER*ORDER*ORDER\ *\ (2*ORDER-\/1)}}
\DoxyCodeLine{00386\ \ \ \ \ FBlas::gemm(ORDER,\ ORDER,\ ORDER*ORDER,\ FReal(1.),}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ChildParentInterpolator[TreeLevel][ChildIndex]\ +\ 1\ *\ ORDER*ORDER,\ ORDER,}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Exp,\ ORDER,\ PermExp,\ ORDER);}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00390\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<nnodes;\ ++n)\ \ \ ChildExpansion[perm[2][n]]\ +=\ PermExp[n];}
\DoxyCodeLine{00391\ \ \ \}}
\DoxyCodeLine{00392\ \ \ \textcolor{comment}{//\ total\ flops\ count:\ 3\ *\ ORDER*ORDER*ORDER\ *\ (2*ORDER-\/1)}}
\DoxyCodeLine{00393\ \};}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ }
\DoxyCodeLine{00405\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keywordtype}{int}\ ORDER,\ \textcolor{keyword}{class}\ MatrixKernelClass,\ \textcolor{keywordtype}{int}\ NVALS>}
\DoxyCodeLine{00406\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ContainerClass>}
\DoxyCodeLine{00407\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_unif_interpolator_a3234e3ea88ad97b7263927d211879da6}{FUnifInterpolator<FReal,\ ORDER,MatrixKernelClass,NVALS>::applyP2M}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ center,}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ width,}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *\textcolor{keyword}{const}\ multipoleExpansion,}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ContainerClass\ *\textcolor{keyword}{const}\ inParticles)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00411\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \ \ \textcolor{comment}{//\ allocate\ stuff}}
\DoxyCodeLine{00414\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classmap__glob__loc}{map\_glob\_loc<FReal>}}\ map(center,\ width);}
\DoxyCodeLine{00415\ \ \ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ localPosition;}
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ \ \ \textcolor{comment}{//\ loop\ over\ source\ particles}}
\DoxyCodeLine{00418\ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsX\ =\ inParticles-\/>getPositions()[0];}
\DoxyCodeLine{00419\ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsY\ =\ inParticles-\/>getPositions()[1];}
\DoxyCodeLine{00420\ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsZ\ =\ inParticles-\/>getPositions()[2];}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \ \ \textcolor{keywordflow}{for}(FSize\ idxPart\ =\ 0\ ;\ idxPart\ <\ inParticles-\/>getNbParticles()\ ;\ ++idxPart)\{}
\DoxyCodeLine{00423\ \ \ \ \ \textcolor{comment}{//\ map\ global\ position\ to\ [-\/1,1]}}
\DoxyCodeLine{00424\ \ \ \ \ map(\mbox{\hyperlink{class_f_point}{FPoint<FReal>}}(positionsX[idxPart],positionsY[idxPart],positionsZ[idxPart]),\ localPosition);\ \textcolor{comment}{//\ 15\ flops}}
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{comment}{//\ evaluate\ Lagrange\ polynomial\ at\ local\ position}}
\DoxyCodeLine{00426\ \ \ \ \ FReal\ L\_of\_x[ORDER][3];}
\DoxyCodeLine{00427\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ o=0;\ o<ORDER;\ ++o)\ \{}
\DoxyCodeLine{00428\ \ \ \ \ \ \ L\_of\_x[o][0]\ =\ BasisType::L(o,\ localPosition.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}());\ \textcolor{comment}{//\ 3\ *\ ORDER*(ORDER-\/1)\ flops\ PB:\ TODO\ confirm}}
\DoxyCodeLine{00429\ \ \ \ \ \ \ L\_of\_x[o][1]\ =\ BasisType::L(o,\ localPosition.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}());\ \textcolor{comment}{//\ 3\ *\ ORDER*(ORDER-\/1)\ flops}}
\DoxyCodeLine{00430\ \ \ \ \ \ \ L\_of\_x[o][2]\ =\ BasisType::L(o,\ localPosition.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}());\ \textcolor{comment}{//\ 3\ *\ ORDER*(ORDER-\/1)\ flops}}
\DoxyCodeLine{00431\ \ \ \ \ \}}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00433\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxRhs\ =\ 0\ ;\ idxRhs\ <\ nRhs\ ;\ ++idxRhs)\{}
\DoxyCodeLine{00434\ }
\DoxyCodeLine{00435\ \ \ \ \ \ \ \textcolor{comment}{//\ compute\ weight}}
\DoxyCodeLine{00436\ \ \ \ \ \ \ FReal\ weight[nVals];}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxVals\ =\ 0\ ;\ idxVals\ <\ nVals\ ;\ ++idxVals)\{}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ read\ physicalValue}}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ physicalValues\ =\ inParticles-\/>getPhysicalValues(idxVals,idxRhs);}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ weight[idxVals]\ =\ physicalValues[idxPart];}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ nVals}}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \ \ \ \ \ \ \textcolor{comment}{//\ assemble\ multipole\ expansions}}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i=0;\ i<ORDER;\ ++i)\ \{}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j=0;\ j<ORDER;\ ++j)\ \{}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ k=0;\ k<ORDER;\ ++k)\ \{}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx\ =\ idxRhs*nVals*nnodes\ +\ k*ORDER*ORDER\ +\ j*ORDER\ +\ i;}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ S\ =\ L\_of\_x[i][0]\ *\ L\_of\_x[j][1]\ *\ L\_of\_x[k][2];}
\DoxyCodeLine{00451\ }
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxVals\ =\ 0\ ;\ idxVals\ <\ nVals\ ;\ ++idxVals)}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ multipoleExpansion[idxVals*nnodes+idx]\ +=\ S\ *\ weight[idxVals];\ \textcolor{comment}{//\ 3\ *\ ORDER*ORDER*ORDER\ flops}}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \ \ \}\ \textcolor{comment}{//\ nRhs}}
\DoxyCodeLine{00459\ }
\DoxyCodeLine{00460\ \ \ \}\ \textcolor{comment}{//\ flops:\ N\ *\ (3\ *\ ORDER*ORDER*ORDER\ +\ 3\ *\ 3\ *\ ORDER*(ORDER-\/1))\ flops}}
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00462\ \}}
\DoxyCodeLine{00463\ }
\DoxyCodeLine{00464\ }
\DoxyCodeLine{00468\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keywordtype}{int}\ ORDER,\ \textcolor{keyword}{class}\ MatrixKernelClass,\ \textcolor{keywordtype}{int}\ NVALS>}
\DoxyCodeLine{00469\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ContainerClass>}
\DoxyCodeLine{00470\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_unif_interpolator_a262fb412654ba58ae36d8f697c9113b2}{FUnifInterpolator<FReal,\ ORDER,MatrixKernelClass,NVALS>::applyL2P}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ center,}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ width,}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ *\textcolor{keyword}{const}\ localExpansion,}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass\ *\textcolor{keyword}{const}\ inParticles)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00474\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00475\ \ \ \textcolor{comment}{//\ loop\ over\ particles}}
\DoxyCodeLine{00476\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classmap__glob__loc}{map\_glob\_loc<FReal>}}\ map(center,\ width);}
\DoxyCodeLine{00477\ \ \ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ localPosition;}
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00479\ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsX\ =\ inParticles-\/>getPositions()[0];}
\DoxyCodeLine{00480\ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsY\ =\ inParticles-\/>getPositions()[1];}
\DoxyCodeLine{00481\ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsZ\ =\ inParticles-\/>getPositions()[2];}
\DoxyCodeLine{00482\ }
\DoxyCodeLine{00483\ \ \ \textcolor{keyword}{const}\ \ FSize\ nParticles\ =\ inParticles-\/>getNbParticles();}
\DoxyCodeLine{00484\ }
\DoxyCodeLine{00485\ \ \ \textcolor{keywordflow}{for}(FSize\ idxPart\ =\ 0\ ;\ idxPart\ <\ nParticles\ ;\ ++\ idxPart)\{}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ \ \ \ \ \textcolor{comment}{//\ map\ global\ position\ to\ [-\/1,1]}}
\DoxyCodeLine{00488\ \ \ \ \ map(\mbox{\hyperlink{class_f_point}{FPoint<FReal>}}(positionsX[idxPart],positionsY[idxPart],positionsZ[idxPart]),\ localPosition);\ \textcolor{comment}{//\ 15\ flops}}
\DoxyCodeLine{00489\ }
\DoxyCodeLine{00490\ \ \ \ \ \textcolor{comment}{//\ evaluate\ Lagrange\ polynomial\ at\ local\ position}}
\DoxyCodeLine{00491\ \ \ \ \ FReal\ L\_of\_x[ORDER][3];}
\DoxyCodeLine{00492\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ o=0;\ o<ORDER;\ ++o)\ \{}
\DoxyCodeLine{00493\ \ \ \ \ \ \ L\_of\_x[o][0]\ =\ BasisType::L(o,\ localPosition.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}());\ \textcolor{comment}{//\ 3\ *\ ORDER*(ORDER-\/1)\ flops}}
\DoxyCodeLine{00494\ \ \ \ \ \ \ L\_of\_x[o][1]\ =\ BasisType::L(o,\ localPosition.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}());\ \textcolor{comment}{//\ 3\ *\ ORDER*(ORDER-\/1)\ flops}}
\DoxyCodeLine{00495\ \ \ \ \ \ \ L\_of\_x[o][2]\ =\ BasisType::L(o,\ localPosition.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}());\ \textcolor{comment}{//\ 3\ *\ ORDER*(ORDER-\/1)\ flops}}
\DoxyCodeLine{00496\ \ \ \ \ \}}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00498\ \ \ \ \ \textcolor{comment}{//\ loop\ over\ dim\ of\ local\ expansions}}
\DoxyCodeLine{00499\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLhs\ =\ 0\ ;\ idxLhs\ <\ nLhs\ ;\ ++idxLhs)\{}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \textcolor{comment}{//\ distribution\ over\ potential\ components:}}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ sum\ the\ multidim\ contribution\ of\ PhysValue}}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ was\ originally\ done\ at\ M2L\ step\ but\ moved\ here}}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \textcolor{comment}{//\ because\ their\ storage\ is\ required\ by\ the\ force\ computation.}}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \textcolor{comment}{//\ In\ fact\ :\ f\_\{ik\}(x)=w\_j(x)\ \(\backslash\)nabla\_\{x\_i\}\ K\_\{ij\}(x,y)w\_j(y))}}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idxPot\ =\ idxLhs\ /\ nPV;}
\DoxyCodeLine{00506\ }
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ }
\DoxyCodeLine{00509\ \ \ \ \ \ \ \textcolor{comment}{//\ interpolate\ and\ increment\ target\ value}}
\DoxyCodeLine{00510\ \ \ \ \ \ \ FReal\ targetValue[nVals];}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxVals\ =\ 0\ ;\ idxVals\ <\ nVals\ ;\ ++idxVals)}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ targetValue[idxVals]=0.;}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ l=0;\ l<ORDER;\ ++l)\ \{}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ m=0;\ m<ORDER;\ ++m)\ \{}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<ORDER;\ ++n)\ \{}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx\ =\ idxLhs*nVals*nnodes\ +\ n*ORDER*ORDER\ +\ m*ORDER\ +\ l;}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ S\ =\ L\_of\_x[l][0]\ *\ L\_of\_x[m][1]\ *\ L\_of\_x[n][2];}
\DoxyCodeLine{00519\ }
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxVals\ =\ 0\ ;\ idxVals\ <\ nVals\ ;\ ++idxVals)}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ targetValue[idxVals]\ +=\ S\ *\ localExpansion[idxVals*nnodes+idx];}
\DoxyCodeLine{00522\ }
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ ORDER\ *\ 4\ flops}}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ ORDER\ *\ ORDER\ *\ 4\ flops}}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ ORDER\ *\ ORDER\ *\ ORDER\ *\ 4\ flops}}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00527\ }
\DoxyCodeLine{00528\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxVals\ =\ 0\ ;\ idxVals\ <\ nVals\ ;\ ++idxVals)\{}
\DoxyCodeLine{00529\ }
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ get\ potential}}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ FReal*\textcolor{keyword}{const}\ potentials\ =\ inParticles-\/>getPotentials(idxVals,idxPot);}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ add\ contribution\ to\ potential}}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ potentials[idxPart]\ +=\ (targetValue[idxVals]);}
\DoxyCodeLine{00534\ }
\DoxyCodeLine{00535\ \ \ \ \ \ \ \}\textcolor{comment}{//\ NVALS}}
\DoxyCodeLine{00536\ }
\DoxyCodeLine{00537\ \ \ \ \ \}\ \textcolor{comment}{//\ idxLhs}}
\DoxyCodeLine{00538\ }
\DoxyCodeLine{00539\ \ \ \}\ \textcolor{comment}{//\ N\ *\ (4\ *\ ORDER\ *\ ORDER\ *\ ORDER\ +\ 9\ *\ ORDER*(ORDER-\/1)\ )\ flops}}
\DoxyCodeLine{00540\ \}}
\DoxyCodeLine{00541\ }
\DoxyCodeLine{00542\ }
\DoxyCodeLine{00543\ }
\DoxyCodeLine{00547\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ FReal,\ \textcolor{keywordtype}{int}\ ORDER,\ \textcolor{keyword}{class}\ MatrixKernelClass,\ \textcolor{keywordtype}{int}\ NVALS>}
\DoxyCodeLine{00548\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ContainerClass>}
\DoxyCodeLine{00549\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_f_unif_interpolator_a63eccb7e2da74d9f8a452838d1af1d75}{FUnifInterpolator<FReal,\ ORDER,MatrixKernelClass,NVALS>::applyL2PGradient}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\&\ center,}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ width,}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ *\textcolor{keyword}{const}\ localExpansion,}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ContainerClass\ *\textcolor{keyword}{const}\ inParticles)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00553\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00555\ \ \ \textcolor{comment}{//\ TENSOR-\/PRODUCT\ INTERPOLUTION\ NOT\ IMPLEMENTED\ YET\ HERE!!!\ ////////}}
\DoxyCodeLine{00557\ }
\DoxyCodeLine{00558\ \ \ \textcolor{comment}{//\ setup\ local\ to\ global\ mapping}}
\DoxyCodeLine{00559\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classmap__glob__loc}{map\_glob\_loc<FReal>}}\ map(center,\ width);}
\DoxyCodeLine{00560\ \ \ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ Jacobian;}
\DoxyCodeLine{00561\ \ \ map.computeJacobian(Jacobian);}
\DoxyCodeLine{00562\ \ \ \textcolor{keyword}{const}\ FReal\ jacobian[3]\ =\ \{Jacobian.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}(),\ Jacobian.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}(),\ Jacobian.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}()\};}
\DoxyCodeLine{00563\ \ \ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ localPosition;}
\DoxyCodeLine{00564\ \ \ FReal\ L\_of\_x[ORDER][3];}
\DoxyCodeLine{00565\ \ \ FReal\ dL\_of\_x[ORDER][3];}
\DoxyCodeLine{00566\ }
\DoxyCodeLine{00567\ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsX\ =\ inParticles-\/>getPositions()[0];}
\DoxyCodeLine{00568\ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsY\ =\ inParticles-\/>getPositions()[1];}
\DoxyCodeLine{00569\ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ positionsZ\ =\ inParticles-\/>getPositions()[2];}
\DoxyCodeLine{00570\ }
\DoxyCodeLine{00571\ \textcolor{comment}{//\ \ const\ FSize\ nParticles\ =\ inParticles-\/>getNbParticles();}}
\DoxyCodeLine{00572\ }
\DoxyCodeLine{00573\ \ \ \textcolor{keywordflow}{for}(FSize\ idxPart\ =\ 0\ ;\ idxPart\ <\ inParticles-\/>getNbParticles()\ ;\ ++\ idxPart)\{}
\DoxyCodeLine{00574\ }
\DoxyCodeLine{00575\ \ \ \ \ \textcolor{comment}{//\ map\ global\ position\ to\ [-\/1,1]}}
\DoxyCodeLine{00576\ \ \ \ \ map(\mbox{\hyperlink{class_f_point}{FPoint<FReal>}}(positionsX[idxPart],positionsY[idxPart],positionsZ[idxPart]),\ localPosition);}
\DoxyCodeLine{00577\ }
\DoxyCodeLine{00578\ \ \ \ \ \textcolor{comment}{//\ evaluate\ Lagrange\ polynomials\ of\ source\ particle}}
\DoxyCodeLine{00579\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ o=0;\ o<ORDER;\ ++o)\ \{}
\DoxyCodeLine{00580\ \ \ \ \ \ \ L\_of\_x[o][0]\ =\ BasisType::L(o,\ localPosition.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}());\ \textcolor{comment}{//\ 3\ *\ ORDER*(ORDER-\/1)\ flops}}
\DoxyCodeLine{00581\ \ \ \ \ \ \ L\_of\_x[o][1]\ =\ BasisType::L(o,\ localPosition.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}());\ \textcolor{comment}{//\ 3\ *\ ORDER*(ORDER-\/1)\ flops}}
\DoxyCodeLine{00582\ \ \ \ \ \ \ L\_of\_x[o][2]\ =\ BasisType::L(o,\ localPosition.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}());\ \textcolor{comment}{//\ 3\ *\ ORDER*(ORDER-\/1)\ flops}}
\DoxyCodeLine{00583\ \ \ \ \ \ \ dL\_of\_x[o][0]\ =\ BasisType::dL(o,\ localPosition.\mbox{\hyperlink{class_f_point_a58d3859160347552d6a4a94fbdf883c3}{getX}}());\ \textcolor{comment}{//\ TODO\ verify\ 3\ *\ ORDER*(ORDER-\/1)\ flops}}
\DoxyCodeLine{00584\ \ \ \ \ \ \ dL\_of\_x[o][1]\ =\ BasisType::dL(o,\ localPosition.\mbox{\hyperlink{class_f_point_ae4383512b9b8d216775b3fb92325cfc9}{getY}}());\ \textcolor{comment}{//\ TODO\ verify\ 3\ *\ ORDER*(ORDER-\/1)\ flops}}
\DoxyCodeLine{00585\ \ \ \ \ \ \ dL\_of\_x[o][2]\ =\ BasisType::dL(o,\ localPosition.\mbox{\hyperlink{class_f_point_a02208d4db50cbafe597adcbfb152b536}{getZ}}());\ \textcolor{comment}{//\ TODO\ verify\ 3\ *\ ORDER*(ORDER-\/1)\ flops}}
\DoxyCodeLine{00586\ \ \ \ \ \}}
\DoxyCodeLine{00587\ }
\DoxyCodeLine{00588\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxLhs\ =\ 0\ ;\ idxLhs\ <\ nLhs\ ;\ ++idxLhs)\{}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idxPot\ =\ idxLhs\ /\ nPV;}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idxPV\ \ =\ idxLhs\ \%\ nPV;}
\DoxyCodeLine{00591\ }
\DoxyCodeLine{00592\ \ \ \ \ \ \ \textcolor{comment}{//\ interpolate\ and\ increment\ forces\ value}}
\DoxyCodeLine{00593\ \ \ \ \ \ \ FReal\ forces[nVals][3];}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxVals\ =\ 0\ ;\ idxVals\ <\ nVals\ ;\ ++idxVals)}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ forces[idxVals][0]=forces[idxVals][1]=forces[idxVals][2]=FReal(0.);}
\DoxyCodeLine{00596\ }
\DoxyCodeLine{00597\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ l=0;\ l<ORDER;\ ++l)\ \{}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ m=0;\ m<ORDER;\ ++m)\ \{}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<ORDER;\ ++n)\ \{}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx\ =\ idxLhs*nVals*nnodes\ +\ n*ORDER*ORDER\ +\ m*ORDER\ +\ l;}
\DoxyCodeLine{00602\ }
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ PX\ =\ dL\_of\_x[l][0]\ *\ L\_of\_x[m][1]\ *\ L\_of\_x[n][2];}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ PY\ =\ L\_of\_x[l][0]\ *\ dL\_of\_x[m][1]\ *\ L\_of\_x[n][2];}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ PZ\ =\ L\_of\_x[l][0]\ *\ L\_of\_x[m][1]\ *\ dL\_of\_x[n][2];}
\DoxyCodeLine{00606\ }
\DoxyCodeLine{00607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxVals\ =\ 0\ ;\ idxVals\ <\ nVals\ ;\ ++idxVals)\{}
\DoxyCodeLine{00608\ }
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ forces[idxVals][0]\ +=\ PX\ *\ localExpansion[idxVals*nnodes\ +\ idx];}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ forces[idxVals][1]\ +=\ PY\ *\ localExpansion[idxVals*nnodes\ +\ idx];}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ forces[idxVals][2]\ +=\ PZ\ *\ localExpansion[idxVals*nnodes\ +\ idx];}
\DoxyCodeLine{00612\ }
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ NVALS}}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ ORDER\ *\ 4\ flops}}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ ORDER\ *\ ORDER\ *\ 4\ flops}}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ ORDER\ *\ ORDER\ *\ ORDER\ *\ 4\ flops}}
\DoxyCodeLine{00617\ }
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ scale\ forces}}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxVals\ =\ 0\ ;\ idxVals\ <\ nVals\ ;\ ++idxVals)\{}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ \ \ forces[idxVals][0]\ *=\ jacobian[0];}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \ \ forces[idxVals][1]\ *=\ jacobian[1];}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \ \ forces[idxVals][2]\ *=\ jacobian[2];}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ NVALS}}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00625\ }
\DoxyCodeLine{00626\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idxVals\ =\ 0\ ;\ idxVals\ <\ nVals\ ;\ ++idxVals)\{}
\DoxyCodeLine{00627\ }
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal*\textcolor{keyword}{const}\ physicalValues\ =\ inParticles-\/>getPhysicalValues(idxVals,idxPV);}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ FReal*\textcolor{keyword}{const}\ forcesX\ =\ inParticles-\/>getForcesX(idxVals,idxPot);}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ FReal*\textcolor{keyword}{const}\ forcesY\ =\ inParticles-\/>getForcesY(idxVals,idxPot);}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ FReal*\textcolor{keyword}{const}\ forcesZ\ =\ inParticles-\/>getForcesZ(idxVals,idxPot);}
\DoxyCodeLine{00632\ }
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ computed\ forces}}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ forcesX[idxPart]\ +=\ forces[idxVals][0]\ *\ physicalValues[idxPart];}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ forcesY[idxPart]\ +=\ forces[idxVals][1]\ *\ physicalValues[idxPart];}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ forcesZ[idxPart]\ +=\ forces[idxVals][2]\ *\ physicalValues[idxPart];}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ NVALS}}
\DoxyCodeLine{00638\ \ \ \ \ \}\ \textcolor{comment}{//\ NLHS}}
\DoxyCodeLine{00639\ }
\DoxyCodeLine{00640\ \ \ \}}
\DoxyCodeLine{00641\ }
\DoxyCodeLine{00642\ \}}
\DoxyCodeLine{00643\ }
\DoxyCodeLine{00644\ }
\DoxyCodeLine{00645\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ FUNIFINTERPOLATOR\_HPP\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
