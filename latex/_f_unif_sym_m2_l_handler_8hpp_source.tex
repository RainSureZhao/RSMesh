\doxysection{FUnif\+Sym\+M2\+LHandler.\+hpp}
\hypertarget{_f_unif_sym_m2_l_handler_8hpp_source}{}\label{_f_unif_sym_m2_l_handler_8hpp_source}\index{third\_party/ScalFMM/include/ScalFMM/Kernels/Uniform/FUnifSymM2LHandler.hpp@{third\_party/ScalFMM/include/ScalFMM/Kernels/Uniform/FUnifSymM2LHandler.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ See\ LICENCE\ file\ at\ project\ root}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Keep\ in\ private\ GIT}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#ifndef\ FUNIFSYMM2LHANDLER\_HPP}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#define\ FUNIFSYMM2LHANDLER\_HPP}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <climits>}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FBlas.hpp"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FDft.hpp"{}}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}../../Utils/FComplex.hpp"{}}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}./FUnifTensor.hpp"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}../Interpolation/FInterpSymmetries.hpp"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}./FUnifM2LHandler.hpp"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{template}\ <\ \textcolor{keyword}{class}\ FReal,\ \textcolor{keywordtype}{int}\ ORDER,\ \textcolor{keyword}{typename}\ MatrixKernelClass>}
\DoxyCodeLine{00029\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ precompute(\textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ MatrixKernel,\ \textcolor{keyword}{const}\ FReal\ CellWidth,}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}*\ FC[343])}
\DoxyCodeLine{00031\ \{}
\DoxyCodeLine{00032\ \ \ \textcolor{comment}{//\ \ \ \ std::cout\ <<\ "{}\(\backslash\)nComputing\ 16\ far-\/field\ interactions\ (l="{}\ <<\ ORDER\ <<\ "{},\ eps="{}\ <<\ Epsilon}}
\DoxyCodeLine{00033\ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ "{})\ for\ cells\ of\ width\ w\ =\ "{}\ <<\ CellWidth\ <<\ std::endl;}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nnodes\ =\ ORDER*ORDER*ORDER;}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{comment}{//\ interpolation\ points\ of\ source\ (Y)\ and\ target\ (X)\ cell}}
\DoxyCodeLine{00038\ \ \ \ \ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ X[nnodes],\ Y[nnodes];}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{comment}{//\ set\ roots\ of\ target\ cell\ (X)}}
\DoxyCodeLine{00040\ \ \ \ \ \mbox{\hyperlink{class_f_interp_tensor_ac8107c468326e9c786873c23fe2e8766}{FUnifTensor<FReal,ORDER>::setRoots}}(\mbox{\hyperlink{class_f_point}{FPoint<FReal>}}(0.,0.,0.),\ CellWidth,\ X);}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{comment}{//\ temporary\ matrices}}
\DoxyCodeLine{00042\ \ \ \ \ FReal\ *\_C;}
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ *\_FC;}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \textcolor{comment}{//\ reduce\ storage\ from\ nnodes\string^2=order\string^6\ to\ (2order-\/1)\string^3}}
\DoxyCodeLine{00046\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ rc\ =\ (2*ORDER-\/1)*(2*ORDER-\/1)*(2*ORDER-\/1);}
\DoxyCodeLine{00047\ \ \ \ \ \_C\ =\ \textcolor{keyword}{new}\ FReal\ [rc];}
\DoxyCodeLine{00048\ \ \ \ \ \_FC\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ [rc];\ \textcolor{comment}{//\ TODO:\ do\ it\ in\ the\ non-\/sym\ version!!!}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \textcolor{comment}{//\ init\ Discrete\ Fourier\ Transformator}}
\DoxyCodeLine{00051\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ dimfft\ =\ 1;\ \textcolor{comment}{//\ unidim\ FFT\ since\ fully\ circulant\ embedding}}
\DoxyCodeLine{00052\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ steps[dimfft]\ =\ \{rc\};}
\DoxyCodeLine{00053\ \textcolor{comment}{//\ \ FDft\ Dft(rc);}}
\DoxyCodeLine{00054\ \ \ \ \ FFft<FReal,dimfft>\ Dft(steps);}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \textcolor{comment}{//\ reduce\ storage\ if\ real\ valued\ kernel}}
\DoxyCodeLine{00057\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ opt\_rc\ =\ rc/2+1;}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \textcolor{comment}{//\ get\ first\ column\ of\ K\ via\ permutation}}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ perm[rc];}
\DoxyCodeLine{00061\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ p=0;\ p<rc;\ ++p)\{}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordflow}{if}(p<rc-\/1)\ perm[p]=p+1;}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordflow}{else}\ perm[p]=p+1-\/rc;}
\DoxyCodeLine{00064\ \ \ \}}
\DoxyCodeLine{00065\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ li,lj,\ mi,mj,\ ni,nj;}
\DoxyCodeLine{00066\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idi,\ idj,\ ido;}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{comment}{//\ initialize\ timer}}
\DoxyCodeLine{00069\ \ \ \ \ \mbox{\hyperlink{class_f_tic}{FTic}}\ time;}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordtype}{double}\ overall\_time(0.);}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordtype}{double}\ elapsed\_time(0.);}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ counter\ =\ 0;}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=2;\ i<=3;\ ++i)\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=0;\ j<=i;\ ++j)\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k=0;\ k<=j;\ ++k)\ \{}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ roots\ of\ source\ cell\ (Y)}}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_point}{FPoint<FReal>}}\ cy(CellWidth*FReal(i),\ CellWidth*FReal(j),\ CellWidth*FReal(k));}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_f_interp_tensor_ac8107c468326e9c786873c23fe2e8766}{FUnifTensor<FReal,ORDER>::setRoots}}(cy,\ CellWidth,\ Y);}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ start\ timer}}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ time.\mbox{\hyperlink{class_f_tic_ac0e070e65af128fbe5af711e51033b0a}{tic}}();}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ evaluate\ m2l\ operator}}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ ido=0;}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ l=0;\ l<2*ORDER-\/1;\ ++l)}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ m=0;\ m<2*ORDER-\/1;\ ++m)}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ n=0;\ n<2*ORDER-\/1;\ ++n)\{\ \ \ }
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ l=0:(2*ORDER-\/1)\ =>\ li-\/lj=-\/(ORDER-\/1):(ORDER-\/1)}}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Convention:}}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ lj=ORDER-\/1\ \&\ li=0:ORDER-\/1\ =>\ li-\/lj=1-\/ORDER:0}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ lj=1\ \&\ li=0:ORDER-\/1\ =>\ li-\/lj=1:ORDER-\/1}}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(l<ORDER-\/1)\ lj=ORDER-\/1;\ \textcolor{keywordflow}{else}\ lj=0;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(m<ORDER-\/1)\ mj=ORDER-\/1;\ \textcolor{keywordflow}{else}\ mj=0;}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(n<ORDER-\/1)\ nj=ORDER-\/1;\ \textcolor{keywordflow}{else}\ nj=0;}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ li=(l-\/(ORDER-\/1))+lj;\ mi=(m-\/(ORDER-\/1))+mj;\ ni=(n-\/(ORDER-\/1))+nj;}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ deduce\ corresponding\ index\ of\ K[nnodes\ x\ nnodes]\ }}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idi=li*ORDER*ORDER\ +\ mi*ORDER\ +\ ni;}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idj=lj*ORDER*ORDER\ +\ mj*ORDER\ +\ nj;}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ store\ value\ at\ current\ position\ in\ C}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ use\ permutation\ if\ DFT\ is\ used\ because\ }}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ storage\ of\ the\ first\ column\ is\ required}}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ i.e.\ C[0]\ C[rc-\/1]\ C[rc-\/2]\ ..\ C[1]\ <\ WRONG!}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ i.e.\ C[rc-\/1]\ C[0]\ C[1]\ ..\ C[rc-\/2]\ <\ RIGHT!}}
\DoxyCodeLine{00108\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_C[counter*rc\ +\ ido]}}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_C[perm[ido]]}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ MatrixKernel-\/>evaluate(X[idi],\ Y[idj]);}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ido++;}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Apply\ Discrete\ Fourier\ Transformation}}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ Dft.applyDFT(\_C,\_FC);}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ determine\ new\ index}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx\ =\ (i+3)*7*7\ +\ (j+3)*7\ +\ (k+3);}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ store}}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ allocate}}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ assert(FC[idx]==NULL);}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FC[idx]\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}[opt\_rc];}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ FBlas::c\_copy(opt\_rc,\ \textcolor{keyword}{reinterpret\_cast<}FReal*\textcolor{keyword}{>}(\_FC),\ }
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{reinterpret\_cast<}FReal*\textcolor{keyword}{>}(FC[idx]));}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ elapsed\_time\ =\ time.\mbox{\hyperlink{class_f_tic_ade3afdb1aa198635ebbc5ee8b7f4f081}{tacAndElapsed}}();\ }
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ overall\_time\ +=\ elapsed\_time;\ \ \ }
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ counter++;}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00135\ \ \ \ \ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}The\ approximation\ of\ the\ "{}}\ <<\ counter}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ far-\/field\ interactions\ (sizeM2L=\ "{}}\ }
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ counter*opt\_rc*\textcolor{keyword}{sizeof}(\mbox{\hyperlink{class_f_complex}{FComplex<FReal>}})\ <<\ \textcolor{stringliteral}{"{}\ B"{}}}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{})\ took\ "{}}\ <<\ overall\_time\ <<\ \textcolor{stringliteral}{"{}s\(\backslash\)n"{}}\ <<\ std::endl;}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ Free\ \_C\ \&\ \_FC}}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keyword}{delete}\ []\ \_C;}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keyword}{delete}\ []\ \_FC;}
\DoxyCodeLine{00145\ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00164\ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{int}\ ORDER,\ KERNEL\_FUNCTION\_TYPE\ TYPE>\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_f_unif_sym_m2_l_handler}{FUnifSymM2LHandler}};}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00167\ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{int}\ ORDER>}
\DoxyCodeLine{00168\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_f_unif_sym_m2_l_handler}{FUnifSymM2LHandler}}<ORDER,\ HOMOGENEOUS>}
\DoxyCodeLine{00169\ \{}
\DoxyCodeLine{00170\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nnodes\ =\ ORDER*ORDER*ORDER;}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{comment}{//\ M2L\ operators}}
\DoxyCodeLine{00173\ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}*\ \ \ \ K[343];}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00176\ \ \ \ \ }
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{comment}{//\ permutation\ vectors\ and\ permutated\ indices}}
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ pvectors[343][nnodes];}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ pindices[343];}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixKernelClass>}
\DoxyCodeLine{00184\ \ \ \ \ \mbox{\hyperlink{class_f_unif_sym_m2_l_handler_3_01_o_r_d_e_r_00_01_h_o_m_o_g_e_n_e_o_u_s_01_4_aafb52ed9fd3c53c2d5ab8504648655b2}{FUnifSymM2LHandler}}(\textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ MatrixKernel,}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int})}
\DoxyCodeLine{00186\ \ \ \ \ \{}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ init\ all\ 343\ item\ to\ zero,\ because\ effectively\ only\ 16\ exist}}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t=0;\ t<343;\ ++t)}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ K[t]\ =\ NULL;}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ permutation\ vector\ and\ indices}}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_interp_symmetries}{FInterpSymmetries<ORDER>}}\ Symmetries;}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=-\/3;\ i<=3;\ ++i)}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=-\/3;\ j<=3;\ ++j)}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k=-\/3;\ k<=3;\ ++k)\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx\ =\ ((i+3)\ *\ 7\ +\ (j+3))\ *\ 7\ +\ (k+3);}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pindices[idx]\ =\ 0;}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(i)>1\ ||\ abs(j)>1\ ||\ abs(k)>1)}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pindices[idx]\ =\ Symmetries.getPermutationArrayAndIndex(i,j,k,\ pvectors[idx]);}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ precompute\ 16\ M2L\ operators}}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ ReferenceCellWidth\ =\ FReal(2.);}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ precompute<ORDER>(MatrixKernel,\ ReferenceCellWidth,\ K);}
\DoxyCodeLine{00205\ \ \ \ \ \}}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00210\ \ \ \ \ \mbox{\hyperlink{class_f_unif_sym_m2_l_handler_3_01_o_r_d_e_r_00_01_h_o_m_o_g_e_n_e_o_u_s_01_4_addf11ee1f8a73b4554176aefde13a8e4}{\string~FUnifSymM2LHandler}}()}
\DoxyCodeLine{00211\ \ \ \ \ \{}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t=0;\ t<343;\ ++t)\ \textcolor{keywordflow}{if}\ (K[t]!=NULL)\ \textcolor{keyword}{delete}\ []\ K[t];}
\DoxyCodeLine{00213\ \ \ \ \ \}}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ *\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_unif_sym_m2_l_handler_3_01_o_r_d_e_r_00_01_h_o_m_o_g_e_n_e_o_u_s_01_4_a8563a4e1d659aedbfd48336cde03c61a}{getK}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00218\ \textcolor{keyword}{\ \ \ \ }\{\ \ \ \textcolor{keywordflow}{return}\ K[t];\ \}}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \};}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00228\ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{int}\ ORDER>}
\DoxyCodeLine{00229\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_f_unif_sym_m2_l_handler}{FUnifSymM2LHandler}}<ORDER,\ NON\_HOMOGENEOUS>}
\DoxyCodeLine{00230\ \{}
\DoxyCodeLine{00231\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nnodes\ =\ ORDER*ORDER*ORDER;}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{comment}{//\ Height\ of\ octree;\ needed\ only\ in\ the\ case\ of\ non-\/homogeneous\ kernel\ functions}}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ TreeHeight;}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{comment}{//\ M2L\ operators\ for\ all\ levels\ in\ the\ octree}}
\DoxyCodeLine{00237\ \ \ \ \ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}***\ \ \ \ K;}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00240\ \ \ \ \ }
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{comment}{//\ permutation\ vectors\ and\ permutated\ indices}}
\DoxyCodeLine{00242\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ pvectors[343][nnodes];}
\DoxyCodeLine{00243\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ pindices[343];}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MatrixKernelClass>}
\DoxyCodeLine{00248\ \ \ \ \ \mbox{\hyperlink{class_f_unif_sym_m2_l_handler_3_01_o_r_d_e_r_00_01_n_o_n___h_o_m_o_g_e_n_e_o_u_s_01_4_a0904bcac1fbc8824f30f2f8cdb21e3d8}{FUnifSymM2LHandler}}(\textcolor{keyword}{const}\ MatrixKernelClass\ *\textcolor{keyword}{const}\ MatrixKernel,}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FReal\ RootCellWidth,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ inTreeHeight)}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ :\ TreeHeight(inTreeHeight)}
\DoxyCodeLine{00251\ \ \ \ \ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ init\ all\ 343\ item\ to\ zero,\ because\ effectively\ only\ 16\ exist}}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ K\ \ \ \ \ \ \ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}**\ [TreeHeight];}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ K[0]\ \ \ \ \ \ \ =\ NULL;\ K[1]\ \ \ \ \ \ \ =\ NULL;}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ l=2;\ l<TreeHeight;\ ++l)\ \{}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ K[l]\ \ \ \ \ \ \ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}*\ [343];}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t=0;\ t<343;\ ++t)}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ K[l][t]\ \ \ \ \ \ \ =\ NULL;}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ permutation\ vector\ and\ indices}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_interp_symmetries}{FInterpSymmetries<ORDER>}}\ Symmetries;}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=-\/3;\ i<=3;\ ++i)}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=-\/3;\ j<=3;\ ++j)}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k=-\/3;\ k<=3;\ ++k)\ \{}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ idx\ =\ ((i+3)\ *\ 7\ +\ (j+3))\ *\ 7\ +\ (k+3);}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pindices[idx]\ =\ 0;}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(i)>1\ ||\ abs(j)>1\ ||\ abs(k)>1)}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pindices[idx]\ =\ Symmetries.getPermutationArrayAndIndex(i,j,k,\ pvectors[idx]);}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ precompute\ 16\ M2L\ operators\ at\ all\ levels\ having\ far-\/field\ interactions}}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ FReal\ CellWidth\ =\ RootCellWidth\ /\ FReal(2.);\ \textcolor{comment}{//\ at\ level\ 1}}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ CellWidth\ /=\ FReal(2.);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ at\ level\ 2}}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ l=2;\ l<TreeHeight;\ ++l)\ \{}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ precompute<ORDER>(MatrixKernel,\ CellWidth,\ K[l]);}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ CellWidth\ /=\ FReal(2.);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ at\ level\ l+1\ }}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00280\ \ \ \ \ \}}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00285\ \ \ \ \ \mbox{\hyperlink{class_f_unif_sym_m2_l_handler_3_01_o_r_d_e_r_00_01_n_o_n___h_o_m_o_g_e_n_e_o_u_s_01_4_acb402d5fe565ea9aa23547d3f54a8c60}{\string~FUnifSymM2LHandler}}()}
\DoxyCodeLine{00286\ \ \ \ \ \{}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ l=0;\ l<TreeHeight;\ ++l)\ \{}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (K[l]!=NULL)\ \{}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t=0;\ t<343;\ ++t)\ \textcolor{keywordflow}{if}\ (K[l][t]!=NULL)\ \textcolor{keyword}{delete}\ []\ K[l][t];}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ K[l];}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ K;}
\DoxyCodeLine{00294\ \ \ \ \ \}}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00297\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_complex}{FComplex<FReal>}}\ *\textcolor{keyword}{const}\ \mbox{\hyperlink{class_f_unif_sym_m2_l_handler_3_01_o_r_d_e_r_00_01_n_o_n___h_o_m_o_g_e_n_e_o_u_s_01_4_a13cf53ca0ded9316c989c7b962ad7d50}{getK}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ l,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ t)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00298\ \textcolor{keyword}{\ \ \ \ }\{\ \ \ \textcolor{keywordflow}{return}\ K[l][t];\ \}}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \};}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \textcolor{comment}{//\#include\ <fstream>}}
\DoxyCodeLine{00310\ \textcolor{comment}{//\#include\ <sstream>}}
\DoxyCodeLine{00311\ \textcolor{comment}{//}}
\DoxyCodeLine{00312\ \textcolor{comment}{//}}
\DoxyCodeLine{00314\ \textcolor{comment}{//\ *\ Computes,\ compresses\ and\ stores\ the\ 16\ M2L\ kernels\ in\ a\ binary\ file.}}
\DoxyCodeLine{00315\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00316\ \textcolor{comment}{//template\ <int\ ORDER,\ typename\ MatrixKernelClass>}}
\DoxyCodeLine{00317\ \textcolor{comment}{//static\ void\ ComputeAndCompressAndStoreInBinaryFile(const\ MatrixKernelClass\ *const\ MatrixKernel,\ const\ FReal\ Epsilon)}}
\DoxyCodeLine{00318\ \textcolor{comment}{//\{}}
\DoxyCodeLine{00319\ \textcolor{comment}{//\ \ static\ const\ unsigned\ int\ nnodes\ =\ ORDER*ORDER*ORDER;}}
\DoxyCodeLine{00320\ \textcolor{comment}{//}}
\DoxyCodeLine{00321\ \textcolor{comment}{//\ \ //\ compute\ and\ compress\ ////////////}}
\DoxyCodeLine{00322\ \textcolor{comment}{//\ \ FReal*\ K[343];}}
\DoxyCodeLine{00323\ \textcolor{comment}{//\ \ int\ LowRank[343];}}
\DoxyCodeLine{00324\ \textcolor{comment}{//\ \ for\ (unsigned\ int\ idx=0;\ idx<343;\ ++idx)\ \{\ K[idx]\ =\ NULL;\ LowRank[idx]\ =\ 0;\ \}}}
\DoxyCodeLine{00325\ \textcolor{comment}{//\ \ precompute<ORDER>(MatrixKernel,\ FReal(2.),\ Epsilon,\ K,\ LowRank);}}
\DoxyCodeLine{00326\ \textcolor{comment}{//}}
\DoxyCodeLine{00327\ \textcolor{comment}{//\ \ //\ write\ to\ binary\ file\ ////////////}}
\DoxyCodeLine{00328\ \textcolor{comment}{//\ \ FTic\ time;\ time.tic();}}
\DoxyCodeLine{00329\ \textcolor{comment}{//\ \ //\ start\ computing\ process}}
\DoxyCodeLine{00330\ \textcolor{comment}{//\ \ const\ char\ precision\ =\ (typeid(FReal)==typeid(double)\ ?\ 'd'\ :\ 'f');}}
\DoxyCodeLine{00331\ \textcolor{comment}{//\ \ std::stringstream\ sstream;}}
\DoxyCodeLine{00332\ \textcolor{comment}{//\ \ sstream\ <<\ "{}sym2l\_"{}\ <<\ precision\ <<\ "{}\_o"{}\ <<\ ORDER\ <<\ "{}\_e"{}\ <<\ Epsilon\ <<\ "{}.bin"{};}}
\DoxyCodeLine{00333\ \textcolor{comment}{//\ \ const\ std::string\ filename(sstream.str());}}
\DoxyCodeLine{00334\ \textcolor{comment}{//\ \ std::ofstream\ stream(filename.c\_str(),}}
\DoxyCodeLine{00335\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::ios::out\ |\ std::ios::binary\ |\ std::ios::trunc);}}
\DoxyCodeLine{00336\ \textcolor{comment}{//\ \ if\ (stream.good())\ \{}}
\DoxyCodeLine{00337\ \textcolor{comment}{//\ \ \ \ \ \ stream.seekp(0);}}
\DoxyCodeLine{00338\ \textcolor{comment}{//\ \ \ \ \ \ for\ (unsigned\ int\ idx=0;\ idx<343;\ ++idx)}}
\DoxyCodeLine{00339\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ if\ (K[idx]!=NULL)\ \{}}
\DoxyCodeLine{00340\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ //\ 1)\ write\ index}}
\DoxyCodeLine{00341\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ stream.write(reinterpret\_cast<char*>(\&idx),\ sizeof(int));}}
\DoxyCodeLine{00342\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ //\ 2)\ write\ low\ rank\ (int)}}
\DoxyCodeLine{00343\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ int\ rank\ =\ LowRank[idx];}}
\DoxyCodeLine{00344\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ stream.write(reinterpret\_cast<char*>(\&rank),\ sizeof(int));}}
\DoxyCodeLine{00345\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ //\ 3)\ write\ U\ and\ V\ (both:\ rank*nnodes\ *\ FReal)}}
\DoxyCodeLine{00346\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *const\ U\ =\ K[idx];}}
\DoxyCodeLine{00347\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *const\ V\ =\ K[idx]\ +\ rank*nnodes;}}
\DoxyCodeLine{00348\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ stream.write(reinterpret\_cast<char*>(U),\ sizeof(FReal)*rank*nnodes);}}
\DoxyCodeLine{00349\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ stream.write(reinterpret\_cast<char*>(V),\ sizeof(FReal)*rank*nnodes);}}
\DoxyCodeLine{00350\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{00351\ \textcolor{comment}{//\ \ \}\ else\ throw\ std::runtime\_error("{}File\ could\ not\ be\ opened\ to\ write"{});}}
\DoxyCodeLine{00352\ \textcolor{comment}{//\ \ stream.close();}}
\DoxyCodeLine{00353\ \textcolor{comment}{//\ \ //\ write\ info}}
\DoxyCodeLine{00354\ \textcolor{comment}{//\ \ //\ \ std::cout\ <<\ "{}Compressed\ M2L\ operators\ stored\ in\ binary\ file\ "{}\ <<\ filename}}
\DoxyCodeLine{00355\ \textcolor{comment}{//\ \ //\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ "{}\ in\ "{}\ <<\ time.tacAndElapsed()\ <<\ "{}sec."{}\ <<\ std::endl;}}
\DoxyCodeLine{00356\ \textcolor{comment}{//}}
\DoxyCodeLine{00357\ \textcolor{comment}{//\ \ //\ free\ memory\ /////////////////////}}
\DoxyCodeLine{00358\ \textcolor{comment}{//\ \ for\ (unsigned\ int\ t=0;\ t<343;\ ++t)\ if\ (K[t]!=NULL)\ delete\ []\ K[t];}}
\DoxyCodeLine{00359\ \textcolor{comment}{//\}}}
\DoxyCodeLine{00360\ \textcolor{comment}{//}}
\DoxyCodeLine{00361\ \textcolor{comment}{//}}
\DoxyCodeLine{00363\ \textcolor{comment}{//\ *\ Reads\ the\ 16\ compressed\ M2L\ kernels\ from\ the\ binary\ files\ and\ writes\ them}}
\DoxyCodeLine{00364\ \textcolor{comment}{//\ *\ in\ K\ and\ the\ respective\ low-\/rank\ in\ LowRank.}}
\DoxyCodeLine{00365\ \textcolor{comment}{//\ */}}
\DoxyCodeLine{00366\ \textcolor{comment}{//template\ <int\ ORDER>}}
\DoxyCodeLine{00367\ \textcolor{comment}{//void\ ReadFromBinaryFile(const\ FReal\ Epsilon,\ FReal*\ K[343],\ int\ LowRank[343])}}
\DoxyCodeLine{00368\ \textcolor{comment}{//\{}}
\DoxyCodeLine{00369\ \textcolor{comment}{//\ \ //\ compile\ time\ constants}}
\DoxyCodeLine{00370\ \textcolor{comment}{//\ \ const\ unsigned\ int\ nnodes\ =\ ORDER*ORDER*ORDER;}}
\DoxyCodeLine{00371\ \textcolor{comment}{//\ \ }}
\DoxyCodeLine{00372\ \textcolor{comment}{//\ \ //\ find\ filename}}
\DoxyCodeLine{00373\ \textcolor{comment}{//\ \ const\ char\ precision\ =\ (typeid(FReal)==typeid(double)\ ?\ 'd'\ :\ 'f');}}
\DoxyCodeLine{00374\ \textcolor{comment}{//\ \ std::stringstream\ sstream;}}
\DoxyCodeLine{00375\ \textcolor{comment}{//\ \ sstream\ <<\ "{}sym2l\_"{}\ <<\ precision\ <<\ "{}\_o"{}\ <<\ ORDER\ <<\ "{}\_e"{}\ <<\ Epsilon\ <<\ "{}.bin"{};}}
\DoxyCodeLine{00376\ \textcolor{comment}{//\ \ const\ std::string\ filename(sstream.str());}}
\DoxyCodeLine{00377\ \textcolor{comment}{//}}
\DoxyCodeLine{00378\ \textcolor{comment}{//\ \ //\ read\ binary\ file}}
\DoxyCodeLine{00379\ \textcolor{comment}{//\ \ std::ifstream\ istream(filename.c\_str(),}}
\DoxyCodeLine{00380\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::ios::in\ |\ std::ios::binary\ |\ std::ios::ate);}}
\DoxyCodeLine{00381\ \textcolor{comment}{//\ \ const\ std::ifstream::pos\_type\ size\ =\ istream.tellg();}}
\DoxyCodeLine{00382\ \textcolor{comment}{//\ \ if\ (size<=0)\ throw\ std::runtime\_error("{}The\ requested\ binary\ file\ does\ not\ yet\ exist.\ Exit."{});}}
\DoxyCodeLine{00383\ \textcolor{comment}{//\ \ }}
\DoxyCodeLine{00384\ \textcolor{comment}{//\ \ if\ (istream.good())\ \{}}
\DoxyCodeLine{00385\ \textcolor{comment}{//\ \ \ \ \ \ istream.seekg(0);}}
\DoxyCodeLine{00386\ \textcolor{comment}{//\ \ \ \ \ \ //\ 1)\ read\ index\ (int)}}
\DoxyCodeLine{00387\ \textcolor{comment}{//\ \ \ \ \ \ int\ \_idx;}}
\DoxyCodeLine{00388\ \textcolor{comment}{//\ \ \ \ \ \ istream.read(reinterpret\_cast<char*>(\&\_idx),\ sizeof(int));}}
\DoxyCodeLine{00389\ \textcolor{comment}{//\ \ \ \ \ \ //\ loop\ to\ find\ 16\ compressed\ m2l\ operators}}
\DoxyCodeLine{00390\ \textcolor{comment}{//\ \ \ \ \ \ for\ (int\ idx=0;\ idx<343;\ ++idx)\ \{}}
\DoxyCodeLine{00391\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ K[idx]\ =\ NULL;}}
\DoxyCodeLine{00392\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ LowRank[idx]\ =\ 0;}}
\DoxyCodeLine{00393\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ //\ if\ it\ exists}}
\DoxyCodeLine{00394\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ if\ (idx\ ==\ \_idx)\ \{}}
\DoxyCodeLine{00395\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ //\ 2)\ read\ low\ rank\ (int)}}
\DoxyCodeLine{00396\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ int\ rank;}}
\DoxyCodeLine{00397\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ istream.read(reinterpret\_cast<char*>(\&rank),\ sizeof(int));}}
\DoxyCodeLine{00398\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ LowRank[idx]\ =\ rank;}}
\DoxyCodeLine{00399\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ //\ 3)\ read\ U\ and\ V\ (both:\ rank*nnodes\ *\ FReal)}}
\DoxyCodeLine{00400\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ K[idx]\ =\ new\ FReal\ [2*rank*nnodes];}}
\DoxyCodeLine{00401\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *const\ U\ =\ K[idx];}}
\DoxyCodeLine{00402\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ FReal\ *const\ V\ =\ K[idx]\ +\ rank*nnodes;}}
\DoxyCodeLine{00403\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ istream.read(reinterpret\_cast<char*>(U),\ sizeof(FReal)*rank*nnodes);}}
\DoxyCodeLine{00404\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ istream.read(reinterpret\_cast<char*>(V),\ sizeof(FReal)*rank*nnodes);}}
\DoxyCodeLine{00405\ \textcolor{comment}{//}}
\DoxyCodeLine{00406\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ //\ 1)\ read\ next\ index}}
\DoxyCodeLine{00407\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ istream.read(reinterpret\_cast<char*>(\&\_idx),\ sizeof(int));}}
\DoxyCodeLine{00408\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{00409\ \textcolor{comment}{//\ \ \ \ \ \ \}}}
\DoxyCodeLine{00410\ \textcolor{comment}{//\ \ \}\ \ \ else\ throw\ std::runtime\_error("{}File\ could\ not\ be\ opened\ to\ read"{});}}
\DoxyCodeLine{00411\ \textcolor{comment}{//\ \ istream.close();}}
\DoxyCodeLine{00412\ \textcolor{comment}{//\}}}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ }
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
